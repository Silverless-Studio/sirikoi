"use strict";jQuery(document).ready(function(n){var i=n(".main-nav").outerHeight();n(window).scroll(function(){100<=n(window).scrollTop()?(n("body").addClass("scrolled"),n(".main-nav").css("top","-"+i+"px")):(n("body").removeClass("scrolled"),n(".main-nav").css("top","0"))});var r,o,a=n(".main-nav");function e(e,t,i){var i=n(t).find(i),r=n(i).length-1,e=n(t).find(".active").index()+e;r<(e=e<0?r:e)&&(e=0),n(t).find("a.active").removeClass("active"),n(i).eq(e).addClass("active")}function t(e){var t,i;n(e).hasClass("active")||(t=n(e).closest(".tabbed-content"),i=n(e).data("tab"),n(t).find(".tabbed-content__tab").removeClass("active"),n(e).addClass("active"),n(t).find(".tabbed-content__content").slideUp(),n(t).find(`.tabbed-content__content[data-tab="${i}"]`).slideDown(),n(t).find(".tabbed-content__content-container").get(0).scrollIntoView({behavior:"smooth"}))}n(window).scroll(function(){var e=n(window).scrollTop(),t=a.height();r<(o=e)&&t+t<e?(a.css("top","-"+i+"px"),a.removeClass("solid")):o<r&&!(e<=t)&&(a.css("top","0"),a.addClass("solid")),r=o}),n(".hero__slider").slick({infinite:!0,speed:500,fade:!0,cssEase:"linear",prevArrow:n(".hero__navigation__previous"),nextArrow:n(".hero__navigation__next")}),n(".card__slider__slick").each(function(e,t){var i=n(t).closest(".card__slider").find(".card__navigation__previous"),r=n(t).closest(".card__slider").find(".card__navigation__next");n(t).slick({infinite:!0,speed:500,fade:!0,cssEase:"linear",prevArrow:n(i),nextArrow:n(r)})}),n(".section-carousel .carousel__slider.carousel__card").each(function(e,t){var i=n(t).closest(".section-carousel").find(".navigation__previous"),r=n(t).closest(".section-carousel").find(".navigation__next"),i={infinite:!0,speed:500,fade:!1,slidesToShow:3,cssEase:"linear",prevArrow:n(i),nextArrow:n(r),responsive:[{breakpoint:1200,settings:{slidesToShow:2}},{breakpoint:900,settings:{slidesToShow:1}}]};n(t).slick(i)}),n(".section-carousel:not(.sidebar__content__extended) .carousel__slider.carousel__images").each(function(e,t){var i=n(t).closest(".section-carousel").find(".navigation__previous"),r=n(t).closest(".section-carousel").find(".navigation__next"),i={infinite:!0,speed:500,fade:!1,centerMode:!0,centerPadding:"calc((100vw - 65.625rem) / 2 )",slidesToShow:1,cssEase:"linear",prevArrow:n(i),nextArrow:n(r),responsive:[{breakpoint:1200,settings:{slidesToShow:1}},{breakpoint:900,settings:{slidesToShow:1,centerPadding:"0"}}]};n(t).slick(i)}),n(".section-carousel.sidebar__content__extended .carousel__slider.carousel__images").each(function(e,t){var i=n(t).closest(".section-carousel").find(".navigation__previous"),r=n(t).closest(".section-carousel").find(".navigation__next"),i={infinite:!1,speed:500,fade:!1,slidesToShow:1.5,cssEase:"linear",prevArrow:n(i),nextArrow:n(r),responsive:[{breakpoint:900,settings:{slidesToShow:1}}]};n(t).slick(i)}),n(".testimonials__slider").each(function(e,t){var i=n(t).closest(".section-testimonials").find(".navigation__previous"),r=n(t).closest(".section-testimonials").find(".navigation__next");n(t).slick({infinite:!0,speed:500,fade:!0,cssEase:"linear",prevArrow:n(i),nextArrow:n(r)})}),n(".section-image .image__grid .navigation__previous").on("click",function(){e(-1,n(this).closest(".image__grid"),"a")}),n(".section-image .image__grid .navigation__next").on("click",function(){e(1,n(this).closest(".image__grid"),"a")}),n(".js-read-more-button").on("click",function(){var e=n(this).closest(".read-more-block");n(e).hasClass("show")?(n(this).text("Read more"),n(e).find(".ellipsis").show(),n(e).find(".read-more-content").slideUp()):(n(this).text("Read less"),n(e).find(".ellipsis").hide(),n(e).find(".read-more-content").slideDown()),n(e).toggleClass("show")}),n(".js-load-more").on("click",function(){n(this).closest(".section-image-gallery").find(".additional").slideDown(),n(this).hide()}),n(".section-video").on("click",".play-button .play",function(){var e=n(this).closest(".section-video").find("video");e.get(0).play(),n(e).attr("controls",""),n(e).removeClass("fade"),n(this).parent().hide()}),n("body").on("click",".js_scroll-next-section",function(e){e.preventDefault();var e=n(this).closest("section"),t=e.next("section"),e=e.next("div");0<t.length&&t[0].scrollIntoView({behavior:"smooth"}),0<e.length&&e[0].scrollIntoView({behavior:"smooth"})}),n("header").on("click",".mobile-burger svg",function(){n("header").addClass("mobile-menu-open")}),n("header").on("click",".menu-close svg",function(){n("header").removeClass("mobile-menu-open"),n(".sub-menu").removeClass("show")}),n("header .menu-item.menu-item-has-children").each(function(){var e=n(this),t=n(e).clone();n(t).removeClass("menu-item-has-children current-page-ancestor current-menu-ancestor current-menu-parent current-page-parent current_page_parent current_page_ancestor"),n(t).attr("id","sub-"+n(t).attr("id")),n(t).find(".sub-menu").remove(),n(e).find(".sub-menu").prepend(t)}),n("header").on("click",".menu-item a",function(e){var t=n(this).closest(".menu-item");n(t).hasClass("menu-item-has-children")&&(e.preventDefault(),n(".sub-menu").removeClass("show"),n(this).next(".sub-menu").addClass("show"))}),n(".timeline-wrapper").on("click",".timeline-event__details .label",function(){var e=this;n(e).closest(".timeline-wrapper").find(".expanded").removeClass("expanded").next().slideUp(500),n(e).toggleClass("expanded"),n(e).next().slideToggle(500,function(){n("html,body").animate({scrollTop:n(e).offset().top-130},500)})}),n(".section-accordion").on("click",".accordion__heading:not(.expanded)",function(){var e=this;n(e).closest(".section-accordion").find(".expanded").removeClass("expanded").next().slideUp(500),n(e).toggleClass("expanded"),n(e).next().slideToggle(500,function(){n("html,body").animate({scrollTop:n(e).offset().top-130},500)})}),n(".tabbed-content").on("click",".tabbed-content__tab",function(e){window.outerWidth<=900?(e.preventDefault(),e=n(this).closest(".tabbed-content__tabs"),n(e).hasClass("expanded")?(n(e).removeClass("expanded"),n(e).find(".tabbed-content__tab").not(n(this)).slideUp(300),setTimeout(()=>t(this),320)):(n(e).find(".tabbed-content__tab").slideDown({start:function(){n(this).css("display","grid")}}),n(e).addClass("expanded"))):t(this)}),n(".sidebar__navigation").on("click",".current-menu-item",function(e){window.outerWidth<=900&&(e.preventDefault(),e=n(this).closest(".sidebar__navigation"),n(e).find(".menu-item").not(n(this)).slideToggle())}),n("body").addClass("js-on");const s=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting?n(e.target).removeClass("hidden").addClass("visible"):n(e.target).removeClass("visible").addClass("hidden")})},{threshold:.5});n(".fm-above, .fm-left, .fm-right").each(function(e,t){s.observe(t)});var l,c,h,u=document.querySelector(".card__posts"),d=document.querySelector(".sidebar__filter");function p(t,i){function e(){e=t;var e={diff:e-=new Date,days:String(Math.floor(e/864e5)).padStart(2,"0"),hours:String(Math.floor(e/36e5%24)).padStart(2,"0"),minutes:String(Math.floor(e/1e3/60%60)).padStart(2,"0")};n(i).find(".countdown__display__days .value").html(e.days),n(i).find(".countdown__display__hours .value").html(e.hours),n(i).find(".countdown__display__minutes .value").html(e.minutes),e.diff<=0&&r&&(clearInterval(r),n(i).find(".countdown__display__days .value").html("00"),n(i).find(".countdown__display__hours .value").html("00"),n(i).find(".countdown__display__minutes .value").html("00"))}e();const r=setInterval(e,6e4)}u&&d&&(l=d.querySelectorAll('input[type="checkbox"]'),c=u.dataset.pagination,h=mixitup(u,c?{pagination:{limit:c},templates:{pagerPrev:'<button type="button" class="${classNames}" data-page="prev">Prev</button>',pagerNext:'<button type="button" class="${classNames}" data-page="next">Next</button>'}}:{}),d.addEventListener("change",function(){for(var e=[],t=0;t<l.length;t++){var i=l[t];i.checked&&e.push("."+i.value)}var r=0<e.length?e.join(","):"all";h.filter(r)})),n(".section-countdown").each(function(){var e,t=n(this),t=n(t).find(".countdown__display");t&&(e=n(t).data("target"),p(new Date(e),t))}),n(".hero .play-container > *").on("click",function(e){e.preventDefault();e=n(this).closest(".play-container").data("video-id");n(`.hero-video-modal[data-video-id='${e}']`).addClass("show"),n(`.hero-video-modal[data-video-id='${e}'] > video`).trigger("play")}),n(".hero-video-modal .close").on("click",function(e){e.preventDefault(),n(this).closest(".hero-video-modal").removeClass("show"),n(this).closest(".hero-video-modal").find("video").trigger("pause"),n(this).closest(".hero-video-modal").find("video").get(0).currentTime=0})});const headings=document.querySelectorAll(".heading__xxl, .heading__xl");function handleIntersection(e){e.forEach(e=>{e.isIntersecting&&e.target.classList.add("in-view")})}const observer=new IntersectionObserver(handleIntersection,{root:null,threshold:.5});headings.forEach(e=>{observer.observe(e)}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".pre-trigger"),t=document.querySelector(".prep-trigger"),i=document.querySelector(".contact-trigger"),r=document.querySelector(".about-trigger"),n=document.querySelector(".offcanvas-menu--pre"),o=document.querySelector(".offcanvas-menu--pre-prep"),a=document.querySelector(".offcanvas-menu--contact"),s=document.querySelector(".offcanvas-menu--about"),l=document.querySelectorAll(".menu-close-sub");e.forEach(function(e){e.addEventListener("click",function(){n.classList.add("active"),o.classList.remove("active")})}),t.addEventListener("click",function(){o.classList.add("active"),n.classList.remove("active")}),i.addEventListener("click",function(){a.classList.add("active"),n.classList.remove("active")}),r.addEventListener("click",function(){s.classList.add("active"),n.classList.remove("active")}),l.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),n.classList.remove("active"),o.classList.remove("active"),a.classList.remove("active"),s.classList.remove("active")})})}),function(d){for(var p,n,o,a,s,f=null,e=["webkit","moz","o","ms"],t=d.document.createElement("div"),i=-1,i=0;i<e.length&&!d.requestAnimationFrame;i++)d.requestAnimationFrame=d[e[i]+"RequestAnimationFrame"];function r(){}void 0===t.nextElementSibling&&Object.defineProperty(d.Element.prototype,"nextElementSibling",{get:function(){for(var e=this.nextSibling;e;){if(1===e.nodeType)return e;e=e.nextSibling}return null}}),(t=d.Element.prototype).matches=t.matches||t.machesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector||function(e){return-1<Array.prototype.indexOf.call(this.parentElement.querySelectorAll(e),this)},Object.keys||(Object.keys=(o=Object.prototype.hasOwnProperty,a=!{toString:null}.propertyIsEnumerable("toString"),s=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){var t=[],i="",r=-1;if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");for(i in e)o.call(e,i)&&t.push(i);if(a)for(r=0;r<s;r++)o.call(e,n[r])&&t.push(n[r]);return t})),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"function"!=typeof Object.create&&(Object.create=function(e,t){if(e!==Object(e)&&null!==e)throw TypeError("Argument must be an object, or null");r.prototype=e||{};var i=new r;return r.prototype=null,void 0!==t&&Object.defineProperties(i,t),null===e&&(i.__proto__=null),i}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t,i,r,n;if(null===this)throw new TypeError;if(0!=(n=(r=Object(this)).length>>>0)&&(t=0,1<arguments.length&&((t=Number(arguments[1]))!=t?t=0:0!==t&&t!==1/0&&t!==-1/0&&(t=(0<t||-1)*Math.floor(Math.abs(t)))),!(n<=t)))for(i=0<=t?t:Math.max(n-Math.abs(t),0);i<n;i++)if(i in r&&r[i]===e)return i;return-1}),Function.prototype.bind||(Function.prototype.bind=function(e){var t,i,r,n;if("function"!=typeof this)throw new TypeError;return t=Array.prototype.slice.call(arguments,1),r=function(){},n=function(){return i.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))},(i=this).prototype&&(r.prototype=this.prototype),n.prototype=new r,n}),d.Element.prototype.dispatchEvent||(d.Element.prototype.dispatchEvent=function(e){try{return this.fireEvent("on"+e.type,e)}catch(e){}}),(p=function(e,t,i){var r,n=null,o=!1,a=null,s=null,l=[],c="",h=[],u=-1,s=i||d.document,o=(o=arguments[3])&&"boolean"==typeof o;if("string"==typeof e)h=s.querySelectorAll(e);else if(e&&"object"==typeof e&&f.isElement(e,s))h=[e];else{if(!e||"object"!=typeof e||!e.length)throw new Error(p.messages.errorFactoryInvalidContainer());h=e}if(h.length<1)throw new Error(p.messages.errorFactoryContainerNotFound());for(u=0;(n=h[u])&&(!(0<u)||o);u++)n.id?c=n.id:(c="MixItUp"+f.randomHex(),n.id=c),p.instances[c]instanceof p.Mixer?(a=p.instances[c],(!t||t.debug&&!1!==t.debug.showWarnings)&&console.warn(p.messages.warningFactoryPreexistingInstance())):((a=new p.Mixer).attach(n,s,c,t),p.instances[c]=a),r=new p.Facade(a),t&&t.debug&&t.debug.enable?l.push(a):l.push(r);return o?new p.Collection(l):l[0]}).use=function(e){p.Base.prototype.callActions.call(p,"beforeUse",arguments),"function"==typeof e&&"mixitup-extension"===e.TYPE?void 0===p.extensions[e.NAME]&&(e(p),p.extensions[e.NAME]=e):e.fn&&e.fn.jquery&&(p.libraries.$=e),p.Base.prototype.callActions.call(p,"afterUse",arguments)},p.instances={},p.extensions={},p.libraries={},f={hasClass:function(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=e.className?" "+t:t)},removeClass:function(e,t){this.hasClass(e,t)&&(t=new RegExp("(\\s|^)"+t+"(\\s|$)"),e.className=e.className.replace(t," ").trim())},extend:function(t,e,i,r){var n,o=[],a=-1;i=i||!1,r=r||!1;try{if(Array.isArray(e))for(a=0;a<e.length;a++)o.push(a);else e&&(o=Object.keys(e));for(a=0;a<o.length;a++)n=o[a],!i||"object"!=typeof e[n]||this.isElement(e[n])?t[n]=e[n]:(Array.isArray(e[n])?t[n]||(t[n]=[]):t[n]||(t[n]={}),this.extend(t[n],e[n],i,r))}catch(e){if(!r)throw e;this.handleExtendError(e,t)}return t},handleExtendError:function(e,t){var i=null,r="",n="",o="",a="",s=-1,l=-1;if(e instanceof TypeError&&(i=/property "?(\w*)"?[,:] object/i.exec(e.message))){for(a in r=i[1],t){for(l=0;l<r.length&&r.charAt(l)===a.charAt(l);)l++;s<l&&(s=l,o=a)}throw 1<s&&(n=p.messages.errorConfigInvalidPropertySuggestion({probableMatch:o})),i=p.messages.errorConfigInvalidProperty({erroneous:r,suggestion:n}),new TypeError(i)}throw e},template:function(r){for(var e,t=/\${([\w]*)}/g,n={};e=t.exec(r);)n[e[1]]=new RegExp("\\${"+e[1]+"}","g");return function(e){var t="",i=r;for(t in e=e||{},n)i=i.replace(n[t],void 0!==e[t]?e[t]:"");return i}},on:function(e,t,i,r){e&&(e.addEventListener?e.addEventListener(t,i,r):e.attachEvent&&(e["e"+t+i]=i,e[t+i]=function(){e["e"+t+i](d.event)},e.attachEvent("on"+t,e[t+i])))},off:function(e,t,i){e&&(e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&(e.detachEvent("on"+t,e[t+i]),e[t+i]=null))},getCustomEvent:function(e,t,i){var r=null;return i=i||d.document,"function"==typeof d.CustomEvent?r=new d.CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):"function"==typeof i.createEvent?(r=i.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t):((r=i.createEventObject()).type=e,r.returnValue=!1,r.cancelBubble=!1,r.detail=t),r},getOriginalEvent:function(e){return e.touches&&e.touches.length?e.touches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e},index:function(e,t){for(var i=0;null!==(e=e.previousElementSibling);)t&&!e.matches(t)||++i;return i},camelCase:function(e){return e.toLowerCase().replace(/([_-][a-z])/g,function(e){return e.toUpperCase().replace(/[_-]/,"")})},pascalCase:function(e){return(e=this.camelCase(e)).charAt(0).toUpperCase()+e.slice(1)},dashCase:function(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()},isElement:function(e,t){return t=t||d.document,!!(d.HTMLElement&&e instanceof d.HTMLElement)||!!(t.defaultView&&t.defaultView.HTMLElement&&e instanceof t.defaultView.HTMLElement)||null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},createElement:function(e,t){var i=null,r=null,i=(t=t||d.document).createDocumentFragment();for((r=t.createElement("div")).innerHTML=e.trim();r.firstChild;)i.appendChild(r.firstChild);return i},removeWhitespace:function(e){for(var t;e&&"#text"===e.nodeName;)e=(t=e).previousSibling,t.parentElement&&t.parentElement.removeChild(t)},isEqualArray:function(e,t){var i=e.length;if(i!==t.length)return!1;for(;i--;)if(e[i]!==t[i])return!1;return!0},deepEquals:function(e,t){if("object"==typeof e&&e&&"object"==typeof t&&t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(!t.hasOwnProperty(i)||!this.deepEquals(e[i],t[i]))return!1}else if(e!==t)return!1;return!0},arrayShuffle:function(e){for(var t,i,r=e.slice(),n=r.length,o=n;o--;)t=~~(Math.random()*n),i=r[o],r[o]=r[t],r[t]=i;return r},arrayFromList:function(t){var i,r;try{return Array.prototype.slice.call(t)}catch(e){for(i=[],r=0;r<t.length;r++)i.push(t[r]);return i}},debounce:function(n,o,a){var s;return function(){var e=this,t=arguments,i=a&&!s,r=function(){s=null,a||n.apply(e,t)};clearTimeout(s),s=setTimeout(r,o),i&&n.apply(e,t)}},position:function(e){for(var t=0,i=0,r=e;e;)t-=e.scrollLeft,i-=e.scrollTop,e===r&&(t+=e.offsetLeft,i+=e.offsetTop,r=e.offsetParent),e=e.parentElement;return{x:t,y:i}},getHypotenuse:function(e,t){var i=(i=e.x-t.x)<0?-1*i:i,e=(e=e.y-t.y)<0?-1*e:e;return Math.sqrt(Math.pow(i,2)+Math.pow(e,2))},getIntersectionRatio:function(e,t){var i=e.width*e.height,r=Math.max(0,Math.min(e.left+e.width,t.left+t.width)-Math.max(e.left,t.left));return Math.max(0,Math.min(e.top+e.height,t.top+t.height)-Math.max(e.top,t.top))*r/i},closestParent:function(e,t,i,r){var n=e.parentNode;if(r=r||d.document,i&&e.matches(t))return e;for(;n&&n!=r.body;){if(n.matches&&n.matches(t))return n;if(!n.parentNode)return null;n=n.parentNode}return null},children:function(e,t,i){var r=[],n="";return i=i||d.doc,e&&(e.id||(n="Temp"+this.randomHexKey(),e.id=n),r=i.querySelectorAll("#"+e.id+" > "+t),n)&&e.removeAttribute("id"),r},clean:function(e){for(var t=[],i=-1,i=0;i<e.length;i++)""!==e[i]&&t.push(e[i]);return t},defer:function(e){var t=null,i=null,r=null,i=new this.Deferred;return p.features.has.promises?i.promise=new Promise(function(e,t){i.resolve=e,i.reject=t}):(r=d.jQuery||e.$)&&"function"==typeof r.Deferred?(t=r.Deferred(),i.promise=t.promise(),i.resolve=t.resolve,i.reject=t.reject):d.console&&console.warn(p.messages.warningNoPromiseImplementation()),i},all:function(e,t){var i=null;return p.features.has.promises?Promise.all(e):(i=d.jQuery||t.$)&&"function"==typeof i.when?i.when.apply(i,e).done(function(){return arguments}):(d.console&&console.warn(p.messages.warningNoPromiseImplementation()),[])},getPrefix:function(e,t,i){var r=-1,n="";if(f.dashCase(t)in e.style)return"";for(r=0;n=i[r];r++)if(n+t in e.style)return n.toLowerCase();return"unsupported"},randomHex:function(){return("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase()},getDocumentState:function(e){return e="object"==typeof e.body?e:d.document,{scrollTop:d.pageYOffset,scrollLeft:d.pageXOffset,docHeight:e.documentElement.scrollHeight,docWidth:e.documentElement.scrollWidth,viewportHeight:e.documentElement.clientHeight,viewportWidth:e.documentElement.clientWidth}},bind:function(e,t){return function(){return t.apply(e,arguments)}},isVisible:function(e){return!!e.offsetParent||"fixed"===(e=d.getComputedStyle(e)).position&&"hidden"!==e.visibility&&"0"!==e.opacity},seal:function(e){"function"==typeof Object.seal&&Object.seal(e)},freeze:function(e){"function"==typeof Object.freeze&&Object.freeze(e)},compareVersions:function(e,t){for(var i,r,n=e.split("."),o=t.split("."),a=-1,a=0;a<n.length;a++){if(i=parseInt(n[a].replace(/[^\d.]/g,"")),(r=parseInt(o[a].replace(/[^\d.]/g,"")||0))<i)return!1;if(i<r)return!0}return!0},Deferred:function(){this.promise=null,this.resolve=null,this.reject=null,this.id=f.randomHex()},isEmptyObject:function(e){var t="";if("function"==typeof Object.keys)return 0===Object.keys(e).length;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},getClassname:function(e,t,i){var r="";return(r+=e.block).length&&(r+=e.delineatorElement),r+=e["element"+this.pascalCase(t)],i?(r.length&&(r+=e.delineatorModifier),r+i):r},getProperty:function(e,t){var i,r=t.split("."),n="",o=0;if(!t)return e;for(i=function(e){return e?e[n]:null};o<r.length;)n=r[o],e=i(e),o++;return void 0!==e?e:null}},p.h=f,(p.Base=function(){}).prototype={constructor:p.Base,callActions:function(e,t){var i=this.constructor.actions[e],r="";if(i&&!f.isEmptyObject(i))for(r in i)i[r].apply(this,t)},callFilters:function(e,t,i){var r=this.constructor.filters[e],n=t,o="";if(r&&!f.isEmptyObject(r))for(o in i=i||[],r)i=f.arrayFromList(i),i.unshift(n),n=r[o].apply(this,i);return n}},(p.BaseStatic=function(){this.actions={},this.filters={},this.extend=function(e){f.extend(this.prototype,e)},this.registerAction=function(e,t,i){(this.actions[e]=this.actions[e]||{})[t]=i},this.registerFilter=function(e,t,i){(this.filters[e]=this.filters[e]||{})[t]=i}}).call(p.Features=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.boxSizingPrefix="",this.transformPrefix="",this.transitionPrefix="",this.boxSizingPrefix="",this.transformProp="",this.transformRule="",this.transitionProp="",this.perspectiveProp="",this.perspectiveOriginProp="",this.has=new p.Has,this.canary=null,this.BOX_SIZING_PROP="boxSizing",this.TRANSITION_PROP="transition",this.TRANSFORM_PROP="transform",this.PERSPECTIVE_PROP="perspective",this.PERSPECTIVE_ORIGIN_PROP="perspectiveOrigin",this.VENDORS=["Webkit","moz","O","ms"],this.TWEENABLE=["opacity","width","height","marginRight","marginBottom","x","y","scale","translateX","translateY","translateZ","rotateX","rotateY","rotateZ"],this.callActions("afterConstruct")}),p.Features.prototype=Object.create(p.Base.prototype),f.extend(p.Features.prototype,{constructor:p.Features,init:function(){var e=this;e.callActions("beforeInit",arguments),e.canary=document.createElement("div"),e.setPrefixes(),e.runTests(),e.callActions("beforeInit",arguments)},runTests:function(){var e=this;e.callActions("beforeRunTests",arguments),e.has.promises="function"==typeof d.Promise,e.has.transitions="unsupported"!==e.transitionPrefix,e.callActions("afterRunTests",arguments),f.freeze(e.has)},setPrefixes:function(){var e=this;e.callActions("beforeSetPrefixes",arguments),e.transitionPrefix=f.getPrefix(e.canary,"Transition",e.VENDORS),e.transformPrefix=f.getPrefix(e.canary,"Transform",e.VENDORS),e.boxSizingPrefix=f.getPrefix(e.canary,"BoxSizing",e.VENDORS),e.boxSizingProp=e.boxSizingPrefix?e.boxSizingPrefix+f.pascalCase(e.BOX_SIZING_PROP):e.BOX_SIZING_PROP,e.transitionProp=e.transitionPrefix?e.transitionPrefix+f.pascalCase(e.TRANSITION_PROP):e.TRANSITION_PROP,e.transformProp=e.transformPrefix?e.transformPrefix+f.pascalCase(e.TRANSFORM_PROP):e.TRANSFORM_PROP,e.transformRule=e.transformPrefix?"-"+e.transformPrefix+"-"+e.TRANSFORM_PROP:e.TRANSFORM_PROP,e.perspectiveProp=e.transformPrefix?e.transformPrefix+f.pascalCase(e.PERSPECTIVE_PROP):e.PERSPECTIVE_PROP,e.perspectiveOriginProp=e.transformPrefix?e.transformPrefix+f.pascalCase(e.PERSPECTIVE_ORIGIN_PROP):e.PERSPECTIVE_ORIGIN_PROP,e.callActions("afterSetPrefixes",arguments)}}),p.Has=function(){this.transitions=!1,this.promises=!1,f.seal(this)},(p.features=new p.Features).init(),p.BaseStatic.call(p.ConfigAnimation=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.enable=!0,this.effects="fade scale",this.effectsIn="",this.effectsOut="",this.duration=600,this.easing="ease",this.applyPerspective=!0,this.perspectiveDistance="3000px",this.perspectiveOrigin="50% 50%",this.queue=!0,this.queueLimit=3,this.animateResizeContainer=!0,this.animateResizeTargets=!1,this.staggerSequence=null,this.reverseOut=!1,this.nudge=!0,this.clampHeight=!0,this.clampWidth=!0,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigAnimation.prototype=Object.create(p.Base.prototype),p.ConfigAnimation.prototype.constructor=p.ConfigAnimation,p.BaseStatic.call(p.ConfigBehavior=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.liveSort=!1,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigBehavior.prototype=Object.create(p.Base.prototype),p.ConfigBehavior.prototype.constructor=p.ConfigBehavior,p.BaseStatic.call(p.ConfigCallbacks=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.onMixStart=null,this.onMixBusy=null,this.onMixEnd=null,this.onMixFail=null,this.onMixClick=null,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigCallbacks.prototype=Object.create(p.Base.prototype),p.ConfigCallbacks.prototype.constructor=p.ConfigCallbacks,p.BaseStatic.call(p.ConfigControls=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.enable=!0,this.live=!1,this.scope="global",this.toggleLogic="or",this.toggleDefault="all",this.callActions("afterConstruct"),f.seal(this)}),p.ConfigControls.prototype=Object.create(p.Base.prototype),p.ConfigControls.prototype.constructor=p.ConfigControls,p.BaseStatic.call(p.ConfigClassNames=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.block="mixitup",this.elementContainer="container",this.elementFilter="control",this.elementSort="control",this.elementMultimix="control",this.elementToggle="control",this.modifierActive="active",this.modifierDisabled="disabled",this.modifierFailed="failed",this.delineatorElement="-",this.delineatorModifier="-",this.callActions("afterConstruct"),f.seal(this)}),p.ConfigClassNames.prototype=Object.create(p.Base.prototype),p.ConfigClassNames.prototype.constructor=p.ConfigClassNames,p.BaseStatic.call(p.ConfigData=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.uidKey="",this.dirtyCheck=!1,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigData.prototype=Object.create(p.Base.prototype),p.ConfigData.prototype.constructor=p.ConfigData,p.BaseStatic.call(p.ConfigDebug=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.enable=!1,this.showWarnings=!0,this.fauxAsync=!1,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigDebug.prototype=Object.create(p.Base.prototype),p.ConfigDebug.prototype.constructor=p.ConfigDebug,p.BaseStatic.call(p.ConfigLayout=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.allowNestedTargets=!0,this.containerClassName="",this.siblingBefore=null,this.siblingAfter=null,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigLayout.prototype=Object.create(p.Base.prototype),p.ConfigLayout.prototype.constructor=p.ConfigLayout,p.BaseStatic.call(p.ConfigLoad=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.filter="all",this.sort="default:asc",this.dataset=null,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigLoad.prototype=Object.create(p.Base.prototype),p.ConfigLoad.prototype.constructor=p.ConfigLoad,p.BaseStatic.call(p.ConfigSelectors=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.target=".mix",this.control="",this.callActions("afterConstruct"),f.seal(this)}),p.ConfigSelectors.prototype=Object.create(p.Base.prototype),p.ConfigSelectors.prototype.constructor=p.ConfigSelectors,p.BaseStatic.call(p.ConfigRender=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.target=null,this.callActions("afterConstruct"),f.seal(this)}),p.ConfigRender.prototype=Object.create(p.Base.prototype),p.ConfigRender.prototype.constructor=p.ConfigRender,p.BaseStatic.call(p.ConfigTemplates=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.callActions("afterConstruct"),f.seal(this)}),p.ConfigTemplates.prototype=Object.create(p.Base.prototype),p.ConfigTemplates.prototype.constructor=p.ConfigTemplates,p.BaseStatic.call(p.Config=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.animation=new p.ConfigAnimation,this.behavior=new p.ConfigBehavior,this.callbacks=new p.ConfigCallbacks,this.controls=new p.ConfigControls,this.classNames=new p.ConfigClassNames,this.data=new p.ConfigData,this.debug=new p.ConfigDebug,this.layout=new p.ConfigLayout,this.load=new p.ConfigLoad,this.selectors=new p.ConfigSelectors,this.render=new p.ConfigRender,this.templates=new p.ConfigTemplates,this.callActions("afterConstruct"),f.seal(this)}),p.Config.prototype=Object.create(p.Base.prototype),p.Config.prototype.constructor=p.Config,p.BaseStatic.call(p.MixerDom=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.document=null,this.body=null,this.container=null,this.parent=null,this.targets=[],this.callActions("afterConstruct"),f.seal(this)}),p.MixerDom.prototype=Object.create(p.Base.prototype),p.MixerDom.prototype.constructor=p.MixerDom,p.BaseStatic.call(p.UiClassNames=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.base="",this.active="",this.disabled="",this.callActions("afterConstruct"),f.seal(this)}),p.UiClassNames.prototype=Object.create(p.Base.prototype),p.UiClassNames.prototype.constructor=p.UiClassNames,p.BaseStatic.call(p.CommandDataset=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.dataset=null,this.callActions("afterConstruct"),f.seal(this)}),p.CommandDataset.prototype=Object.create(p.Base.prototype),p.CommandDataset.prototype.constructor=p.CommandDataset,p.BaseStatic.call(p.CommandMultimix=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.filter=null,this.sort=null,this.insert=null,this.remove=null,this.changeLayout=null,this.callActions("afterConstruct"),f.seal(this)}),p.CommandMultimix.prototype=Object.create(p.Base.prototype),p.CommandMultimix.prototype.constructor=p.CommandMultimix,p.BaseStatic.call(p.CommandFilter=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.selector="",this.collection=null,this.action="show",this.callActions("afterConstruct"),f.seal(this)}),p.CommandFilter.prototype=Object.create(p.Base.prototype),p.CommandFilter.prototype.constructor=p.CommandFilter,p.BaseStatic.call(p.CommandSort=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.sortString="",this.attribute="",this.order="asc",this.collection=null,this.next=null,this.callActions("afterConstruct"),f.seal(this)}),p.CommandSort.prototype=Object.create(p.Base.prototype),p.CommandSort.prototype.constructor=p.CommandSort,p.BaseStatic.call(p.CommandInsert=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.index=0,this.collection=[],this.position="before",this.sibling=null,this.callActions("afterConstruct"),f.seal(this)}),p.CommandInsert.prototype=Object.create(p.Base.prototype),p.CommandInsert.prototype.constructor=p.CommandInsert,p.BaseStatic.call(p.CommandRemove=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.targets=[],this.collection=[],this.callActions("afterConstruct"),f.seal(this)}),p.CommandRemove.prototype=Object.create(p.Base.prototype),p.CommandRemove.prototype.constructor=p.CommandRemove,p.BaseStatic.call(p.CommandChangeLayout=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.containerClassName="",this.callActions("afterConstruct"),f.seal(this)}),p.CommandChangeLayout.prototype=Object.create(p.Base.prototype),p.CommandChangeLayout.prototype.constructor=p.CommandChangeLayout,p.BaseStatic.call(p.ControlDefinition=function(e,t,i,r){p.Base.call(this),this.callActions("beforeConstruct"),this.type=e,this.selector=t,this.live=i||!1,this.parent=r||"",this.callActions("afterConstruct"),f.freeze(this),f.seal(this)}),p.ControlDefinition.prototype=Object.create(p.Base.prototype),p.ControlDefinition.prototype.constructor=p.ControlDefinition,(p.controlDefinitions=[]).push(new p.ControlDefinition("multimix","[data-filter][data-sort]")),p.controlDefinitions.push(new p.ControlDefinition("filter","[data-filter]")),p.controlDefinitions.push(new p.ControlDefinition("sort","[data-sort]")),p.controlDefinitions.push(new p.ControlDefinition("toggle","[data-toggle]")),p.BaseStatic.call(p.Control=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.el=null,this.selector="",this.bound=[],this.pending=-1,this.type="",this.status="inactive",this.filter="",this.sort="",this.canDisable=!1,this.handler=null,this.classNames=new p.UiClassNames,this.callActions("afterConstruct"),f.seal(this)}),p.Control.prototype=Object.create(p.Base.prototype),f.extend(p.Control.prototype,{constructor:p.Control,init:function(e,t,i){var r=this;if(this.callActions("beforeInit",arguments),r.el=e,r.type=t,r.selector=i,r.selector)r.status="live";else switch(r.canDisable="boolean"==typeof r.el.disable,r.type){case"filter":r.filter=r.el.getAttribute("data-filter");break;case"toggle":r.filter=r.el.getAttribute("data-toggle");break;case"sort":r.sort=r.el.getAttribute("data-sort");break;case"multimix":r.filter=r.el.getAttribute("data-filter"),r.sort=r.el.getAttribute("data-sort")}r.bindClick(),p.controls.push(r),this.callActions("afterInit",arguments)},isBound:function(e){return this.callActions("beforeIsBound",arguments),e=-1<this.bound.indexOf(e),this.callFilters("afterIsBound",e,arguments)},addBinding:function(e){this.callActions("beforeAddBinding",arguments),this.isBound()||this.bound.push(e),this.callActions("afterAddBinding",arguments)},removeBinding:function(e){var t=this;this.callActions("beforeRemoveBinding",arguments),-1<(e=t.bound.indexOf(e))&&t.bound.splice(e,1),t.bound.length<1&&(t.unbindClick(),e=p.controls.indexOf(t),p.controls.splice(e,1),"active"===t.status)&&t.renderStatus(t.el,"inactive"),this.callActions("afterRemoveBinding",arguments)},bindClick:function(){var t=this;this.callActions("beforeBindClick",arguments),t.handler=function(e){t.handleClick(e)},f.on(t.el,"click",t.handler),this.callActions("afterBindClick",arguments)},unbindClick:function(){this.callActions("beforeUnbindClick",arguments),f.off(this.el,"click",this.handler),this.handler=null,this.callActions("afterUnbindClick",arguments)},handleClick:function(e){var t,i=this,r=null,n=null,o=!1,a={},s=[],l=-1;if(this.callActions("beforeHandleClick",arguments),this.pending=0,n=i.bound[0],r=i.selector?f.closestParent(e.target,n.config.selectors.control+i.selector,!0,n.dom.document):i.el){switch(i.type){case"filter":a.filter=i.filter||r.getAttribute("data-filter");break;case"sort":a.sort=i.sort||r.getAttribute("data-sort");break;case"multimix":a.filter=i.filter||r.getAttribute("data-filter"),a.sort=i.sort||r.getAttribute("data-sort");break;case"toggle":a.filter=i.filter||r.getAttribute("data-toggle"),o="live"===i.status?f.hasClass(r,i.classNames.active):"active"===i.status}for(l=0;l<i.bound.length;l++)t=new p.CommandMultimix,f.extend(t,a),s.push(t);for(s=i.callFilters("commandsHandleClick",s,arguments),i.pending=i.bound.length,l=0;n=i.bound[l];l++)(a=s[l])&&(n.lastClicked||(n.lastClicked=r),p.events.fire("mixClick",n.dom.container,{state:n.state,instance:n,originalEvent:e,control:n.lastClicked},n.dom.document),"function"==typeof n.config.callbacks.onMixClick&&!1===n.config.callbacks.onMixClick.call(n.lastClicked,n.state,e,n)||("toggle"===i.type?o?n.toggleOff(a.filter):n.toggleOn(a.filter):n.multimix(a)));this.callActions("afterHandleClick",arguments)}else i.callActions("afterHandleClick",arguments)},update:function(e,t){var i=this,r=new p.CommandMultimix;i.callActions("beforeUpdate",arguments),i.pending--,i.pending=Math.max(0,i.pending),0<i.pending||("live"===i.status?i.updateLive(e,t):(r.sort=i.sort,r.filter=i.filter,i.callFilters("actionsUpdate",r,arguments),i.parseStatusChange(i.el,e,r,t)),i.callActions("afterUpdate",arguments))},updateLive:function(e,t){var i,r=this,n=null,o=null,a=-1;if(r.callActions("beforeUpdateLive",arguments),r.el){for(i=r.el.querySelectorAll(r.selector),a=0;o=i[a];a++){switch(n=new p.CommandMultimix,r.type){case"filter":n.filter=o.getAttribute("data-filter");break;case"sort":n.sort=o.getAttribute("data-sort");break;case"multimix":n.filter=o.getAttribute("data-filter"),n.sort=o.getAttribute("data-sort");break;case"toggle":n.filter=o.getAttribute("data-toggle")}n=r.callFilters("actionsUpdateLive",n,arguments),r.parseStatusChange(o,e,n,t)}r.callActions("afterUpdateLive",arguments)}},parseStatusChange:function(e,t,i,r){var n=this,o="",a=-1;switch(n.callActions("beforeParseStatusChange",arguments),n.type){case"filter":t.filter===i.filter?n.renderStatus(e,"active"):n.renderStatus(e,"inactive");break;case"multimix":t.sort===i.sort&&t.filter===i.filter?n.renderStatus(e,"active"):n.renderStatus(e,"inactive");break;case"sort":t.sort.match(/:asc/g)&&(o=t.sort.replace(/:asc/g,"")),t.sort===i.sort||o===i.sort?n.renderStatus(e,"active"):n.renderStatus(e,"inactive");break;case"toggle":for(r.length<1&&n.renderStatus(e,"inactive"),t.filter===i.filter&&n.renderStatus(e,"active"),a=0;a<r.length;a++){if(r[a]===i.filter){n.renderStatus(e,"active");break}n.renderStatus(e,"inactive")}}n.callActions("afterParseStatusChange",arguments)},renderStatus:function(e,t){var i=this;switch(i.callActions("beforeRenderStatus",arguments),t){case"active":f.addClass(e,i.classNames.active),f.removeClass(e,i.classNames.disabled),i.canDisable&&(i.el.disabled=!1);break;case"inactive":f.removeClass(e,i.classNames.active),f.removeClass(e,i.classNames.disabled),i.canDisable&&(i.el.disabled=!1);break;case"disabled":i.canDisable&&(i.el.disabled=!0),f.addClass(e,i.classNames.disabled),f.removeClass(e,i.classNames.active)}"live"!==i.status&&(i.status=t),i.callActions("afterRenderStatus",arguments)}}),p.controls=[],p.BaseStatic.call(p.StyleData=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.marginRight=0,this.marginBottom=0,this.opacity=0,this.scale=new p.TransformData,this.translateX=new p.TransformData,this.translateY=new p.TransformData,this.translateZ=new p.TransformData,this.rotateX=new p.TransformData,this.rotateY=new p.TransformData,this.rotateZ=new p.TransformData,this.callActions("afterConstruct"),f.seal(this)}),p.StyleData.prototype=Object.create(p.Base.prototype),p.StyleData.prototype.constructor=p.StyleData,p.BaseStatic.call(p.TransformData=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.value=0,this.unit="",this.callActions("afterConstruct"),f.seal(this)}),p.TransformData.prototype=Object.create(p.Base.prototype),p.TransformData.prototype.constructor=p.TransformData,p.BaseStatic.call(p.TransformDefaults=function(){p.StyleData.apply(this),this.callActions("beforeConstruct"),this.scale.value=.01,this.scale.unit="",this.translateX.value=20,this.translateX.unit="px",this.translateY.value=20,this.translateY.unit="px",this.translateZ.value=20,this.translateZ.unit="px",this.rotateX.value=90,this.rotateX.unit="deg",this.rotateY.value=90,this.rotateY.unit="deg",this.rotateX.value=90,this.rotateX.unit="deg",this.rotateZ.value=180,this.rotateZ.unit="deg",this.callActions("afterConstruct"),f.seal(this)}),p.TransformDefaults.prototype=Object.create(p.StyleData.prototype),p.TransformDefaults.prototype.constructor=p.TransformDefaults,p.transformDefaults=new p.TransformDefaults,p.EventDetail=function(){this.state=null,this.futureState=null,this.instance=null,this.originalEvent=null},p.BaseStatic.call(p.Events=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.mixStart=null,this.mixBusy=null,this.mixEnd=null,this.mixFail=null,this.mixClick=null,this.callActions("afterConstruct"),f.seal(this)}),p.Events.prototype=Object.create(p.Base.prototype),p.Events.prototype.constructor=p.Events,p.Events.prototype.fire=function(e,t,i,r){var n=new p.EventDetail;if(this.callActions("beforeFire",arguments),void 0===this[e])throw new Error('Event type "'+e+'" not found.');n.state=new p.State,f.extend(n.state,i.state),i.futureState&&(n.futureState=new p.State,f.extend(n.futureState,i.futureState)),n.instance=i.instance,i.originalEvent&&(n.originalEvent=i.originalEvent),i=f.getCustomEvent(e,n,r),this.callFilters("eventFire",i,arguments),t.dispatchEvent(i)},p.events=new p.Events,p.BaseStatic.call(p.QueueItem=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.args=[],this.instruction=null,this.triggerElement=null,this.deferred=null,this.isToggling=!1,this.callActions("afterConstruct"),f.seal(this)}),p.QueueItem.prototype=Object.create(p.Base.prototype),p.QueueItem.prototype.constructor=p.QueueItem,p.BaseStatic.call(p.Mixer=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.config=new p.Config,this.id="",this.isBusy=!1,this.isToggling=!1,this.incPadding=!0,this.controls=[],this.targets=[],this.origOrder=[],this.cache={},this.toggleArray=[],this.targetsMoved=0,this.targetsImmovable=0,this.targetsBound=0,this.targetsDone=0,this.staggerDuration=0,this.effectsIn=null,this.effectsOut=null,this.transformIn=[],this.transformOut=[],this.queue=[],this.state=null,this.lastOperation=null,this.lastClicked=null,this.userCallback=null,this.userDeferred=null,this.dom=new p.MixerDom,this.callActions("afterConstruct"),f.seal(this)}),p.Mixer.prototype=Object.create(p.Base.prototype),f.extend(p.Mixer.prototype,{constructor:p.Mixer,attach:function(e,t,i,r){var n=this,o=null,a=-1;for(n.callActions("beforeAttach",arguments),n.id=i,r&&f.extend(n.config,r,!0,!0),n.sanitizeConfig(),n.cacheDom(e,t),n.config.layout.containerClassName&&f.addClass(n.dom.container,n.config.layout.containerClassName),p.features.has.transitions||(n.config.animation.enable=!1),void 0===d.console&&(n.config.debug.showWarnings=!1),n.config.data.uidKey&&(n.config.controls.enable=!1),n.indexTargets(),n.state=n.getInitialState(),a=0;o=n.lastOperation.toHide[a];a++)o.hide();n.config.controls.enable&&(n.initControls(),n.buildToggleArray(null,n.state),n.updateControls({filter:n.state.activeFilter,sort:n.state.activeSort})),n.parseEffects(),n.callActions("afterAttach",arguments)},sanitizeConfig:function(){var e=this;e.callActions("beforeSanitizeConfig",arguments),e.config.controls.scope=e.config.controls.scope.toLowerCase().trim(),e.config.controls.toggleLogic=e.config.controls.toggleLogic.toLowerCase().trim(),e.config.controls.toggleDefault=e.config.controls.toggleDefault.toLowerCase().trim(),e.config.animation.effects=e.config.animation.effects.trim(),e.callActions("afterSanitizeConfig",arguments)},getInitialState:function(){var e=this,t=new p.State,i=new p.Operation;if(e.callActions("beforeGetInitialState",arguments),t.activeContainerClassName=e.config.layout.containerClassName,e.config.load.dataset){if(!e.config.data.uidKey||"string"!=typeof e.config.data.uidKey)throw new TypeError(p.messages.errorConfigDataUidKeyNotSet());i.startDataset=i.newDataset=t.activeDataset=e.config.load.dataset.slice(),i.startContainerClassName=i.newContainerClassName=t.activeContainerClassName,i.show=e.targets.slice(),t=e.callFilters("stateGetInitialState",t,arguments)}else t.activeFilter=e.parseFilterArgs([e.config.load.filter]).command,t.activeSort=e.parseSortArgs([e.config.load.sort]).command,t.totalTargets=e.targets.length,(t=e.callFilters("stateGetInitialState",t,arguments)).activeSort.collection||t.activeSort.attribute||"random"===t.activeSort.order||"desc"===t.activeSort.order?(i.newSort=t.activeSort,e.sortOperation(i),e.printSort(!1,i),e.targets=i.newOrder):i.startOrder=i.newOrder=e.targets,i.startFilter=i.newFilter=t.activeFilter,i.startSort=i.newSort=t.activeSort,i.startContainerClassName=i.newContainerClassName=t.activeContainerClassName,"all"===i.newFilter.selector?i.newFilter.selector=e.config.selectors.target:"none"===i.newFilter.selector&&(i.newFilter.selector="");return i=e.callFilters("operationGetInitialState",i,[t]),(e.lastOperation=i).newFilter&&e.filterOperation(i),e.buildState(i)},cacheDom:function(e,t){var i=this;i.callActions("beforeCacheDom",arguments),i.dom.document=t,i.dom.body=i.dom.document.querySelector("body"),i.dom.container=e,i.dom.parent=e,i.callActions("afterCacheDom",arguments)},indexTargets:function(){var e,t,i=this,r=null,n=-1;if(i.callActions("beforeIndexTargets",arguments),i.dom.targets=i.config.layout.allowNestedTargets?i.dom.container.querySelectorAll(i.config.selectors.target):f.children(i.dom.container,i.config.selectors.target,i.dom.document),i.dom.targets=f.arrayFromList(i.dom.targets),i.targets=[],(t=i.config.load.dataset)&&t.length!==i.dom.targets.length)throw new Error(p.messages.errorDatasetPrerenderedMismatch());if(i.dom.targets.length){for(n=0;e=i.dom.targets[n];n++)(r=new p.Target).init(e,i,t?t[n]:void 0),r.isInDom=!0,i.targets.push(r);i.dom.parent=i.dom.targets[0].parentElement===i.dom.container?i.dom.container:i.dom.targets[0].parentElement}i.origOrder=i.targets,i.callActions("afterIndexTargets",arguments)},initControls:function(){var e,t,i=this,r=null,n=null,o=null,a=null,s=-1,l=-1;switch(i.callActions("beforeInitControls",arguments),i.config.controls.scope){case"local":n=i.dom.container;break;case"global":n=i.dom.document;break;default:throw new Error(p.messages.errorConfigInvalidControlsScope())}for(s=0;e=p.controlDefinitions[s];s++)if(i.config.controls.live||e.live){if(e.parent){if(!(o=i.dom[e.parent])||o.length<0)continue;"number"!=typeof o.length&&(o=[o])}else o=[n];for(l=0;r=o[l];l++)a=i.getControl(r,e.type,e.selector),i.controls.push(a)}else for(t=n.querySelectorAll(i.config.selectors.control+e.selector),l=0;r=t[l];l++)(a=i.getControl(r,e.type,""))&&i.controls.push(a);i.callActions("afterInitControls",arguments)},getControl:function(e,t,i){var r=this,n=null,o=-1;if(r.callActions("beforeGetControl",arguments),!i)for(o=0;n=p.controls[o];o++){if(n.el===e&&n.isBound(r))return r.callFilters("controlGetControl",null,arguments);if(n.el===e&&n.type===t&&n.selector===i)return n.addBinding(r),r.callFilters("controlGetControl",n,arguments)}return(n=new p.Control).init(e,t,i),n.classNames.base=f.getClassname(r.config.classNames,t),n.classNames.active=f.getClassname(r.config.classNames,t,r.config.classNames.modifierActive),n.classNames.disabled=f.getClassname(r.config.classNames,t,r.config.classNames.modifierDisabled),n.addBinding(r),r.callFilters("controlGetControl",n,arguments)},getToggleSelector:function(){var e=this,t="or"===e.config.controls.toggleLogic?", ":"",i="";return e.callActions("beforeGetToggleSelector",arguments),e.toggleArray=f.clean(e.toggleArray),""===(i=e.toggleArray.join(t))&&(i=e.config.controls.toggleDefault),e.callFilters("selectorGetToggleSelector",i,arguments)},buildToggleArray:function(e,t){var i=this,r="";if(i.callActions("beforeBuildToggleArray",arguments),e&&e.filter)r=e.filter.selector.replace(/\s/g,"");else{if(!t)return;r=t.activeFilter.selector.replace(/\s/g,"")}r!==i.config.selectors.target&&"all"!==r||(r=""),"or"===i.config.controls.toggleLogic?i.toggleArray=r.split(","):i.toggleArray=i.splitCompoundSelector(r),i.toggleArray=f.clean(i.toggleArray),i.callActions("afterBuildToggleArray",arguments)},splitCompoundSelector:function(e){var t=e.split(/([\.\[])/g),i=[],r="",n=-1;for(""===t[0]&&t.shift(),n=0;n<t.length;n++)n%2==0&&(r=""),r+=t[n],n%2!=0&&i.push(r);return i},updateControls:function(e){var t=this,i=null,r=new p.CommandMultimix,n=-1;for(t.callActions("beforeUpdateControls",arguments),e.filter?r.filter=e.filter.selector:r.filter=t.state.activeFilter.selector,e.sort?r.sort=t.buildSortString(e.sort):r.sort=t.buildSortString(t.state.activeSort),r.filter===t.config.selectors.target&&(r.filter="all"),""===r.filter&&(r.filter="none"),f.freeze(r),n=0;i=t.controls[n];n++)i.update(r,t.toggleArray);t.callActions("afterUpdateControls",arguments)},buildSortString:function(e){var t="";return t+=e.sortString,e.next&&(t+=" "+this.buildSortString(e.next)),t},insertTargets:function(e,t){var i,r=this,n=-1,o=null,a=null,s=null,l=-1;if(r.callActions("beforeInsertTargets",arguments),void 0===e.index&&(e.index=0),i=r.getNextSibling(e.index,e.sibling,e.position),o=r.dom.document.createDocumentFragment(),n=i?f.index(i,r.config.selectors.target):r.targets.length,e.collection){for(l=0;s=e.collection[l];l++){if(-1<r.dom.targets.indexOf(s))throw new Error(p.messages.errorInsertPreexistingElement());s.style.display="none",o.appendChild(s),o.appendChild(r.dom.document.createTextNode(" ")),f.isElement(s,r.dom.document)&&s.matches(r.config.selectors.target)&&((a=new p.Target).init(s,r),a.isInDom=!0,r.targets.splice(n,0,a),n++)}r.dom.parent.insertBefore(o,i)}t.startOrder=r.origOrder=r.targets,r.callActions("afterInsertTargets",arguments)},getNextSibling:function(e,t,i){var r=this,n=null;return e=Math.max(e,0),t&&"before"===i?n=t:t&&"after"===i?n=t.nextElementSibling||null:0<r.targets.length&&void 0!==e?n=e<r.targets.length||!r.targets.length?r.targets[e].dom.el:r.targets[r.targets.length-1].dom.el.nextElementSibling:0===r.targets.length&&0<r.dom.parent.children.length&&(r.config.layout.siblingAfter?n=r.config.layout.siblingAfter:r.config.layout.siblingBefore?n=r.config.layout.siblingBefore.nextElementSibling:r.dom.parent.children[0]),r.callFilters("elementGetNextSibling",n,arguments)},filterOperation:function(e){var t,i,r,n=null,o=-1;for(this.callActions("beforeFilterOperation",arguments),r=e.newFilter.action,o=0;n=e.newOrder[o];o++)t=e.newFilter.collection?-1<e.newFilter.collection.indexOf(n.dom.el):""!==e.newFilter.selector&&n.dom.el.matches(e.newFilter.selector),this.evaluateHideShow(t,n,r,e);if(e.toRemove.length)for(o=0;n=e.show[o];o++)-1<e.toRemove.indexOf(n)&&(e.show.splice(o,1),-1<(i=e.toShow.indexOf(n))&&e.toShow.splice(i,1),e.toHide.push(n),e.hide.push(n),o--);e.matching=e.show.slice(),0===e.show.length&&""!==e.newFilter.selector&&0!==this.targets.length&&(e.hasFailed=!0),this.callActions("afterFilterOperation",arguments)},evaluateHideShow:function(e,t,i,r){var n=Array.prototype.slice.call(arguments,1),e=this.callFilters("testResultEvaluateHideShow",e,n);this.callActions("beforeEvaluateHideShow",arguments),!0===e&&"show"===i||!1===e&&"hide"===i?(r.show.push(t),t.isShown||r.toShow.push(t)):(r.hide.push(t),t.isShown&&r.toHide.push(t)),this.callActions("afterEvaluateHideShow",arguments)},sortOperation:function(i){var e,r=this,t=[],n=null,o=-1;if(r.callActions("beforeSortOperation",arguments),i.startOrder=r.targets,i.newSort.collection){for(t=[],o=0;e=i.newSort.collection[o];o++){if(r.dom.targets.indexOf(e)<0)throw new Error(p.messages.errorSortNonExistentElement());(n=new p.Target).init(e,r),n.isInDom=!0,t.push(n)}i.newOrder=t}else"random"===i.newSort.order?i.newOrder=f.arrayShuffle(i.startOrder):""===i.newSort.attribute?(i.newOrder=r.origOrder.slice(),"desc"===i.newSort.order&&i.newOrder.reverse()):(i.newOrder=i.startOrder.slice(),i.newOrder.sort(function(e,t){return r.compare(e,t,i.newSort)}));f.isEqualArray(i.newOrder,i.startOrder)&&(i.willSort=!1),r.callActions("afterSortOperation",arguments)},compare:function(e,t,i){var r=i.order,n=this.getAttributeValue(e,i.attribute),o=this.getAttributeValue(t,i.attribute),o=isNaN(+n)||isNaN(+o)?(n=n.toLowerCase(),o.toLowerCase()):(n=+n,+o);return n<o?"asc"===r?-1:1:o<n?"asc"===r?1:-1:n===o&&i.next?this.compare(e,t,i.next):0},getAttributeValue:function(e,t){return null===(e=e.dom.el.getAttribute("data-"+t))&&this.config.debug.showWarnings&&console.warn(p.messages.warningInconsistentSortingAttributes({attribute:"data-"+t})),this.callFilters("valueGetAttributeValue",e||0,arguments)},printSort:function(e,t){var i=this,r=e?t.newOrder:t.startOrder,n=e?t.startOrder:t.newOrder,e=r.length?r[r.length-1].dom.el.nextElementSibling:null,o=d.document.createDocumentFragment(),a=null,s=null,l=-1;for(i.callActions("beforePrintSort",arguments),l=0;a=r[l];l++)"absolute"!==(s=a.dom.el).style.position&&(f.removeWhitespace(s.previousSibling),s.parentElement.removeChild(s));for((t=e?e.previousSibling:i.dom.parent.lastChild)&&"#text"===t.nodeName&&f.removeWhitespace(t),l=0;a=n[l];l++)s=a.dom.el,f.isElement(o.lastChild)&&o.appendChild(d.document.createTextNode(" ")),o.appendChild(s);i.dom.parent.firstChild&&i.dom.parent.firstChild!==e&&o.insertBefore(d.document.createTextNode(" "),o.childNodes[0]),e?(o.appendChild(d.document.createTextNode(" ")),i.dom.parent.insertBefore(o,e)):i.dom.parent.appendChild(o),i.callActions("afterPrintSort",arguments)},parseSortString:function(e,t){for(var i,r=e.split(" "),n=t,o=-1,o=0;o<r.length;o++){switch(i=r[o].split(":"),n.sortString=r[o],n.attribute=f.dashCase(i[0]),n.order=i[1]||"asc",n.attribute){case"default":n.attribute="";break;case"random":n.attribute="",n.order="random"}if(!n.attribute||"random"===n.order)break;o<r.length-1&&(n.next=new p.CommandSort,f.freeze(n),n=n.next)}return this.callFilters("commandsParseSort",t,arguments)},parseEffects:function(){var e=this,t="",i=e.config.animation.effectsIn||e.config.animation.effects,r=e.config.animation.effectsOut||e.config.animation.effects;for(t in e.callActions("beforeParseEffects",arguments),e.effectsIn=new p.StyleData,e.effectsOut=new p.StyleData,e.transformIn=[],e.transformOut=[],e.effectsIn.opacity=e.effectsOut.opacity=1,e.parseEffect("fade",i,e.effectsIn,e.transformIn),e.parseEffect("fade",r,e.effectsOut,e.transformOut,!0),p.transformDefaults)p.transformDefaults[t]instanceof p.TransformData&&(e.parseEffect(t,i,e.effectsIn,e.transformIn),e.parseEffect(t,r,e.effectsOut,e.transformOut,!0));e.parseEffect("stagger",i,e.effectsIn,e.transformIn),e.parseEffect("stagger",r,e.effectsOut,e.transformOut,!0),e.callActions("afterParseEffects",arguments)},parseEffect:function(e,t,i,r,n){var o,a,s=this,l="",c=["%","px","em","rem","vh","vw","deg"],h=-1;if(s.callActions("beforeParseEffect",arguments),"string"!=typeof t)throw new TypeError(p.messages.errorConfigInvalidAnimationEffects());if(t.indexOf(e)<0)"stagger"===e&&(s.staggerDuration=0);else{switch(-1<(o=t.indexOf(e+"("))&&(t=t.substring(o),l=/\(([^)]+)\)/.exec(t)[1]),e){case"fade":i.opacity=l?parseFloat(l):0;break;case"stagger":s.staggerDuration=l?parseFloat(l):100;break;default:if(n&&s.config.animation.reverseOut&&"scale"!==e?i[e].value=-1*(l?parseFloat(l):p.transformDefaults[e].value):i[e].value=l?parseFloat(l):p.transformDefaults[e].value,l){for(h=0;a=c[h];h++)if(-1<l.indexOf(a)){i[e].unit=a;break}}else i[e].unit=p.transformDefaults[e].unit;r.push(e+"("+i[e].value+i[e].unit+")")}s.callActions("afterParseEffect",arguments)}},buildState:function(e){var t=this,i=new p.State,r=null,n=-1;for(t.callActions("beforeBuildState",arguments),n=0;r=t.targets[n];n++)(!e.toRemove.length||e.toRemove.indexOf(r)<0)&&i.targets.push(r.dom.el);for(n=0;r=e.matching[n];n++)i.matching.push(r.dom.el);for(n=0;r=e.show[n];n++)i.show.push(r.dom.el);for(n=0;r=e.hide[n];n++)(!e.toRemove.length||e.toRemove.indexOf(r)<0)&&i.hide.push(r.dom.el);return i.id=t.id,i.container=t.dom.container,i.activeFilter=e.newFilter,i.activeSort=e.newSort,i.activeDataset=e.newDataset,i.activeContainerClassName=e.newContainerClassName,i.hasFailed=e.hasFailed,i.totalTargets=t.targets.length,i.totalShow=e.show.length,i.totalHide=e.hide.length,i.totalMatching=e.matching.length,i.triggerElement=e.triggerElement,t.callFilters("stateBuildState",i,arguments)},goMix:function(e,t){var i,r=this;return r.callActions("beforeGoMix",arguments),r.config.animation.duration&&r.config.animation.effects&&f.isVisible(r.dom.container)||(e=!1),t.toShow.length||t.toHide.length||t.willSort||t.willChangeLayout||(e=!1),t.startState.show.length||t.show.length||(e=!1),p.events.fire("mixStart",r.dom.container,{state:t.startState,futureState:t.newState,instance:r},r.dom.document),"function"==typeof r.config.callbacks.onMixStart&&r.config.callbacks.onMixStart.call(r.dom.container,t.startState,t.newState,r),f.removeClass(r.dom.container,f.getClassname(r.config.classNames,"container",r.config.classNames.modifierFailed)),i=r.userDeferred||(r.userDeferred=f.defer(p.libraries)),r.isBusy=!0,e&&p.features.has.transitions?(d.pageYOffset!==t.docState.scrollTop&&d.scrollTo(t.docState.scrollLeft,t.docState.scrollTop),r.config.animation.applyPerspective&&(r.dom.parent.style[p.features.perspectiveProp]=r.config.animation.perspectiveDistance,r.dom.parent.style[p.features.perspectiveOriginProp]=r.config.animation.perspectiveOrigin),r.config.animation.animateResizeContainer&&t.startHeight!==t.newHeight&&t.viewportDeltaY!==t.startHeight-t.newHeight&&(r.dom.parent.style.height=t.startHeight+"px"),r.config.animation.animateResizeContainer&&t.startWidth!==t.newWidth&&t.viewportDeltaX!==t.startWidth-t.newWidth&&(r.dom.parent.style.width=t.startWidth+"px"),t.startHeight===t.newHeight&&(r.dom.parent.style.height=t.startHeight+"px"),t.startWidth===t.newWidth&&(r.dom.parent.style.width=t.startWidth+"px"),t.startHeight===t.newHeight&&t.startWidth===t.newWidth&&(r.dom.parent.style.overflow="hidden"),requestAnimationFrame(function(){r.moveTargets(t)})):r.config.debug.fauxAsync?setTimeout(function(){r.cleanUp(t)},r.config.animation.duration):r.cleanUp(t),r.callFilters("promiseGoMix",i.promise,arguments)},getStartMixData:function(e){var t=this,i=d.getComputedStyle(t.dom.parent),r=t.dom.parent.getBoundingClientRect(),n=null,o={},a=-1,s=i[p.features.boxSizingProp];for(t.incPadding="border-box"===s,t.callActions("beforeGetStartMixData",arguments),a=0;n=e.show[a];a++)o=n.getPosData(),e.showPosData[a]={startPosData:o};for(a=0;n=e.toHide[a];a++)o=n.getPosData(),e.toHidePosData[a]={startPosData:o};e.startX=r.left,e.startY=r.top,e.startHeight=t.incPadding?r.height:r.height-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderTop)-parseFloat(i.borderBottom),e.startWidth=t.incPadding?r.width:r.width-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderLeft)-parseFloat(i.borderRight),t.callActions("afterGetStartMixData",arguments)},setInter:function(e){var t=this,i=null,r=-1;for(t.callActions("beforeSetInter",arguments),t.config.animation.clampHeight&&(t.dom.parent.style.height=e.startHeight+"px",t.dom.parent.style.overflow="hidden"),t.config.animation.clampWidth&&(t.dom.parent.style.width=e.startWidth+"px",t.dom.parent.style.overflow="hidden"),r=0;i=e.toShow[r];r++)i.show();e.willChangeLayout&&(f.removeClass(t.dom.container,e.startContainerClassName),f.addClass(t.dom.container,e.newContainerClassName)),t.callActions("afterSetInter",arguments)},getInterMixData:function(e){var t=null,i=-1;for(this.callActions("beforeGetInterMixData",arguments),i=0;t=e.show[i];i++)e.showPosData[i].interPosData=t.getPosData();for(i=0;t=e.toHide[i];i++)e.toHidePosData[i].interPosData=t.getPosData();this.callActions("afterGetInterMixData",arguments)},setFinal:function(e){var t=null,i=-1;for(this.callActions("beforeSetFinal",arguments),e.willSort&&this.printSort(!1,e),i=0;t=e.toHide[i];i++)t.hide();this.callActions("afterSetFinal",arguments)},getFinalMixData:function(e){var t,i=this,r=null,n=null,o=-1;for(i.callActions("beforeGetFinalMixData",arguments),o=0;n=e.show[o];o++)e.showPosData[o].finalPosData=n.getPosData();for(o=0;n=e.toHide[o];o++)e.toHidePosData[o].finalPosData=n.getPosData();for((i.config.animation.clampHeight||i.config.animation.clampWidth)&&(i.dom.parent.style.height=i.dom.parent.style.width=i.dom.parent.style.overflow=""),i.incPadding||(r=d.getComputedStyle(i.dom.parent)),t=i.dom.parent.getBoundingClientRect(),e.newX=t.left,e.newY=t.top,e.newHeight=i.incPadding?t.height:t.height-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderTop)-parseFloat(r.borderBottom),e.newWidth=i.incPadding?t.width:t.width-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderLeft)-parseFloat(r.borderRight),e.viewportDeltaX=e.docState.viewportWidth-this.dom.document.documentElement.clientWidth,e.viewportDeltaY=e.docState.viewportHeight-this.dom.document.documentElement.clientHeight,e.willSort&&i.printSort(!0,e),o=0;n=e.toShow[o];o++)n.hide();for(o=0;n=e.toHide[o];o++)n.show();e.willChangeLayout&&(f.removeClass(i.dom.container,e.newContainerClassName),f.addClass(i.dom.container,i.config.layout.containerClassName)),i.callActions("afterGetFinalMixData",arguments)},getTweenData:function(e){var t=this,i=null,r=null,n=Object.getOwnPropertyNames(t.effectsIn),o="",a=null,s=-1,l=-1,c=-1,h=-1;for(t.callActions("beforeGetTweenData",arguments),c=0;i=e.show[c];c++)for((r=e.showPosData[c]).posIn=new p.StyleData,r.posOut=new p.StyleData,r.tweenData=new p.StyleData,i.isShown?(r.posIn.x=r.startPosData.x-r.interPosData.x,r.posIn.y=r.startPosData.y-r.interPosData.y):r.posIn.x=r.posIn.y=0,r.posOut.x=r.finalPosData.x-r.interPosData.x,r.posOut.y=r.finalPosData.y-r.interPosData.y,r.posIn.opacity=i.isShown?1:t.effectsIn.opacity,r.posOut.opacity=1,r.tweenData.opacity=r.posOut.opacity-r.posIn.opacity,i.isShown||t.config.animation.nudge||(r.posIn.x=r.posOut.x,r.posIn.y=r.posOut.y),r.tweenData.x=r.posOut.x-r.posIn.x,r.tweenData.y=r.posOut.y-r.posIn.y,t.config.animation.animateResizeTargets&&(r.posIn.width=r.startPosData.width,r.posIn.height=r.startPosData.height,s=(r.startPosData.width||r.finalPosData.width)-r.interPosData.width,r.posIn.marginRight=r.startPosData.marginRight-s,l=(r.startPosData.height||r.finalPosData.height)-r.interPosData.height,r.posIn.marginBottom=r.startPosData.marginBottom-l,r.posOut.width=r.finalPosData.width,r.posOut.height=r.finalPosData.height,s=(r.finalPosData.width||r.startPosData.width)-r.interPosData.width,r.posOut.marginRight=r.finalPosData.marginRight-s,l=(r.finalPosData.height||r.startPosData.height)-r.interPosData.height,r.posOut.marginBottom=r.finalPosData.marginBottom-l,r.tweenData.width=r.posOut.width-r.posIn.width,r.tweenData.height=r.posOut.height-r.posIn.height,r.tweenData.marginRight=r.posOut.marginRight-r.posIn.marginRight,r.tweenData.marginBottom=r.posOut.marginBottom-r.posIn.marginBottom),h=0;o=n[h];h++)(a=t.effectsIn[o])instanceof p.TransformData&&a.value&&(r.posIn[o].value=a.value,r.posOut[o].value=0,r.tweenData[o].value=r.posOut[o].value-r.posIn[o].value,r.posIn[o].unit=r.posOut[o].unit=r.tweenData[o].unit=a.unit);for(c=0;i=e.toHide[c];c++)for((r=e.toHidePosData[c]).posIn=new p.StyleData,r.posOut=new p.StyleData,r.tweenData=new p.StyleData,r.posIn.x=i.isShown?r.startPosData.x-r.interPosData.x:0,r.posIn.y=i.isShown?r.startPosData.y-r.interPosData.y:0,r.posOut.x=t.config.animation.nudge?0:r.posIn.x,r.posOut.y=t.config.animation.nudge?0:r.posIn.y,r.tweenData.x=r.posOut.x-r.posIn.x,r.tweenData.y=r.posOut.y-r.posIn.y,t.config.animation.animateResizeTargets&&(r.posIn.width=r.startPosData.width,r.posIn.height=r.startPosData.height,s=r.startPosData.width-r.interPosData.width,r.posIn.marginRight=r.startPosData.marginRight-s,l=r.startPosData.height-r.interPosData.height,r.posIn.marginBottom=r.startPosData.marginBottom-l),r.posIn.opacity=1,r.posOut.opacity=t.effectsOut.opacity,r.tweenData.opacity=r.posOut.opacity-r.posIn.opacity,h=0;o=n[h];h++)(a=t.effectsOut[o])instanceof p.TransformData&&a.value&&(r.posIn[o].value=0,r.posOut[o].value=a.value,r.tweenData[o].value=r.posOut[o].value-r.posIn[o].value,r.posIn[o].unit=r.posOut[o].unit=r.tweenData[o].unit=a.unit);t.callActions("afterGetTweenData",arguments)},moveTargets:function(e){var t=this,i=null,r=null,n=null,o="",a=!1,s=-1,l=-1,c=t.checkProgress.bind(t);for(t.callActions("beforeMoveTargets",arguments),l=0;i=e.show[l];l++)r=new p.IMoveData,n=e.showPosData[l],o=i.isShown?"none":"show",(a=t.willTransition(o,e.hasEffect,n.posIn,n.posOut))&&s++,i.show(),r.posIn=n.posIn,r.posOut=n.posOut,r.statusChange=o,r.staggerIndex=s,r.operation=e,r.callback=a?c:null,i.move(r);for(l=0;i=e.toHide[l];l++)n=e.toHidePosData[l],r=new p.IMoveData,a=t.willTransition(o="hide",n.posIn,n.posOut),r.posIn=n.posIn,r.posOut=n.posOut,r.statusChange=o,r.staggerIndex=l,r.operation=e,r.callback=a?c:null,i.move(r);t.config.animation.animateResizeContainer&&(t.dom.parent.style[p.features.transitionProp]="height "+t.config.animation.duration+"ms ease, width "+t.config.animation.duration+"ms ease ",requestAnimationFrame(function(){e.startHeight!==e.newHeight&&e.viewportDeltaY!==e.startHeight-e.newHeight&&(t.dom.parent.style.height=e.newHeight+"px"),e.startWidth!==e.newWidth&&e.viewportDeltaX!==e.startWidth-e.newWidth&&(t.dom.parent.style.width=e.newWidth+"px")})),e.willChangeLayout&&(f.removeClass(t.dom.container,t.config.layout.ContainerClassName),f.addClass(t.dom.container,e.newContainerClassName)),t.callActions("afterMoveTargets",arguments)},hasEffect:function(){var e,t=["scale","translateX","translateY","translateZ","rotateX","rotateY","rotateZ"],i=!1,r=-1;if(1!==this.effectsIn.opacity)return this.callFilters("resultHasEffect",!0,arguments);for(r=0;e=t[r];r++)if(0!==("undefined"!==(e=this.effectsIn[e]).value?e.value:e)){i=!0;break}return this.callFilters("resultHasEffect",i,arguments)},willTransition:function(e,t,i,r){e=!(!f.isVisible(this.dom.container)||!("none"!==e&&t||i.x!==r.x||i.y!==r.y)&&(!this.config.animation.animateResizeTargets||i.width===r.width&&i.height===r.height&&i.marginRight===r.marginRight&&i.marginTop===r.marginTop));return this.callFilters("resultWillTransition",e,arguments)},checkProgress:function(e){this.targetsDone++,this.targetsBound===this.targetsDone&&this.cleanUp(e)},cleanUp:function(e){var t,i,r=this,n=null,o=null,a=-1;for(r.callActions("beforeCleanUp",arguments),a=r.targetsMoved=r.targetsImmovable=r.targetsBound=r.targetsDone=0;n=e.show[a];a++)n.cleanUp(),n.show();for(a=0;n=e.toHide[a];a++)n.cleanUp(),n.hide();if(e.willSort&&r.printSort(!1,e),r.dom.parent.style[p.features.transitionProp]=r.dom.parent.style.height=r.dom.parent.style.width=r.dom.parent.style.overflow=r.dom.parent.style[p.features.perspectiveProp]=r.dom.parent.style[p.features.perspectiveOriginProp]="",e.willChangeLayout&&(f.removeClass(r.dom.container,e.startContainerClassName),f.addClass(r.dom.container,e.newContainerClassName)),e.toRemove.length){for(a=0;n=r.targets[a];a++)-1<e.toRemove.indexOf(n)&&((t=n.dom.el.previousSibling)&&"#text"===t.nodeName&&(o=n.dom.el.nextSibling)&&"#text"===o.nodeName&&f.removeWhitespace(t),e.willSort||r.dom.parent.removeChild(n.dom.el),r.targets.splice(a,1),n.isInDom=!1,a--);r.origOrder=r.targets}e.willSort&&(r.targets=e.newOrder),r.state=e.newState,r.lastOperation=e,r.dom.targets=r.state.targets,p.events.fire("mixEnd",r.dom.container,{state:r.state,instance:r},r.dom.document),"function"==typeof r.config.callbacks.onMixEnd&&r.config.callbacks.onMixEnd.call(r.dom.container,r.state,r),e.hasFailed&&(p.events.fire("mixFail",r.dom.container,{state:r.state,instance:r},r.dom.document),"function"==typeof r.config.callbacks.onMixFail&&r.config.callbacks.onMixFail.call(r.dom.container,r.state,r),f.addClass(r.dom.container,f.getClassname(r.config.classNames,"container",r.config.classNames.modifierFailed))),"function"==typeof r.userCallback&&r.userCallback.call(r.dom.container,r.state,r),"function"==typeof r.userDeferred.resolve&&r.userDeferred.resolve(r.state),r.userCallback=null,r.userDeferred=null,r.lastClicked=null,r.isToggling=!1,r.isBusy=!1,r.queue.length&&(r.callActions("beforeReadQueueCleanUp",arguments),i=r.queue.shift(),r.userDeferred=i.deferred,r.isToggling=i.isToggling,r.lastClicked=i.triggerElement,(i.instruction.command instanceof p.CommandMultimix?r.multimix:r.dataset).apply(r,i.args)),r.callActions("afterCleanUp",arguments)},parseMultimixArgs:function(e){var t,i=this,r=new p.UserInstruction,n=-1;for(r.animate=i.config.animation.enable,r.command=new p.CommandMultimix,n=0;n<e.length;n++)null!==(t=e[n])&&("object"==typeof t?f.extend(r.command,t):"boolean"==typeof t?r.animate=t:"function"==typeof t&&(r.callback=t));return!r.command.insert||r.command.insert instanceof p.CommandInsert||(r.command.insert=i.parseInsertArgs([r.command.insert]).command),!r.command.remove||r.command.remove instanceof p.CommandRemove||(r.command.remove=i.parseRemoveArgs([r.command.remove]).command),!r.command.filter||r.command.filter instanceof p.CommandFilter||(r.command.filter=i.parseFilterArgs([r.command.filter]).command),!r.command.sort||r.command.sort instanceof p.CommandSort||(r.command.sort=i.parseSortArgs([r.command.sort]).command),!r.command.changeLayout||r.command.changeLayout instanceof p.CommandChangeLayout||(r.command.changeLayout=i.parseChangeLayoutArgs([r.command.changeLayout]).command),r=i.callFilters("instructionParseMultimixArgs",r,arguments),f.freeze(r),r},parseFilterArgs:function(e){var t,i=new p.UserInstruction,r=-1;for(i.animate=this.config.animation.enable,i.command=new p.CommandFilter,r=0;r<e.length;r++)"string"==typeof(t=e[r])?i.command.selector=t:null===t?i.command.collection=[]:"object"==typeof t&&f.isElement(t,this.dom.document)?i.command.collection=[t]:"object"==typeof t&&void 0!==t.length?i.command.collection=f.arrayFromList(t):"object"==typeof t?f.extend(i.command,t):"boolean"==typeof t?i.animate=t:"function"==typeof t&&(i.callback=t);if(i.command.selector&&i.command.collection)throw new Error(p.messages.errorFilterInvalidArguments());return i=this.callFilters("instructionParseFilterArgs",i,arguments),f.freeze(i),i},parseSortArgs:function(e){var t,i=new p.UserInstruction,r="",n=-1;for(i.animate=this.config.animation.enable,i.command=new p.CommandSort,n=0;n<e.length;n++)if(null!==(t=e[n]))switch(typeof t){case"string":r=t;break;case"object":t.length&&(i.command.collection=f.arrayFromList(t));break;case"boolean":i.animate=t;break;case"function":i.callback=t}return r&&(i.command=this.parseSortString(r,i.command)),i=this.callFilters("instructionParseSortArgs",i,arguments),f.freeze(i),i},parseInsertArgs:function(e){var t,i=new p.UserInstruction,r=-1;for(i.animate=this.config.animation.enable,i.command=new p.CommandInsert,r=0;r<e.length;r++)null!==(t=e[r])&&("number"==typeof t?i.command.index=t:"string"==typeof t&&-1<["before","after"].indexOf(t)?i.command.position=t:"string"==typeof t?i.command.collection=f.arrayFromList(f.createElement(t).childNodes):"object"==typeof t&&f.isElement(t,this.dom.document)?i.command.collection.length?i.command.sibling=t:i.command.collection=[t]:"object"==typeof t&&t.length?i.command.collection.length?i.command.sibling=t[0]:i.command.collection=t:"object"==typeof t&&t.childNodes&&t.childNodes.length?i.command.collection.length?i.command.sibling=t.childNodes[0]:i.command.collection=f.arrayFromList(t.childNodes):"object"==typeof t?f.extend(i.command,t):"boolean"==typeof t?i.animate=t:"function"==typeof t&&(i.callback=t));if(i.command.index&&i.command.sibling)throw new Error(p.messages.errorInsertInvalidArguments());return!i.command.collection.length&&this.config.debug.showWarnings&&console.warn(p.messages.warningInsertNoElements()),i=this.callFilters("instructionParseInsertArgs",i,arguments),f.freeze(i),i},parseRemoveArgs:function(e){var t,i,r=this,n=new p.UserInstruction,o=-1;for(n.animate=r.config.animation.enable,n.command=new p.CommandRemove,o=0;o<e.length;o++)if(null!==(i=e[o]))switch(typeof i){case"number":r.targets[i]&&(n.command.targets[0]=r.targets[i]);break;case"string":n.command.collection=f.arrayFromList(r.dom.parent.querySelectorAll(i));break;case"object":i&&i.length?n.command.collection=i:f.isElement(i,r.dom.document)?n.command.collection=[i]:f.extend(n.command,i);break;case"boolean":n.animate=i;break;case"function":n.callback=i}if(n.command.collection.length)for(o=0;t=r.targets[o];o++)-1<n.command.collection.indexOf(t.dom.el)&&n.command.targets.push(t);return!n.command.targets.length&&r.config.debug.showWarnings&&console.warn(p.messages.warningRemoveNoElements()),f.freeze(n),n},parseDatasetArgs:function(e){var t,i=new p.UserInstruction,r=-1;for(i.animate=this.config.animation.enable,i.command=new p.CommandDataset,r=0;r<e.length;r++)if(null!==(t=e[r]))switch(typeof t){case"object":Array.isArray(t)||"number"==typeof t.length?i.command.dataset=t:f.extend(i.command,t);break;case"boolean":i.animate=t;break;case"function":i.callback=t}return f.freeze(i),i},parseChangeLayoutArgs:function(e){var t,i=new p.UserInstruction,r=-1;for(i.animate=this.config.animation.enable,i.command=new p.CommandChangeLayout,r=0;r<e.length;r++)if(null!==(t=e[r]))switch(typeof t){case"string":i.command.containerClassName=t;break;case"object":f.extend(i.command,t);break;case"boolean":i.animate=t;break;case"function":i.callback=t}return f.freeze(i),i},queueMix:function(e){var t,i=this,r=null;return i.callActions("beforeQueueMix",arguments),r=f.defer(p.libraries),i.config.animation.queue&&i.queue.length<i.config.animation.queueLimit?(e.deferred=r,i.queue.push(e),i.config.controls.enable&&(i.isToggling?(i.buildToggleArray(e.instruction.command),t=i.getToggleSelector(),i.updateControls({filter:{selector:t}})):i.updateControls(e.instruction.command))):(i.config.debug.showWarnings&&console.warn(p.messages.warningMultimixInstanceQueueFull()),r.resolve(i.state),p.events.fire("mixBusy",i.dom.container,{state:i.state,instance:i},i.dom.document),"function"==typeof i.config.callbacks.onMixBusy&&i.config.callbacks.onMixBusy.call(i.dom.container,i.state,i)),i.callFilters("promiseQueueMix",r.promise,arguments)},getDataOperation:function(e){var t=this,i=new p.Operation,r=[],i=t.callFilters("operationUnmappedGetDataOperation",i,arguments);if(t.dom.targets.length&&!(r=t.state.activeDataset||[]).length)throw new Error(p.messages.errorDatasetNotSet());return i.id=f.randomHex(),i.startState=t.state,i.startDataset=r,i.newDataset=e.slice(),t.diffDatasets(i),i.startOrder=t.targets,i.newOrder=i.show,t.config.animation.enable&&(t.getStartMixData(i),t.setInter(i),i.docState=f.getDocumentState(t.dom.document),t.getInterMixData(i),t.setFinal(i),t.getFinalMixData(i),t.parseEffects(),i.hasEffect=t.hasEffect(),t.getTweenData(i)),t.targets=i.show.slice(),i.newState=t.buildState(i),Array.prototype.push.apply(t.targets,i.toRemove),t.callFilters("operationMappedGetDataOperation",i,arguments)},diffDatasets:function(e){var t=this,i=[],r=[],n=[],o=null,a=null,s=null,l=null,c=null,h={},u="",d=-1;for(t.callActions("beforeDiffDatasets",arguments),d=0;o=e.newDataset[d];d++){if(void 0===(u=o[t.config.data.uidKey])||u.toString().length<1)throw new TypeError(p.messages.errorDatasetInvalidUidKey({uidKey:t.config.data.uidKey}));if(h[u])throw new Error(p.messages.errorDatasetDuplicateUid({uid:u}));h[u]=!0,(a=t.cache[u])instanceof p.Target?(t.config.data.dirtyCheck&&!f.deepEquals(o,a.data)&&(s=a.render(o),a.data=o,s!==a.dom.el)&&(a.isInDom&&(a.unbindEvents(),t.dom.parent.replaceChild(s,a.dom.el)),a.isShown||(s.style.display="none"),a.dom.el=s,a.isInDom)&&a.bindEvents(),s=a.dom.el):((a=new p.Target).init(null,t,o),a.hide()),a.isInDom?(c=a.dom.el.nextElementSibling,r.push(u),l&&(l.lastElementChild&&l.appendChild(t.dom.document.createTextNode(" ")),t.insertDatasetFrag(l,a.dom.el,n),l=null)):((l=l||t.dom.document.createDocumentFragment()).lastElementChild&&l.appendChild(t.dom.document.createTextNode(" ")),l.appendChild(a.dom.el),a.isInDom=!0,a.unbindEvents(),a.bindEvents(),a.hide(),e.toShow.push(a),n.push(a)),e.show.push(a)}for(l&&((c=c||t.config.layout.siblingAfter)&&l.appendChild(t.dom.document.createTextNode(" ")),t.insertDatasetFrag(l,c,n)),d=0;o=e.startDataset[d];d++)u=o[t.config.data.uidKey],a=t.cache[u],e.show.indexOf(a)<0?(e.hide.push(a),e.toHide.push(a),e.toRemove.push(a)):i.push(u);f.isEqualArray(i,r)||(e.willSort=!0),t.callActions("afterDiffDatasets",arguments)},insertDatasetFrag:function(e,t,i){var r=t?f.arrayFromList(this.dom.parent.children).indexOf(t):this.targets.length;for(this.dom.parent.insertBefore(e,t);i.length;)this.targets.splice(r,0,i.shift()),r++},willSort:function(e,t){e=!!(this.config.behavior.liveSort||"random"===e.order||e.attribute!==t.attribute||e.order!==t.order||e.collection!==t.collection||null===e.next&&t.next||e.next&&null===t.next)||!(!e.next||!t.next)&&this.willSort(e.next,t.next);return this.callFilters("resultWillSort",e,arguments)},show:function(){return this.filter("all")},hide:function(){return this.filter("none")},isMixing:function(){return this.isBusy},filter:function(){var e=this.parseFilterArgs(arguments);return this.multimix({filter:e.command},e.animate,e.callback)},toggleOn:function(){var e=this,t=e.parseFilterArgs(arguments),i=t.command.selector;return e.isToggling=!0,e.toggleArray.indexOf(i)<0&&e.toggleArray.push(i),i=e.getToggleSelector(),e.multimix({filter:i},t.animate,t.callback)},toggleOff:function(){var e=this,t=e.parseFilterArgs(arguments),i=t.command.selector,i=e.toggleArray.indexOf(i);return e.isToggling=!0,-1<i&&e.toggleArray.splice(i,1),i=e.getToggleSelector(),e.multimix({filter:i},t.animate,t.callback)},sort:function(){var e=this.parseSortArgs(arguments);return this.multimix({sort:e.command},e.animate,e.callback)},changeLayout:function(){var e=this.parseChangeLayoutArgs(arguments);return this.multimix({changeLayout:e.command},e.animate,e.callback)},dataset:function(){var e=this,t=e.parseDatasetArgs(arguments),i=null;return e.callActions("beforeDataset",arguments),e.isBusy?((i=new p.QueueItem).args=arguments,i.instruction=t,e.queueMix(i)):(t.callback&&(e.userCallback=t.callback),i=t.animate^e.config.animation.enable?t.animate:e.config.animation.enable,t=e.getDataOperation(t.command.dataset),e.goMix(i,t))},multimix:function(){var e=this,t=null,i=e.parseMultimixArgs(arguments);return e.callActions("beforeMultimix",arguments),e.isBusy?((t=new p.QueueItem).args=arguments,t.instruction=i,t.triggerElement=e.lastClicked,t.isToggling=e.isToggling,e.queueMix(t)):(t=e.getOperation(i.command),e.config.controls.enable&&(i.command.filter&&!e.isToggling&&(e.toggleArray.length=0,e.buildToggleArray(t.command)),e.queue.length<1)&&e.updateControls(t.command),i.callback&&(e.userCallback=i.callback),i=i.animate^e.config.animation.enable?i.animate:e.config.animation.enable,e.callFilters("operationMultimix",t,arguments),e.goMix(i,t))},getOperation:function(e){var t=this,i=e.sort,r=e.filter,n=e.changeLayout,o=e.remove,a=e.insert,s=new p.Operation;return(s=t.callFilters("operationUnmappedGetOperation",s,arguments)).id=f.randomHex(),s.command=e,s.startState=t.state,s.triggerElement=t.lastClicked,t.isBusy?(t.config.debug.showWarnings&&console.warn(p.messages.warningGetOperationInstanceBusy()),null):(a&&t.insertTargets(a,s),o&&(s.toRemove=o.targets),s.startSort=s.newSort=s.startState.activeSort,s.startOrder=s.newOrder=t.targets,i&&(s.startSort=s.startState.activeSort,s.newSort=i,s.willSort=t.willSort(i,s.startState.activeSort),s.willSort)&&t.sortOperation(s),s.startFilter=s.startState.activeFilter,s.newFilter=r||f.extend(new p.CommandFilter,s.startFilter),"all"===s.newFilter.selector?s.newFilter.selector=t.config.selectors.target:"none"===s.newFilter.selector&&(s.newFilter.selector=""),t.filterOperation(s),s.startContainerClassName=s.startState.activeContainerClassName,n?(s.newContainerClassName=n.containerClassName,s.newContainerClassName!==s.startContainerClassName&&(s.willChangeLayout=!0)):s.newContainerClassName=s.startContainerClassName,t.config.animation.enable&&(t.getStartMixData(s),t.setInter(s),s.docState=f.getDocumentState(t.dom.document),t.getInterMixData(s),t.setFinal(s),t.getFinalMixData(s),t.parseEffects(),s.hasEffect=t.hasEffect(),t.getTweenData(s)),s.willSort&&(t.targets=s.newOrder),s.newState=t.buildState(s),t.callFilters("operationMappedGetOperation",s,arguments))},tween:function(e,t){var i,r=null,n=null,o=-1;for(t=Math.min(t,1),t=Math.max(t,0),o=0;r=e.show[o];o++)n=e.showPosData[o],r.applyTween(n,t);for(o=0;r=e.hide[o];o++)r.isShown&&r.hide(),-1<(i=e.toHide.indexOf(r))&&(n=e.toHidePosData[i],r.isShown||r.show(),r.applyTween(n,t))},insert:function(){var e=this.parseInsertArgs(arguments);return this.multimix({insert:e.command},e.animate,e.callback)},insertBefore:function(){var e=this.parseInsertArgs(arguments);return this.insert(e.command.collection,"before",e.command.sibling,e.animate,e.callback)},insertAfter:function(){var e=this.parseInsertArgs(arguments);return this.insert(e.command.collection,"after",e.command.sibling,e.animate,e.callback)},prepend:function(){var e=this.parseInsertArgs(arguments);return this.insert(0,e.command.collection,e.animate,e.callback)},append:function(){var e=this.parseInsertArgs(arguments);return this.insert(this.state.totalTargets,e.command.collection,e.animate,e.callback)},remove:function(){var e=this.parseRemoveArgs(arguments);return this.multimix({remove:e.command},e.animate,e.callback)},getConfig:function(e){e=e?f.getProperty(this.config,e):this.config;return this.callFilters("valueGetConfig",e,arguments)},configure:function(e){this.callActions("beforeConfigure",arguments),f.extend(this.config,e,!0,!0),this.callActions("afterConfigure",arguments)},getState:function(){var e=new p.State;return f.extend(e,this.state),f.freeze(e),this.callFilters("stateGetState",e,arguments)},forceRefresh:function(){this.indexTargets()},forceRender:function(){var e=this,t=null,i=null,r="";for(r in e.cache)t=e.cache[r],i=t.render(t.data),i!==t.dom.el&&(t.isInDom&&(t.unbindEvents(),e.dom.parent.replaceChild(i,t.dom.el)),t.isShown||(i.style.display="none"),t.dom.el=i,t.isInDom)&&t.bindEvents();e.state=e.buildState(e.lastOperation)},destroy:function(e){var t=this,i=null,r=null,n=0;for(t.callActions("beforeDestroy",arguments),n=0;i=t.controls[n];n++)i.removeBinding(t);for(n=0;r=t.targets[n];n++)e&&r.show(),r.unbindEvents();t.dom.container.id.match(/^MixItUp/)&&t.dom.container.removeAttribute("id"),delete p.instances[t.id],t.callActions("afterDestroy",arguments)}}),p.BaseStatic.call(p.IMoveData=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.posIn=null,this.posOut=null,this.operation=null,this.callback=null,this.statusChange="",this.duration=-1,this.staggerIndex=-1,this.callActions("afterConstruct"),f.seal(this)}),p.IMoveData.prototype=Object.create(p.Base.prototype),p.IMoveData.prototype.constructor=p.IMoveData,p.BaseStatic.call(p.TargetDom=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.el=null,this.callActions("afterConstruct"),f.seal(this)}),p.TargetDom.prototype=Object.create(p.Base.prototype),p.TargetDom.prototype.constructor=p.TargetDom,p.BaseStatic.call(p.Target=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.sortString="",this.mixer=null,this.callback=null,this.isShown=!1,this.isBound=!1,this.isExcluded=!1,this.isInDom=!1,this.handler=null,this.operation=null,this.data=null,this.dom=new p.TargetDom,this.callActions("afterConstruct"),f.seal(this)}),p.Target.prototype=Object.create(p.Base.prototype),f.extend(p.Target.prototype,{constructor:p.Target,init:function(e,t,i){var r=this,n="";if(r.callActions("beforeInit",arguments),r.mixer=t,e=e||r.render(i),r.cacheDom(e),r.bindEvents(),"none"!==r.dom.el.style.display&&(r.isShown=!0),i&&t.config.data.uidKey){if(void 0===(n=i[t.config.data.uidKey])||n.toString().length<1)throw new TypeError(p.messages.errorDatasetInvalidUidKey({uidKey:t.config.data.uidKey}));r.id=n,r.data=i,t.cache[n]=r}r.callActions("afterInit",arguments)},render:function(e){var t=null,i=null,r=null;if(this.callActions("beforeRender",arguments),"function"!=typeof(t=this.callFilters("renderRender",this.mixer.config.render.target,arguments)))throw new TypeError(p.messages.errorDatasetRendererNotSet());return(t=t(e))&&"object"==typeof t&&f.isElement(t)?i=t:"string"==typeof t&&((r=document.createElement("div")).innerHTML=t,i=r.firstElementChild),this.callFilters("elRender",i,arguments)},cacheDom:function(e){this.callActions("beforeCacheDom",arguments),this.dom.el=e,this.callActions("afterCacheDom",arguments)},getSortString:function(e){e=this.dom.el.getAttribute("data-"+e)||"";this.callActions("beforeGetSortString",arguments),e=isNaN(+e)?e.toLowerCase():+e,this.sortString=e,this.callActions("afterGetSortString",arguments)},show:function(){var e=this;e.callActions("beforeShow",arguments),e.isShown||(e.dom.el.style.display="",e.isShown=!0),e.callActions("afterShow",arguments)},hide:function(){var e=this;e.callActions("beforeHide",arguments),e.isShown&&(e.dom.el.style.display="none",e.isShown=!1),e.callActions("afterHide",arguments)},move:function(e){var t=this;t.callActions("beforeMove",arguments),t.isExcluded||t.mixer.targetsMoved++,t.applyStylesIn(e),requestAnimationFrame(function(){t.applyStylesOut(e)}),t.callActions("afterMove",arguments)},applyTween:function(e,t){var i,r,n=this,o=e.posIn,a=[],s=new p.StyleData,l=-1;for(n.callActions("beforeApplyTween",arguments),s.x=o.x,s.y=o.y,0===t?n.hide():n.isShown||n.show(),l=0;i=p.features.TWEENABLE[l];l++)if(r=e.tweenData[i],"x"===i){if(!r)continue;s.x=o.x+r*t}else if("y"===i){if(!r)continue;s.y=o.y+r*t}else if(r instanceof p.TransformData){if(!r.value)continue;s[i].value=o[i].value+r.value*t,s[i].unit=r.unit,a.push(i+"("+s[i].value+r.unit+")")}else{if(!r)continue;s[i]=o[i]+r*t,n.dom.el.style[i]=s[i]}(s.x||s.y)&&a.unshift("translate("+s.x+"px, "+s.y+"px)"),a.length&&(n.dom.el.style[p.features.transformProp]=a.join(" ")),n.callActions("afterApplyTween",arguments)},applyStylesIn:function(e){var t=this,i=e.posIn,r=1!==t.mixer.effectsIn.opacity,n=[];t.callActions("beforeApplyStylesIn",arguments),n.push("translate("+i.x+"px, "+i.y+"px)"),t.mixer.config.animation.animateResizeTargets&&("show"!==e.statusChange&&(t.dom.el.style.width=i.width+"px",t.dom.el.style.height=i.height+"px"),t.dom.el.style.marginRight=i.marginRight+"px",t.dom.el.style.marginBottom=i.marginBottom+"px"),r&&(t.dom.el.style.opacity=i.opacity),"show"===e.statusChange&&(n=n.concat(t.mixer.transformIn)),t.dom.el.style[p.features.transformProp]=n.join(" "),t.callActions("afterApplyStylesIn",arguments)},applyStylesOut:function(e){var t=this,i=[],r=[],n=t.mixer.config.animation.animateResizeTargets,o=void 0!==t.mixer.effectsIn.opacity;if(t.callActions("beforeApplyStylesOut",arguments),i.push(t.writeTransitionRule(p.features.transformRule,e.staggerIndex)),"none"!==e.statusChange&&i.push(t.writeTransitionRule("opacity",e.staggerIndex,e.duration)),n&&(i.push(t.writeTransitionRule("width",e.staggerIndex,e.duration)),i.push(t.writeTransitionRule("height",e.staggerIndex,e.duration)),i.push(t.writeTransitionRule("margin",e.staggerIndex,e.duration))),e.callback){switch(t.operation=e.operation,t.callback=e.callback,t.isExcluded||t.mixer.targetsBound++,t.isBound=!0,t.applyTransition(i),n&&0<e.posOut.width&&0<e.posOut.height&&(t.dom.el.style.width=e.posOut.width+"px",t.dom.el.style.height=e.posOut.height+"px",t.dom.el.style.marginRight=e.posOut.marginRight+"px",t.dom.el.style.marginBottom=e.posOut.marginBottom+"px"),t.mixer.config.animation.nudge||"hide"!==e.statusChange||r.push("translate("+e.posOut.x+"px, "+e.posOut.y+"px)"),e.statusChange){case"hide":o&&(t.dom.el.style.opacity=t.mixer.effectsOut.opacity),r=r.concat(t.mixer.transformOut);break;case"show":o&&(t.dom.el.style.opacity=1)}(t.mixer.config.animation.nudge||!t.mixer.config.animation.nudge&&"hide"!==e.statusChange)&&r.push("translate("+e.posOut.x+"px, "+e.posOut.y+"px)"),t.dom.el.style[p.features.transformProp]=r.join(" "),t.callActions("afterApplyStylesOut",arguments)}else t.mixer.targetsImmovable++,t.mixer.targetsMoved===t.mixer.targetsImmovable&&t.mixer.cleanUp(e.operation)},writeTransitionRule:function(e,t,i){t=this.getDelay(t),i=e+" "+(0<i?i:this.mixer.config.animation.duration)+"ms "+t+"ms "+("opacity"===e?"linear":this.mixer.config.animation.easing);return this.callFilters("ruleWriteTransitionRule",i,arguments)},getDelay:function(e){var t=this;return"function"==typeof t.mixer.config.animation.staggerSequence&&(e=t.mixer.config.animation.staggerSequence.call(t,e,t.state)),e=t.mixer.staggerDuration?e*t.mixer.staggerDuration:0,t.callFilters("delayGetDelay",e,arguments)},applyTransition:function(e){e=e.join(", ");this.callActions("beforeApplyTransition",arguments),this.dom.el.style[p.features.transitionProp]=e,this.callActions("afterApplyTransition",arguments)},handleTransitionEnd:function(e){var t=this,i=e.propertyName,r=t.mixer.config.animation.animateResizeTargets;t.callActions("beforeHandleTransitionEnd",arguments),t.isBound&&e.target.matches(t.mixer.config.selectors.target)&&(-1<i.indexOf("transform")||-1<i.indexOf("opacity")||r&&-1<i.indexOf("height")||r&&-1<i.indexOf("width")||r&&-1<i.indexOf("margin"))&&(t.callback.call(t,t.operation),t.isBound=!1,t.callback=null,t.operation=null),t.callActions("afterHandleTransitionEnd",arguments)},eventBus:function(e){switch(this.callActions("beforeEventBus",arguments),e.type){case"webkitTransitionEnd":case"transitionend":this.handleTransitionEnd(e)}this.callActions("afterEventBus",arguments)},unbindEvents:function(){var e=this;e.callActions("beforeUnbindEvents",arguments),f.off(e.dom.el,"webkitTransitionEnd",e.handler),f.off(e.dom.el,"transitionend",e.handler),e.callActions("afterUnbindEvents",arguments)},bindEvents:function(){var e,t=this;t.callActions("beforeBindEvents",arguments),e="webkit"===p.features.transitionPrefix?"webkitTransitionEnd":"transitionend",t.handler=function(e){return t.eventBus(e)},f.on(t.dom.el,e,t.handler),t.callActions("afterBindEvents",arguments)},getPosData:function(e){var t=this,i=new p.StyleData;return t.callActions("beforeGetPosData",arguments),i.x=t.dom.el.offsetLeft,i.y=t.dom.el.offsetTop,(t.mixer.config.animation.animateResizeTargets||e)&&(e=t.dom.el.getBoundingClientRect(),i.top=e.top,i.right=e.right,i.bottom=e.bottom,i.left=e.left,i.width=e.width,i.height=e.height),t.mixer.config.animation.animateResizeTargets&&(e=d.getComputedStyle(t.dom.el),i.marginBottom=parseFloat(e.marginBottom),i.marginRight=parseFloat(e.marginRight)),t.callFilters("posDataGetPosData",i,arguments)},cleanUp:function(){var e=this;e.callActions("beforeCleanUp",arguments),e.dom.el.style[p.features.transformProp]="",e.dom.el.style[p.features.transitionProp]="",e.dom.el.style.opacity="",e.mixer.config.animation.animateResizeTargets&&(e.dom.el.style.width="",e.dom.el.style.height="",e.dom.el.style.marginRight="",e.dom.el.style.marginBottom=""),e.callActions("afterCleanUp",arguments)}}),p.BaseStatic.call(p.Collection=function(e){var t,i=-1;for(this.callActions("beforeConstruct"),i=0;t=e[i];i++)this[i]=t;this.length=e.length,this.callActions("afterConstruct"),f.freeze(this)}),p.Collection.prototype=Object.create(p.Base.prototype),f.extend(p.Collection.prototype,{constructor:p.Collection,mixitup:function(e){var t=null,i=Array.prototype.slice.call(arguments),r=[],n=-1;for(this.callActions("beforeMixitup"),i.shift(),n=0;t=this[n];n++)r.push(t[e].apply(t,i));return this.callFilters("promiseMixitup",f.all(r,p.libraries),arguments)}}),p.BaseStatic.call(p.Operation=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.args=[],this.command=null,this.showPosData=[],this.toHidePosData=[],this.startState=null,this.newState=null,this.docState=null,this.willSort=!1,this.willChangeLayout=!1,this.hasEffect=!1,this.hasFailed=!1,this.triggerElement=null,this.show=[],this.hide=[],this.matching=[],this.toShow=[],this.toHide=[],this.toMove=[],this.toRemove=[],this.startOrder=[],this.newOrder=[],this.startSort=null,this.newSort=null,this.startFilter=null,this.newFilter=null,this.startDataset=null,this.newDataset=null,this.viewportDeltaX=0,this.viewportDeltaY=0,this.startX=0,this.startY=0,this.startHeight=0,this.startWidth=0,this.newX=0,this.newY=0,this.newHeight=0,this.newWidth=0,this.startContainerClassName="",this.startDisplay="",this.newContainerClassName="",this.newDisplay="",this.callActions("afterConstruct"),f.seal(this)}),p.Operation.prototype=Object.create(p.Base.prototype),p.Operation.prototype.constructor=p.Operation,p.BaseStatic.call(p.State=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.activeFilter=null,this.activeSort=null,this.activeContainerClassName="",this.container=null,this.targets=[],this.hide=[],this.show=[],this.matching=[],this.totalTargets=-1,this.totalShow=-1,this.totalHide=-1,this.totalMatching=-1,this.hasFailed=!1,this.triggerElement=null,this.activeDataset=null,this.callActions("afterConstruct"),f.seal(this)}),p.State.prototype=Object.create(p.Base.prototype),p.State.prototype.constructor=p.State,p.BaseStatic.call(p.UserInstruction=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.command={},this.animate=!1,this.callback=null,this.callActions("afterConstruct"),f.seal(this)}),p.UserInstruction.prototype=Object.create(p.Base.prototype),p.UserInstruction.prototype.constructor=p.UserInstruction,p.BaseStatic.call(p.Messages=function(){p.Base.call(this),this.callActions("beforeConstruct"),this.ERROR_FACTORY_INVALID_CONTAINER="[MixItUp] An invalid selector or element reference was passed to the mixitup factory function",this.ERROR_FACTORY_CONTAINER_NOT_FOUND="[MixItUp] The provided selector yielded no container element",this.ERROR_CONFIG_INVALID_ANIMATION_EFFECTS="[MixItUp] Invalid value for `animation.effects`",this.ERROR_CONFIG_INVALID_CONTROLS_SCOPE="[MixItUp] Invalid value for `controls.scope`",this.ERROR_CONFIG_INVALID_PROPERTY='[MixitUp] Invalid configuration object property "${erroneous}"${suggestion}',this.ERROR_CONFIG_INVALID_PROPERTY_SUGGESTION='. Did you mean "${probableMatch}"?',this.ERROR_CONFIG_DATA_UID_KEY_NOT_SET="[MixItUp] To use the dataset API, a UID key must be specified using `data.uidKey`",this.ERROR_DATASET_INVALID_UID_KEY='[MixItUp] The specified UID key "${uidKey}" is not present on one or more dataset items',this.ERROR_DATASET_DUPLICATE_UID='[MixItUp] The UID "${uid}" was found on two or more dataset items. UIDs must be unique.',this.ERROR_INSERT_INVALID_ARGUMENTS="[MixItUp] Please provider either an index or a sibling and position to insert, not both",this.ERROR_INSERT_PREEXISTING_ELEMENT="[MixItUp] An element to be inserted already exists in the container",this.ERROR_FILTER_INVALID_ARGUMENTS="[MixItUp] Please provide either a selector or collection `.filter()`, not both",this.ERROR_DATASET_NOT_SET="[MixItUp] To use the dataset API with pre-rendered targets, a starting dataset must be set using `load.dataset`",this.ERROR_DATASET_PRERENDERED_MISMATCH="[MixItUp] `load.dataset` does not match pre-rendered targets",this.ERROR_DATASET_RENDERER_NOT_SET="[MixItUp] To insert an element via the dataset API, a target renderer function must be provided to `render.target`",this.ERROR_SORT_NON_EXISTENT_ELEMENT="[MixItUp] An element to be sorted does not already exist in the container",this.WARNING_FACTORY_PREEXISTING_INSTANCE="[MixItUp] WARNING: This element already has an active MixItUp instance. The provided configuration object will be ignored. If you wish to perform additional methods on this instance, please create a reference.",this.WARNING_INSERT_NO_ELEMENTS="[MixItUp] WARNING: No valid elements were passed to `.insert()`",this.WARNING_REMOVE_NO_ELEMENTS="[MixItUp] WARNING: No valid elements were passed to `.remove()`",this.WARNING_MULTIMIX_INSTANCE_QUEUE_FULL="[MixItUp] WARNING: An operation was requested but the MixItUp instance was busy. The operation was rejected because the queue is full or queuing is disabled.",this.WARNING_GET_OPERATION_INSTANCE_BUSY="[MixItUp] WARNING: Operations can be be created while the MixItUp instance is busy.",this.WARNING_NO_PROMISE_IMPLEMENTATION="[MixItUp] WARNING: No Promise implementations could be found. If you wish to use promises with MixItUp please install an ES6 Promise polyfill.",this.WARNING_INCONSISTENT_SORTING_ATTRIBUTES='[MixItUp] WARNING: The requested sorting data attribute "${attribute}" was not present on one or more target elements which may product unexpected sort output',this.callActions("afterConstruct"),this.compileTemplates(),f.seal(this)}),p.Messages.prototype=Object.create(p.Base.prototype),p.Messages.prototype.constructor=p.Messages,p.Messages.prototype.compileTemplates=function(){var e,t="";for(t in this)"string"==typeof(e=this[t])&&(this[f.camelCase(t)]=f.template(e))},p.messages=new p.Messages,p.BaseStatic.call(p.Facade=function(e){p.Base.call(this),this.callActions("beforeConstruct",arguments),this.configure=e.configure.bind(e),this.show=e.show.bind(e),this.hide=e.hide.bind(e),this.filter=e.filter.bind(e),this.toggleOn=e.toggleOn.bind(e),this.toggleOff=e.toggleOff.bind(e),this.sort=e.sort.bind(e),this.changeLayout=e.changeLayout.bind(e),this.multimix=e.multimix.bind(e),this.dataset=e.dataset.bind(e),this.tween=e.tween.bind(e),this.insert=e.insert.bind(e),this.insertBefore=e.insertBefore.bind(e),this.insertAfter=e.insertAfter.bind(e),this.prepend=e.prepend.bind(e),this.append=e.append.bind(e),this.remove=e.remove.bind(e),this.destroy=e.destroy.bind(e),this.forceRefresh=e.forceRefresh.bind(e),this.forceRender=e.forceRender.bind(e),this.isMixing=e.isMixing.bind(e),this.getOperation=e.getOperation.bind(e),this.getConfig=e.getConfig.bind(e),this.getState=e.getState.bind(e),this.callActions("afterConstruct",arguments),f.freeze(this),f.seal(this)}),p.Facade.prototype=Object.create(p.Base.prototype),p.Facade.prototype.constructor=p.Facade,"object"==typeof exports&&"object"==typeof module?module.exports=p:"function"==typeof define&&define.amd?define(function(){return p}):void 0!==d.mixitup&&"function"==typeof d.mixitup||(d.mixitup=p),p.BaseStatic.call(p.constructor),p.NAME="mixitup",p.CORE_VERSION="3.3.1"}(window),function(e){function t(m){var g=m.h;if(!m.CORE_VERSION||!g.compareVersions(t.REQUIRE_CORE_VERSION,m.CORE_VERSION))throw new Error("[MixItUp Pagination] MixItUp Pagination "+t.EXTENSION_VERSION+" requires at least MixItUp "+t.REQUIRE_CORE_VERSION);m.ConfigClassNames.registerAction("afterConstruct","pagination",function(){this.elementPager="control",this.elementPageList="page-list",this.elementPageStats="page-stats",this.modifierFirst="first",this.modifierLast="last",this.modifierPrev="prev",this.modifierNext="next",this.modifierTruncationMarker="truncation-marker"}),m.ConfigLoad.registerAction("afterConstruct","pagination",function(){this.page=1}),m.ConfigPagination=function(){this.generatePageList=!0,this.generatePageStats=!0,this.maintainActivePage=!0,this.loop=!1,this.hidePageListIfSinglePage=!1,this.hidePageStatsIfSinglePage=!1,this.limit=-1,this.maxPagers=5,g.seal(this)},m.ConfigRender.registerAction("afterConstruct","pagination",function(){this.pager=null,this.pageStats=null}),m.ConfigSelectors.registerAction("afterConstruct","pagination",function(){this.pageList=".mixitup-page-list",this.pageStats=".mixitup-page-stats"}),m.ConfigTemplates.registerAction("afterConstruct","pagination",function(){this.pager='<button type="button" class="${classNames}" data-page="${pageNumber}">${pageNumber}</button>',this.pagerPrev='<button type="button" class="${classNames}" data-page="prev">&lt;</button>',this.pagerNext='<button type="button" class="${classNames}" data-page="next">&gt;</button>',this.pagerTruncationMarker='<span class="${classNames}">&hellip;</span>',this.pageStats="${startPageAt} to ${endPageAt} of ${totalTargets}",this.pageStatsSingle="${startPageAt} of ${totalTargets}",this.pageStatsFail="None found"}),m.Config.registerAction("beforeConstruct","pagination",function(){this.pagination=new m.ConfigPagination}),m.ModelPager=function(){this.pageNumber=-1,this.classNames="",this.classList=[],this.isDisabled=!1,this.isPrev=!1,this.isNext=!1,this.isPageLink=!1,this.isTruncationMarker=!1,g.seal(this)},m.ModelPageStats=function(){this.startPageAt=-1,this.endPageAt=-1,this.totalTargets=-1,g.seal(this)},m.UiClassNames.registerAction("afterConstruct","pagination",function(){this.first="",this.last="",this.prev="",this.next="",this.first="",this.last="",this.truncated="",this.truncationMarker=""}),m.controlDefinitions.push(new m.ControlDefinition("pager","[data-page]",!0,"pageListEls")),m.Control.registerFilter("commandsHandleClick","pagination",function(e,t){var i,r=this,n={},o=null,a=null,s=-1;if(r.selector&&"[data-page]"===r.selector)for(a=g.closestParent(t.target,r.selector,!0,r.bound[0].dom.document),s=0;o=r.bound[s];s++)n=e[s],!o.config.pagination||o.config.pagination.limit<0||o.config.pagination.limit===1/0||!a||g.hasClass(a,o.classNamesPager.active)||g.hasClass(a,o.classNamesPager.disabled)?e[s]=null:(i=a.getAttribute("data-page"),n.paginate="prev"===i?"prev":"next"===i?"next":parseInt(i),o.lastClicked&&(o.lastClicked=a));return e}),m.CommandMultimix.registerAction("afterConstruct","pagination",function(){this.paginate=null}),m.CommandPaginate=function(){this.page=-1,this.limit=-1,this.action="",this.anchor=null,g.seal(this)},m.Operation.registerAction("afterConstruct","pagination",function(){this.startPagination=null,this.newPagination=null,this.startTotalPages=-1,this.newTotalPages=-1}),m.State.registerAction("afterConstruct","pagination",function(){this.activePagination=null,this.totalPages=-1}),m.MixerDom.registerAction("afterConstruct","pagination",function(){this.pageListEls=[],this.pageStatsEls=[]}),m.Mixer.registerAction("afterConstruct","pagination",function(){this.classNamesPager=new m.UiClassNames,this.classNamesPageList=new m.UiClassNames,this.classNamesPageStats=new m.UiClassNames}),m.Mixer.registerAction("afterAttach","pagination",function(){var e=this,t=null,i=-1;if(!(e.config.pagination.limit<0)){if(e.classNamesPager.base=g.getClassname(e.config.classNames,"pager"),e.classNamesPager.active=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierActive),e.classNamesPager.disabled=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierDisabled),e.classNamesPager.first=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierFirst),e.classNamesPager.last=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierLast),e.classNamesPager.prev=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierPrev),e.classNamesPager.next=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierNext),e.classNamesPager.truncationMarker=g.getClassname(e.config.classNames,"pager",e.config.classNames.modifierTruncationMarker),e.classNamesPageList.base=g.getClassname(e.config.classNames,"page-list"),e.classNamesPageList.disabled=g.getClassname(e.config.classNames,"page-list",e.config.classNames.modifierDisabled),e.classNamesPageStats.base=g.getClassname(e.config.classNames,"page-stats"),e.classNamesPageStats.disabled=g.getClassname(e.config.classNames,"page-stats",e.config.classNames.modifierDisabled),e.config.pagination.generatePageList&&0<e.dom.pageListEls.length)for(i=0;t=e.dom.pageListEls[i];i++)e.renderPageListEl(t,e.lastOperation);if(e.config.pagination.generatePageStats&&0<e.dom.pageStatsEls.length)for(i=0;t=e.dom.pageStatsEls[i];i++)e.renderPageStatsEl(t,e.lastOperation)}}),m.Mixer.registerFilter("operationGetInitialState","pagination",function(e,t){return this.config.pagination.limit<0||(e.newPagination=t.activePagination),e}),m.Mixer.registerFilter("stateGetInitialState","pagination",function(e){return this.config.pagination.limit<0||(e.activePagination=new m.CommandPaginate,e.activePagination.page=this.config.load.page,e.activePagination.limit=this.config.pagination.limit),e}),m.Mixer.registerAction("afterGetFinalMixData","pagination",function(){this.config.pagination.limit<0||"number"==typeof this.config.pagination.maxPagers&&(this.config.pagination.maxPagers=Math.max(5,this.config.pagination.maxPagers))}),m.Mixer.registerAction("afterCacheDom","pagination",function(){var e=this,t=null;if(!(e.config.pagination.limit<0)&&e.config.pagination.generatePageList){switch(e.config.controls.scope){case"local":t=e.dom.container;break;case"global":t=e.dom.document;break;default:throw new Error(m.messages.ERROR_CONFIG_INVALID_CONTROLS_SCOPE)}e.dom.pageListEls=t.querySelectorAll(e.config.selectors.pageList),e.dom.pageStatsEls=t.querySelectorAll(e.config.selectors.pageStats)}}),m.Mixer.registerFilter("stateBuildState","pagination",function(e,t){return this.config.pagination.limit<0||(e.activePagination=t.newPagination,e.totalPages=t.newTotalPages),e}),m.Mixer.registerFilter("instructionParseMultimixArgs","pagination",function(e){return this.config.pagination.limit<0||!e.command.paginate||e.command.paginate instanceof m.CommandPaginate||(e.command.paginate=this.parsePaginateArgs([e.command.paginate]).command),e}),m.Mixer.registerAction("afterFilterOperation","pagination",function(e){var t,i=-1,r=-1,n=[],o=[],a=null,s=-1;if(!(this.config.pagination.limit<0)){if(e.newTotalPages=e.newPagination.limit?Math.max(Math.ceil(e.matching.length/e.newPagination.limit),1):1,this.config.pagination.maintainActivePage&&(e.newPagination.page=e.newPagination.page>e.newTotalPages?e.newTotalPages:e.newPagination.page),this.config.pagination.limit=e.newPagination.limit,e.newPagination.anchor){for(s=0;(a=e.matching[s])&&a.dom.el!==e.newPagination.anchor;s++);r=(i=s)+e.newPagination.limit-1}else i=e.newPagination.limit*(e.newPagination.page-1),r=e.newPagination.limit*e.newPagination.page-1,isNaN(i)&&(i=0);if(!(e.newPagination.limit<0)){for(s=0;a=e.show[s];s++)(i<=s&&s<=r?n:o).push(a);for(e.show=n,s=0;a=e.toHide[s];s++)a.isShown||(e.toHide.splice(s,1),a.isShown=!1,s--);for(s=0;a=o[s];s++)e.hide.push(a),-1<(t=e.toShow.indexOf(a))&&e.toShow.splice(t,1),a.isShown&&e.toHide.push(a)}}}),m.Mixer.registerFilter("operationUnmappedGetOperation","pagination",function(e,t){var i=this;return i.config.pagination.limit<0||(e.startState=i.state,e.startPagination=i.state.activePagination,e.startTotalPages=i.state.totalPages,e.newPagination=new m.CommandPaginate,e.newPagination.limit=e.startPagination.limit,e.newPagination.page=e.startPagination.page,t.paginate?i.parsePaginateCommand(t.paginate,e):(t.filter||t.sort)&&(g.extend(e.newPagination,e.startPagination),i.config.pagination.maintainActivePage?e.newPagination.page=i.state.activePagination.page:e.newPagination.page=1)),e}),m.Mixer.registerFilter("operationMappedGetOperation","pagination",function(e,t,i){var r=this,n=null,o=-1;if(!(r.config.pagination.limit<0||i)){if(r.config.pagination.generatePageList&&0<r.dom.pageListEls.length)for(o=0;n=r.dom.pageListEls[o];o++)r.renderPageListEl(n,e);if(r.config.pagination.generatePageStats&&0<r.dom.pageStatsEls.length)for(o=0;n=r.dom.pageStatsEls[o];o++)r.renderPageStatsEl(n,e)}return e}),m.Mixer.extend({parsePaginateCommand:function(e,t){if(-1<e.page){if(0===e.page)throw new Error(m.messages.ERROR_PAGINATE_INDEX_RANGE);t.newPagination.page=Math.max(1,Math.min(1/0,e.page))}else"next"===e.action?t.newPagination.page=this.getNextPage():"prev"===e.action?t.newPagination.page=this.getPrevPage():e.anchor&&(t.newPagination.anchor=e.anchor);-1<e.limit&&(t.newPagination.limit=e.limit),t.newPagination.limit!==t.startPagination.limit&&(t.newTotalPages=t.newPagination.limit?Math.max(Math.ceil(t.startState.matching.length/t.newPagination.limit),1):1),(t.newPagination.limit<=0||t.newPagination.limit===1/0)&&(t.newPagination.page=1)},getNextPage:function(){var e=-1;return e=(e=this.state.activePagination.page+1)>this.state.totalPages?this.config.pagination.loop?1:this.state.activePagination.page:e},getPrevPage:function(){var e=-1;return e=(e=this.state.activePagination.page-1)<1?this.config.pagination.loop?this.state.totalPages:this.state.activePagination.page:e},renderPageListEl:function(e,t){var i,r,n,o=this,a="",s=[],l=null,c=null,h=[],u=!1,d=!1,p=null,f=-1;if(t.newPagination.limit<0||t.newPagination.limit===1/0||t.newTotalPages<2&&o.config.pagination.hidePageListIfSinglePage)e.innerHTML="",g.addClass(e,o.classNamesPageList.disabled);else{for(i=t.newPagination.page-1,c="function"==typeof(c=o.config.render.pager)?c:null,o.config.pagination.maxPagers<1/0&&t.newTotalPages>o.config.pagination.maxPagers&&(h=o.getAllowedIndices(t)),(l=new m.ModelPager).isPrev=!0,l.classList.push(o.classNamesPager.base,o.classNamesPager.prev),1!==t.newPagination.page||o.config.pagination.loop||(l.classList.push(o.classNamesPager.disabled),l.isDisabled=!0),l.classNames=l.classList.join(" "),a=(c||g.template(o.config.templates.pagerPrev))(l),s.push(a),f=0;f<t.newTotalPages;f++)(a=o.renderPager(f,t,h))||f<i&&u||i<f&&d?a&&s.push(a):((l=new m.ModelPager).isTruncationMarker=!0,l.classList.push(o.classNamesPager.base,o.classNamesPager.truncationMarker),l.classNames=l.classList.join(" "),a=(c||g.template(o.config.templates.pagerTruncationMarker))(l),s.push(a),f<i&&(u=!0),i<f&&(d=!0));for((l=new m.ModelPager).isNext=!0,l.classList.push(o.classNamesPager.base,o.classNamesPager.next),t.newPagination.page!==t.newTotalPages||o.config.pagination.loop||l.classList.push(o.classNamesPager.disabled),l.classNames=l.classList.join(" "),a=(c||g.template(o.config.templates.pagerNext))(l),s.push(a),n=s.join(" "),e.innerHTML=n,r=e.querySelectorAll("."+o.classNamesPager.disabled),f=0;p=r[f];f++)"boolean"==typeof p.disabled&&(p.disabled=!0);u||d?g.addClass(e,o.classNamesPageList.truncated):g.removeClass(e,o.classNamesPageList.truncated),1<t.newTotalPages?g.removeClass(e,o.classNamesPageList.disabled):g.addClass(e,o.classNamesPageList.disabled)}},getAllowedIndices:function(e){var t,i=e.newPagination.page-1,e=e.newTotalPages-1,r=[],n=-1,o=-1,a=-1;for(r.push(0),n=this.config.pagination.maxPagers-2,o=0,(t=i-Math.ceil((n-1)/2))<1&&(o=1-t),a=t+(o=e-1<(t=i+Math.floor((n-1)/2))?e-1-t:o);n;)r.push(a),a++,n--;return r.push(e),r},renderPager:function(e,t,i){var r=this,n=null,o=t.newPagination.page-1,a=new m.ModelPager;return r.config.pagination.maxPagers<1/0&&i.length&&i.indexOf(e)<0?"":(n="function"==typeof(n=r.config.render.pager)?n:null,a.isPageLink=!0,a.classList.push(r.classNamesPager.base),0===e&&a.classList.push(r.classNamesPager.first),e===t.newTotalPages-1&&a.classList.push(r.classNamesPager.last),e===o&&a.classList.push(r.classNamesPager.active),a.classNames=a.classList.join(" "),a.pageNumber=e+1,(n||g.template(r.config.templates.pager))(a))},renderPageStatsEl:function(e,t){var i=this,r=new m.ModelPageStats,n=null,o="",a="";t.newPagination.limit<0||t.newPagination.limit===1/0||t.newTotalPages<2&&i.config.pagination.hidePageStatsIfSinglePage?(e.innerHTML="",g.addClass(e,i.classNamesPageStats.disabled)):(n="function"==typeof(n=i.config.render.pageStats)?n:null,r.totalTargets=t.matching.length,a=r.totalTargets?1===t.newPagination.limit?i.config.templates.pageStatsSingle:i.config.templates.pageStats:i.config.templates.pageStatsFail,r.totalTargets&&0<t.newPagination.limit?(r.startPageAt=(t.newPagination.page-1)*t.newPagination.limit+1,r.endPageAt=Math.min(r.startPageAt+t.newPagination.limit-1,r.totalTargets)):r.startPageAt=r.endPageAt=0,o=(n||g.template(a))(r),e.innerHTML=o,r.totalTargets?g.removeClass(e,i.classNamesPageStats.disabled):g.addClass(e,i.classNamesPageStats.disabled))},parsePaginateArgs:function(e){var t,i=new m.UserInstruction,r=-1;for(i.animate=this.config.animation.enable,i.command=new m.CommandPaginate,r=0;r<e.length;r++)null!==(t=e[r])&&("object"==typeof t&&g.isElement(t,this.dom.document)?i.command.anchor=t:t instanceof m.CommandPaginate||"object"==typeof t?g.extend(i.command,t):"number"==typeof t?i.command.page=t:"string"!=typeof t||isNaN(parseInt(t))?"string"==typeof t?i.command.action=t:"boolean"==typeof t?i.animate=t:"function"==typeof t&&(i.callback=t):i.command.page=parseInt(t));return g.freeze(i),i},paginate:function(){var e=this.parsePaginateArgs(arguments);return this.multimix({paginate:e.command},e.animate,e.callback)},nextPage:function(){var e=this.parsePaginateArgs(arguments);return this.multimix({paginate:{action:"next"}},e.animate,e.callback)},prevPage:function(){var e=this.parsePaginateArgs(arguments);return this.multimix({paginate:{action:"prev"}},e.animate,e.callback)}}),m.Facade.registerAction("afterConstruct","pagination",function(e){this.paginate=e.paginate.bind(e),this.nextPage=e.nextPage.bind(e),this.prevPage=e.prevPage.bind(e)})}if(t.TYPE="mixitup-extension",t.NAME="mixitup-pagination",t.EXTENSION_VERSION="3.2.0",t.REQUIRE_CORE_VERSION="^3.1.8","object"==typeof exports&&"object"==typeof module)module.exports=t;else if("function"==typeof define&&define.amd)define(function(){return t});else{if(!e.mixitup||"function"!=typeof e.mixitup)throw new Error("[MixItUp Pagination] MixItUp core not found");t(e.mixitup)}}(window),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i,r=t();for(i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(self,function(){return e=W={},"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0}),Mi="fslightbox-",e="".concat(Mi,"styles"),Ii="".concat(Mi,"full-dimension"),Pi="".concat(Mi,"cursor-grabbing"),Li="".concat(Mi,"flex-centered"),g="".concat(Mi,"open"),Di="".concat(Mi,"transform-transition"),ki="".concat(Mi,"absoluted"),a="".concat(Mi,"slide-btn"),c="".concat(a,"-container"),H="".concat(Mi,"fade-in"),zi="".concat(Mi,"fade-out"),Ri=H+"-strong",Z=zi+"-strong",Oi="".concat(Mi,"caption"),sr=Oi+"-inner",Bi=Oi+"-active",t="".concat(Mi,"opacity-"),Fi="".concat(t,"0"),Ni="".concat(t,"1"),u="".concat(Mi,"source"),lr="".concat(u,"-wrappers-container"),$="".concat(lr,"-pinching"),d="".concat(Mi,"thumb"),Ui=d+"s",cr="".concat(Ui,"-loader"),hr="".concat(Ui,"-cursorer"),ur="".concat(Ui,"-inner"),ji=d+"s-active",Y=(X=d+"-wrapper")+"-darkener",K=d+"-invalid",p=d+"-active","object"===("undefined"==typeof document?"undefined":r(document))&&((t=document.createElement("style")).className=e,t.appendChild(document.createTextNode(".fslightbox-fade-in{animation:fslightbox-fade-in .3s cubic-bezier(0,0,.7,1)}.fslightbox-fade-out{animation:fslightbox-fade-out .3s ease}.fslightbox-fade-in-strong{animation:fslightbox-fade-in-strong forwards .3s cubic-bezier(0,0,.7,1)}.fslightbox-fade-out-strong{animation:fslightbox-fade-out-strong .3s ease}@keyframes fslightbox-fade-in{from{opacity:.65}to{opacity:1}}@keyframes fslightbox-fade-out{from{opacity:.35}to{opacity:0}}@keyframes fslightbox-fade-in-strong{from{opacity:.3}to{opacity:1}}@keyframes fslightbox-fade-out-strong{from{opacity:1}to{opacity:0}}.fslightbox-absoluted{position:absolute;top:0;left:0}.fslightbox-cursor-grabbing{cursor:grabbing!important}.fslightbox-full-dimension{width:100%;height:100%}.fslightbox-open{overflow:hidden;height:100%}.fslightbox-flex-centered{display:flex;justify-content:center;align-items:center}.fslightbox-opacity-0{opacity:0!important}.fslightbox-opacity-1{opacity:1!important}.fslightbox-scrollbarfix{padding-right:17px}.fslightbox-transform-transition{transition:transform .3s!important}.fslightbox-container{font-family:Arial,sans-serif;position:fixed;top:0;left:0;background:linear-gradient(rgba(30,30,30,.9),#000 1810%);touch-action:none;z-index:1000000000;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.fslightbox-container *{box-sizing:border-box}.fslightbox-svg-path{transition:fill .15s ease;fill:#d1d2d2}.fslightbox-loader{display:block;margin:auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:67px;height:67px}.fslightbox-loader-child{box-sizing:border-box;display:block;position:absolute;width:54px;height:54px;margin:6px;border:5px solid;border-color:#999 transparent transparent transparent;border-radius:50%;animation:fslightbox-loader 1.2s cubic-bezier(.5,0,.5,1) infinite}.fslightbox-loader-child:nth-child(1){animation-delay:-.45s}.fslightbox-loader-child:nth-child(2){animation-delay:-.3s}.fslightbox-loader-child:nth-child(3){animation-delay:-.15s}@keyframes fslightbox-loader{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.fslightbox-thumbs-loader{width:54px!important;height:54px!important}.fslightbox-thumbs-loader div{border-width:4px!important;width:44px!important;height:44px!important}.fslightbox-nav{height:45px;width:100%;transition:opacity .3s}.fslightbox-slide-number-container{display:flex;justify-content:center;align-items:center;position:relative;height:100%;font-size:15px;color:#d7d7d7;z-index:0;max-width:55px;text-align:left}.fslightbox-slide-number-container .fslightbox-flex-centered{height:100%}.fslightbox-slash{display:block;margin:0 5px;width:1px;height:12px;transform:rotate(15deg);background:#fff}.fslightbox-toolbar{position:absolute;z-index:3;right:0;top:0;height:45px;display:flex;background:rgba(35,35,35,.65)}.fslightbox-toolbar-button{height:100%;width:45px;cursor:pointer}.fslightbox-toolbar-button:hover .fslightbox-svg-path{fill:#fff}.fslightbox-slide-btn-container{display:flex;align-items:center;padding:12px 12px 12px 6px;position:absolute;top:50%;cursor:pointer;z-index:3;transform:translateY(-50%);transition:opacity .3s}@media (min-width:476px){.fslightbox-slide-btn-container{padding:22px 22px 22px 6px}}@media (min-width:768px){.fslightbox-slide-btn-container{padding:30px 30px 30px 6px}}.fslightbox-slide-btn-container:hover .fslightbox-svg-path{fill:#f1f1f1}.fslightbox-slide-btn{padding:9px;font-size:26px;background:rgba(35,35,35,.65)}@media (min-width:768px){.fslightbox-slide-btn{padding:10px}}@media (min-width:1600px){.fslightbox-slide-btn{padding:11px}}.fslightbox-slide-btn-container-previous{left:0}@media (max-width:475.99px){.fslightbox-slide-btn-container-previous{padding-left:3px}}.fslightbox-slide-btn-container-next{right:0;padding-left:12px;padding-right:3px}@media (min-width:476px){.fslightbox-slide-btn-container-next{padding-left:22px}}@media (min-width:768px){.fslightbox-slide-btn-container-next{padding-left:30px}}@media (min-width:476px){.fslightbox-slide-btn-container-next{padding-right:6px}}.fslightbox-down-event-detector{position:absolute;z-index:1}.fslightbox-slide-swiping-hoverer{z-index:4}.fslightbox-slideshow-bar{width:0;height:2px;z-index:4;opacity:0;background:#fff}.fslightbox-invalid-file-wrapper{font-size:24px;color:#eaebeb;margin:auto}.fslightbox-video{object-fit:cover}.fslightbox-youtube-iframe{border:0}.fslightbox-source{position:relative;z-index:2;display:block;opacity:0;margin:auto;cursor:zoom-in}.fslightbox-source-wrappers-container{transition:transform .2s linear;z-index:2}.fslightbox-source-wrappers-container-pinching{transition:none!important}.fslightbox-thumbs{position:absolute;bottom:0;left:0;width:100%;z-index:-1;background:linear-gradient(180deg,rgba(0,0,0,0),#1e1e1e 100%);opacity:0;transition:opacity .2s;padding:0 5px 12px 5px;height:114px}@media (min-width:992px){.fslightbox-thumbs{padding-bottom:13px;height:120px}}@media (min-width:1600px){.fslightbox-thumbs{padding-bottom:14px;height:126px}}.fslightbox-thumbs-active{opacity:1;z-index:3}.fslightbox-thumbs-inner{display:inline-flex;justify-content:flex-start;align-items:center;height:100%}.fslightbox-thumb-wrapper{position:relative;height:100%;margin:0 4px;opacity:0;transition:opacity .3s}.fslightbox-thumb-wrapper svg{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);cursor:pointer;z-index:1}.fslightbox-thumb-wrapper path{fill:#fff}.fslightbox-thumb-wrapper-darkener{position:absolute;top:2px;left:2px;width:calc(100% - 4px);height:calc(100% - 4px);background:rgba(0,0,0,.4);cursor:pointer}.fslightbox-thumb{cursor:pointer;border-radius:1px;height:100%;width:auto!important;border:2px solid transparent;max-width:unset;max-height:unset}.fslightbox-thumb-active{border:2px solid #fff!important}.fslightbox-thumb-invalid{background:linear-gradient(to bottom,#0f0f0f,rgba(15,15,15,.5));display:inline-block;min-width:155px}.fslightbox-thumbs-cursorer{z-index:4;cursor:grabbing}.fslightbox-caption{position:absolute;bottom:0;left:50%;width:100%;background:linear-gradient(180deg,rgba(0,0,0,0),#1e1e1e 100%);transform:translateX(-50%);opacity:0;transition:opacity .2s;z-index:-1}.fslightbox-caption-inner{padding:25px;max-width:1200px;color:#eee;text-align:center;font-size:14px}@media (min-width:768px){.fslightbox-caption-inner{padding:30px 25px}}.fslightbox-caption-active{opacity:1;z-index:3}")),document.head.appendChild(t)),J="fslightbox-types",dr="fslightbox-scrollbar-width",f="image",Q="video",ee="youtube",pr="custom",m="invalid",window.FsLightbox=function(){var r=this;this.props={sources:[],maxYoutubeDimensions:null,customAttributes:[],customClasses:[],types:[],type:null,thumbs:[],thumbsIcons:[],captions:[],videosPosters:[],customToolbarButtons:[],initialAnimation:Ri,slideChangeAnimation:H,slideDistance:.3,slideshowTime:8e3,UIFadeOutTime:8e3,zoomIncrement:.25,toolbarButtons:{thumbs:{width:"17px",height:"17px",viewBox:"0 0 22 22",d:"M 3 2 C 2.448 2 2 2.448 2 3 L 2 6 C 2 6.552 2.448 7 3 7 L 6 7 C 6.552 7 7 6.552 7 6 L 7 3 C 7 2.448 6.552 2 6 2 L 3 2 z M 10 2 C 9.448 2 9 2.448 9 3 L 9 6 C 9 6.552 9.448 7 10 7 L 13 7 C 13.552 7 14 6.552 14 6 L 14 3 C 14 2.448 13.552 2 13 2 L 10 2 z M 17 2 C 16.448 2 16 2.448 16 3 L 16 6 C 16 6.552 16.448 7 17 7 L 20 7 C 20.552 7 21 6.552 21 6 L 21 3 C 21 2.448 20.552 2 20 2 L 17 2 z M 3 9 C 2.448 9 2 9.448 2 10 L 2 13 C 2 13.552 2.448 14 3 14 L 6 14 C 6.552 14 7 13.552 7 13 L 7 10 C 7 9.448 6.552 9 6 9 L 3 9 z M 10 9 C 9.448 9 9 9.448 9 10 L 9 13 C 9 13.552 9.448 14 10 14 L 13 14 C 13.552 14 14 13.552 14 13 L 14 10 C 14 9.448 13.552 9 13 9 L 10 9 z M 17 9 C 16.448 9 16 9.448 16 10 L 16 13 C 16 13.552 16.448 14 17 14 L 20 14 C 20.552 14 21 13.552 21 13 L 21 10 C 21 9.448 20.552 9 20 9 L 17 9 z M 3 16 C 2.448 16 2 16.448 2 17 L 2 20 C 2 20.552 2.448 21 3 21 L 6 21 C 6.552 21 7 20.552 7 20 L 7 17 C 7 16.448 6.552 16 6 16 L 3 16 z M 10 16 C 9.448 16 9 16.448 9 17 L 9 20 C 9 20.552 9.448 21 10 21 L 13 21 C 13.552 21 14 20.552 14 20 L 14 17 C 14 16.448 13.552 16 13 16 L 10 16 z M 17 16 C 16.448 16 16 16.448 16 17 L 16 20 C 16 20.552 16.448 21 17 21 L 20 21 C 20.552 21 21 20.552 21 20 L 21 17 C 21 16.448 20.552 16 20 16 L 17 16 z",title:"Thumbnails"},zoomIn:{width:"20px",height:"20px",viewBox:"0 0 30 30",d:"M 13 3 C 7.4889971 3 3 7.4889971 3 13 C 3 18.511003 7.4889971 23 13 23 C 15.396508 23 17.597385 22.148986 19.322266 20.736328 L 25.292969 26.707031 A 1.0001 1.0001 0 1 0 26.707031 25.292969 L 20.736328 19.322266 C 22.148986 17.597385 23 15.396508 23 13 C 23 7.4889971 18.511003 3 13 3 z M 13 5 C 17.430123 5 21 8.5698774 21 13 C 21 17.430123 17.430123 21 13 21 C 8.5698774 21 5 17.430123 5 13 C 5 8.5698774 8.5698774 5 13 5 z M 12.984375 7.9863281 A 1.0001 1.0001 0 0 0 12 9 L 12 12 L 9 12 A 1.0001 1.0001 0 1 0 9 14 L 12 14 L 12 17 A 1.0001 1.0001 0 1 0 14 17 L 14 14 L 17 14 A 1.0001 1.0001 0 1 0 17 12 L 14 12 L 14 9 A 1.0001 1.0001 0 0 0 12.984375 7.9863281 z",title:"Zoom In"},zoomOut:{width:"20px",height:"20px",viewBox:"0 0 30 30",d:"M 13 3 C 7.4889971 3 3 7.4889971 3 13 C 3 18.511003 7.4889971 23 13 23 C 15.396508 23 17.597385 22.148986 19.322266 20.736328 L 25.292969 26.707031 A 1.0001 1.0001 0 1 0 26.707031 25.292969 L 20.736328 19.322266 C 22.148986 17.597385 23 15.396508 23 13 C 23 7.4889971 18.511003 3 13 3 z M 13 5 C 17.430123 5 21 8.5698774 21 13 C 21 17.430123 17.430123 21 13 21 C 8.5698774 21 5 17.430123 5 13 C 5 8.5698774 8.5698774 5 13 5 z M 9 12 A 1.0001 1.0001 0 1 0 9 14 L 17 14 A 1.0001 1.0001 0 1 0 17 12 L 9 12 z",title:"Zoom Out"},slideshow:{start:{width:"16px",height:"16px",viewBox:"0 0 30 30",d:"M 6 3 A 1 1 0 0 0 5 4 A 1 1 0 0 0 5 4.0039062 L 5 15 L 5 25.996094 A 1 1 0 0 0 5 26 A 1 1 0 0 0 6 27 A 1 1 0 0 0 6.5800781 26.8125 L 6.5820312 26.814453 L 26.416016 15.908203 A 1 1 0 0 0 27 15 A 1 1 0 0 0 26.388672 14.078125 L 6.5820312 3.1855469 L 6.5800781 3.1855469 A 1 1 0 0 0 6 3 z",title:"Turn on slideshow"},pause:{width:"14px",height:"14px",viewBox:"0 0 356.19 356.19",d:"M121,0c18,0,33,15,33,33v372c0,18-15,33-33,33s-32-15-32-33V33C89,15,103,0,121,0zM317,0c18,0,32,15,32,33v372c0,18-14,33-32,33s-33-15-33-33V33C284,15,299,0,317,0z",title:"Turn off slideshow"}},fullscreen:{enter:{width:"20px",height:"20px",viewBox:"0 0 18 18",d:"M4.5 11H3v4h4v-1.5H4.5V11zM3 7h1.5V4.5H7V3H3v4zm10.5 6.5H11V15h4v-4h-1.5v2.5zM11 3v1.5h2.5V7H15V3h-4z",title:"Enter fullscreen"},exit:{width:"24px",height:"24px",viewBox:"0 0 950 1024",d:"M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z",title:"Exit fullscreen"}},close:{width:"20px",height:"20px",viewBox:"0 0 24 24",d:"M 4.7070312 3.2929688 L 3.2929688 4.7070312 L 10.585938 12 L 3.2929688 19.292969 L 4.7070312 20.707031 L 12 13.414062 L 19.292969 20.707031 L 20.707031 19.292969 L 13.414062 12 L 20.707031 4.7070312 L 19.292969 3.2929688 L 12 10.585938 L 4.7070312 3.2929688 z",title:"Close"}},slideButtons:{previous:{width:"20px",height:"20px",viewBox:"0 0 20 20",d:"M18.271,9.212H3.615l4.184-4.184c0.306-0.306,0.306-0.801,0-1.107c-0.306-0.306-0.801-0.306-1.107,0L1.21,9.403C1.194,9.417,1.174,9.421,1.158,9.437c-0.181,0.181-0.242,0.425-0.209,0.66c0.005,0.038,0.012,0.071,0.022,0.109c0.028,0.098,0.075,0.188,0.142,0.271c0.021,0.026,0.021,0.061,0.045,0.085c0.015,0.016,0.034,0.02,0.05,0.033l5.484,5.483c0.306,0.307,0.801,0.307,1.107,0c0.306-0.305,0.306-0.801,0-1.105l-4.184-4.185h14.656c0.436,0,0.788-0.353,0.788-0.788S18.707,9.212,18.271,9.212z",title:"Previous"},next:{width:"20px",height:"20px",viewBox:"0 0 20 20",d:"M1.729,9.212h14.656l-4.184-4.184c-0.307-0.306-0.307-0.801,0-1.107c0.305-0.306,0.801-0.306,1.106,0l5.481,5.482c0.018,0.014,0.037,0.019,0.053,0.034c0.181,0.181,0.242,0.425,0.209,0.66c-0.004,0.038-0.012,0.071-0.021,0.109c-0.028,0.098-0.075,0.188-0.143,0.271c-0.021,0.026-0.021,0.061-0.045,0.085c-0.015,0.016-0.034,0.02-0.051,0.033l-5.483,5.483c-0.306,0.307-0.802,0.307-1.106,0c-0.307-0.305-0.307-0.801,0-1.105l4.184-4.185H1.729c-0.436,0-0.788-0.353-0.788-0.788S1.293,9.212,1.729,9.212z",title:"Next"}}},this.data={isInitialized:!1,isThumbing:!1,maxSourceWidth:0,maxSourceHeight:0,scrollbarWidth:0,isFullscreenOpen:!1,isSlideshowOn:!1,captionHeights:[],notThumbedSourceEnhancementWrapperScales:[],notThumbedSourceEnhancementWrapperTranslatesY:[],zoom:1},this.sourcePointerProps={isPointering:!1,pointers:{},pointersCount:0,downScreenX:null,downScreenY:null,isSourceDownEventTarget:!1,swipedX:0,swipedY:0,upSwipedX:0,upSwipedY:0,pinchedHypot:0},this.stageIndexes={},this.elements={a:[],captions:[],container:null,nav:null,slideSwipingHoverer:null,slideButtonPrevious:null,slideButtonNext:null,sourceWrappersContainer:null,slideshowBar:null,sourceAnimationWrappers:[],sourceEnhancementWrappers:[],sourceTurboWrappers:[],sourceMainWrappers:[],sourceZoomWrappers:[],sources:[]},this.componentsServices={enterFullscreen:null,exitFullscreen:null,setSlideNumber:function(){},startSlideshow:null,stopSlideshow:null},this.middleware=function(e,t){return n=e,o=t,a=[r],function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var r=[].concat(j(a),t);o.apply(void 0,j(r))&&n.apply(void 0,t)};var n,o,a},this.resolve=function(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return i.unshift(r),V(e,function(e){if(Array.isArray(e))return n(e)}(t=i)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(e){var t;if(e)return"string"==typeof e?n(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(e,void 0):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())},this.collections={sourceMainWrapperTransformers:[],sourceLoadHandlers:[],sourcesRenderFunctions:[],sourceSizers:[]},this.core={captionsActioner:{},classFacade:{},clickZoomer:{},eventsDispatcher:{},fullscreenToggler:{},globalEventsController:{},inactiver:{},lightboxCloser:{},lightboxOpener:{},lightboxUpdater:{},pointeringBucket:{},scrollbarRecompensor:{},slideshowManager:{},slideChangeFacade:{},slideIndexChanger:{},sourceDisplayFacade:{},sourceEnhancementWrappersTransformer:{},sourceLoadersManager:{},sourcesPointerDown:{},stageManager:{},swipingActioner:{},windowResizeActioner:{},zoomer:{}},ar(this),this.open=this.core.lightboxOpener.open,this.close=function(){return r.core.lightboxCloser.close()}},window.fsLightboxInstances={},q(),window.refreshFsLightbox=function(){for(var e in fsLightboxInstances){var t=fsLightboxInstances[e].props;fsLightboxInstances[e]=new FsLightbox,fsLightboxInstances[e].props=t,fsLightboxInstances[e].props.sources=[],fsLightboxInstances[e].elements.a=[]}q()},W;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vi(e){var o,e=e.props,a=0,s={},t=(this.getSourceTypeFromLocalStorageByUrl=function(e){return o[e]||t(e)},this.handleReceivedSourceTypeForUrl=function(e,t){if(!1===s[t]&&(a--,"invalid"!==e?s[t]=e:delete s[t],0===a)){var i,r=o,n=s;for(i in n)r[i]=n[i];localStorage.setItem(J,JSON.stringify(o))}},function(e){a++,s[e]=!1});e.disableLocalStorage?(this.getSourceTypeFromLocalStorageByUrl=function(){},this.handleReceivedSourceTypeForUrl=function(){}):(o=JSON.parse(localStorage.getItem(J)))||(o={},this.getSourceTypeFromLocalStorageByUrl=t)}function _(e,t,i,r){var n=e.data,o=e.elements.sources,a=i/r,s=0,l=(this.adjustSize=function(){if((s=n.maxSourceWidth/a)<n.maxSourceHeight)return i<n.maxSourceWidth&&(s=r),l();s=r>n.maxSourceHeight?n.maxSourceHeight:r,l()},function(){var e=o[t].style;e.width=s*a+"px",e.height=s+"px"})}function y(e,i){var r=this,n=e.collections.sourceSizers,t=e.core,o=t.sourceEnhancementWrappersTransformer,a=t.sourceLoadersManager,t=e.elements,s=t.sourceAnimationWrappers,l=t.sourceEnhancementWrappers,c=(t.sourceMainWrappers,t.sources),h=e.resolve;function u(e,t){n[i]=h(_,[i,e,t]),n[i].adjustSize()}this.runActions=function(e,t){c[i].classList.add(Ni),s[i].classList.add(Ri),a.handleSourceLoad(i),o.ifSourceIsLoadedTransformEnhancementWrapperAtIndex(i),requestAnimationFrame(function(){requestAnimationFrame(function(){l[i].classList.add(Di)})}),u(e,t),r.runActions=u}}function v(e,t){var i,r=this,n=e.elements.sources,o=e.props,a=(0,e.resolve)(y,[t]);this.handleImageLoad=function(e){var e=e.target,t=e.naturalWidth,e=e.naturalHeight;a.runActions(t,e)},this.handleVideoLoad=function(e){var e=e.target,t=e.videoWidth,e=e.videoHeight;i=!0,a.runActions(t,e)},this.handleNotMetaDatedVideoLoad=function(){i||r.handleYoutubeLoad()},this.handleYoutubeLoad=function(){var e=1920,t=1080;o.maxYoutubeDimensions&&(e=o.maxYoutubeDimensions.width,t=o.maxYoutubeDimensions.height),a.runActions(e,t)},this.handleCustomLoad=function(){setTimeout(function(){var e=n[t];a.runActions(e.offsetWidth,e.offsetHeight)})}}function s(e,t,i){var r=e.elements.sources,e=e.props.customClasses,e=e[t]||"";r[t].className=i+" "+e}function l(e,t){var i,r=e.elements.sources,n=e.props.customAttributes;for(i in n[t])r[t].setAttribute(i,n[t][i])}function x(e,t){var i=e.collections.sourceLoadHandlers,r=e.elements,n=r.sources,r=r.sourceAnimationWrappers,o=e.props.sources;n[t]=document.createElement("img"),s(e,t,u),n[t].src=o[t],n[t].onload=i[t].handleImageLoad,l(e,t),r[t].appendChild(n[t])}function b(e,t){var i=e.collections.sourceLoadHandlers,r=e.elements,n=r.sources,r=r.sourceAnimationWrappers,o=e.props,a=o.sources,o=o.videosPosters,e=(n[t]=document.createElement("video"),s(e,t,u),n[t].src=a[t],n[t].onloadedmetadata=function(e){i[t].handleVideoLoad(e)},n[t].controls=!0,l(e,t),o[t]&&(n[t].poster=o[t]),document.createElement("source"));e.src=a[t],n[t].appendChild(e),setTimeout(i[t].handleNotMetaDatedVideoLoad,3e3),r[t].appendChild(n[t])}function w(e,t){var i=e.collections.sourceLoadHandlers,r=e.elements,n=r.sources,r=r.sourceAnimationWrappers,o=e.props.sources;n[t]=document.createElement("iframe"),s(e,t,"".concat(u," ").concat(Mi,"youtube-iframe")),n[t].src="https://www.youtube.com/embed/".concat(o[t].match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/)[2],"?enablejsapi=1"),n[t].allowFullscreen=!0,l(e,t),r[t].appendChild(n[t]),i[t].handleYoutubeLoad()}function T(e,t){var i=e.collections.sourceLoadHandlers,r=e.elements,n=r.sources,r=r.sourceAnimationWrappers,o=e.props.sources;n[t]=o[t],s(e,t,"".concat(n[t].className," ").concat(u)),r[t].appendChild(n[t]),i[t].handleCustomLoad()}function S(e,t){var i=e.core.sourceLoadersManager,r=(e.data.isSourceLoaded,e.elements),n=r.sources,o=r.sourceAnimationWrappers;r.sourceMainWrappers,e.props.sources,n[t]=document.createElement("div"),n[t].className="".concat(Mi,"invalid-file-wrapper ").concat(Li," ").concat(Ri),n[t].innerHTML="Invalid source",i.handleSourceLoad(t),o[t].appendChild(n[t])}function A(e,t,i){var e=e.props.thumbsIcons;e[i]&&(t.appendChild(e[i]),(e=document.createElement("div")).className=Y,t.appendChild(e))}function E(e,t,i){var r,n,o,a,s=e.elements,l=s.thumbsWrappers,s=s.thumbsInner;l[t]=document.createElement("div"),l[t].className=X,A(e,l[t],t),r=l[t],n=t,i=i,o=e.core.thumbLoadHandler.handleLoad,a=e.elements.thumbs,e=e.stageIndexes.current,a[n]=document.createElement("img"),a[n].src=i,i=d,e===n&&(i+=" ".concat(p)),a[n].className=i,a[n].onload=o,r.appendChild(a[n]),s.appendChild(l[t])}function bi(e,t,i,r,n){var o=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=(o.setAttributeNS(null,"width",t),o.setAttributeNS(null,"height",t),o.setAttributeNS(null,"viewBox",r),document.createElementNS("http://www.w3.org/2000/svg","path"));return t.setAttributeNS(null,"class","".concat(Mi,"svg-path")),t.setAttributeNS(null,"d",n),o.appendChild(t),e.appendChild(o),o}function C(h){var t=h.core.thumbsRenderDispatcher,i=h.data,e=h.props,r=e.showThumbsOnMount,n=e.sources,o=e.thumbs;this.buildThumbForTypeAndIndex=function(e,c){e=o[c]?function(){return E(h,c,o[c])}:e===f?function(){return E(h,c,n[c])}:function(){return t=c,s=(e=h).elements,l=s.thumbsWrappers,s=s.thumbsInner,l[t]=document.createElement("div"),l[t].className="".concat(K," ").concat(X),A(e,l[t],t),i=l[t],r=t,n=e.core.thumbLoadHandler.handleLoad,o=e.elements.thumbs,e=e.stageIndexes.current,o[r]=document.createElement("div"),a="".concat(d," ").concat(Li),e===r&&(a+=" ".concat(p)),o[r].className=a,bi(o[r],"22px",0,"0 0 30 30","M15,3C8.373,3,3,8.373,3,15c0,6.627,5.373,12,12,12s12-5.373,12-12C27,8.373,21.627,3,15,3z M16.212,8l-0.2,9h-2.024l-0.2-9 H16.212z M15.003,22.189c-0.828,0-1.323-0.441-1.323-1.182c0-0.755,0.494-1.196,1.323-1.196c0.822,0,1.316,0.441,1.316,1.196 C16.319,21.748,15.825,22.189,15.003,22.189z"),i.appendChild(o[r]),setTimeout(n),void s.appendChild(l[t]);var e,t,i,r,n,o,a,s,l};t.addFunctionToToBeRenderedAtIndex(e,c),(r||i.isThumbing)&&t.renderThumbsIfNotYetAndAllTypesDetected()}}function Gi(r){var n,e=r.collections,o=e.sourceLoadHandlers,a=e.sourcesRenderFunctions,s=r.core.sourceDisplayFacade,l=r.props.disableThumbs,c=r.resolve;l||(n=c(C)),this.runActionsForSourceTypeAndIndex=function(e,t){var i;switch(e!==m&&(o[t]=c(v,[t])),e){case f:i=x;break;case Q:i=b;break;case ee:i=w;break;case pr:i=T;break;default:i=S}a[t]=function(){return i(r,t)},s.displaySourcesWhichShouldBeDisplayed(),l||n.buildThumbForTypeAndIndex(e,t)}}function M(){var r,n,o;function a(){if(4!==o.readyState){if(2===o.readyState){var e;switch((t=o.getResponseHeader("content-type")).slice(0,t.indexOf("/"))){case"image":e=f;break;case"video":e=Q;break;default:e=m}o.onreadystatechange=null,o.abort(),n(e)}}else n(m);var t}this.setUrlToCheck=function(e){r=e},this.getSourceType=function(e){if(t=r,(i=document.createElement("a")).href=t,"www.youtube.com"===i.hostname)return e(ee);var t,i;n=e,(o=new XMLHttpRequest).onreadystatechange=a,o.open("GET",r,!0),o.send()}}function qi(e,i,r){var t=e.props,n=t.types,o=t.type,a=t.sources,s=e.resolve;this.getTypeSetByClientForIndex=function(e){var t;return n&&n[e]?t=n[e]:o&&(t=o),t},this.retrieveTypeWithXhrForIndex=function(t){var e=s(M);e.setUrlToCheck(a[t]),e.getSourceType(function(e){i.handleReceivedSourceTypeForUrl(e,a[t]),r.runActionsForSourceTypeAndIndex(e,t)})}}function Wi(e,t){e=e.sourcePointerProps,e.pointers[t.pointerId]={screenX:t.screenX,screenY:t.screenY},t=Object.keys(e.pointers).length;return(e.pointersCount=t)<=2}function wi(e,t){var i=document.createElement("div");return i.className="".concat(Mi,"toolbar-button ").concat(Li),i.title=t,e.appendChild(i),i}function Ti(e,t,i){e=wi(e,t.title);e.onclick=i,bi(e,t.width,t.height,t.viewBox,t.d)}function Hi(e,t){var i=this,r=e.elements.sourceMainWrappers,n=e.props,o=0,a=0,s=0,l=(this.translate=function(e,t){return a=e,void 0!==t&&(s=t),i},this.getTranslateX=function(){return o},this.getTranslateY=function(){return s},this.negative=function(){l(-(1+n.slideDistance)*innerWidth)},this.zero=function(){l(0)},this.positive=function(){l((1+n.slideDistance)*innerWidth)},function(e){o=e+a,c(),a=0}),c=function(){r[t].style.transform="translate(".concat(o,"px, ").concat(s,"px)")}}function Zi(e,t){var i=e.core.slideChangeFacade,r=e.elements,e=e.props.slideButtons,n=t.charAt(0).toUpperCase()+t.slice(1),o="slideButton".concat(n),e=e[t];r[o]=document.createElement("div"),r[o].className="".concat(c," ").concat(c,"-").concat(t),r[o].title=e.title,r[o].onclick=i["changeTo".concat(n)],t=r[o],i=e,(n=document.createElement("div")).className="".concat(a," ").concat(Li),bi(n,i.width,i.height,i.viewBox,i.d),t.appendChild(n),r.container.appendChild(r[o])}function $i(e){var t=e.componentsServices,i=e.core,r=i.sourceEnhancementWrappersTransformer,n=i.thumbsRenderDispatcher,o=i.zoomer,a=e.data,s=e.elements,l=e.props.sources,c=e.stageIndexes;function h(){for(var e=0;e<l.length;e++)r.ifSourceIsLoadedTransformEnhancementWrapperAtIndex(e)}function u(e){s.captions[c.current]&&s.captions[c.current].classList[e](Bi)}this.openThumbs=function(){o.ifZoomingResetZoom(),a.isThumbing=!0,s.thumbsContainer.classList.add(ji),h(),u("remove"),n.renderThumbsIfNotYetAndAllTypesDetected(),a.unloadedThumbsCount&&t.appendThumbsLoaderIfNotYet()},this.closeThumbs=function(){o.ifZoomingResetZoom(),a.isThumbing=!1,s.thumbsContainer.classList.remove(ji),h(),u("add")}}function Si(e,t){e=e.classList;e.contains(t)&&e.remove(t)}function Ai(e,t){e=e.classList;e.contains(t)||e.add(t)}function Xi(e){var r=e.data,n=e.elements,o=e.stageIndexes,a=(this.runActions=function(){Si(n.thumbsContainer,Li);var e=innerWidth/2,t=n.thumbsWrappers[o.current],t=t.offsetLeft+t.offsetWidth/2,i=r.thumbsInnerWidth-t;e<t&&e<i?a(e-t):e<t?a(innerWidth-r.thumbsInnerWidth-9):e<i&&a(0)},this.runToThinThumbsActions=function(){Ai(n.thumbsContainer,Li),a(0)},function(e){r.thumbsTransform=e,n.thumbsInner.style.transform="translateX(".concat(e,"px)")})}function Ei(e,t){var i=[];return function(){i.push(!0),setTimeout(function(){i.pop(),i.length||e()},t)}}function Yi(e){var t="fslightbox-loader",i=document.createElement("div");i.className=t;for(var r=0;r<3;r++){var n=document.createElement("div");n.className="".concat(t,"-child"),i.appendChild(n)}return e.appendChild(i),i}function Ki(e){var t=this,i=e.core,r=i.eventsDispatcher,n=i.fullscreenToggler,o=i.globalEventsController,a=i.scrollbarRecompensor,s=i.slideshowManager,l=i.zoomer,c=e.data,h=e.elements,u=e.props,d=e.sourcePointerProps,p=e.thumbsSwipingProps;this.isLightboxFadingOut=!1,this.runActions=function(){t.isLightboxFadingOut=!0,h.container.classList.add(Z),o.removeListeners(),s.resetSlideshow(),u.exitFullscreenOnClose&&c.isFullscreenOpen&&n.exitFullscreen(),l.ifZoomingResetZoom(),setTimeout(function(){t.isLightboxFadingOut=!1,d.isPointering=!1,p&&(p.isPointering=!1),h.container.classList.remove(Z),document.documentElement.classList.remove(g),a.removeRecompense(),document.body.removeChild(h.container),r.dispatch("onClose")},270)}}function Ji(e,t){var i=e.elements.thumbs,e=e.stageIndexes;i&&i[e.current]&&(i[e.current].classList.remove(p),i[t].classList.add(p))}function Qi(e){var t,i=e.core,r=i.slideshowManager,n=i.slideChangeFacade,o=e.componentsServices,a=e.elements,s=e.props,l=!1;function c(){l=!1,clearTimeout(t),a.slideshowBar.classList.remove(Ni),o.stopSlideshow()}r.toggleSlideshow=function(){(l?c:(l=!0,o.startSlideshow(),a.slideshowBar.classList.add(Ni),function e(){a.slideshowBar.style.transition="opacity .2s",a.slideshowBar.style.width="0px",a.slideshowBar.offsetWidth,a.slideshowBar.style.transition="opacity .2s, width linear ".concat(s.slideshowTime,"ms"),a.slideshowBar.style.width=innerWidth+"px",t=setTimeout(function(){n.changeToNext(),e()},s.slideshowTime)}))()},r.resetSlideshow=function(){l&&c()}}function Ci(e){return!e.sourcePointerProps.isPointering}function er(e){var t=e.core,i=t.clickZoomer,r=t.fullscreenToggler,n=t.lightboxCloser,o=t.slideChangeFacade,a=t.slideshowManager,s=t.thumbsToggler,l=e.middleware,c=e.props;this.listener=function(e){if("Space"!==e.code)switch(e.key){case"Escape":n.close();break;case"ArrowLeft":o.changeToPrevious();break;case"ArrowRight":o.changeToNext();break;case"t":c.disableThumbs||s.toggleThumbs();break;case"+":l(i.zoomIn,Ci)();break;case"-":l(i.zoomOut,Ci)();break;case"F11":e.preventDefault(),r.enterFullscreen()}else a.toggleSlideshow()}}function I(e){var t=e.core.pointeringBucket,i=e.data,r=e.elements,n=e.thumbsSwipingProps;this.runActions=function(e){t.runSwipingMoveActionsForPropsAndEvent(n,e),r.thumbsInner.style.transform="translateX(".concat(i.thumbsTransform+n.swipedX,"px)"),r.thumbsContainer.contains(r.thumbsCursorer)||r.thumbsContainer.appendChild(r.thumbsCursorer)}}function P(e){var t=e.data,i=e.resolve,r=e.thumbsSwipingProps,n=i(I),o=window.innerWidth;this.listener=function(e){t.thumbsInnerWidth>o&&r.isPointering&&n.runActions(e)}}function h(e,t){e.contains(t)&&e.removeChild(t)}function o(e){var t=e.data,i=e.core,r=i.slideIndexChanger,n=i.thumbsTransformTransitioner,o=i.pointeringBucket,a=e.elements,s=e.thumbsSwipingProps,l=a.thumbsWrappers,c=(this.runNoSwipeActionsForEvent=function(e){h(a.thumbsContainer,a.thumbsCursorer),s.isPointering=!1;for(var t=0;t<l.length;t++)if(l[t]&&l[t].contains(e.target))return void r.jumpTo(t)},this.runActions=function(){if(h(a.thumbsContainer,a.thumbsCursorer),t.thumbsTransform+=s.swipedX,o.runSwipingTopActionsForPropsAndEvent(s),0<t.thumbsTransform)return c(0);t.thumbsTransform<innerWidth-t.thumbsInnerWidth-9&&c(innerWidth-t.thumbsInnerWidth-9)},function(e){t.thumbsTransform=e,n.callActionWithTransition(function(){a.thumbsInner.style.transform="translateX(".concat(e,"px)")})})}function L(e){var t=e.resolve,i=e.thumbsSwipingProps,r=t(o);this.listener=function(e){i.isPointering&&(i.swipedX?r.runActions():r.runNoSwipeActionsForEvent(e))}}function D(e){var i=e.collections.sourceMainWrapperTransformers,r=e.core.zoomer,n=e.data,o=e.sourcePointerProps;this.runZoomingPinchActionsForHypot=function(e){var t=e-o.pinchedHypot,t=n.zoom+t/Math.hypot(innerWidth,innerHeight)*10;r.zoomTo(t=t<.9?.9:t),o.pinchedHypot=e},this.translateSourceMainWrapperAtIndexUsingMethod=function(e,t){i[e].translate(o.swipedX)[t]()}}function k(e){var t=Object.keys(e.pointers),i=e.pointers[t[0]],e=e.pointers[t[1]];return Math.hypot(i.screenX-e.screenX,i.screenY-e.screenY)}function z(e){var t=e.collections.sourceMainWrapperTransformers,i=e.core.pointeringBucket,r=e.data,n=e.elements,o=e.resolve,a=e.sourcePointerProps,s=e.stageIndexes,l=o(D);this.runActions=function(e){i.runSwipingMoveActionsForPropsAndEvent(a,e),n.container.contains(n.slideSwipingHoverer)||n.container.appendChild(n.slideSwipingHoverer)},this.runPinchActions=function(){var e=k(a);a.pinchedHypot?l.runZoomingPinchActionsForHypot(e):a.pinchedHypot=e},this.runNormalSwipeActions=function(){l.translateSourceMainWrapperAtIndexUsingMethod(s.current,"zero"),void 0!==s.previous&&0<a.swipedX?l.translateSourceMainWrapperAtIndexUsingMethod(s.previous,"negative"):void 0!==s.next&&a.swipedX<0&&l.translateSourceMainWrapperAtIndexUsingMethod(s.next,"positive")},this.runZoomSwipeActions=function(e){a.swipedX=(e.screenX-a.downScreenX)/r.zoom,a.swipedY=(e.screenY-a.downScreenY)/r.zoom,t[s.current].translate(a.upSwipedX+a.swipedX,a.upSwipedY+a.swipedY).zero()}}function R(e){var t=e.data,i=e.props.sources,r=e.resolve,n=e.sourcePointerProps,o=r(z);this.listener=function(e){n.isPinching?(o.runActions(e),o.runPinchActions()):2!==n.pointersCount&&(o.runActions(e),1===t.zoom?1===i.length?n.swipedX=1:o.runNormalSwipeActions():o.runZoomSwipeActions(e))}}function O(e){var t=e.collections.sourceMainWrapperTransformers,i=e.core,r=i.slideIndexChanger,n=i.clickZoomer,o=e.data,a=e.elements.sourceMainWrappers,s=e.sourcePointerProps,l=e.stageIndexes,c=(this.runPositiveSwipedXActions=function(){void 0!==l.previous&&(c("positive"),r.changeTo(l.previous)),c("zero")},this.runNegativeSwipedXActions=function(){void 0!==l.next&&(c("negative"),r.changeTo(l.next)),c("zero")},this.saveCurrentSourceMainWrapperPosition=function(){s.upSwipedX=t[l.current].getTranslateX(),s.upSwipedY=t[l.current].getTranslateY()},this.runSourceDownEventTargetActions=function(){o.zoom<=1?n.zoomIn():n.zoomOut()},function(e){a[l.current].classList.add(Di),t[l.current][e]()})}function B(e){var t=e.core,i=t.lightboxCloser,r=t.pointeringBucket,n=e.data,o=e.elements,t=e.resolve,a=e.sourcePointerProps,s=t(O);this.runActions=function(){h(o.container,o.slideSwipingHoverer),a.isPinching=!1,a.pinchedHypot=0,r.runSwipingTopActionsForPropsAndEvent(a),Si(o.sourceWrappersContainer,$)},this.runSwipeActions=function(){1===n.zoom?0<a.swipedX?s.runPositiveSwipedXActions():s.runNegativeSwipedXActions():s.saveCurrentSourceMainWrapperPosition()},this.runNoSwipeActions=function(){a.isSourceDownEventTarget?s.runSourceDownEventTargetActions():i.close()}}function F(e){var t=e.data,i=e.resolve,r=e.sourcePointerProps,n=e.core.zoomer,o=i(B);this.listener=function(e){r.pointers={},r.isPointering&&(r.isPinching||(r.swipedX?o.runSwipeActions():o.runNoSwipeActions()),o.runActions(e),t.zoom<1)&&(n.zoomTo(1),n.stopZooming())}}function N(e){return e.sourcePointerProps.isPointering}function tr(e){var t=e.core.inactiver,i=e.middleware,r=e.props,e=e.resolve,n=e(R),o=e(F),a=e(P),s=e(L);this.moveListener=function(e){t.listener(e),i(i(n.listener,Wi),N)(e),r.disableThumbs||a.listener(e)},this.upListener=function(e){o.listener(e),r.disableThumbs||s.listener(e)}}function ir(e){var r=e.core.zoomer,n=e.data;this.listener=function(e){if(1===n.zoom){if(0<e.deltaY)return;r.startZooming()}var t=.1*n.zoom,i=n.zoom;e.deltaY<0?i+=t:(i-=t)<1&&(i=1),r.zoomTo(i),1===i&&r.stopZooming()}}function rr(e){var t=e.data,i=e.elements,r=e.stageIndexes;this.runOpacity0ActionUsingMethod=function(e){i.slideButtonPrevious&&(i.slideButtonPrevious.classList[e](Fi),i.slideButtonNext.classList[e](Fi))},this.runActiveEnhancementActionUsingMethod=function(e){t.isThumbing?i.thumbsContainer.classList[e](ji):i.captions[r.current]&&i.captions[r.current].classList[e](Bi)}}function nr(e){var t=e.core.zoomer,i=e.data,r=e.elements,n=e.sourcePointerProps;this.runPinchActions=function(){n.isPinching=!0,n.pinchedHypot=k(n),Ai(r.sourceWrappersContainer,$),1===i.zoom&&t.startZooming()}}function or(e){var t,i,r,n=e.data,o=e.elements,a=n.captionHeights,s=n.notThumbedSourceEnhancementWrapperScales,l=n.notThumbedSourceEnhancementWrapperTranslatesY,c=o.sourceEnhancementWrappers,h=o.sources;this.setUpThumbedEnhancementWrapperTransform=function(){t=o.thumbsContainer.offsetHeight,i=n.thumbedSourceEnhancementWrapperTranslateY,r="translateY(".concat(i,"px) scale(").concat(n.thumbedSourceEnhancementWrapperScale,")")},this.setUpNotThumbedEnhancementWrapperTransformAtIndex=function(e){t=a[e],i=l[e],r="translateY(".concat(i,"px) scale(").concat(s[e],")")},this.ifSourceIsLoadedTransformEnhancementWrapperAtIndex=function(e){h[e]&&(innerWidth<innerHeight&&h[e].offsetWidth>h[e].offsetHeight+t?c[e].style.transform="translateY(".concat(i/2,"px) scale(1)"):c[e].style.transform=r)}}function U(o){var e,O,B,F,t,N,U,j,V,G,q,W,H,Z,$,X,Y,K,J,i,r,Q,ee,te,ie,re,ne,oe,ae,se,n,a,s,le,ce,he,l,ue,de,pe,fe,me,ge,_e,ye,ve,xe,c,h,be,we,Te,Se,Ae,Ee,Ce,Me,Ie,Pe,Le,u,De,ke,ze,Re,Oe,Be,Fe,Ne,Ue,je,Ve,Ge,qe,d,We,He,Ze,$e,Xe,Ye,Ke,Je,Qe,et,tt,it,rt,nt,ot,at,p,st,lt,ct,ht,ut,dt,pt,ft,mt,gt,_t,yt,vt,xt,bt,wt,Tt,St,At,Et,Ct,Mt,It,Pt,Lt,Dt,f,m,kt=o.core.eventsDispatcher,g=o.data,_=o.elements,zt=o.props,Rt=zt.disableThumbs,y=zt.showThumbsOnMount,zt=zt.sources;g.isInitialized=!0,g.scrollbarWidth=function(){var e=o.props.disableLocalStorage;if(!e){var t=localStorage.getItem(dr);if(t)return t}t=document.createElement("div"),(i=t.style).visibility="hidden",i.width="100px",i.msOverflowStyle="scrollbar",i.overflow="scroll";var i=t,r=((n=document.createElement("div")).style.width="100%",document.body.appendChild(i),i.offsetWidth),n=(i.appendChild(n),n.offsetWidth),i=(document.body.removeChild(i),r-n);return e||localStorage.setItem(dr,i.toString()),i}(),g.unloadedThumbsCount=zt.length;for(var Ot=o.collections.sourceMainWrapperTransformers,Bt=o.props.sources,Ft=o.resolve,Nt=0;Nt<Bt.length;Nt++)Ot[Nt]=Ft(Hi,[Nt]);Rt||(g.isThumbing=y,y=(g=o).core,v=g.data,f=g.elements,m=g.props,v.isThumbing=m.showThumbsOnMount,v.thumbsInnerWidth=null,v.thumbsTransform=0,v.thumbedSourceEnhancementWrapperScale=null,v.thumbedSourceEnhancementWrapperTranslateY=null,v.unloadedThumbsCount=m.sources.length,g.thumbsSwipingProps={isPointering:!1,downScreenX:null,swipedX:null},y.thumbLoadHandler={},y.thumbsRenderDispatcher={},y.thumbsSwipingDown={},y.thumbsToggler={},y.thumbsTransformer={},y.thumbsTransformTransitioner={},f.thumbsContainer=null,f.thumbs=[],f.thumbsWrappers=[],f.thumbsComponents=[],f.thumbsInner=null,v=g.core,m=v.thumbLoadHandler,It=v.windowResizeActioner,Pt=g.componentsServices,Lt=g.data,Dt=g.elements.thumbsWrappers,m.handleLoad=function(){if(Lt.unloadedThumbsCount--,0===Lt.unloadedThumbsCount){for(var e=0;e<Dt.length;e++)Dt[e].classList.add(Ni);It.runThumbsActions(),Pt.hideThumbsLoader()}},y=g.core.thumbsRenderDispatcher,At=g.props.sources,Ct=!(Et=[]),Mt=0,y.addFunctionToToBeRenderedAtIndex=function(e,t){Et[t]=e,Mt++},y.renderThumbsIfNotYetAndAllTypesDetected=function(){if(!Ct&&Mt===At.length){Ct=!0;for(var e=0;e<At.length;e++)Et[e]()}},f=g.core,v=f.thumbsSwipingDown,Tt=f.pointeringBucket,St=g.thumbsSwipingProps,v.listener=function(e){e.preventDefault(),Tt.runSwipingDownActionsForPropsAndEvent(St,e)},m=g.core.thumbsToggler,bt=g.data,wt=(0,g.resolve)($i),m.toggleThumbs=function(){bt.isThumbing?wt.closeThumbs():wt.openThumbs()},y=g.core,f=y.thumbsTransformer,yt=y.thumbsTransformTransitioner,vt=g.data,xt=(0,g.resolve)(Xi),f.transformToCurrent=function(){vt.thumbsInnerWidth>innerWidth?xt.runActions():xt.runToThinThumbsActions()},f.transformToCurrentWithTransition=function(){vt.thumbsInnerWidth>innerWidth&&yt.callActionWithTransition(xt.runActions)},v=g.core.thumbsTransformTransitioner,gt=g.elements,_t=Ei(function(){gt.thumbsInner.classList.remove(Di)},300),v.callActionWithTransition=function(e){gt.thumbsInner.classList.add(Di),e(),_t()}),y=(m=o).core.captionsActioner,pt=m.data,ft=m.elements.captions,y.changeActiveCaptionFromTo=function(e,t){pt.isThumbing||(mt(e,Si),mt(t,Ai))},mt=function(e,t){ft[e]&&t(ft[e],Bi)},y=m.core.classFacade,dt=m.elements,y.removeFromEachElementClassIfContains=function(e,t){for(var i=0;i<dt[e].length;i++)Si(dt[e][i],t)},y=m.core,f=y.clickZoomer,at=y.zoomer,p=m.data,st=m.elements,lt=m.props.zoomIncrement,ct=Ei(function(){Si(st.sourceWrappersContainer,Di)},300),f.zoomIn=function(){ht(),ut(p.zoom+lt)},f.zoomOut=function(){p.zoom-lt<=1?1!==p.zoom&&(ut(1),at.stopZooming()):(ht(),ut(p.zoom-lt),1===p.zoom&&at.stopZooming())},ht=function(){1===p.zoom&&at.startZooming()},ut=function(e){Ai(st.sourceWrappersContainer,Di),at.zoomTo(e),ct()},y=(nt=m).core.eventsDispatcher,ot=nt.props,y.dispatch=function(e){ot[e]&&ot[e](nt)},rt=m.componentsServices,(f=m.core.fullscreenToggler).enterFullscreen=function(){rt.enterFullscreen();var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},f.exitFullscreen=function(){rt.exitFullscreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},y=m.core,Ke=y.inactiver,f=y.globalEventsController,Je=y.windowResizeActioner,Qe=m.middleware,y=m.resolve,et=y(tr),tt=y(er),it=y(ir),f.addListeners=function(){document.addEventListener("pointerdown",Ke.listener),document.addEventListener("pointermove",et.moveListener),document.addEventListener("pointerup",et.upListener),addEventListener("resize",Je.runActions),document.addEventListener("keydown",tt.listener);e=!1;var e,t=function(){return!e&&(e=!0,requestAnimationFrame(function(){e=!1}),!0)};Ye=Qe(Ye=function(e){return t()&&it.listener(e)},Ci),document.addEventListener("wheel",Ye)},f.removeListeners=function(){document.removeEventListener("pointerdown",Ke.listener),document.removeEventListener("pointermove",et.moveListener),document.removeEventListener("pointerup",et.upListener),removeEventListener("resize",Je.runActions),document.removeEventListener("keydown",tt.listener),document.removeEventListener("wheel",Ye)},y=m.core.inactiver,qe=m.data,d=m.elements,f=m.props.UIFadeOutTime,We=!1,He=Ei(function(){We=!0,Ze($e)},f),y.listener=function(){He(),We&&(Ze(Xe),We=!1)},Ze=function(e){e(d.nav),1===qe.zoom&&d.slideButtonPrevious&&(e(d.slideButtonPrevious),e(d.slideButtonNext)),qe.isThumbing&&e(d.thumbsContainer)},$e=function(e){e.classList.add(Fi)},Xe=function(e){e.classList.remove(Fi)},f=m.core.lightboxCloser,Ge=(0,m.resolve)(Ki),f.close=function(){Ge.isLightboxFadingOut||Ge.runActions()},ar(m),y=m.core.pointeringBucket,Ve=m.elements,y.runSwipingDownActionsForPropsAndEvent=function(e,t){e.isPointering=!0,e.downScreenX=t.screenX,e.swipedX=0},y.runSwipingMoveActionsForPropsAndEvent=function(e,t){Ai(Ve.slideSwipingHoverer,Pi),e.swipedX=t.screenX-e.downScreenX},y.runSwipingTopActionsForPropsAndEvent=function(e){Si(Ve.slideSwipingHoverer,Pi),e.isPointering=!1},Ne=m.data,(Ue=m.core.scrollbarRecompensor).addRecompense=function(){"complete"===document.readyState?je():window.addEventListener("load",function(){je(),Ue.addRecompense=je})},je=function(){document.body.offsetHeight>window.innerHeight&&(document.body.style.marginRight=Ne.scrollbarWidth+"px")},Ue.removeRecompense=function(){document.body.style.removeProperty("margin-right")},Qi(m),f=m.core,y=f.slideChangeFacade,Be=f.slideIndexChanger,Fe=f.stageManager,1<m.props.sources.length?(y.changeToPrevious=function(){Be.jumpTo(Fe.getPreviousSlideIndex())},y.changeToNext=function(){Be.jumpTo(Fe.getNextSlideIndex())}):(y.changeToPrevious=function(){},y.changeToNext=function(){}),be=(h=m).collections.sourceMainWrapperTransformers,we=h.componentsServices,f=h.core,Te=f.captionsActioner,Se=f.classFacade,Ae=f.eventsDispatcher,Ee=f.slideIndexChanger,Ce=f.sourceDisplayFacade,Me=f.sourceLoadersManager,Ie=f.stageManager,Pe=f.thumbsTransformer,Le=f.zoomer,u=h.elements.sourceAnimationWrappers,f=h.props,De=f.disableThumbs,ke=f.initialAnimation,ze=f.slideChangeAnimation,Re=h.stageIndexes,Oe=Ei(function(){Se.removeFromEachElementClassIfContains("sourceAnimationWrappers",zi)},300),Ee.changeTo=function(e){Ji(h,e),Le.ifZoomingResetZoom(),Te.changeActiveCaptionFromTo(Re.current,e),Re.current=e,Ie.updateStageIndexes(),De||Pe.transformToCurrentWithTransition(),we.setSlideNumber(e+1),Me.displayLoadersWhichShouldBeDisplayed(),Ce.displaySourcesWhichShouldBeDisplayed(),Ae.dispatch("onSlideChange")},Ee.jumpTo=function(e){var t=Re.current;Ee.changeTo(e),Se.removeFromEachElementClassIfContains("sourceMainWrappers",Di),Si(u[t],ke),Si(u[t],ze),u[t].classList.add(zi),Si(u[e],ke),Si(u[e],zi),u[e].classList.add(ze),Oe(),be[e].zero(),setTimeout(function(){t!==Re.current&&be[t].negative()},260)},y=m.core.sourceEnhancementWrappersTransformer,xe=m.data,c=(0,m.resolve)(or),y.ifSourceIsLoadedTransformEnhancementWrapperAtIndex=function(e){xe.isThumbing?c.setUpThumbedEnhancementWrapperTransform():c.setUpNotThumbedEnhancementWrapperTransformAtIndex(e),c.ifSourceIsLoadedTransformEnhancementWrapperAtIndex(e)},y.ifSourceIsLoadedTransformThumbedEnhancementWrapperAtIndex=function(e){c.setUpThumbedEnhancementWrapperTransform(e),c.ifSourceIsLoadedTransformEnhancementWrapperAtIndex(e)},y.ifSourceIsLoadedTransformNotThumbedEnhancementWrapperAtIndex=function(e){c.setUpNotThumbedEnhancementWrapperTransformAtIndex(e),c.ifSourceIsLoadedTransformEnhancementWrapperAtIndex(e)},f=m.core,y=f.sourceLoadersManager,ge=f.stageManager,_e=m.elements.sourceAnimationWrappers,ye=m.stageIndexes,ve=[],y.handleSourceAnimationWrapperRendering=function(e){ge.isSourceInStage(e)&&xi(e)},y.displayLoadersWhichShouldBeDisplayed=function(){for(var e in ye){e=ye[e];ve[e]||xi(e)}},y.handleSourceLoad=function(e){ve[e]=!0,_e[e].removeChild(_e[e].firstChild)},pe=m.collections.sourcesRenderFunctions,f=m.core.sourceDisplayFacade,fe=m.props.loadOnlyCurrentSource,me=m.stageIndexes,f.displaySourcesWhichShouldBeDisplayed=function(){if(fe)vi(me.current);else for(var e in me)vi(me[e])},(y=m.core).classFacade,f=y.sourcesPointerDown,le=y.pointeringBucket,y=m.elements,ce=y.sources,he=y.sourceMainWrappers,y=m.resolve,l=m.sourcePointerProps,ue=m.stageIndexes,de=y(nr),f.listener=function(e){if("touch"!==e.pointerType&&"VIDEO"!==e.target.tagName&&e.preventDefault(),le.runSwipingDownActionsForPropsAndEvent(l,e),l.downScreenY=e.screenY,2===l.pointersCount)de.runPinchActions();else for(var t in ue){t=ue[t];Si(he[t],Di)}var i=ce[ue.current];i&&i.contains(e.target)?l.isSourceDownEventTarget=!0:l.isSourceDownEventTarget=!1},n=m.stageIndexes,a=m.core.stageManager,s=m.props.sources.length-1,a.getPreviousSlideIndex=function(){return 0===n.current?s:n.current-1},a.getNextSlideIndex=function(){return n.current===s?0:n.current+1},a.updateStageIndexes=0==s?function(){}:1==s?function(){0===n.current?(n.next=1,delete n.previous):(n.previous=0,delete n.next)}:function(){n.previous=a.getPreviousSlideIndex(),n.next=a.getNextSlideIndex()},a.isSourceInStage=s<=2?function(){return!0}:function(e){var t=n.current;return 0===t&&e===s||t===s&&0===e||-1==(t=t-e)||0==t||1==t},y=m.collections,$=y.sourceMainWrapperTransformers,X=y.sourceSizers,y=m.core,Y=y.sourceEnhancementWrappersTransformer,K=y.windowResizeActioner,J=y.thumbsTransformer,i=m.data,r=m.elements,y=m.props,Q=y.disableThumbs,ee=y.sources,te=m.stageIndexes,ie=i.notThumbedSourceEnhancementWrapperScales,re=i.captionHeights,ne=i.notThumbedSourceEnhancementWrapperTranslatesY,oe=r.captions,ae=r.sourceMainWrappers,se=r.thumbs,K.runActions=function(){innerWidth<992?i.maxSourceWidth=innerWidth:i.maxSourceWidth=.9*innerWidth,i.maxSourceHeight=.9*innerHeight,Q||(i.thumbedSourceEnhancementWrapperScale=1-r.thumbsContainer.offsetHeight/innerHeight,i.thumbedSourceEnhancementWrapperTranslateY=-r.thumbsContainer.offsetHeight/2),0===i.unloadedThumbsCount&&K.runThumbsActions();for(var e,t=0;t<ee.length;t++)oe[t]?(re[t]=oe[t].offsetHeight,e=re[t]-25,ie[t]=1-e/innerHeight,ne[t]=-e/2):(ie[t]=1,ne[t]=0),Si(ae[t],Di),Y.ifSourceIsLoadedTransformEnhancementWrapperAtIndex(t),t!==te.current&&$[t].negative(),X[t]&&X[t].adjustSize()},K.runThumbsActions=function(){for(var e=i.thumbsInnerWidth=0;e<ee.length;e++)i.thumbsInnerWidth+=se[e].offsetWidth+8;J.transformToCurrent()},F=m.collections.sourceMainWrapperTransformers,t=m.core.zoomer,N=m.data,U=m.elements,f=m.resolve,j=m.sourcePointerProps,V=m.stageIndexes,G=U.sources,q=U.sourceMainWrappers,W=f(rr),t.zoomTo=function(e){N.zoom=Z(e),U.sourceWrappersContainer.style.transform="scale(".concat(N.zoom,")")},t.ifZoomingResetZoom=function(){1!==N.zoom&&(t.zoomTo(1),t.stopZooming())},t.startZooming=function(){H("grab"),W.runOpacity0ActionUsingMethod("add"),W.runActiveEnhancementActionUsingMethod("remove")},t.stopZooming=function(){H("zoom-in"),W.runOpacity0ActionUsingMethod("remove"),W.runActiveEnhancementActionUsingMethod("add"),q[V.current].classList.add(Di),F[V.current].translate(0,0).zero(),j.upSwipedX=0,j.upSwipedY=0},H=function(e){G[V.current]&&(G[V.current].style.cursor=e)},Z=function(e){return parseFloat(e.toPrecision(12))},_.container=document.createElement("div"),_.container.className="".concat(Mi,"container ").concat(Ii," ").concat(Ri),(g=o.elements).slideSwipingHoverer=document.createElement("div"),g.slideSwipingHoverer.className="".concat(Mi,"slide-swiping-hoverer ").concat(Ii," ").concat(ki);var Ut,jt,Vt,v=o,y=v.props.sources,_=v.elements,x=(_.nav=document.createElement("div"),_.nav.className="".concat(Mi,"nav"),_.container.appendChild(_.nav),v),g=_.nav,b=x.core,w=(T=b.clickZoomer).zoomIn,T=T.zoomOut,Gt=b.lightboxCloser.close,b=b.thumbsToggler,qt=(A=x.props).customToolbarButtons,S=A.disableThumbs,A=A.toolbarButtons,E=document.createElement("div");E.className="".concat(Mi,"toolbar"),g.appendChild(E);for(var Wt,Ht,C,Zt,$t,Xt,M,Yt,Kt,Jt,Qt=0;Qt<qt.length;Qt++)!function(e){Ti(E,qt[e],function(){return qt[e].onClick(x)})}(Qt);function ei(e){$t.title=e.title,Xt.setAttributeNS(null,"width",e.width),Xt.setAttributeNS(null,"height",e.height),Xt.setAttributeNS(null,"viewBox",e.viewBox),Xt.firstChild.setAttributeNS(null,"d",e.d)}function ti(e){Kt.title=e.title,Jt.setAttributeNS(null,"width",e.width),Jt.setAttributeNS(null,"height",e.height),Jt.setAttributeNS(null,"viewBox",e.viewBox),Jt.firstChild.setAttributeNS(null,"d",e.d)}S||Ti(E,A.thumbs,b.toggleThumbs),Ti(E,A.zoomIn,w),Ti(E,A.zoomOut,T),g=x.core.slideshowManager.toggleSlideshow,S=x.componentsServices,b=x.props.toolbarButtons.slideshow,M=b.start,Yt=b.pause,(Kt=wi(E,M.title)).onclick=g,Jt=bi(Kt,M.width,M.height,M.viewBox,M.d),S.startSlideshow=function(){ti(Yt)},S.stopSlideshow=function(){ti(M)},Wt=x.core.fullscreenToggler,w=x.componentsServices,Ht=x.data,T=x.props.toolbarButtons.fullscreen,C=T.enter,Zt=T.exit,$t=wi(E,C.title),Xt=bi($t,C.width,C.height,C.viewBox,C.d),w.enterFullscreen=function(){Ht.isFullscreenOpen=!0,ei(Zt)},w.exitFullscreen=function(){Ht.isFullscreenOpen=!1,ei(C)},$t.onclick=function(){Ht.isFullscreenOpen?Wt.exitFullscreen():Wt.enterFullscreen()},Ti(E,A.close,Gt),1<y.length&&(b=_.nav,g=v.componentsServices,S=v.props.sources,(Ut=document.createElement("div")).className="".concat(Mi,"slide-number-container"),(jt=document.createElement("div")).className=Li,Vt=document.createElement("span"),g.setSlideNumber=function(e){return Vt.innerHTML=e},(g=document.createElement("span")).className="".concat(Mi,"slash"),(T=document.createElement("div")).innerHTML=S.length,Ut.appendChild(jt),jt.appendChild(Vt),jt.appendChild(g),jt.appendChild(T),b.appendChild(Ut),setTimeout(function(){55<jt.offsetWidth&&(Ut.style.justifyContent="flex-start")})),(w=o.elements).slideshowBar=document.createElement("div"),w.slideshowBar.className="".concat(Mi,"slideshow-bar ").concat(ki),w.container.appendChild(w.slideshowBar);var ii=o,A=ii.core.sourcesPointerDown.listener,Gt=ii.elements,y=ii.middleware,ri=ii.props.sources,_=document.createElement("div");_.className="".concat(lr," ").concat(ki," ").concat(Ii),Gt.container.appendChild(_),_.addEventListener("pointerdown",y(A,Wi)),Gt.sourceWrappersContainer=_;for(var I,P,L,D,ni=0;ni<ri.length;ni++)P=ni,D=L=void 0,L=(I=ii).elements,D=L.sourceWrappersContainer,(L=L.sourceMainWrappers)[P]=document.createElement("div"),L[P].className="".concat(ki," ").concat(Ii," ").concat(Li),D.appendChild(L[P]),D=P,P=(L=I).elements,I=P.sourceMainWrappers,(P=P.sourceEnhancementWrappers)[D]=document.createElement("div"),I[D].appendChild(P[D]),I=D,P=L.core.sourceLoadersManager,D=L.elements,L=D.sourceAnimationWrappers,D=D.sourceEnhancementWrappers,L[I]=document.createElement("div"),P.handleSourceAnimationWrapperRendering(I),D[I].appendChild(L[I]);for(var k,z,oi,ai,si,li,ci,hi=o,ui=hi.props.captions,di=0;di<ui.length;di++)ui[di]&&(z=di,ci=li=si=ai=oi=void 0,oi=(k=hi).data.isThumbing,ai=(si=k.elements).captions,si=si.container,li=k.props.captions,k=k.stageIndexes.current,ai[z]=document.createElement("div"),ci="".concat(Oi," ").concat(Li),k!==z||oi||(ci+=" ".concat(Bi)),ai[z].className=ci,(k=document.createElement("div")).className=sr,k.innerHTML=li[z],ai[z].appendChild(k),si.appendChild(ai[z]));1<zt.length&&(Zi(S=o,"previous"),Zi(S,"next")),Rt||(T=(g=o).componentsServices,e=g.elements,b=g.data,e.thumbsContainer=document.createElement("div"),w=Ui,b.isThumbing&&(w+=" ".concat(ji),yi()),T.appendThumbsLoaderIfNotYet=function(){B||yi()},T.hideThumbsLoader=function(){e.thumbsContainer.removeChild(O)},e.thumbsContainer.className=w,e.container.appendChild(e.thumbsContainer),(b=g.elements).thumbsCursorer=document.createElement("div"),b.thumbsCursorer.className="".concat(hr," ").concat(Ii," ").concat(ki),T=g.core.thumbsSwipingDown.listener,(w=g.elements).thumbsInner=document.createElement("div"),w.thumbsInner.className=ur,w.thumbsInner.addEventListener("pointerdown",T),w.thumbsContainer.appendChild(w.thumbsInner));for(var pi,fi=o.props.sources,y=o.resolve,mi=y(Vi),gi=y(Gi),_i=y(qi,[mi,gi]),R=0;R<fi.length;R++)"string"==typeof fi[R]?(pi=_i.getTypeSetByClientForIndex(R))?gi.runActionsForSourceTypeAndIndex(pi,R):(pi=mi.getSourceTypeFromLocalStorageByUrl(fi[R]))?gi.runActionsForSourceTypeAndIndex(pi,R):_i.retrieveTypeWithXhrForIndex(R):gi.runActionsForSourceTypeAndIndex(pr,R);function yi(){B=!0,(O=Yi(e.thumbsContainer)).classList.add(cr)}function vi(e){pe[e]&&(pe[e](),delete pe[e])}function xi(e){ve[e]=!0,Yi(_e[e])}kt.dispatch("onInit")}function ar(i){var r=i.collections.sourceMainWrapperTransformers,n=i.componentsServices,e=i.core,o=e.captionsActioner,a=e.eventsDispatcher,t=e.lightboxOpener,s=e.globalEventsController,l=e.scrollbarRecompensor,c=e.sourceDisplayFacade,h=e.sourceLoadersManager,u=e.stageManager,d=e.windowResizeActioner,p=i.data,f=i.elements,m=i.stageIndexes;t.open=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=m.current;Ji(i,e),m.current=e,p.isInitialized?a.dispatch("onShow"):U(i),u.updateStageIndexes(),h.displayLoadersWhichShouldBeDisplayed(),c.displaySourcesWhichShouldBeDisplayed(),o.changeActiveCaptionFromTo(t,e),n.setSlideNumber(e+1),document.body.appendChild(f.container),document.documentElement.classList.add(g),l.addRecompense(),s.addListeners(),d.runActions(),r[m.current].zero(),a.dispatch("onOpen")}}function j(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}()||function(e){var t;if(e)return"string"==typeof e?i(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?i(e,void 0):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function V(e,t,i){return(V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct:function(e,t,i){var r=[null],t=(r.push.apply(r,t),new(Function.bind.apply(e,r)));return i&&G(t,i.prototype),t}).apply(null,arguments)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function q(){for(var u=document.getElementsByTagName("a"),e=0;e<u.length;e++)!function(i){if(!u[i].hasAttribute("data-fslightbox"))return;var r=u[i].getAttribute("data-fslightbox"),e=u[i].getAttribute("href"),t=(fsLightboxInstances[r]||(fsLightboxInstances[r]=new FsLightbox),null),n=("#"===e.charAt(0)?(t=document.getElementById(e.substring(1)).cloneNode(!0)).removeAttribute("id"):t=e,fsLightboxInstances[r].props.sources.push(t),fsLightboxInstances[r].elements.a.push(u[i]),fsLightboxInstances[r].props.sources.length-1);u[i].onclick=function(e){e.preventDefault(),fsLightboxInstances[r].open(n)},h("captions","data-caption"),h("customClasses","data-class"),h("customClasses","data-custom-class"),h("types","data-type"),h("thumbs","data-thumb"),h("videosPosters","data-video-poster");for(var o,a=["href","data-fslightbox","data-caption","data-class","data-custom-class","data-type","data-thumb","data-video-poster"],s=u[i].attributes,l=fsLightboxInstances[r].props.customAttributes,c=0;c<s.length;c++)-1===a.indexOf(s[c].name)&&"data-"===s[c].name.substr(0,5)&&(l[n]||(l[n]={}),o=s[c].name.substr(5),l[n][o]=s[c].value);function h(e,t){u[i].hasAttribute(t)&&(fsLightboxInstances[r].props[e][n]=u[i].getAttribute(t))}}(e);var t=Object.keys(fsLightboxInstances);window.fsLightbox=fsLightboxInstances[t[t.length-1]]}var W,Mi,e,Ii,Pi,Li,g,Di,ki,a,c,H,zi,Ri,Z,Oi,sr,Bi,t,Fi,Ni,u,lr,$,d,Ui,cr,hr,ur,ji,X,Y,K,p,J,dr,f,Q,ee,pr,m}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MapboxGeocoder=e()}(function(){return function r(n,o,a){function s(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}},n[t][0].call(i.exports,function(e){return s(n[t][1][e]||e)},i,i.exports,r,n,o,a)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,i){function r(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox||null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}var n=e("nanoid");r.prototype={select:function(e,t){var i=this.getSelectedIndex(e,t),t=this.getEventPayload("search.select",t);if(t.resultIndex=i,t.resultPlaceName=e.place_name,t.resultId=e.id,(i!==this.lastSentIndex||t.queryString!==this.lastSentInput)&&-1!=i&&(this.lastSentIndex=i,this.lastSentInput=t.queryString,t.queryString))return this.push(t)},start:function(e){e=this.getEventPayload("search.start",e);if(e.queryString)return this.push(e)},keyevent:function(e,t){if(e.key&&!e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(e.keyCode)){t=this.getEventPayload("search.keystroke",t);if(t.lastAction=e.key,t.queryString)return this.push(t)}},send:function(e,t){if(this.enableEventLogging){e=this.getRequestOptions(e);this.request(e,function(e){return e?this.handleError(e,t):t?t():void 0}.bind(this))}else if(t)return t()},getRequestOptions:function(e){return Array.isArray(e)||(e=[e]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}},getEventPayload:function(e,t){var i=t.options.proximity?[t.options.proximity.longitude,t.options.proximity.latitude]:null,r=t._map?t._map.getZoom():null;return{event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",proximity:i,limit:t.options.limit,queryString:t._inputEl?t._inputEl.value:t.inputString,mapZoom:r,keyboardLocale:this.locale}},request:function(e,t){var i,r=new XMLHttpRequest;for(i in r.onreadystatechange=function(){if(4==this.readyState)return t(204==this.status?null:this.statusText)},r.open(e.method,e.host+"/"+e.path,!0),e.headers){var n=e.headers[i];r.setRequestHeader(i,n)}r.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return n()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead)return t=t._typeahead.data,e=e.id,t.map(function(e){return e.id}).indexOf(e)},shouldEnableLogging:function(e){return!(!1===e.enableEventLogging||e.origin&&-1==e.origin.indexOf("api.mapbox.com")||e.localGeocoder||e.filter)},flush:function(){0<this.eventQueue.length&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}},t.exports=r},{nanoid:30}],2:[function(e,t,i){t.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},{}],3:[function(e,t,i){function r(e){this._eventEmitter=new l,this.options=s({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null}var o,n=e("suggestions"),a=e("lodash.debounce"),s=e("xtend"),l=e("events").EventEmitter,c=e("./exceptions"),h=e("@mapbox/mapbox-sdk"),u=e("@mapbox/mapbox-sdk/services/geocoding"),d=e("./events"),p=e("./localization"),f=e("subtag");r.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,getItemValue:function(e){return e.place_name},render:function(e){e=e.place_name.split(",");return'<div class="geocoder-suggestion"><div class="geocoder-suggestion-title">'+e[0]+'</div><div class="geocoder-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},onAdd:function(e){this._map=e,this.setLanguage(),o=u(h({accessToken:this.options.accessToken,origin:this.options.origin})),this.eventManager=new d(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this);var e=this.container=document.createElement("div"),t=(e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl",this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>')),i=(this._inputEl=document.createElement("input"),this._inputEl.type="text",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse),this._inputEl.addEventListener("blur",this._collapse)),this._inputEl.addEventListener("keydown",a(this._onKeyDown,200)),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(e){this.eventManager.keyevent(e,this)}.bind(this)),document.createElement("div")),r=(i.classList.add("geocoder-pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>'));return this._clearEl.appendChild(r),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(i),this._typeahead=new n(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1),e},createIcon:function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("class","geocoder-icon geocoder-icon-"+e),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width",18),i.setAttribute("height",18),i.innerHTML=t,i},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onKeyDown:function(e){var t=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target;if(!t||!t.value)return this.fresh=!0,9!==e.keyCode&&this.clear(e),this._clearEl.style.display="none";e.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(e.keyCode)||t.value.length>=this.options.minLength&&this._geocode(t.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onChange:function(){var e,t,i=this._typeahead.selected;i&&i.id!==this.lastSelected&&(this._clearEl.style.display="none",this.options.flyTo&&(i.properties&&!c[i.properties.short_code]&&i.bbox?(t=i.bbox,e=s({},this.options.flyTo),this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)):i.properties&&c[i.properties.short_code]?(e=s({},this.options.flyTo),this._map.fitBounds(c[i.properties.short_code].bbox,e)):(t={zoom:this.options.zoom},(e=s({},t,this.options.flyTo)).center=i.center,this._map.flyTo(e))),this.options.marker&&this._mapboxgl&&this._handleMarker(i),this._eventEmitter.emit("result",{result:i}),this.eventManager.select(i,this),this.lastSelected=i.id)},_geocode:function(e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:e}),this.inputString=e;var i=this,r=["bbox","limit","proximity","countries","types","language","reverseMode"].reduce(function(e,t){return i.options[t]&&(-1<["countries","types","language"].indexOf(t)?e[t]=i.options[t].split(/[\s,]+/):e[t]=i.options[t],"proximity"===t)&&i.options[t]&&i.options[t].longitude&&i.options[t].latitude&&(e[t]=[i.options[t].longitude,i.options[t].latitude]),e},{}),t=(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(e)?(t=e.split(/[\s(,)?]+/).map(function(e){return parseFloat(e,10)}).reverse(),r.types&&r.types[0],r=s(r,{query:t,limit:1}),o.reverseGeocode(r)):(r=s(r,{query:e}),o.forwardGeocode(r))).send(),n=[];return this.options.localGeocoder&&(n=(n=this.options.localGeocoder(e))||[]),t.then(function(e){this._loadingEl.style.display="none";var t={};(t="200"==e.statusCode?e.body:t).features=t.features?n.concat(t.features):n,this.options.filter&&t.features.length&&(t.features=t.features.filter(this.options.filter)),t.features.length?this._clearEl.style.display="block":(this._clearEl.style.display="none",this._typeahead.selected=null),t.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),this._eventEmitter.emit("results",t),this._typeahead.update(t.features)}.bind(this)),t.catch(function(e){this._loadingEl.style.display="none",n.length?this._clearEl.style.display="block":(this._clearEl.style.display="none",this._typeahead.selected=null),this._eventEmitter.emit("results",{features:n}),this._typeahead.update(n),this._eventEmitter.emit("error",{error:e})}.bind(this)),t},clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._inputEl.focus(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},_onQueryResult:function(e){var e=e.body;e.features.length&&(e=e.features[0],this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange())},_updateProximity:function(){var e;9<this._map.getZoom()?(e=this._map.getCenter().wrap(),this.setProximity({longitude:e.lng,latitude:e.lat})):this.setProximity(null)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("geocoder-collapsed")},_unCollapse:function(){this.container.classList.remove("geocoder-collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],e=f.language(e),e=p.placeholder[e];if(e)return e}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this},setProximity:function(e){return this.options.proximity=e,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&"function"==typeof e&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},_handleMarker:function(e){this._removeMarker();var t=s({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(t),this.mapMarker.setLngLat(e.center).addTo(this._map),this},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}},t.exports=r},{"./events":1,"./exceptions":2,"./localization":4,"@mapbox/mapbox-sdk":6,"@mapbox/mapbox-sdk/services/geocoding":17,events:25,"lodash.debounce":29,subtag:32,suggestions:33,xtend:36}],4:[function(e,t,i){t.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje"}}},{}],5:[function(e,t,i){function r(n){var o=Array.isArray(n);return function(e){var t=a(h.plainArray,e);if(t)return t;if(o&&e.length!==n.length)return"an array with "+n.length+" items";for(var i,r=0;r<e.length;r++)if(t=a((i=r,o?n[i]:n),e[r]))return[r].concat(t)}}function a(e,t){return(null!=t||e.hasOwnProperty("__required"))&&(e=e(t))?Array.isArray(e)?e:[e]:void 0}function s(e,t){var i=e.length,r=e[i-1],e=e.slice(0,i-1);return 0===e.length&&(e=["value"]),t=c(t,{path:e}),"function"==typeof r?r(t):n(t,"must be "+function(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}(r)+".")}function n(e,t){return(o(e.path)?"Item at position ":"")+(e.path.join(".")+" "+t)}function o(e){return"number"==typeof e[e.length-1]||"number"==typeof e[0]}var l=e("is-plain-obj"),c=e("xtend"),h={assert:function(t,i){return i=i||{},function(e){var e=a(t,e);if(e)throw e=s(e,i),i.apiName&&(e=i.apiName+": "+e),new Error(e)}}};h.shape=function(e){t=e;var t,o=Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}});return function(e){var t=a(h.plainObject,e);if(t)return t;for(var i,r=[],n=0;n<o.length;n++)i=o[n].key,(t=a(o[n].value,e[i]))&&r.push([i].concat(t));return r.length<2?r[0]:function(t){r=r.map(function(e){return"- "+e[0]+": "+s(e,t).split("\n").join("\n  ")});var e=t.path.join(".");return"The following properties"+("value"===e?"":" of "+e)+" have invalid values:\n  "+r.join("\n  ")}}},h.strictShape=function(r){var n=h.shape(r);return function(e){var t,i=n(e);return i||(0!==(t=Object.keys(e).reduce(function(e,t){return void 0===r[t]&&e.push(t),e},[])).length?function(){return"The following keys are invalid: "+t.join(", ")}:void 0)}},h.arrayOf=r,h.tuple=function(){return r(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},h.required=function(t){function e(e){return null==e?function(e){return n(e,o(e.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return e.__required=!0,e},h.oneOfType=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(t){var e,i=r.map(function(e){return a(e,t)}).filter(Boolean);if(i.length===r.length)return i.every(function(e){return 1===e.length&&"string"==typeof e[0]})?(e=i.map(function(e){return e[0]})).length<2?e[0]:2===e.length?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1):i.reduce(function(e,t){return t.length>e.length?t:e})}},h.equal=function(t){return function(e){if(e!==t)return JSON.stringify(t)}},h.oneOf=function(){var e=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(e){return h.equal(e)});return h.oneOfType.apply(this,e)},h.range=function(e){var t=e[0],i=e[1];return function(e){if(a(h.number,e)||e<t||i<e)return"number between "+t+" & "+i+" (inclusive)"}},h.any=function(){},h.boolean=function(e){if("boolean"!=typeof e)return"boolean"},h.number=function(e){if("number"!=typeof e)return"number"},h.plainArray=function(e){if(!Array.isArray(e))return"array"},h.plainObject=function(e){if(!l(e))return"object"},h.string=function(e){if("string"!=typeof e)return"string"},h.func=function(e){if("function"!=typeof e)return"function"},h.validate=a,h.processMessage=s,t.exports=h},{"is-plain-obj":28,xtend:36}],6:[function(e,t,i){e=e("./lib/client");t.exports=e},{"./lib/client":7}],7:[function(e,t,i){function r(e){o.call(this,e)}var n=e("./browser-layer"),o=e("../classes/mapi-client");((r.prototype=Object.create(o.prototype)).constructor=r).prototype.sendRequest=n.browserSend,r.prototype.abortRequest=n.browserAbort,t.exports=function(e){return new r(e)}},{"../classes/mapi-client":9,"./browser-layer":8}],8:[function(e,t,i){function a(e){var t=e.total,e=e.loaded;return{total:t,transferred:e,percent:100*e/t}}function r(n,o){return new Promise(function(t,i){o.onprogress=function(e){n.emitter.emit(c.EVENT_PROGRESS_DOWNLOAD,a(e))};var e=n.file,r=(e&&(o.upload.onprogress=function(e){n.emitter.emit(c.EVENT_PROGRESS_UPLOAD,a(e))}),o.onerror=function(e){i(e)},o.onabort=function(){var e=new l({request:n,type:c.ERROR_REQUEST_ABORTED});i(e)},o.onload=function(){var e;delete u[n.id],o.status<200||400<=o.status?(e=new l({request:n,body:o.response,statusCode:o.status}),i(e)):t(o)},n.body);"string"==typeof r?o.send(r):r?o.send(JSON.stringify(r)):e?o.send(e):o.send(),u[n.id]=o}).then(function(e){return new s(n,{body:(e=e).response,headers:h(e.getAllResponseHeaders()),statusCode:e.status})})}function n(t,e){var e=t.url(e),i=new window.XMLHttpRequest;return i.open(t.method,e),Object.keys(t.headers).forEach(function(e){i.setRequestHeader(e,t.headers[e])}),i}var s=e("../classes/mapi-response"),l=e("../classes/mapi-error"),c=e("../constants"),h=e("../helpers/parse-headers"),u={};t.exports={browserAbort:function(e){var t=u[e.id];t&&(t.abort(),delete u[e.id])},sendRequestXhr:r,browserSend:function(t){return Promise.resolve().then(function(){var e=n(t,t.client.accessToken);return r(t,e)})},createRequestXhr:n}},{"../classes/mapi-error":10,"../classes/mapi-response":12,"../constants":13,"../helpers/parse-headers":14}],9:[function(e,t,i){function r(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");n(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||a.API_ORIGIN}var n=e("@mapbox/parse-mapbox-token"),o=e("./mapi-request"),a=e("../constants");r.prototype.createRequest=function(e){return new o(this,e)},t.exports=r},{"../constants":13,"./mapi-request":11,"@mapbox/parse-mapbox-token":23}],10:[function(e,t,i){var n=e("../constants");t.exports=function(e){var t,i=e.type||n.ERROR_HTTP;if(e.body)try{t=JSON.parse(e.body)}catch(i){t=e.body}else t=null;var r=e.message||null;r||("string"==typeof t?r=t:t&&"string"==typeof t.message?r=t.message:i===n.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=i,this.statusCode=e.statusCode||null,this.request=e.request,this.body=t}},{"../constants":13}],11:[function(e,t,i){function r(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var i={},r=(t.body&&(i["content-type"]="application/json"),o(i,t.headers)),i=Object.keys(r).reduce(function(e,t){return e[t.toLowerCase()]=r[t],e},{});this.id=c++,this._options=t,this.emitter=new a,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.headers=i}var n=e("@mapbox/parse-mapbox-token"),o=e("xtend"),a=e("eventemitter3"),s=e("../helpers/url-utils"),l=e("../constants"),c=1;r.prototype.url=function(e){var t=s.prependOrigin(this.path,this.origin),i=(t=s.appendQueryObject(t,this.query),this.params);return e&&(t=s.appendQueryParam(t,"access_token",e),e=n(e).user,i=o({ownerId:e},i)),t=s.interpolateRouteParams(t,i)},r.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(e){return t.response=e,t.emitter.emit(l.EVENT_RESPONSE,e),e},function(e){throw t.error=e,t.emitter.emit(l.EVENT_ERROR,e),e})},r.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},r.prototype.eachPage=function(i){function t(t){i(null,t,function(){delete o._nextPageRequest;var e=t.nextPage();e&&n(o._nextPageRequest=e)})}function r(e){i(e,null,function(){})}function n(e){e.send().then(t,r)}var o=this;n(this)},r.prototype.clone=function(){return this._extend()},r.prototype._extend=function(e){e=o(this._options,e);return new r(this.client,e)},t.exports=r},{"../constants":13,"../helpers/url-utils":16,"@mapbox/parse-mapbox-token":23,eventemitter3:26,xtend:36}],12:[function(e,t,i){function r(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch(e){this.body=t.body}this.links=n(this.headers.link)}var n=e("../helpers/parse-link-header");r.prototype.hasNextPage=function(){return!!this.links.next},r.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},t.exports=r},{"../helpers/parse-link-header":15}],13:[function(e,t,i){t.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},{}],14:[function(e,t,i){t.exports=function(e){var i={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(e){t=(e=e).indexOf(":");var t,e={name:e.substring(0,t).trim().toLowerCase(),value:e.substring(t+1).trim()};i[e.name]=e.value}),i}},{}],15:[function(e,t,i){t.exports=function(e){return e?e.split(/,\s*</).reduce(function(t,e){var i,r,n=(e=(e=e).match(/<?([^>]*)>(.*)/))&&(i=e[1],e=e[2].split(";"),r=null,e=e.reduce(function(e,t){t=(t=(t=t).match(/\s*(.+)\s*=\s*"?([^"]+)"?/))?{key:t[1],value:t[2]}:null;return t&&("rel"===t.key?r=r||t.value:e[t.key]=t.value),e},{}),r)?{url:i,rel:r,params:e}:null;return n&&n.rel.split(/\s+/).forEach(function(e){t[e]||(t[e]={url:n.url,params:n.params})}),t},{}):{}}},{}],16:[function(e,t,i){function n(e){return Array.isArray(e)?e.map(encodeURIComponent).join(","):encodeURIComponent(String(e))}function o(e,t,i){var r;return!1===i||null===i?e:(r=/\?/.test(e)?"&":"?",t=encodeURIComponent(t),void 0!==i&&""!==i&&!0!==i&&(t+="="+n(i)),e+r+t)}t.exports={appendQueryObject:function(e,i){var r;return i?(r=e,Object.keys(i).forEach(function(e){var t=i[e];void 0!==t&&(Array.isArray(t)&&(t=t.filter(function(e){return!!e}).join(",")),r=o(r,e,t))}),r):e},appendQueryParam:o,prependOrigin:function(e,t){var i;return!t||"http"===e.slice(0,4)?e:(i="/"===e[0]?"":"/",t.replace(/\/$/,"")+i+e)},interpolateRouteParams:function(e,r){return r?e.replace(/\/:([a-zA-Z0-9]+)/g,function(e,t){var i=r[t];if(void 0===i)throw new Error("Unspecified route parameter "+t);return"/"+n(i)}):e}}},{}],17:[function(e,t,i){var r=e("xtend"),n=e("./service-helpers/validator"),o=e("./service-helpers/pick"),a=e("./service-helpers/stringify-booleans"),e=e("./service-helpers/create-service-factory"),s={},l=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];s.forwardGeocode=function(e){n.assertShape({query:n.required(n.string),mode:n.oneOf("mapbox.places","mapbox.places-permanent"),countries:n.arrayOf(n.string),proximity:n.coordinates,types:n.arrayOf(n.oneOf(l)),autocomplete:n.boolean,bbox:n.arrayOf(n.number),limit:n.number,language:n.arrayOf(n.string)})(e),e.mode=e.mode||"mapbox.places";var t=a(r({country:e.countries},o(e,["proximity","types","autocomplete","bbox","limit","language"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(e,["mode","query"]),query:t})},s.reverseGeocode=function(e){n.assertShape({query:n.required(n.coordinates),mode:n.oneOf("mapbox.places","mapbox.places-permanent"),countries:n.arrayOf(n.string),types:n.arrayOf(n.oneOf(l)),bbox:n.arrayOf(n.number),limit:n.number,language:n.arrayOf(n.string),reverseMode:n.oneOf("distance","score")})(e),e.mode=e.mode||"mapbox.places";var t=a(r({country:e.countries},o(e,["country","types","bbox","limit","language","reverseMode"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(e,["mode","query"]),query:t})},t.exports=e(s)},{"./service-helpers/create-service-factory":18,"./service-helpers/pick":20,"./service-helpers/stringify-booleans":21,"./service-helpers/validator":22,xtend:36}],18:[function(e,t,i){var r=e("../../lib/classes/mapi-client"),n=e("../../lib/client");t.exports=function(i){return function(e){var e=r.prototype.isPrototypeOf(e)?e:n(e),t=Object.create(i);return t.client=e,t}}},{"../../lib/classes/mapi-client":9,"../../lib/client":7}],19:[function(e,t,i){t.exports=function(i,r){return Object.keys(i).reduce(function(e,t){return e[t]=r(t,i[t]),e},{})}},{}],20:[function(e,t,i){t.exports=function(i,r){var t="function"==typeof r?r:function(e,t){return-1!==r.indexOf(e)&&void 0!==t};return Object.keys(i).filter(function(e){return t(e,i[e])}).reduce(function(e,t){return e[t]=i[t],e},{})}},{}],21:[function(e,t,i){var r=e("./object-map");t.exports=function(e){return r(e,function(e,t){return"boolean"==typeof t?JSON.stringify(t):t})}},{"./object-map":19}],22:[function(r,n,e){!function(t){var e=r("xtend"),i=r("@mapbox/fusspot");n.exports=e(i,{file:function(e){return"undefined"!=typeof window?e instanceof t.Blob||e instanceof t.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof e&&void 0===e.pipe?"Filename or Readable stream":void 0},date:function(e){if("boolean"==typeof e)return"date";try{var t=new Date(e);if(t.getTime&&isNaN(t.getTime()))return"date"}catch(e){return"date"}},coordinates:function(e){return i.tuple(i.number,i.number)(e)},assertShape:function(e,t){return i.assert(i.strictShape(e),t)}})}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@mapbox/fusspot":5,xtend:36}],23:[function(e,t,i){function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var n=e("base-64"),o={};t.exports=function(e){if(o[e])return o[e];var t=e.split("."),i=t[0];if(t=t[1])return t={usage:i,user:(i=function(e){try{return JSON.parse(n.decode(e))}catch(e){throw new Error("Invalid token")}}(t)).u},r(i,"a")&&(t.authorization=i.a),r(i,"exp")&&(t.expires=1e3*i.exp),r(i,"iat")&&(t.created=1e3*i.iat),r(i,"scopes")&&(t.scopes=i.scopes),r(i,"client")&&(t.client=i.client),r(i,"ll")&&(t.lastLogin=i.ll),r(i,"iu")&&(t.impersonator=i.iu),o[e]=t;throw new Error("Invalid token")}},{"base-64":24}],24:[function(e,l,u){!function(e){var t=this;function c(e){throw new n(e)}var i="object"==typeof u&&u,r="object"==typeof l&&l&&l.exports==i&&l,e="object"==typeof e&&e,n=(e.global!==e&&e.window!==e||(t=e),function(e){this.message=e}),h=(n.prototype=new Error,n.prototype.name="InvalidCharacterError","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),s=/[\t\n\f\r ]/g,o={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,i,r,n,o=e.length%3,a="",s=-1,l=e.length-o;++s<l;)t=e.charCodeAt(s)<<16,i=e.charCodeAt(++s)<<8,r=e.charCodeAt(++s),a+=h.charAt((n=t+i+r)>>18&63)+h.charAt(n>>12&63)+h.charAt(n>>6&63)+h.charAt(63&n);return 2==o?(t=e.charCodeAt(s)<<8,i=e.charCodeAt(++s),a+=h.charAt((n=t+i)>>10)+h.charAt(n>>4&63)+h.charAt(n<<2&63)+"="):1==o&&(n=e.charCodeAt(s),a+=h.charAt(n>>2)+h.charAt(n<<4&63)+"=="),a},decode:function(e){var t=(e=String(e).replace(s,"")).length;(t=t%4==0?(e=e.replace(/==?$/,"")).length:t)%4!=1&&!/[^+a-zA-Z0-9\/]/.test(e)||c("Invalid character: the string to be decoded is not correctly encoded.");for(var i,r,n=0,o="",a=-1;++a<t;)r=h.indexOf(e.charAt(a)),i=n%4?64*i+r:r,n++%4&&(o+=String.fromCharCode(255&i>>(-2*n&6)));return o},version:"0.1.0"};if(i&&!i.nodeType)if(r)r.exports=o;else for(var a in o)o.hasOwnProperty(a)&&(i[a]=o[a]);else t.base64=o}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(e,t,i){function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=d(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function a(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function n(e,t,i,r){var n,o;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');return(n=e._events)?(n.newListener&&(e.emit("newListener",t,i.listener||i),n=e._events),o=n[t]):(n=e._events=d(null),e._eventsCount=0),o?("function"==typeof o?o=n[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),!o.warned&&(r=a(e))&&0<r&&o.length>r&&(o.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",r.emitter=e,r.type=t,r.count=o.length,"object"==typeof console)&&console.warn&&console.warn("%s: %s",r.name,r.message)):(o=n[t]=i,++e._eventsCount),e}function o(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function s(e,t,i){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},t=u.call(o,e);return t.listener=i,e.wrapFn=t}function l(e,t,i){e=e._events;if(e){e=e[t];if(e)if("function"==typeof e)return i?[e.listener||e]:[e];else if(i){var r=e;for(var n=new Array(r.length),o=0;o<n.length;++o)n[o]=r[o].listener||r[o];return n;return}else return V(e,e.length);else;}return[]}function c(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function V(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}var d=Object.create||function(e){function t(){}return t.prototype=e,new t},h=Object.keys||function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return t},u=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};((t.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0;var p,f=10;try{var m={};Object.defineProperty&&Object.defineProperty(m,"x",{value:0}),p=0===m.x}catch(e){p=!1}p?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');f=e}}):r.defaultMaxListeners=f,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return a(this)},r.prototype.emit=function(e){var t,i,r,n,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if((t=1<arguments.length?arguments[1]:t)instanceof Error)throw t;s=new Error('Unhandled "error" event. ('+t+")");throw s.context=t,s}if(!(i=a[e]))return!1;var l="function"==typeof i;switch(r=arguments.length){case 1:var c=i,h=l,u=this;if(h)c.call(u);else for(var d=c.length,R=V(c,d),p=0;p<d;++p)R[p].call(u);break;case 2:var h=i,c=l,f=this,m=arguments[1];if(c)h.call(f,m);else for(var g=h.length,O=V(h,g),_=0;_<g;++_)O[_].call(f,m);break;case 3:var y=i,v=l,x=this,b=arguments[1],w=arguments[2];if(v)y.call(x,b,w);else for(var T=y.length,B=V(y,T),S=0;S<T;++S)B[S].call(x,b,w);break;case 4:var v=i,y=l,A=this,E=arguments[1],C=arguments[2],M=arguments[3];if(y)v.call(A,E,C,M);else for(var I=v.length,F=V(v,I),P=0;P<I;++P)F[P].call(A,E,C,M);break;default:for(n=new Array(r-1),o=1;o<r;o++)n[o-1]=arguments[o];var L=i,N=l,D=this,k=n;if(N)L.apply(D,k);else for(var U=L.length,j=V(L,U),z=0;z<U;++z)j[z].apply(D,k)}return!0},r.prototype.on=r.prototype.addListener=function(e,t){return n(this,e,t,!1)},r.prototype.prependListener=function(e,t){return n(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,s(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,s(this,e,t)),this},r.prototype.removeListener=function(e,t){var i,r,n,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((r=this._events)&&(i=r[e]))if(i===t||i.listener===t)0==--this._eventsCount?this._events=d(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,o=i.length-1;0<=o;o--)if(i[o]===t||i[o].listener===t){a=i[o].listener,n=o;break}if(n<0)return this;if(0===n)i.shift();else{var s=i;var l=n;for(var c=l,h=c+1,u=s.length;h<u;c+=1,h+=1)s[c]=s[h];s.pop()}1===i.length&&(r[e]=i[0]),r.removeListener&&this.emit("removeListener",e,a||t)}return this},r.prototype.removeAllListeners=function(e){var t,i;if(i=this._events)if(i.removeListener){if(0===arguments.length){for(var r,n=h(i),o=0;o<n.length;++o)"removeListener"!==(r=n[o])&&this.removeAllListeners(r);this.removeAllListeners("removeListener"),this._events=d(null),this._eventsCount=0}else if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o])}else 0===arguments.length?(this._events=d(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=d(null):delete i[e]);return this},r.prototype.listeners=function(e){return l(this,e,!0)},r.prototype.rawListeners=function(e){return l(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):c.call(e,t)},r.prototype.listenerCount=c,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],26:[function(e,t,i){function r(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");i=new o(i,r||e,n),r=p?p+t:t;return e._events[r]?e._events[r].fn?e._events[r]=[e._events[r],i]:e._events[r].push(i):(e._events[r]=i,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,p="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(p=!1)),a.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)s.call(e,t)&&i.push(p?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var e=p?p+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var i=0,r=t.length,n=new Array(r);i<r;i++)n[i]=t[i].fn;return n},a.prototype.listenerCount=function(e){e=p?p+e:e,e=this._events[e];return e?e.fn?1:e.length:0},a.prototype.emit=function(e,t,i,r,n,o){var a=p?p+e:e;if(!this._events[a])return!1;var s,l=this._events[a],c=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,n),!0;case 6:return l.fn.call(l.context,t,i,r,n,o),!0}for(d=1,s=new Array(c-1);d<c;d++)s[d-1]=arguments[d];l.fn.apply(l.context,s)}else for(var h,u=l.length,d=0;d<u;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,i);break;case 4:l[d].fn.call(l[d].context,t,i,r);break;default:if(!s)for(h=1,s=new Array(c-1);h<c;h++)s[h-1]=arguments[h];l[d].fn.apply(l[d].context,s)}return!0},a.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,i,r){e=p?p+e:e;if(this._events[e])if(t){var n=this._events[e];if(n.fn)n.fn!==t||r&&!n.once||i&&n.context!==i||l(this,e);else{for(var o=0,a=[],s=n.length;o<s;o++)(n[o].fn!==t||r&&!n[o].once||i&&n[o].context!==i)&&a.push(n[o]);a.length?this._events[e]=1===a.length?a[0]:a:l(this,e)}}else l(this,e);return this},a.prototype.removeAllListeners=function(e){return e?(e=p?p+e:e,this._events[e]&&l(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=p,a.EventEmitter=a,void 0!==t&&(t.exports=a)},{}],27:[function(e,t,i){!function(){var s={};void 0!==i?t.exports=s:this.fuzzy=s,s.simpleFilter=function(t,e){return e.filter(function(e){return s.test(t,e)})},s.test=function(e,t){return null!==s.match(e,t)},s.match=function(e,t,i){var r,n=0,o=[],a=t.length,s=0,l=0,c=(i=i||{}).pre||"",h=i.post||"",u=i.caseSensitive&&t||t.toLowerCase();e=i.caseSensitive&&e||e.toLowerCase();for(var d=0;d<a;d++)r=t[d],u[d]===e[n]?(r=c+r+h,n+=1,l+=1+l):l=0,s+=l,o[o.length]=r;return n===e.length?(s=u===e?1/0:s,{rendered:o.join(""),score:s}):null},s.filter=function(o,e,a){return e&&0!==e.length?"string"!=typeof o?e:(a=a||{},e.reduce(function(e,t,i,r){var n=t,n=(a.extract&&(n=a.extract(t)),s.match(o,n,a));return null!=n&&(e[e.length]={string:n.rendered,score:n.score,index:i,original:t}),e},[]).sort(function(e,t){return t.score-e.score||e.index-t.index})):[]}}()},{}],28:[function(e,t,i){var r=Object.prototype.toString;t.exports=function(e){return"[object Object]"===r.call(e)&&(null===(e=Object.getPrototypeOf(e))||e===Object.getPrototypeOf({}))}},{}],29:[function(e,u,t){!function(e){function y(e){var t=typeof e;return e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if("symbol"==typeof(i=e)||!!(t=i)&&"object"==typeof t&&h.call(i)==n)return r;var t;if("string"!=typeof(e=y(e)?y(t="function"==typeof e.valueOf?e.valueOf():e)?t+"":t:e))return 0===e?e:+e;e=e.replace(o,"");var i=s.test(e);return i||l.test(e)?c(e.slice(2),i?2:8):a.test(e)?r:+e}function x(){return i.Date.now()}var r=NaN,n="[object Symbol]",o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt,e="object"==typeof e&&e&&e.Object===Object&&e,t="object"==typeof self&&self&&self.Object===Object&&self,i=e||t||Function("return this")(),h=Object.prototype.toString,b=Math.max,w=Math.min;u.exports=function(r,i,e){function n(e){var t=l,i=c;return l=c=void 0,f=e,u=r.apply(i,t)}function o(e){var t=e-p;return void 0===p||i<=t||t<0||g&&h<=e-f}function a(){var e,t=x();if(o(t))return s(t);d=setTimeout(a,(e=i-((t=t)-p),g?w(e,h-(t-f)):e))}function s(e){return d=void 0,_&&l?n(e):(l=c=void 0,u)}function t(){var e=x(),t=o(e);if(l=arguments,c=this,p=e,t){if(void 0===d)return f=e=p,d=setTimeout(a,i),m?n(e):u;if(g)return d=setTimeout(a,i),n(p)}return void 0===d&&(d=setTimeout(a,i)),u}var l,c,h,u,d,p,f=0,m=!1,g=!1,_=!0;if("function"!=typeof r)throw new TypeError("Expected a function");return i=v(i)||0,y(e)&&(m=!!e.leading,g="maxWait"in e,h=g?b(v(e.maxWait)||0,i):h,_="trailing"in e?!!e.trailing:_),t.cancel=function(){void 0!==d&&clearTimeout(d),l=p=c=d=void(f=0)},t.flush=function(){return void 0===d?u:s(x())},t}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],30:[function(e,t,i){!function(e){if("production"!==e.env.NODE_ENV&&("undefined"==typeof self||!self.crypto&&!self.msCrypto))throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.");var r=self.crypto||self.msCrypto;t.exports=function(e){e=e||21;for(var t="",i=r.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&i[e]];return t}}.call(this,e("_process"))},{_process:31}],31:[function(e,t,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===r||!h)&&setTimeout)return(h=setTimeout)(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function a(){f&&d&&(f=!1,d.length?p=d.concat(p):m=-1,p.length)&&s()}function s(){if(!f){var e=o(a);f=!0;for(var t=p.length;t;){for(d=p,p=[];++m<t;)d&&d[m].run();m=-1,t=p.length}d=null,f=!1,function(t){if(u===clearTimeout)return clearTimeout(t);if((u===n||!u)&&clearTimeout)return(u=clearTimeout)(t);try{u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var h,u,t=t.exports={};try{h="function"==typeof setTimeout?setTimeout:r}catch(e){h=r}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(e){u=n}var d,p=[],f=!1,m=-1;t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new l(e,t)),1!==p.length||f||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=c,t.addListener=c,t.once=c,t.off=c,t.removeListener=c,t.removeAllListeners=c,t.emit=c,t.prependListener=c,t.prependOnceListener=c,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],32:[function(e,t,i){var r,n;r=this,n=function(){function n(e){return e.match(t)||[]}function o(e){return{language:(e=n(e))[1]||s,extlang:e[2]||s,script:e[3]||s,region:e[4]||s}}function a(e,t,i){Object.defineProperty(e,t,{value:i,enumerable:!0})}function e(t,e,i){function r(e){return n(e)[t]||s}a(r,"pattern",e),a(o,i,r)}var s="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;return e(1,/^[a-zA-Z]{2,3}$/,"language"),e(2,/^[a-zA-Z]{3}$/,"extlang"),e(3,/^[a-zA-Z]{4}$/,"script"),e(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(o,"split",function(e){return n(e).filter(function(e,t){return e&&t})}),o},void 0!==t&&t.exports?t.exports=n():r.subtag=n()},{}],33:[function(e,t,i){e=e("./src/suggestions");window.Suggestions=t.exports=e},{"./src/suggestions":35}],34:[function(e,t,i){function r(e){return this.component=e,this.items=[],this.active=0,this.element=document.createElement("ul"),this.element.className="suggestions",this.selectingListItem=!1,e.el.parentNode.insertBefore(this.element,e.el.nextSibling),this}r.prototype.show=function(){this.element.style.display="block"},r.prototype.hide=function(){this.element.style.display="none"},r.prototype.add=function(e){this.items.push(e)},r.prototype.clear=function(){this.items=[],this.active=0},r.prototype.isEmpty=function(){return!this.items.length},r.prototype.isVisible=function(){return"block"===this.element.style.display},r.prototype.draw=function(){if(this.element.innerHTML="",0===this.items.length)this.hide();else{for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()}},r.prototype.drawItem=function(e,t){var i=document.createElement("li"),r=document.createElement("a");t&&(i.className+=" active"),r.innerHTML=e.string,i.appendChild(r),this.element.appendChild(i),i.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),i.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))},r.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},r.prototype.move=function(e){this.active=e,this.draw()},r.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},r.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},t.exports=r},{}],35:[function(e,t,i){function r(e,t,i){return this.options=n({minLength:2,limit:5,filter:!0},i=i||{}),this.el=e,this.data=t||[],this.list=new a(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(e){this.handleKeyUp(e.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(e){this.handleKeyDown(e)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(e){this.handlePaste(e)}.bind(this)),this.render=(this.options.render?this.options:this).render.bind(this),this.getItemValue=(this.options.getItemValue?this.options:this).getItemValue.bind(this),this}var n=e("xtend"),o=e("fuzzy"),a=e("./list");r.prototype.handleKeyUp=function(e){40!==e&&38!==e&&27!==e&&13!==e&&9!==e&&this.handleInputChange(this.el.value)},r.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},r.prototype.handleBlur=function(){this.list.selectingListItem||this.list.hide()},r.prototype.handlePaste=function(e){var t;e.clipboardData?this.handleInputChange(e.clipboardData.getData("Text")):(t=this,setTimeout(function(){t.handleInputChange(e.target.value)},100))},r.prototype.handleInputChange=function(e){this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}.bind(this))},r.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},r.prototype.update=function(e){this.data=e,this.handleKeyUp()},r.prototype.clear=function(){this.data=[],this.list.clear()},r.prototype.normalize=function(e){return e.toLowerCase()},r.prototype.match=function(e,t){return-1<e.indexOf(t)},r.prototype.value=function(e){this.selected=e,this.el.value=this.getItemValue(e),document.createEvent?((e=document.createEvent("HTMLEvents")).initEvent("change",!0,!1),this.el.dispatchEvent(e)):this.el.fireEvent("onchange")},r.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(e){return this.getItemValue(e)}.bind(this)},i=this.options.filter?(i=o.filter(this.query,this.data,t)).map(function(e){return{original:e.original,string:this.render(e.original,e.string)}}.bind(this)):this.data.map(function(e){return{original:e,string:this.render(e)}}.bind(this));e(i)},r.prototype.getItemValue=function(e){return e},r.prototype.render=function(e,t){if(t)return t;for(var i=e.original?this.getItemValue(e.original):this.getItemValue(e),r=this.normalize(i),n=r.lastIndexOf(this.query);-1<n;)var o=n+this.query.length,i=i.slice(0,n)+"<strong>"+i.slice(n,o)+"</strong>"+i.slice(o),n=r.slice(0,n).lastIndexOf(this.query);return i},t.exports=r},{"./list":34,fuzzy:27,xtend:36}],36:[function(e,t,i){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i,r=arguments[t];for(i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[3])(3)}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).mapboxgl=t()}(this,function(){var n,o,a;function e(e,t){var i,r;n?o?(i="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",n(r={}),a=t(r),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([i],{type:"text/javascript"})))):o=t:n=t}return e(0,function(Te){var L="3.3.0";let k;const o={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==k){var t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{k=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){k=t}}return k},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!o.API_URL)return null;try{var e=new URL(o.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function z(e){return o.API_URL_REGEX.test(e)}function R(e){return 0===e.indexOf("mapbox:")}function O(e){return o.API_CDN_URL_REGEX.test(e)}function B(e){return o.API_SPRITE_REGEX.test(e)}function F(e){return o.API_STYLE_REGEX.test(e)&&!B(e)}const N={create:"create",load:"load",fullLoad:"fullLoad"};function V(e){var t,e=e.name.split("?")[0];return O(e)&&e.includes("mapbox-gl.js")?"javascript":O(e)&&e.includes("mapbox-gl.css")?"css":(t=e,o.API_FONTS_REGEX.test(t)?"fontRange":B(e)?"sprite":F(e)?"style":(t=e,o.API_TILEJSON_REGEX.test(t)?"tilejson":"other"))}function G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var q=W;function W(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}W.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(1<e)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}for(var a=0,s=1,i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)n<e?a=i:s=i,i=.5*(s-a)+a;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var H=G(q),q=Z;function Z(e,t){this.x=e,this.y=t}Z.prototype={clone:function(){return new Z(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),e=Math.sin(e),i=e*this.x+t*this.y;return this.x=t*this.x-e*this.y,this.y=i,this},_rotateAround:function(e,t){var i=Math.cos(e),e=Math.sin(e),r=t.y+e*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-e*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Z.convert=function(e){return!(e instanceof Z)&&Array.isArray(e)?new Z(e[0],e[1]):e};var U=G(q);const $=Math.PI/180,X=180/Math.PI;function _(e){return e*$}function Y(e){return e*X}const K=[[0,0],[1,0],[1,1],[0,1]];function J(e){var t,i;return e<=0?0:1<=e?1:(i=(t=e*e)*e,4*(e<.5?i:3*(e-t)+i-.75))}function Q(e,t,i,r){const n=new H(e,t,i,r);return function(e){return n.solve(e)}}var ee=Q(.25,.1,.25,1);function S(e,t,i){return Math.min(i,Math.max(t,e))}function te(e,t,i){return(i=S((i-e)/(t-e),0,1))*i*(3-2*i)}function ie(e,t,i){var r=i-t,e=((e-t)%r+r)%r+t;return e===t?i:e}function re(e,t,r){if(!e.length)return r(null,[]);let n=e.length;const o=new Array(e.length);let a=null;e.forEach((e,i)=>{t(e,(e,t)=>{e&&(a=e),o[i]=t,0==--n&&r(a,o)})})}function ne(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let oe=1;function ae(){return oe++}function se(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function le(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ce(e){return e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function he(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function de(e,t){return-1!==e.indexOf(t,e.length-t.length)}function pe(e,t,i){var r={};for(const n in e)r[n]=t.call(i||this,e[n],n,e);return r}function fe(e,t,i){var r={};for(const n in e)t.call(i||this,e[n],n,e)&&(r[n]=e[n]);return r}function me(e){return Array.isArray(e)?e.map(me):"object"==typeof e&&e?pe(e,me):e}const ge={};function _e(e){ge[e]||("undefined"!=typeof console&&console.warn(e),ge[e]=!0)}function ye(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function ve([e,t,i]){var r=_(t+90),n=_(i);return{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n),azimuthal:t,polar:i}}function xe(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function be(e){const n={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,t,i,r)=>{i=i||r;return n[t]=!i||i.toLowerCase(),""}),n["max-age"]){const e=parseInt(n["max-age"],10);isNaN(e)?delete n["max-age"]:n["max-age"]=e}return n}let we,Se,Ae,Ee,Ce,Me,Ie=null;function Pe(e){try{var t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function Le(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function De(e,t,i,r){for(;t<i;){var n=t+i>>1;e[n]<r?t=1+n:i=n}return t}function ke(e,t,i,r){for(;t<i;){var n=t+i>>1;e[n]<=r?t=1+n:i=n}return t}function ze(){return we=null==we?self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap:we}const Re={now:()=>void 0!==Ee?Ee:performance.now(),setNow(e){Ee=e},restoreNow(){Ee=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){var{width:i,height:r}=e,n=(Ce=Ce||document.createElement("canvas")).getContext("2d",{willReadFrequently:!0});if(n)return(i>Ce.width||r>Ce.height)&&(Ce.width=i,Ce.height=r),n.clearRect(-t,-t,i+2*t,r+2*t),n.drawImage(e,0,0,i,r),n.getImageData(-t,-t,i+2*t,r+2*t);throw new Error("failed to create canvas 2d context")},resolveURL:e=>((Se=Se||document.createElement("a")).href=e,Se.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ae=null==Ae?window.matchMedia("(prefers-reduced-motion: reduce)"):Ae).matches},hasCanvasFingerprintNoise(){if(void 0!==Me)return Me;if(ze()){var i=new OffscreenCanvas(85,1),r=i.getContext("2d",{willReadFrequently:!0});let t=0;for(let e=0;e<i.width;++e)r.fillStyle=`rgba(${t++},${t++},${t++}, 255)`,r.fillRect(e,0,1,1);var n=r.getImageData(0,0,i.width,i.height);for(let e=t=0;e<n.data.length;++e)if(e%4!=3&&t++!==n.data[e])return Me=!0}return Me=!1}},Oe="mapbox-tiles";let Be=500,Fe=50,Ne,Ue;function je(){try{return caches}catch(e){}}function Ve(){var e=je();e&&!Ne&&(Ne=e.open(Oe))}function Ge(e){const t=e.indexOf("?");if(t<0)return e;var i=new URLSearchParams,r=new URLSearchParams(e.slice(t));for(const e of["language","worldview"]){const t=r.get(e);t&&i.set(e,t)}return e.slice(0,t)+"?"+i.toString()}function qe(e,t){var i=e.indexOf("?");if(i<0)return e+"?"+new URLSearchParams(t).toString();var r=new URLSearchParams(e.slice(i));for(const e in t)r.set(e,t[e]);return e.slice(0,i)+"?"+r.toString()}let We=1/0;const He={supported:!1,testSupport:function(e){!Xe&&$e&&(Ye?Ke(e):Ze=e)}};let Ze,$e,Xe=!1,Ye=!1;var e="undefined"!=typeof self?self:{};function Ke(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,$e),e.isContextLost())return;He.supported=!0}catch(e){}e.deleteTexture(t),Xe=!0}e.document&&(($e=e.document.createElement("img")).onload=function(){Ze&&Ke(Ze),Ze=null,Ye=!0},$e.onerror=function(){Xe=!0,Ze=null},$e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Je={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Je);class Qe extends Error{constructor(e,t,i){401===t&&z(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): `+this.url}}function et(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(it())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal")){var a=e;var s=t;const c=new AbortController,h=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:it(),referrerPolicy:a.referrerPolicy,signal:c.signal});let n=!1,o=!1;const u=0<(r=h.url).indexOf("sku=")&&z(r);var i,l;"json"===a.type&&h.headers.set("Accept","application/json");const d=(e,t,i)=>{if(!o){if(e&&"SecurityError"!==e.message&&_e(e.toString()),t&&i)return p(t);const r=Date.now();fetch(h).then(e=>{if(e.ok){const a=u?e.clone():null;return p(e,a,r)}return s(new Qe(e.statusText,e.status,a.url))}).catch(e=>{"AbortError"!==e.name&&s(new Error(e.message+" "+a.url))})}},p=(t,i,r)=>{("arrayBuffer"===a.type?t.arrayBuffer():"json"===a.type?t.json():t.text()).then(e=>{o||(i&&r&&function(e,t,i){if(Ve(),Ne){var r=be(t.headers.get("Cache-Control")||"");if(!r["no-store"]){const o={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach((e,t)=>o.headers.set(t,e)),r["max-age"]&&o.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString());r=o.headers.get("Expires");if(r&&!(new Date(r).getTime()-i<42e4)){let i=Ge(e.url);if(206===t.status){const t=e.headers.get("Range");if(!t)return;o.status=200,i=qe(i,{range:t})}var n=t,r=e=>{const t=new Response(e,o);Ve(),Ne&&Ne.then(e=>e.put(i,t)).catch(e=>_e(e.message))};if(void 0===Ue)try{new Response(new ReadableStream),Ue=!0}catch(n){Ue=!1}Ue?r(n.body):n.blob().then(r)}}}}(h,i,r),n=!0,s(null,e,t.headers.get("Cache-Control"),t.headers.get("Expires")))}).catch(e=>{o||s(new Error(e.message))})};return u?(i=h,l=d,Ve(),Ne?Ne.then(r=>{let n=Ge(i.url);var e=i.headers.get("Range");e&&(n=qe(n,{range:e})),r.match(n).then(e=>{var t,i=!!(t=e)&&(i=new Date(t.headers.get("Expires")||0),t=be(t.headers.get("Cache-Control")||""),i>Date.now())&&!t["no-cache"];r.delete(n),i&&r.put(n,e.clone()),l(null,e,i)}).catch(l)}).catch(l):l(null)):d(null,null),{cancel:()=>{o=!0,n||c.abort()}};return}if(xe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;{var n=e,o=t;const f=new XMLHttpRequest;f.open(n.method||"GET",n.url,!0),"arrayBuffer"===n.type&&(f.responseType="arraybuffer");for(const o in n.headers)f.setRequestHeader(o,n.headers[o]);return"json"===n.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===n.credentials,f.onerror=()=>{o(new Error(f.statusText))},f.onload=()=>{if((200<=f.status&&f.status<300||0===f.status)&&null!==f.response){let e=f.response;if("json"===n.type)try{e=JSON.parse(f.response)}catch(e){return o(e)}o(null,e,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else o(new Qe(f.statusText,f.status,n.url))},f.send(n.body),{cancel:()=>f.abort()}}}function tt(e,t){return et(ne(e,{type:"arrayBuffer"}),t)}const it=xe()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href;const rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nt,ot;nt=[],ot=0;function at(e,s){if(He.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ot>=o.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return nt.push(i),i}ot++;let i=!1;const l=()=>{if(!i)for(i=!0,ot--;nt.length&&ot<o.MAX_PARALLEL_IMAGE_REQUESTS;){const e=nt.shift(),{requestParameters:t,callback:i,cancelled:o}=e;o||(e.cancel=at(t,i).cancel)}},t=tt(e,(e,t,i,r)=>{if(l(),e)s(e);else if(t)if(self.createImageBitmap)o=(e,t)=>s(e,t,i,r),e=new Blob([new Uint8Array(t)],{type:"image/png"}),createImageBitmap(e).then(e=>{o(null,e)}).catch(e=>{o(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))});else{e=t;var n=(e,t)=>s(e,t,i,r);const a=new Image;a.onload=()=>{n(null,a),URL.revokeObjectURL(a.src),a.onload=null,requestAnimationFrame(()=>{a.src=rt})},a.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),t=new Blob([new Uint8Array(e)],{type:"image/png"}),a.src=e.byteLength?URL.createObjectURL(t):rt}var o});return{cancel:()=>{t.cancel(),l()}}}const st="NO_ACCESS_TOKEN",lt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ct(e){e=e.match(lt);if(e)return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]};throw new Error("Unable to parse URL object")}function ht(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}const ut="mapbox.eventData";function dt(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(e){return null}}class pt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){var t=dt(o.ACCESS_TOKEN),t=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t)))):o.ACCESS_TOKEN||"";return e?ut+`.${e}:`+t:ut+":"+t}fetchEventData(){const e=Pe("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));var r=localStorage.getItem(i);r&&(this.anonId=r)}catch(e){_e("Unable to read from LocalStorage")}}saveEventData(){var e=Pe("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid"),r=this.anonId;if(e&&r)try{localStorage.setItem(i,r),1<=Object.keys(this.eventData).length&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){_e("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,r){var n;o.EVENTS_URL&&((n=ct(o.EVENTS_URL)).params.push("access_token="+(r||o.ACCESS_TOKEN||"")),e={event:this.type,created:new Date(e).toISOString()},t=t?ne(e,t):e,e={url:ht(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([t])},this.pendingRequest=(n=e,t=e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)},et(ne(n,{method:"POST"}),t)))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const ft=new class extends pt{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){o.EVENTS_URL&&o.ACCESS_TOKEN&&Array.isArray(e)&&e.some(e=>R(e)||z(e))&&this.queueRequest(Date.now(),t)}processRequests(t){if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=dt(o.ACCESS_TOKEN),r=i?i.u:o.ACCESS_TOKEN;let e=r!==this.eventData.tokenU;ce(this.anonId)||(this.anonId=se(),e=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),L=new Date(n),i=(n-this.eventData.lastSuccess)/864e5;e=e||1<=i||i<-1||t.getDate()!==L.getDate()}else e=!0;e?this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:"01","enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=n,this.eventData.tokenU=r)},t):this.processRequests()}}},mt=ft.postTurnstileEvent.bind(ft),gt=new class extends pt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,r){this.skuToken=t,this.errorCb=r,o.EVENTS_URL&&(i||o.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(st)))}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ce(this.anonId)||(this.anonId=se()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:"01",skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e))}}remove(){this.errorCb=null}},_t=gt.postMapLoadEvent.bind(gt),yt=new class extends pt{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){o.EVENTS_URL&&(e||o.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){var{timestamp:t,performanceData:i}=this.queue.shift(),i=function(e){const t=performance.getEntriesByType("resource"),i=performance.getEntriesByType("mark"),r=function(e){const t={};if(e)for(const r in e)if("other"!==r)for(const n of e[r]){const e=r+"ResolveRangeMin",o=r+"ResolveRangeMax",a=r+"RequestCount",s=r+"RequestCachedCount";t[e]=Math.min(t[e]||1/0,n.startTime),t[o]=Math.max(t[o]||-1/0,n.responseEnd);var i=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&i(s),i(a)}return t}(function(e,t){var i={};if(e)for(const r of e){const e=t(r);void 0===i[e]&&(i[e]=[]),i[e].push(r)}return i}(t,V)),n=window.devicePixelRatio,o=navigator.connection||navigator.mozConnection||navigator.webkitConnection,a=o?o.effectiveType:void 0,s={counters:[],metadata:[],attributes:[]},l=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const e in r)l(s.counters,e,r[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(l(s.counters,"interactionRangeMin",e.interactionRange[0]),l(s.counters,"interactionRangeMax",e.interactionRange[1])),i)for(const e of Object.keys(N)){const L=N[e],t=i.find(e=>e.name===L);t&&l(s.counters,L,t.startTime)}return l(s.counters,"visibilityHidden",e.visibilityHidden),l(s.attributes,"style",function(e){if(e)for(const i of e){const e=i.name.split("?")[0];if(F(e)){var t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/`+t[1]}}}(t)),l(s.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),l(s.attributes,"fogEnabled",e.fogEnabled?"true":"false"),l(s.attributes,"projection",e.projection),l(s.attributes,"zoom",e.zoom),l(s.metadata,"devicePixelRatio",n),l(s.metadata,"connectionEffectiveType",a),l(s.metadata,"navigatorUserAgent",navigator.userAgent),l(s.metadata,"screenWidth",window.screen.width),l(s.metadata,"screenHeight",window.screen.height),l(s.metadata,"windowWidth",window.innerWidth),l(s.metadata,"windowHeight",window.innerHeight),l(s.metadata,"mapWidth",e.width/n),l(s.metadata,"mapHeight",e.height/n),l(s.metadata,"webglRenderer",e.renderer),l(s.metadata,"webglVendor",e.vendor),l(s.metadata,"sdkVersion",L),l(s.metadata,"sdkIdentifier","mapbox-gl-js"),s}(i);for(const e of i.metadata);for(const e of i.counters);for(const e of i.attributes);this.postEvent(t,i,()=>{},e)}}},vt=yt.postPerformanceEvent.bind(yt),xt=new class extends pt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,r){var n;o.API_URL&&o.SESSION_PATH&&((n=ct(o.API_URL+o.SESSION_PATH)).params.push("sku="+(t||"")),n.params.push("access_token="+(r||o.ACCESS_TOKEN||"")),t={url:ht(n),headers:{"Content-Type":"text/plain"}},this.pendingRequest=(n=t,t=e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)},et(ne(n,{method:"GET"}),t)))}getSessionAPI(e,t,i,r){this.skuToken=t,this.errorCb=r,o.SESSION_PATH&&o.API_URL&&(i||o.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(st)))}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}}remove(){this.errorCb=null}},bt=xt.getSessionAPI.bind(xt),wt=new Set;function Tt(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function St(e,t,i){i&&i[e]&&-1!==(t=i[e].indexOf(t))&&i[e].splice(t,1)}class At{constructor(e,t={}){ne(this,t),this.type=e}}class Et extends At{constructor(e,t={}){super("error",ne({error:e},t))}}class Ct{on(e,t){return this._listeners=this._listeners||{},Tt(e,t,this._listeners),this}off(e,t){return St(e,t,this._listeners),St(e,t,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Tt(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(e,t){const i=(e="string"==typeof e?new At(e,t||{}):e).type;if(this.listens(i)){const t=(e.target=this)._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);for(const t of this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[])St(i,t,this._oneTimeListeners),t.call(this,e);var r=this._eventedParent;r&&(ne(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof Et&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&0<this._listeners[e].length||this._oneTimeListeners&&this._oneTimeListeners[e]&&0<this._oneTimeListeners[e].length||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}Te.y=void 0;var Mt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function It(e){return(e=Math.round(e))<0?0:255<e?255:e}function Pt(e){return It("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Lt(e){return(e="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:1<e?1:e}function Dt(e,t,i){return i<0?i+=1:1<i&&--i,6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{Te.y={}.parseCSSColor=function(e){e=e.replace(/ /g,"").toLowerCase();if(e in Mt)return Mt[e].slice();if("#"===e[0])return 4===e.length?0<=(t=parseInt(e.substr(1),16))&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===e.length&&0<=(t=parseInt(e.substr(1),16))&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var t=e.indexOf("("),i=e.indexOf(")");if(-1!==t&&i+1===e.length){var r,n,o,a=e.substr(0,t),s=e.substr(t+1,i-(t+1)).split(","),l=1;switch(a){case"rgba":if(4!==s.length)return null;l=Lt(s.pop());case"rgb":return 3!==s.length?null:[Pt(s[0]),Pt(s[1]),Pt(s[2]),l];case"hsla":if(4!==s.length)return null;l=Lt(s.pop());case"hsl":return 3!==s.length?null:(r=(parseFloat(s[0])%360+360)%360/360,o=Lt(s[1]),[It(255*Dt(o=2*(n=Lt(s[2]))-(n=n<=.5?n*(o+1):n+o-n*o),n,r+1/3)),It(255*Dt(o,n,r)),It(255*Dt(o,n,r-1/3)),l]);default:return null}}return null}}catch(Te){}class kt{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(e)return e instanceof kt?e:"string"==typeof e&&(e=Te.y(e))?new kt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){var[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){var{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}toArray01(){var{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[e/r,t/r,i/r,r]}toArray01Scaled(e){var{r:t,g:i,b:r,a:n}=this;return 0===n?[0,0,0]:[t/n*e,i/n*e,r/n*e]}toArray01PremultipliedAlpha(){var{r:e,g:t,b:i,a:r}=this;return[e,t,i,r]}toArray01Linear(){var{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(e/r,2.2),Math.pow(t/r,2.2),Math.pow(i/r,2.2),r]}}kt.black=new kt(0,0,0,1),kt.white=new kt(1,1,1,1),kt.transparent=new kt(0,0,0,0),kt.red=new kt(1,0,0,1),kt.blue=new kt(0,0,1,1);var zt=kt;function A(e,t,i){return e*(1-i)+t*i}function Rt(e,i,r){return e.map((e,t)=>A(e,i[t],r))}var Ot=Object.freeze({__proto__:null,array:Rt,color:function(e,t,i){return new zt(A(e.r,t.r,i),A(e.g,t.g,i),A(e.b,t.b,i),A(e.a,t.a,i))},number:A});function Bt(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class Ft extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Nt=Ft;var Ut=class x_{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new x_(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}};const jt={kind:"null"},h={kind:"number"},l={kind:"string"},c={kind:"boolean"},Vt={kind:"color"},Gt={kind:"object"},u={kind:"value"},qt={kind:"collator"},Wt={kind:"formatted"},Ht={kind:"resolvedImage"};function Zt(e,t){return{kind:"array",itemType:e,N:t}}function $t(e){var t;return"array"===e.kind?(t=$t(e.itemType),"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`):e.kind}const Xt=[jt,h,l,c,Vt,Wt,Gt,Zt(u),Ht];function Yt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Yt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Xt)if(!Yt(e,t))return null}return`Expected ${$t(e)} but found ${$t(t)} instead.`}function Kt(t,e){return e.some(e=>e.kind===t.kind)}function Jt(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}class Qt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class ei{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class ti{constructor(e){this.sections=e}static fromString(e){return new ti([new ei(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof ti?e:ti.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){var e,t=["format"];for(const i of this.sections)i.image?t.push(["image",i.image.namePrimary]):(t.push(i.text),e={},i.fontStack&&(e["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(e["font-scale"]=i.scale),i.textColor&&(e["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(e));return t}}class ii{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new ii({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ri(e,t,i,r){return"number"==typeof e&&0<=e&&e<=255&&"number"==typeof t&&0<=t&&t<=255&&"number"==typeof i&&0<=i&&i<=255?void 0===r||"number"==typeof r&&0<=r&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ni(e){if(null===e)return 1;if("string"==typeof e)return 1;if("boolean"==typeof e)return 1;if("number"==typeof e)return 1;if(e instanceof zt)return 1;if(e instanceof Qt)return 1;if(e instanceof ti)return 1;if(e instanceof ii)return 1;if(Array.isArray(e)){for(const t of e)if(!ni(t))return;return 1}if("object"==typeof e){for(const i in e)if(!ni(e[i]))return;return 1}}function oi(t){if(null===t)return jt;if("string"==typeof t)return l;if("boolean"==typeof t)return c;if("number"==typeof t)return h;if(t instanceof zt)return Vt;if(t instanceof Qt)return qt;if(t instanceof ti)return Wt;if(t instanceof ii)return Ht;if(Array.isArray(t)){var i=t.length;let e;for(const r of t){const t=oi(r);if(e){if(e===t)continue;e=u;break}e=t}return Zt(e||u,i)}return Gt}function ai(e){var t=typeof e;return null===e?"":"string"==t||"number"==t||"boolean"==t?String(e):e instanceof zt||e instanceof ti||e instanceof ii?e.toString():JSON.stringify(e)}var si=class b_{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ni(e[1]))return t.error("invalid value");let i=oi(e=e[1]);return t=t.expectedType,"array"!==i.kind||0!==i.N||!t||"array"!==t.kind||"number"==typeof t.N&&0!==t.N||(i=t),new b_(i,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zt?["rgba"].concat(this.value.toArray()):this.value instanceof ti?this.value.serialize():this.value}},li=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const ci={string:l,number:h,boolean:c,object:Gt};var hi=class w_{constructor(e,t){this.type=e,this.args=t}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");let n,o=1;var e=i[0];if("array"===e){let e,t;if(2<i.length){const n=i[1];if("string"!=typeof n||!(n in ci)||"object"===n)return r.error('The item type argument of "array" must be one of string, number, boolean',1);e=ci[n],o++}else e=u;if(3<i.length){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return r.error('The length argument to "array" must be a positive integer literal',2);t=i[2],o++}n=Zt(e,t)}else n=ci[e];for(var t=[];o<i.length;o++){const n=r.parse(i[o],o,u);if(!n)return null;t.push(n)}return new w_(n,t)}evaluate(t){for(let e=0;e<this.args.length;e++){var i=this.args[e].evaluate(t);if(!Yt(this.type,oi(i)))return i;if(e===this.args.length-1)throw new li(`Expected value to be of type ${$t(this.type)}, but found ${$t(oi(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){var e,t=this.type,i=[t.kind];return"array"===t.kind&&("string"===(e=t.itemType).kind||"number"===e.kind||"boolean"===e.kind)&&(i.push(e.kind),"number"==typeof(e=t.N)||1<this.args.length)&&i.push(e),i.concat(this.args.map(e=>e.serialize()))}};class ui{constructor(e){this.type=Wt,this.sections=e}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");var e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return r.error("First argument must be an image or text section.");var n=[];let o=!1;for(let e=1;e<=t.length-1;++e){var a=t[e];if(o&&"object"==typeof a&&!Array.isArray(a)){o=!1;let e=null;if(a["font-scale"]&&!(e=r.parse(a["font-scale"],1,h)))return null;let t=null;if(a["text-font"]&&!(t=r.parse(a["text-font"],1,Zt(l))))return null;let i=null;if(a["text-color"]&&!(i=r.parse(a["text-color"],1,Vt)))return null;a=n[n.length-1];a.scale=e,a.font=t,a.textColor=i}else{a=r.parse(t[e],1,u);if(!a)return null;var i=a.type.kind;if("string"!==i&&"value"!==i&&"null"!==i&&"resolvedImage"!==i)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,n.push({content:a,scale:null,font:null,textColor:null})}}return new ui(n)}evaluate(i){return new ti(this.sections.map(e=>{var t=e.content.evaluate(i);return oi(t)===Ht?new ei("",t,null,null,null):new ei(ai(t),null,e.scale?e.scale.evaluate(i):null,e.font?e.font.evaluate(i).join(","):null,e.textColor?e.textColor.evaluate(i):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){var e=["format"];for(const i of this.sections){e.push(i.content.serialize());var t={};i.scale&&(t["font-scale"]=i.scale.serialize()),i.font&&(t["text-font"]=i.font.serialize()),i.textColor&&(t["text-color"]=i.textColor.serialize()),e.push(t)}return e}}class di{constructor(e,t){this.type=Ht,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){var i;return e.length<2?t.error("Expected two or more arguments."):(i=t.parse(e[1],1,l))?2===e.length?new di(i):(e=t.parse(e[2],1,l))?new di(i,e):t.error("Secondary image variant is not a string."):t.error("No image name provided.")}evaluate(e){var t=ii.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=-1<e.availableImages.indexOf(t.namePrimary),t.nameSecondary)&&t.available&&e.availableImages&&(t.available=-1<e.availableImages.indexOf(t.nameSecondary)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function pi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const fi={"to-boolean":c,"to-color":Vt,"to-number":h,"to-string":l};var mi=class T_{constructor(e,t){this.type=e,this.args=t}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");const n=i[0],o=[];let a=jt;if("to-array"===n){if(!Array.isArray(i[1]))return null;const n=i[1].length;if(r.expectedType){if("array"!==r.expectedType.kind)return r.error(`Expected ${r.expectedType.kind} but found array.`);a=Zt(r.expectedType.itemType,n)}else{if(!(0<n&&ni(i[1][0])))return null;a=Zt(oi(i[1][0]),n)}for(let t=0;t<n;t++){const n=i[1][t];let e;if("array"===pi(n))e=r.parse(n,void 0,a.itemType);else{const i=pi(n);if(i!==a.itemType.kind)return r.error(`Expected ${a.itemType.kind} but found ${i}.`);e=r.registry.literal.parse(["literal",void 0===n?null:n],r)}if(!e)return null;o.push(e)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==i.length)return r.error("Expected one argument.");a=fi[n];for(let e=1;e<i.length;e++){const a=r.parse(i[e],e,u);if(!a)return null;o.push(a)}}return new T_(a,o)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let e,t;for(const n of this.args){if(e=n.evaluate(i),t=null,e instanceof zt)return e;if("string"==typeof e){var r=i.parseColor(e);if(r)return r}else if(Array.isArray(e)&&!(t=e.length<3||4<e.length?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ri(e[0],e[1],e[2],e[3])))return new zt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new li(t||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"!==this.type.kind)return"formatted"===this.type.kind?ti.fromString(ai(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?ii.fromString(ai(this.args[0].evaluate(i))):"array"===this.type.kind?this.args.map(e=>e.evaluate(i)):ai(this.args[0].evaluate(i));{let e=null;for(const o of this.args){if(null===(e=o.evaluate(i)))return 0;var t=Number(e);if(!isNaN(t))return t}throw new li(`Could not convert ${JSON.stringify(e)} to number.`)}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ui([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new di(this.args[0]).serialize();const t="array"===this.type.kind?[]:["to-"+this.type.kind];return this.eachChild(e=>{t.push(e.serialize())}),t}};const gi=["Unknown","Point","LineString","Polygon"];var _i=class{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?gi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){var e,t,i,r;return this.featureTileCoord&&this.featureDistanceData?(e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord,this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])):0}parseColor(e){let t=this._parseColorCache[e];return t=t||(this._parseColorCache[e]=zt.parse(e))}getConfig(e){return this.options?this.options.get(e):null}};class yi{constructor(e,t,i,r,n){this.name=e,this.type=t,this._evaluate=i,this.args=r,this._overloadIndex=n}evaluate(e){if(!this._evaluate){const e=yi.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(i,r){const n=i[0],o=yi.definitions[n];if(!o)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(o)?o[0]:o.type,s=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,l=[];let c=null,e=-1;for(const[o,h]of s)if(!Array.isArray(o)||o.length===i.length-1){l.push(o),e++,c=new Er(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const s=[];let t=!1;for(let e=1;e<i.length;e++){const n=i[e],a=Array.isArray(o)?o[e-1]:o.type,l=c.parse(n,1+s.length,a);if(!l){t=!0;break}s.push(l)}if(!t)if(Array.isArray(o)&&o.length!==s.length)c.error(`Expected ${o.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const r=Array.isArray(o)?o[e]:o.type,n=s[e];c.concat(e+1).checkSubtype(r,n.type)}if(0===c.errors.length)return new yi(n,a,h,s,e)}}if(1===l.length)r.errors.push(...c.errors);else{const n=(l.length?l:s.map(([e])=>e)).map(vi).join(" | "),o=[];for(let e=1;e<i.length;e++){const a=r.parse(i[e],1+o.length);if(!a)return null;o.push($t(a.type))}r.error(`Expected arguments of type ${n}, but found (${o.join(", ")}) instead.`)}return null}static register(e,t){for(const i in yi.definitions=t)e[i]=yi}}function vi(e){return Array.isArray(e)?`(${e.map($t).join(", ")})`:`(${$t(e.type)}...)`}var xi=yi;class bi{constructor(e,t,i){this.type=qt,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");e=e[1];if("object"!=typeof e||Array.isArray(e))return t.error("Collator options argument must be an object.");var i=t.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,c);if(!i)return null;var r=t.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,c);if(!r)return null;let n=null;return e.locale&&!(n=t.parse(e.locale,1,l))?null:new bi(i,r,n)}evaluate(e){return new Qt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}e={exports:{}};function wi(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function Ti(e,t){return e<t?-1:t<e?1:0}e.exports=function(e,t,i,r,n){!function e(t,i,r,n,o){for(;r<n;){600<n-r&&(a=n-r+1,s=i-r+1,c=Math.log(a),l=.5*Math.exp(2*c/3),c=.5*Math.sqrt(c*l*(a-l)/a)*(s-a/2<0?-1:1),e(t,i,Math.max(r,Math.floor(i-s*l/a+c)),Math.min(n,Math.floor(i+(a-s)*l/a+c)),o));var a,s,l,c,h=t[i],u=r,d=n;for(wi(t,r,i),0<o(t[n],h)&&wi(t,r,n);u<d;){for(wi(t,u,d),u++,d--;o(t[u],h)<0;)u++;for(;0<o(t[d],h);)d--}0===o(t[r],h)?wi(t,r,d):wi(t,++d,n),d<=i&&(r=d+1),i<=d&&(n=d-1)}}(e,t,i||0,r||e.length-1,n||Ti)};var Si=G(e.exports);function Ai(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ei(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ci(r,i,n=!1){let o=!1;for(let e=0,t=i.length;e<t;e++){var a=i[e];for(let e=0,t=a.length,i=t-1;e<t;i=e++){var s=a[i],l=a[e];if(h=s,d=u=void 0,u=(c=r)[0]-h[0],h=c[1]-h[1],d=c[0]-l[0],c=c[1]-l[1],u*c-d*h==0&&u*d<=0&&h*c<=0)return n;s[1]>r[1]!=l[1]>r[1]&&r[0]<(l[0]-s[0])*(r[1]-s[1])/(l[1]-s[1])+s[0]&&(o=!o)}}var c,h,u,d;return o}function Mi(e,t,i,r){var n=r[0]-i[0],r=r[1]-i[1],e=(e[0]-i[0])*r-n*(e[1]-i[1]),r=(t[0]-i[0])*r-n*(t[1]-i[1]);return 0<e&&r<0||e<0&&0<r}function Ii(e,t,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*o[0]&&Mi(e,t,i,r)&&Mi(i,r,e,t);var n,o}const Pi=8192;function Li(t,i){for(let e=0;e<t.length;++e)if(!Ci(t[e],i))return;for(let e=0;e<t.length-1;++e)if(function(r,n,e){for(const o of e)for(let e=0,t=o.length,i=t-1;e<t;i=e++)if(Ii(r,n,o[i],o[e]))return 1}(t[e],t[e+1],i))return;return 1}function Di(i,r,n){var o,a,e=[];for(let t=0;t<i.length;t++){var s=[];for(let e=0;e<i[t].length;e++){o=i[t][e],a=n,l=void 0,l=(180+o[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,a=Math.pow(2,a.z);var l=[Math.round(l*a*Pi),Math.round(o*a*Pi)];Ai(r,l),s.push(l)}e.push(s)}return e}function ki(t,i,r){var n=[];for(let e=0;e<t.length;e++){var o=Di(t[e],i,r);n.push(o)}return n}function zi(t,i,r,n){if(t[0]<r[0]||t[0]>r[2]){const i=.5*n;let e=t[0]-r[0]>i?-n:r[0]-t[0]>i?n:0;0===e&&(e=t[0]-r[2]>i?-n:r[2]-t[0]>i?n:0),t[0]+=e}Ai(i,t)}function Ri(e,t,i,r){var n=Math.pow(2,r.z)*Pi,o=[r.x*Pi,r.y*Pi],a=[];if(e)for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];zi(r,t,i,n),a.push(r)}return a}function Oi(e,t,i,r){var n=Math.pow(2,r.z)*Pi,o=[r.x*Pi,r.y*Pi],a=[];if(e){for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Ai(t,i),e.push(i)}a.push(e)}if(t[2]-t[0]<=n/2){(r=t)[0]=r[1]=1/0,r[2]=r[3]=-1/0;for(const e of a)for(const r of e)zi(r,t,i,n)}}return a}var Bi,Fi,Ni,Ui=class S_{constructor(e,t){this.type=c,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ni(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){var i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new S_(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new S_(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new S_(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType()){var t=e,i=this.geometries,r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(!o)return!1;if("Polygon"===i.type){var a=Di(i.coordinates,n,o),s=Ri(t.geometry(),r,n,o);if(!Ei(r,n))return!1;for(const t of s)if(!Ci(t,a))return!1}if("MultiPolygon"===i.type){var l=ki(i.coordinates,n,o),s=Ri(t.geometry(),r,n,o);if(!Ei(r,n))return!1;for(const t of s)if(!function(t,i){for(let e=0;e<i.length;e++)if(Ci(t,i[e]))return 1}(t,l))return!1}return!0}if("LineString"===e.geometryType()){var c=e;if(i=this.geometries,t=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],!(r=c.canonicalID()))return!1;if("Polygon"===i.type){var h=Di(i.coordinates,o,r),u=Oi(c.geometry(),t,o,r);if(!Ei(t,o))return!1;for(const c of u)if(!Li(c,h))return!1}if("MultiPolygon"===i.type){var d=ki(i.coordinates,o,r),u=Oi(c.geometry(),t,o,r);if(!Ei(t,o))return!1;for(const c of u)if(!function(t,i){for(let e=0;e<i.length;e++)if(Li(t,i[e]))return 1}(c,d))return!1}return!0}}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}},e={exports:{}};function ji(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!Bi[t])throw new Error("Unknown unit "+t+". Use one of: "+Object.keys(Bi).join(", "));var t=6378.137*Ni*(t?Bi[t]:1),e=Math.cos(e*Ni),i=1/(1-Fi*(1-e*e)),r=Math.sqrt(i);this.kx=t*r*e,this.ky=t*r*i*(1-Fi)}function Vi(e,t){return e[0]===t[0]&&e[1]===t[1]}function Gi(e,t,i){var r=qi(t[0]-e[0]);return[e[0]+r*i,e[1]+(t[1]-e[1])*i]}function qi(e){for(;e<-180;)e+=360;for(;180<e;)e-=360;return e}e.exports=(Bi={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Fi=(Hi=1/298.257223563)*(2-Hi),Ni=Math.PI/180,Hi={units:{configurable:!0}},ji.fromTile=function(e,t,i){e=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),t=Math.atan(.5*(Math.exp(e)-Math.exp(-e)))/Ni;return new ji(t,i)},Hi.units.get=function(){return Bi},ji.prototype.distance=function(e,t){var i=qi(e[0]-t[0])*this.kx,e=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+e*e)},ji.prototype.bearing=function(e,t){var i=qi(t[0]-e[0])*this.kx;return Math.atan2(i,(t[1]-e[1])*this.ky)/Ni},ji.prototype.destination=function(e,t,i){i*=Ni;return this.offset(e,Math.sin(i)*t,Math.cos(i)*t)},ji.prototype.offset=function(e,t,i){return[e[0]+t/this.kx,e[1]+i/this.ky]},ji.prototype.lineDistance=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t},ji.prototype.area=function(e){for(var t=0,i=0;i<e.length;i++)for(var r=e[i],n=0,o=r.length,a=o-1;n<o;a=n++)t+=qi(r[n][0]-r[a][0])*(r[n][1]+r[a][1])*(i?-1:1);return Math.abs(t)/2*this.kx*this.ky},ji.prototype.along=function(e,t){var i=0;if(t<=0)return e[0];for(var r=0;r<e.length-1;r++){var n=e[r],o=e[r+1],a=this.distance(n,o);if((i+=a)>t)return Gi(n,o,(t-(i-a))/a)}return e[e.length-1]},ji.prototype.pointToSegmentDistance=function(e,t,i){var r,n=t[0],t=t[1],o=qi(i[0]-n)*this.kx,a=(i[1]-t)*this.ky;return 0==o&&0==a||(1<(r=(qi(e[0]-n)*this.kx*o+(e[1]-t)*this.ky*a)/(o*o+a*a))?(n=i[0],t=i[1]):0<r&&(n+=o/this.kx*r,t+=a/this.ky*r)),o=qi(e[0]-n)*this.kx,a=(e[1]-t)*this.ky,Math.sqrt(o*o+a*a)},ji.prototype.pointOnLine=function(e,t){for(var i,r,n,o,a=1/0,s=0;s<e.length-1;s++){var l=e[s][0],c=e[s][1],h=qi(e[s+1][0]-l)*this.kx,u=(e[s+1][1]-c)*this.ky,d=0,h=(0==h&&0==u||(1<(d=(qi(t[0]-l)*this.kx*h+(t[1]-c)*this.ky*u)/(h*h+u*u))?(l=e[s+1][0],c=e[s+1][1]):0<d&&(l+=h/this.kx*d,c+=u/this.ky*d)),(h=qi(t[0]-l)*this.kx)*h+(u=(t[1]-c)*this.ky)*u);h<a&&(a=h,i=l,r=c,n=s,o=d)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}},ji.prototype.lineSlice=function(e,t,i){var e=this.pointOnLine(i,e),t=this.pointOnLine(i,t),r=((e.index>t.index||e.index===t.index&&e.t>t.t)&&(n=e,e=t,t=n),[e.point]),n=e.index+1,o=t.index;!Vi(i[n],r[0])&&n<=o&&r.push(i[n]);for(var a=n+1;a<=o;a++)r.push(i[a]);return Vi(i[o],t.point)||r.push(t.point),r},ji.prototype.lineSliceAlong=function(e,t,i){for(var r=0,n=[],o=0;o<i.length-1;o++){var a=i[o],s=i[o+1],l=this.distance(a,s);if((r+=l)>e&&0===n.length&&n.push(Gi(a,s,(e-(r-l))/l)),t<=r)return n.push(Gi(a,s,(t-(r-l))/l)),n;e<r&&n.push(s)}return n},ji.prototype.bufferPoint=function(e,t){var i=t/this.ky,t=t/this.kx;return[e[0]-t,e[1]-i,e[0]+t,e[1]+i]},ji.prototype.bufferBBox=function(e,t){var i=t/this.ky,t=t/this.kx;return[e[0]-t,e[1]-i,e[2]+t,e[3]+i]},ji.prototype.insideBBox=function(e,t){return 0<=qi(e[0]-t[0])&&qi(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(ji,Hi),ji);var Wi=G(e.exports),Hi={exports:{}};function Zi(e,t){if(void 0===t&&(t=$i),this.data=e=void 0===e?[]:e,this.length=this.data.length,this.compare=t,0<this.length)for(var i=(this.length>>1)-1;0<=i;i--)this._down(i)}function $i(e,t){return e<t?-1:t<e?1:0}Hi.exports=(Zi.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Zi.prototype.pop=function(){var e,t;if(0!==this.length)return e=this.data[0],t=this.data.pop(),this.length--,0<this.length&&(this.data[0]=t,this._down(0)),e},Zi.prototype.peek=function(){return this.data[0]},Zi.prototype._up=function(e){for(var t=this.data,i=this.compare,r=t[e];0<e;){var n=e-1>>1,o=t[n];if(0<=i(r,o))break;t[e]=o,e=n}t[e]=r},Zi.prototype._down=function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),a=t[o],s=o+1;if(s<this.length&&i(t[s],a)<0&&(a=t[o=s]),0<=i(a,n))break;t[e]=a,e=o}t[e]=n},Zi);var Xi=G(Hi.exports),ue=8192;function Yi(e,t){return t.dist-e.dist}const Ki=100,Ji=50;function Qi(t){var i=[1/0,1/0,-1/0,-1/0];if(i.length===t.length){for(let e=0;e<i.length;e++)if(i[e]!==t[e])return;return 1}}function er(e){return e[1]-e[0]+1}function tr(e,t){e=e[1]>=e[0]&&e[1]<t;return e||console.warn("Distance Expression: Index is out of range"),e}function ir(e,t){if(e[0]>e[1])return[null,null];var i=er(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===i)return[e,null];const t=Math.floor(i/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function rr(t,i){var r=[1/0,1/0,-1/0,-1/0];if(tr(i,t.length))for(let e=i[0];e<=i[1];++e)Ai(r,t[e]);return r}function nr(i){var r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;++t)for(let e=0;e<i[t].length;++e)Ai(r,i[t][e]);return r}function or(e,t,i){if(Qi(e)||Qi(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function ar(e,t){var i=Math.pow(2,t.z),r=(e.y/ue+t.y)/i;return[(e.x/ue+t.x)/i*360-180,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90]}function sr(e,t,i){t=i.pointOnLine(t,e).point;return i.distance(e,t)}function lr(t,i,e,r,n){var o=e.slice(r[0],r[1]+1);let a=1/0;for(let e=i[0];e<=i[1];++e)if(0===(a=Math.min(a,sr(t[e],o,n))))return 0;return a}function cr(e,t,i,r,n){var o=Math.min(n.pointToSegmentDistance(e,i,r),n.pointToSegmentDistance(t,i,r)),i=Math.min(n.pointToSegmentDistance(i,e,t),n.pointToSegmentDistance(r,e,t));return Math.min(o,i)}function hr(e,t){for(const i of e)for(let e=0;e<=i.length-1;++e)if(Ci(i[e],t,!0))return 1}function ur(e,t,i,r,n,o,a){null!==o&&null!==a&&(r=or(rr(r,o),rr(n,a),i))<t&&e.push({dist:r,range1:o,range2:a})}function dr(t,e,i,r,n=1/0){let o=Math.min(r.distance(t[0],i[0][0]),n);if(0!==o)for(var a=new Xi([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Yi),s=e?Ji:Ki,l=nr(i);a.length;){const n=a.pop();if(!(n.dist>=o)){var c=n.range1;if(er(c)<=s){if(!tr(c,t.length))return NaN;if(e){const e=function(n,o,t,a){if(!tr(o,n.length))return NaN;for(let e=o[0];e<=o[1];++e)if(Ci(n[e],t,!0))return 0;let s=1/0;for(let r=o[0];r<o[1];++r)for(const o of t)for(let e=0,t=o.length,i=t-1;e<t;i=e++){if(Ii(n[r],n[r+1],o[i],o[e]))return 0;s=Math.min(s,cr(n[r],n[r+1],o[i],o[e],a))}return s}(t,c,i,r);if(0===(o=Math.min(o,e)))return o}else for(let e=c[0];e<=c[1];++e){const n=function(e,t,i){if(Ci(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[t-1]&&0===(r=Math.min(r,i.pointToSegmentDistance(e,n[t-1],n[0]))))return r;if(0===(r=Math.min(r,sr(e,n,i))))return r}return r}(t[e],i,r);if(0===(o=Math.min(o,n)))return o}}else{const i=ir(c,e);if(null!==i[0]){const e=or(rr(t,i[0]),l,r);e<o&&a.push({dist:e,range1:i[0],range2:[0,0]})}if(null!==i[1]){const e=or(rr(t,i[1]),l,r);e<o&&a.push({dist:e,range1:i[1],range2:[0,0]})}}}}return o}function pr(e,t,i,r,n,o=1/0){let a=Math.min(o,n.distance(e[0],i[0]));if(0!==a){const c=new Xi([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],Yi),h=t?Ji:Ki,u=r?Ji:Ki;for(;c.length;){const o=c.pop();if(!(o.dist>=a)){var s=o.range1,l=o.range2;if(er(s)<=h&&er(l)<=u){if(!tr(s,e.length)||!tr(l,i.length))return NaN;if(t&&r?a=Math.min(a,function(i,e,r,n,o){if(!tr(e,i.length)||!tr(n,r.length))return NaN;let a=1/0;for(let t=e[0];t<e[1];++t)for(let e=n[0];e<n[1];++e){if(Ii(i[t],i[t+1],r[e],r[e+1]))return 0;a=Math.min(a,cr(i[t],i[t+1],r[e],r[e+1],o))}return a}(e,s,i,l,n)):t||r?t&&!r?a=Math.min(a,lr(i,l,e,s,n)):!t&&r&&(a=Math.min(a,lr(e,s,i,l,n))):a=Math.min(a,function(i,e,r,n,o){if(!tr(e,i.length)||!tr(n,r.length))return NaN;let a=1/0;for(let t=e[0];t<=e[1];++t)for(let e=n[0];e<=n[1];++e)if(0===(a=Math.min(a,o.distance(i[t],r[e]))))return a;return a}(e,s,i,l,n)),0===a)return a}else{const o=ir(s,t),h=ir(l,r);ur(c,a,n,e,i,o[0],h[0]),ur(c,a,n,e,i,o[0],h[1]),ur(c,a,n,e,i,o[1],h[0]),ur(c,a,n,e,i,o[1],h[1])}}}}return a}function fr(e,t,i,r,n=1/0){let o=n;var a=rr(e,[0,e.length-1]);for(const n of i)if(!(o!==1/0&&or(a,rr(n,[0,n.length-1]),r)>=o)&&(o=Math.min(o,pr(e,t,n,!0,r,o)),0===o))return o;return o}function mr(e,t,i,r,n=1/0){let o=n;var a=rr(e,[0,e.length-1]);for(const n of i)if(!(o!==1/0&&or(a,nr(n),r)>=o)){const i=dr(e,t,n,r,o);if(isNaN(i))return i;if(0===(o=Math.min(o,i)))return o}return o}function gr(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}var _r=class A_{constructor(e,t){this.type=h,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ni(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(gr(t.features[e].geometry.type))return new A_(t,t.features[e].geometry)}else if("Feature"===t.type){if(gr(t.geometry.type))return new A_(t,t.geometry)}else if(gr(t.type))return new A_(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){var t=e.geometry(),i=e.canonicalID();if(null!=t&&null!=i){if("Point"===e.geometryType()){var r=t,n=i,o=this.geometries,a=[];for(const o of r)for(const r of o)a.push(ar(r,n));return r=new Wi(a[0][1],"meters"),"Point"===o.type||"MultiPoint"===o.type||"LineString"===o.type?pr(a,!1,"Point"===o.type?[o.coordinates]:o.coordinates,"LineString"===o.type,r):"MultiLineString"===o.type?fr(a,!1,o.coordinates,r):"Polygon"===o.type||"MultiPolygon"===o.type?mr(a,!1,"Polygon"===o.type?[o.coordinates]:o.coordinates,r):null}if("LineString"===e.geometryType()){var s=t,l=i,c=this.geometries;const w=[];for(const c of s){const s=[];for(const w of c)s.push(ar(w,l));w.push(s)}var h=new Wi(w[0][0][1],"meters");if("Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type)return fr("Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,w,h);if("MultiLineString"===c.type){let t=1/0;for(let e=0;e<c.coordinates.length;e++){var u=fr(c.coordinates[e],!0,w,h,t);if(isNaN(u))return u;if(0===(t=Math.min(t,u)))return t}return t}if("Polygon"!==c.type&&"MultiPolygon"!==c.type)return null;{let t=1/0;for(let e=0;e<w.length;e++){var d=mr(w[e],!0,"Polygon"===c.type?[c.coordinates]:c.coordinates,h,t);if(isNaN(d))return d;if(0===(t=Math.min(t,d)))return t}return t}}if("Polygon"===e.geometryType()){var p=t,f=i,m=this.geometries,g=[];for(const m of function(t){const i=t.length;if(i<=1)return[t];var r=[];let n,o;for(let e=0;e<i;e++){const i=function(o){let a=0;for(let e,t,i=0,r=o.length,n=r-1;i<r;n=i++)e=o[i],t=o[n],a+=(t.x-e.x)*(e.y+t.y);return a}(t[e]);0!==i&&(t[e].area=Math.abs(i),(o=void 0===o?i<0:o)===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}return n&&r.push(n),r}(p)){const p=[];for(let e=0;e<m.length;++e)p.push(function(t,i){var r=[];for(let e=0;e<t.length;++e)r.push(ar(t[e],i));return r}(m[e],f));g.push(p)}var _=new Wi(g[0][0][0][1],"meters");if("Point"===m.type||"MultiPoint"===m.type||"LineString"===m.type)return mr("Point"===m.type?[m.coordinates]:m.coordinates,"LineString"===m.type,g,_);if("MultiLineString"!==m.type){if("Polygon"!==m.type&&"MultiPolygon"!==m.type)return null;{var y="Polygon"===m.type?[m.coordinates]:m.coordinates,v=g,x=_;let e=1/0;for(const T of y)for(const y of v){const v=function(e,t,o,a=1/0){const s=nr(e),i=nr(t);if(a!==1/0&&or(s,i,o)>=a)return a;if(Ei(s,i)){if(hr(e,t))return 0}else if(hr(t,e))return 0;let l=a;for(const a of e)for(let r=0,e=a.length,n=e-1;r<e;n=r++)for(const s of t)for(let e=0,t=s.length,i=t-1;e<t;i=e++){if(Ii(a[n],a[r],s[i],s[e]))return 0;l=Math.min(l,cr(a[n],a[r],s[i],s[e],o))}return l}(T,y,x,e);if(isNaN(v))return v;if(0===(e=Math.min(e,v)))return e}return e}}{let t=1/0;for(let e=0;e<m.coordinates.length;e++){var b=mr(m.coordinates[e],!0,g,_,t);if(isNaN(b))return b;if(0===(t=Math.min(t,b)))return t}return t}}console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}};function yr(e,t){switch(e){case"string":return ai(t);case"number":return+t;case"boolean":return!!t;case"color":return zt.parse(t);case"formatted":return ti.fromString(ai(t));case"resolvedImage":return ii.fromString(ai(t))}return t}function vr(e,t,i,r){return void 0!==r&&(e=r*Math.round(e/r)),void 0!==t&&e<t&&(e=t),e=void 0!==i&&i<e?i:e}var xr=class E_{constructor(e,t,i){this.type=e,this.key=t,this.scope=i}static parse(e,t){let i=t.expectedType;var r;return null==i&&(i=u),e.length<2||3<e.length?t.error("Invalid number of arguments for 'config' expression."):(r=t.parse(e[1],1))instanceof si?3<=e.length?(e=t.parse(e[2],2))instanceof si?new E_(i,ai(r.value),ai(e.value)):t.error("Scope of 'config' expression must be a string literal."):new E_(i,ai(r.value)):t.error("Key name of 'config' expression must be a string literal.")}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join(""),i=e.getConfig(t);if(!i)return null;const{type:r,value:n,values:o,minValue:a,maxValue:s,stepValue:l}=i,c=i.default.evaluate(e);let h=c;if(n){const t=e.scope;e.scope=(t||"").split("").slice(1).join(""),h=n.evaluate(e),e.scope=t}return void 0===(h=r?yr(r,h):h)||void 0===a&&void 0===s&&void 0===l||("number"==typeof h?h=vr(h,a,s,l):Array.isArray(h)&&(h=h.map(e=>"number"==typeof e?vr(e,a,s,l):e))),void 0!==n&&void 0!==h&&o&&!o.includes(h)&&(h=c,r)&&(h=yr(r,h)),h=r&&r!==this.type||void 0!==h&&oi(h)!==this.type?yr(this.type.kind,h):h}eachChild(){}outputDefined(){return!1}serialize(){var e=["config",this.key];return this.scope&&e.concat(this.key),e}};function br(e){if(e instanceof xi){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Ui)return!1;if(e instanceof _r)return!1;let t=!0;return e.eachChild(e=>{t&&!br(e)&&(t=!1)}),t}function wr(e){if(e instanceof xi&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!wr(e)&&(t=!1)}),t}function Tr(e){if(!(e instanceof xr)){let t=!0;return e.eachChild(e=>{t&&!Tr(e)&&(t=!1)}),t}}function Sr(e,t){if(e instanceof xi&&0<=t.indexOf(e.name))return!1;let i=!0;return e.eachChild(e=>{i&&!Sr(e,t)&&(i=!1)}),i}var Ar=class C_{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){return 2!==e.length||"string"!=typeof e[1]?t.error("'var' expression requires exactly one string literal argument."):(e=e[1],t.scope.has(e)?new C_(e,t.scope.get(e)):t.error(`Unknown variable "${e}". Make sure "${e}" has been bound in an enclosing "let" expression before using it.`,1))}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}};var Er=class M_{constructor(e,t=[],i,r=new Ut,n=[],o,a){this.registry=e,this.path=t,this.key=t.map(e=>`[${e}]`).join(""),this.scope=r,this.errors=n,this.expectedType=i,this._scope=o,this.options=a}parse(e,t,i,r,n={}){return(t||i?this.concat(t,i,r):this)._parse(e,n)}_parse(t,i){function r(e,t,i){return"assert"===i?new hi(t,[e]):"coerce"===i?new mi(t,[e]):e}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n="string"==typeof t[0]?this.registry[t[0]]:void 0;if(n){let e=n.parse(t,this);if(!e)return null;if(this.expectedType){const t=this.expectedType,o=e.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==o.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==o.kind&&"string"!==o.kind){if(this.checkSubtype(t,o))return null}else e=r(e,t,i.typeAnnotation||"coerce");else e=r(e,t,i.typeAnnotation||"assert")}if(!(e instanceof si)&&"resolvedImage"!==e.type.kind&&function t(e){if(e instanceof Ar)return t(e.boundExpression);if(e instanceof xi&&"error"===e.name)return!1;if(e instanceof bi)return!1;if(e instanceof Ui)return!1;if(e instanceof _r)return!1;if(e instanceof xr)return!1;const i=e instanceof mi||e instanceof hi;let r=!0;return e.eachChild(e=>{r=i?r&&t(e):r&&e instanceof si}),!!r&&br(e)&&Sr(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}(e)){const t=new _i(this._scope,this.options);try{e=new si(e.type,e.evaluate(t))}catch(t){return this.error(t.message),null}}return e}return mi.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(e,t,i){return e="number"==typeof e?this.path.concat(e):this.path,i=i?this.scope.concat(i):this.scope,new M_(this.registry,e,t||null,i,this.errors,this._scope,this.options)}error(e,...t){t=""+this.key+t.map(e=>`[${e}]`).join(""),this.errors.push(new Nt(t,e))}checkSubtype(e,t){return(e=Yt(e,t))&&this.error(e),e}};function Cr(e,t){var i=e.length-1;let r,n,o=0,a=i,s;for(;o<=a;)if(r=e[s=Math.floor((o+a)/2)],n=e[s+1],r<=t){if(s===i||t<n)return s;o=s+1}else{if(!(t<r))throw new li("Input is not a number.");a=s-1}return 0}var Mr=class I_{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");var e=i.parse(t[1],1,h);if(!e)return null;var r=[];let n=null;i.expectedType&&"value"!==i.expectedType.kind&&(n=i.expectedType);for(let e=1;e<t.length;e+=2){var o=1===e?-1/0:t[e],a=t[e+1],s=e,l=e+1;if("number"!=typeof o)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=o)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);if(!(s=i.parse(a,l,n)))return null;n=n||s.type,r.push([o,s])}return new I_(n,e,r)}evaluate(e){var t,i,r=this.labels,n=this.outputs;return(1===r.length||(t=this.input.evaluate(e))<=r[0]?n[0]:t>=r[(i=r.length)-1]?n[i-1]:n[Cr(r,t)]).evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){var t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)0<e&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}};const Ir=4/29,Pr=6/29,Lr=3*Pr*Pr,Dr=Pr*Pr*Pr,kr=Math.PI/180,zr=180/Math.PI;function Rr(e){return e>Dr?Math.pow(e,1/3):e/Lr+Ir}function Or(e){return e>Pr?e*e*e:Lr*(e-Ir)}function Br(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Fr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Nr(e){var t=Fr(e.r),i=Fr(e.g),r=Fr(e.b),n=Rr((.4124564*t+.3575761*i+.1804375*r)/.95047),o=Rr(.2126729*t+.7151522*i+.072175*r);return{l:116*o-16,a:500*(n-o),b:200*(o-Rr((.0193339*t+.119192*i+.9503041*r)/1.08883)),alpha:e.a}}function Ur(e){var t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200,t=+Or(t),i=.95047*Or(i),r=1.08883*Or(r);return new zt(Br(3.2404542*i-1.5371385*t-.4985314*r),Br(-.969266*i+1.8760108*t+.041556*r),Br(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}const jr={forward:Nr,reverse:Ur,interpolate:function(e,t,i){return{l:A(e.l,t.l,i),a:A(e.a,t.a,i),b:A(e.b,t.b,i),alpha:A(e.alpha,t.alpha,i)}}},Vr={forward:function(e){var{l:t,a:i,b:r}=Nr(e),n=Math.atan2(r,i)*zr;return{h:n<0?360+n:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){var t=e.h*kr,i=e.c;return Ur({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:(r=e.h,n=t.h,r+i*(180<(n-=r)||n<-180?n-360*Math.round(n/360):n)),c:A(e.c,t.c,i),l:A(e.l,t.l,i),alpha:A(e.alpha,t.alpha,i)};var r,n}};var Gr=Object.freeze({__proto__:null,hcl:Vr,lab:jr});class qr{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;return"exponential"===e.name?n=Wr(t,e.base,i,r):"linear"===e.name?n=Wr(t,1,i,r):"cubic-bezier"===e.name&&(e=e.controlPoints,n=new H(e[0],e[1],e[2],e[3]).solve(Wr(t,1,i,r))),n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type "+String(r[0]),1,0);{const e=r.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||1<e))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(n=t.parse(n,2,h)))return null;var a=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=Vt:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,c=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(a.length&&a[a.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);var l=t.parse(r,c,s);if(!l)return null;s=s||l.type,a.push([i,l])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new qr(s,i,r,n,a):t.error(`Type ${$t(s)} is not interpolatable.`)}evaluate(e){var t,i,r=this.labels,n=this.outputs;return 1===r.length||(i=this.input.evaluate(e))<=r[0]?n[0].evaluate(e):i>=r[(t=r.length)-1]?n[t-1].evaluate(e):(t=Cr(r,i),i=qr.interpolationFactor(this.interpolation,i,r[t],r[t+1]),r=n[t].evaluate(e),n=n[t+1].evaluate(e),"interpolate"===this.operator?Ot[this.type.kind.toLowerCase()](r,n,i):"interpolate-hcl"===this.operator?Vr.reverse(Vr.interpolate(Vr.forward(r),Vr.forward(n),i)):jr.reverse(jr.interpolate(jr.forward(r),jr.forward(n),i)))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){var e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints),t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Wr(e,t,i,r){r-=i,e-=i;return 0==r?0:1===t?e/r:(Math.pow(t,e)-1)/(Math.pow(t,r)-1)}var Hr=qr;var Zr=class P_{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);var n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}return e=r&&n.some(e=>Yt(r,e.type)),new P_(e?u:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,(i=n.evaluate(e))&&i instanceof ii&&!i.available&&(t=t||i,i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}};var $r=class L_{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);var r=[];for(let e=1;e<t.length-1;e+=2){var n=t[e];if("string"!=typeof n)return i.error(`Expected string, but found ${typeof n} instead.`,e);if(/[^a-zA-Z0-9_]/.test(n))return i.error("Variable names must contain only alphanumeric characters or '_'.",e);var o=i.parse(t[e+1],e+1);if(!o)return null;r.push([n,o])}var e=i.parse(t[t.length-1],t.length-1,i.expectedType,r);return e?new L_(r,e):null}outputDefined(){return this.result.outputDefined()}serialize(){var e,t,i=["let"];for([e,t]of this.bindings)i.push(e,t.serialize());return i.push(this.result.serialize()),i}};function Xr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Yr(e,t,i,r){return 0===r.compare(t,i)}function Kr(r,n,o){const a="=="!==r&&"!="!==r;return class s{constructor(e,t,i){this.type=c,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var i=e[0];let r=t.parse(e[1],1,u);if(!r)return null;if(!Xr(i,r.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${$t(r.type)}'.`);let n=t.parse(e[2],2,u);if(!n)return null;if(!Xr(i,n.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${$t(n.type)}'.`);if(r.type.kind!==n.type.kind&&"value"!==r.type.kind&&"value"!==n.type.kind)return t.error(`Cannot compare types '${$t(r.type)}' and '${$t(n.type)}'.`);a&&("value"===r.type.kind&&"value"!==n.type.kind?r=new hi(n.type,[r]):"value"!==r.type.kind&&"value"===n.type.kind&&(n=new hi(r.type,[n])));let o=null;if(4===e.length){if("string"!==r.type.kind&&"string"!==n.type.kind&&"value"!==r.type.kind&&"value"!==n.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(o=t.parse(e[3],3,qt)))return null}return new s(r,n,o)}evaluate(e){var t=this.lhs.evaluate(e),i=this.rhs.evaluate(e);if(a&&this.hasUntypedArgument){const n=oi(t),o=oi(i);if(n.kind!==o.kind||"string"!==n.kind&&"number"!==n.kind)throw new li(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${n.kind}, ${o.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const r=oi(t),o=oi(i);if("string"!==r.kind||"string"!==o.kind)return n(e,t,i)}return this.collator?o(e,t,i,this.collator.evaluate(e)):n(e,t,i)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[r];return this.eachChild(e=>{t.push(e.serialize())}),t}}}var e=Kr("==",function(e,t,i){return t===i},Yr),Hi=Kr("!=",function(e,t,i){return t!==i},function(e,t,i,r){return!Yr(0,t,i,r)}),t=Kr("<",function(e,t,i){return t<i},function(e,t,i,r){return r.compare(t,i)<0}),i=Kr(">",function(e,t,i){return i<t},function(e,t,i,r){return 0<r.compare(t,i)}),r=Kr("<=",function(e,t,i){return t<=i},function(e,t,i,r){return r.compare(t,i)<=0});function Jr(t){return function(){t=1831565813+(0|t)|0;var e=Math.imul(t^t>>>15,1|t);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/4294967296}}e={"==":e,"!=":Hi,">":i,"<":t,">=":Kr(">=",function(e,t,i){return i<=t},function(e,t,i,r){return 0<=r.compare(t,i)}),"<=":r,array:hi,at:class D_{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){var i;return 3!==e.length?t.error(`Expected 2 arguments, but found ${e.length-1} instead.`):(i=t.parse(e[1],1,h),e=t.parse(e[2],2,Zt(t.expectedType||u)),i&&e?new D_(e.type.itemType,i,e):null)}evaluate(e){var t=this.index.evaluate(e),e=this.input.evaluate(e);if(t<0)throw new li(`Array index out of bounds: ${t} < 0.`);if(t>=e.length)throw new li(`Array index out of bounds: ${t} > ${e.length-1}.`);if(t!==Math.floor(t))throw new li(`Array index must be an integer, but found ${t} instead.`);return e[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}},boolean:hi,case:class k_{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);var n=[];for(let e=1;e<t.length-1;e+=2){var o=i.parse(t[e],e,c);if(!o)return null;var a=i.parse(t[e+1],e+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var e=i.parse(t[t.length-1],t.length-1,r);return e?new k_(r,n,e):null}evaluate(e){for(var[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(var[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}},coalesce:Zr,collator:bi,format:ui,image:di,in:class z_{constructor(e,t){this.type=c,this.needle=e,this.haystack=t}static parse(e,t){var i;return 3!==e.length?t.error(`Expected 2 arguments, but found ${e.length-1} instead.`):(i=t.parse(e[1],1,u),e=t.parse(e[2],2,u),i&&e?Kt(i.type,[c,l,h,jt,u])?new z_(i,e):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$t(i.type)} instead`):null)}evaluate(e){var t=this.needle.evaluate(e);if(null==(e=this.haystack.evaluate(e)))return!1;if(!Jt(t,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${$t(oi(t))} instead.`);if(Jt(e,["string","array"]))return 0<=e.indexOf(t);throw new li(`Expected second argument to be of type array or string, but found ${$t(oi(e))} instead.`)}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}},"index-of":class R_{constructor(e,t,i){this.type=h,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){var i,r;return e.length<=2||5<=e.length?t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`):(i=t.parse(e[1],1,u),r=t.parse(e[2],2,u),i&&r?Kt(i.type,[c,l,h,jt,u])?4===e.length?(e=t.parse(e[3],3,h))?new R_(i,r,e):null:new R_(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$t(i.type)} instead`):null)}evaluate(e){var t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Jt(t,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${$t(oi(t))} instead.`);if(Jt(i,["string","array"]))return this.fromIndex?(e=this.fromIndex.evaluate(e),i.indexOf(t,e)):i.indexOf(t);throw new li(`Expected second argument to be of type array or string, but found ${$t(oi(i))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){var e;return null!=this.fromIndex&&void 0!==this.fromIndex?(e=this.fromIndex.serialize(),["index-of",this.needle.serialize(),this.haystack.serialize(),e]):["index-of",this.needle.serialize(),this.haystack.serialize()]}},interpolate:Hr,"interpolate-hcl":Hr,"interpolate-lab":Hr,length:class O_{constructor(e){this.type=h,this.input=e}static parse(e,t){return 2!==e.length?t.error(`Expected 1 argument, but found ${e.length-1} instead.`):(e=t.parse(e[1],1))?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?t.error(`Expected argument of type string or array, but found ${$t(e.type)} instead.`):new O_(e):null}evaluate(e){if("string"==typeof(e=this.input.evaluate(e)))return e.length;if(Array.isArray(e))return e.length;throw new li(`Expected value to be of type string or array, but found ${$t(oi(e))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}},let:$r,literal:si,match:class B_{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(i,r){if(i.length<5)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return r.error("Expected an even number of arguments.");let n,o;r.expectedType&&"value"!==r.expectedType.kind&&(o=r.expectedType);var a={},s=[];for(let t=2;t<i.length-1;t+=2){let e=i[t];var l=i[t+1],c=(Array.isArray(e)||(e=[e]),r.concat(t));if(0===e.length)return c.error("Expected at least one branch label.");for(const i of e){if("number"!=typeof i&&"string"!=typeof i)return c.error("Branch labels must be numbers or strings.");if("number"==typeof i&&Math.abs(i)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof i&&Math.floor(i)!==i)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,oi(i)))return null}else n=oi(i);if(void 0!==a[String(i)])return c.error("Branch labels must be unique.");a[String(i)]=s.length}if(!(l=r.parse(l,t,o)))return null;o=o||l.type,s.push(l)}var e,t=r.parse(i[1],1,u);return!t||!(e=r.parse(i[i.length-1],i.length-1,o))||"value"!==t.type.kind&&r.concat(1).checkSubtype(n,t.type)?null:new B_(n,o,t,a,s,e)}evaluate(e){var t=this.input.evaluate(e);return(oi(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}var n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)e.push(1===r.length?n(r[0]):r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}},number:hi,"number-format":class F_{constructor(e,t,i,r,n,o){this.type=l,this.number=e,this.locale=t,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");var i=t.parse(e[1],1,h);if(!i)return null;if("object"!=typeof(e=e[2])||Array.isArray(e))return t.error("NumberFormat options argument must be an object.");let r=null;if(e.locale&&!(r=t.parse(e.locale,1,l)))return null;let n=null;if(e.currency&&!(n=t.parse(e.currency,1,l)))return null;let o=null;if(e.unit&&!(o=t.parse(e.unit,1,l)))return null;let a=null;if(e["min-fraction-digits"]&&!(a=t.parse(e["min-fraction-digits"],1,h)))return null;let s=null;return e["max-fraction-digits"]&&!(s=t.parse(e["max-fraction-digits"],1,h))?null:new F_(i,r,n,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}},object:hi,slice:class N_{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){var i,r;return e.length<=2||5<=e.length?t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`):(i=t.parse(e[1],1,u),r=t.parse(e[2],2,h),i&&r?Kt(i.type,[Zt(u),l,u])?4===e.length?(e=t.parse(e[3],3,h))?new N_(i.type,i,r,e):null:new N_(i.type,i,r):t.error(`Expected first argument to be of type array or string, but found ${$t(i.type)} instead`):null)}evaluate(e){var t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(Jt(t,["string","array"]))return this.endIndex?(e=this.endIndex.evaluate(e),t.slice(i,e)):t.slice(i);throw new li(`Expected first argument to be of type array or string, but found ${$t(oi(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){var e;return null!=this.endIndex&&void 0!==this.endIndex?(e=this.endIndex.serialize(),["slice",this.input.serialize(),this.beginIndex.serialize(),e]):["slice",this.input.serialize(),this.beginIndex.serialize()]}},step:Mr,string:hi,"to-boolean":mi,"to-color":mi,"to-number":mi,"to-string":mi,var:Ar,within:Ui,distance:_r,config:xr};function Qr(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);n=n?n.evaluate(e):1,e=ri(t,i,r,n);if(e)throw new li(e);return new zt(t/255*n,i/255*n,r/255*n,n)}function en(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);var o,n=n?n.evaluate(e):1,a=(e=i,o=r,a=n,"number"==typeof(s=t)&&0<=s&&s<=360?"number"==typeof e&&0<=e&&e<=100&&"number"==typeof o&&0<=o&&o<=100?void 0===a||"number"==typeof a&&0<=a&&a<=1?null:`Invalid hsla value [${[s,e,o,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof a?[s,e,o,a]:[s,e,o]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof a?[s,e,o,a]:[s,e,o]).join(", ")}]: 'h' must be between 0 and 360.`);if(a)throw new li(a);var s=`hsla(${t}, ${i}%, ${r}%, ${n})`,e=zt.parse(s);if(e)return e;throw new li("Failed to parse HSLA color: "+s)}function tn(e,t){t=t[e];return void 0===t?null:t}function rn(e){return{type:e}}xi.register(e,{error:[{kind:"error"},[l],(e,[t])=>{throw new li(t.evaluate(e))}],typeof:[l,[u],(e,[t])=>$t(oi(t.evaluate(e)))],"to-rgba":[Zt(h,4),[Vt],(e,[t])=>t.evaluate(e).toArray()],rgb:[Vt,[h,h,h],Qr],rgba:[Vt,[h,h,h,h],Qr],hsl:[Vt,[h,h,h],en],hsla:[Vt,[h,h,h,h],en],has:{type:c,overloads:[[[l],(e,[t])=>t.evaluate(e)in e.properties()],[[l,Gt],(e,[t,i])=>t.evaluate(e)in i.evaluate(e)]]},get:{type:u,overloads:[[[l],(e,[t])=>tn(t.evaluate(e),e.properties())],[[l,Gt],(e,[t,i])=>tn(t.evaluate(e),i.evaluate(e))]]},"feature-state":[u,[l],(e,[t])=>tn(t.evaluate(e),e.featureState||{})],properties:[Gt,[],e=>e.properties()],"geometry-type":[l,[],e=>e.geometryType()],id:[u,[],e=>e.id()],zoom:[h,[],e=>e.globals.zoom],pitch:[h,[],e=>e.globals.pitch||0],"distance-from-center":[h,[],e=>e.distanceFromCenter()],"measure-light":[h,[l],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[h,[],e=>e.globals.heatmapDensity||0],"line-progress":[h,[],e=>e.globals.lineProgress||0],"raster-value":[h,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[h,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[h,[],e=>e.globals.skyRadialProgress||0],accumulated:[u,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[h,rn(h),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[h,rn(h),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:h,overloads:[[[h,h],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[h],(e,[t])=>-t.evaluate(e)]]},"/":[h,[h,h],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[h,[h,h],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[h,[],()=>Math.LN2],pi:[h,[],()=>Math.PI],e:[h,[],()=>Math.E],"^":[h,[h,h],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[h,[h],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[h,[h],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[h,[h],(e,[t])=>Math.log(t.evaluate(e))],log2:[h,[h],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[h,[h],(e,[t])=>Math.sin(t.evaluate(e))],cos:[h,[h],(e,[t])=>Math.cos(t.evaluate(e))],tan:[h,[h],(e,[t])=>Math.tan(t.evaluate(e))],asin:[h,[h],(e,[t])=>Math.asin(t.evaluate(e))],acos:[h,[h],(e,[t])=>Math.acos(t.evaluate(e))],atan:[h,[h],(e,[t])=>Math.atan(t.evaluate(e))],min:[h,rn(h),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[h,rn(h),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[h,[h],(e,[t])=>Math.abs(t.evaluate(e))],round:[h,[h],(e,[t])=>{t=t.evaluate(e);return t<0?-Math.round(-t):Math.round(t)}],floor:[h,[h],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[h,[h],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[c,[l,u],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[c,[u],(e,[t])=>e.id()===t.value],"filter-type-==":[c,[l],(e,[t])=>e.geometryType()===t.value],"filter-<":[c,[l,u],(e,[t,i])=>{e=e.properties()[t.value],t=i.value;return typeof e==typeof t&&e<t}],"filter-id-<":[c,[u],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<t}],"filter->":[c,[l,u],(e,[t,i])=>{e=e.properties()[t.value],t=i.value;return typeof e==typeof t&&t<e}],"filter-id->":[c,[u],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<e}],"filter-<=":[c,[l,u],(e,[t,i])=>{e=e.properties()[t.value],t=i.value;return typeof e==typeof t&&e<=t}],"filter-id-<=":[c,[u],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<=t}],"filter->=":[c,[l,u],(e,[t,i])=>{e=e.properties()[t.value],t=i.value;return typeof e==typeof t&&t<=e}],"filter-id->=":[c,[u],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<=e}],"filter-has":[c,[u],(e,[t])=>t.value in e.properties()],"filter-has-id":[c,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[c,[Zt(l)],(e,[t])=>0<=t.value.indexOf(e.geometryType())],"filter-id-in":[c,[Zt(u)],(e,[t])=>0<=t.value.indexOf(e.id())],"filter-in-small":[c,[l,Zt(u)],(e,[t,i])=>0<=i.value.indexOf(e.properties()[t.value])],"filter-in-large":[c,[l,Zt(u)],(e,[t,i])=>{for(var r=e.properties()[t.value],n=i.value,o=0,a=i.value.length-1;o<=a;){var s=o+a>>1;if(n[s]===r)return!0;n[s]>r?a=s-1:o=1+s}return!1}],all:{type:c,overloads:[[[c,c],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[rn(c),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:c,overloads:[[[c,c],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[rn(c),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[c,[c],(e,[t])=>!t.evaluate(e)],"is-supported-script":[c,[l],(e,[t])=>{var i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[l,[l],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[l,[l],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[l,rn(u),(t,e)=>e.map(e=>ai(e.evaluate(t))).join("")],"resolved-locale":[l,[qt],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[h,[h,h,u],(t,e)=>{var[e,i,r]=e.map(e=>e.evaluate(t));if(i<e)return e;if(e===i)return e;let n;if("string"==typeof r)n=function(t){let i=0;if(0!==t.length)for(let e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i}(r);else{if("number"!=typeof r)throw new li("Invalid seed input: "+r);n=r}return e+Jr(n)()*(i-e)}]});var nn=e;function on(e){return{result:"success",value:e}}function an(e){return{result:"error",value:e}}function sn(e,t){return!!e&&!!e.parameters&&-1<e.parameters.indexOf(t)}function ln(e){return"data-driven"===e["property-type"]}function cn(e){return sn(e.expression,"measure-light")}function hn(e){return sn(e.expression,"zoom")}function un(e){return!!e.expression&&e.expression.interpolated}function dn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function pn(e){return e}function fn(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function mn(e,t,i,r,n){return fn(typeof i===n?r[i]:void 0,e.default,t.default)}function gn(e,t,i){return"number"!==pi(i)?fn(e.default,t.default):(1===(t=e.stops.length)||i<=e.stops[0][0]?e.stops[0]:i>=e.stops[t-1][0]?e.stops[t-1]:(t=Cr(e.stops.map(e=>e[0]),i),e.stops[t]))[1]}function _n(e,i,t){var r=void 0!==e.base?e.base:1;if("number"!==pi(t))return fn(e.default,i.default);var n,o=e.stops.length;if(1===o)return e.stops[0][1];if(t<=e.stops[0][0])return e.stops[0][1];if(t>=e.stops[o-1][0])return e.stops[o-1][1];const a=Cr(e.stops.map(e=>e[0]),t),s=(o=t,t=r,r=e.stops[a][0],n=e.stops[a+1][0]-r,o-=r,0==n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)),l=e.stops[a][1],c=e.stops[a+1][1];let h=Ot[i.type]||pn;if(e.colorSpace&&"rgb"!==e.colorSpace){const i=Gr[e.colorSpace];h=(e,t)=>i.reverse(i.interpolate(i.forward(e),i.forward(t),s))}return"function"==typeof l.evaluate?{evaluate(...e){var t=l.evaluate.apply(void 0,e),e=c.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==e)return h(t,e,s)}}:h(l,c,s)}function yn(e,t,i){return"color"===t.type?i=zt.parse(i):"formatted"===t.type?i=ti.fromString(i.toString()):"resolvedImage"===t.type?i=ii.fromString(i.toString()):pi(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),fn(i,e.default,t.default)}class vn{constructor(e,t,i,r){this.expression=e,this._warningHistory={},this._evaluator=new _i(i,r),this._defaultValue=t?"color"===(e=t).type&&(dn(e.default)||Array.isArray(e.default))?new zt(0,0,0,0):"color"===e.type?zt.parse(e.default)||null:void 0===e.default?null:e.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(!this._enumValues||e in this._enumValues)return e;throw new li(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`)}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function xn(e){return Array.isArray(e)&&0<e.length&&"string"==typeof e[0]&&e[0]in nn}function bn(e,t,i,r){var n=new Er(nn,[],t?(o=t,n={color:Vt,string:l,number:h,enum:l,boolean:c,formatted:Wt,resolvedImage:Ht},"array"===o.type?Zt(n[o.value]||u,o.length):n[o.type]):void 0,void 0,void 0,i,r),o=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?on(new vn(o,t,i,r)):an(n.errors)}class wn{constructor(e,t,i){this.kind=e,this._styleExpression=t,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!wr(t.expression),this.isConfigDependent=!Tr(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class Tn{constructor(e,t,i,r,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!wr(t.expression),this.isLightConstant=n,this.isConfigDependent=!Tr(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?Hr.interpolationFactor(this.interpolationType,e,t,i):0}}function Sn(e,t,i,r){var n,o,a;return"error"===(e=bn(e,t,i,r)).result?e:(r=br(i=e.value.expression))||ln(t)?(n=Sr(i,["zoom","pitch","distance-from-center"]))||hn(t)?(o=Sr(i,["measure-light"]))||cn(t)?(a=t.expression&&t.expression.relaxZoomRestriction,(i=function i(e){let r=null;if(e instanceof $r)r=i(e.result);else if(e instanceof Zr){for(const t of e.args)if(r=i(t),r)break}else(e instanceof Mr||e instanceof Hr)&&e.input instanceof xi&&"zoom"===e.input.name&&(r=e);return r instanceof Nt||e.eachChild(e=>{const t=i(e);t instanceof Nt?r=t:r&&t&&r!==t&&(r=new Nt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}(i))||n||a?i instanceof Nt?an([i]):i instanceof Hr&&!un(t)?an([new Nt("",'"interpolate" expressions cannot be used with this property')]):on(i?new Tn(r?"camera":"composite",e.value,i.labels,i instanceof Hr?i.interpolation:void 0,o):new wn(r?"constant":"source",e.value,o)):an([new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])):an([new Nt("","measure-light expression not supported")]):an([new Nt("","zoom expressions not supported")]):an([new Nt("","data expressions not supported")])}class An{constructor(e,t){this._parameters=e,this._specification=t,Bt(this,function e(i,r){const t="color"===r.type,n=i.stops&&"object"==typeof i.stops[0][0],o=n||!(n||void 0!==i.property),a=i.type||(un(r)?"exponential":"interval");if(t&&((i=Bt({},i)).stops&&(i.stops=i.stops.map(e=>[e[0],zt.parse(e[1])])),i.default=zt.parse(i.default||r.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!Gr[i.colorSpace])throw new Error("Unknown color space: "+i.colorSpace);let s,l,c;if("exponential"===a)s=_n;else if("interval"===a)s=gn;else if("categorical"===a){s=mn,l=Object.create(null);for(const r of i.stops)l[r[0]]=r[1];c=typeof i.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);s=yn}if(n){const t={},n=[];for(let e=0;e<i.stops.length;e++){const o=i.stops[e],a=o[0].zoom;void 0===t[a]&&(t[a]={zoom:a,type:i.type,property:i.property,default:i.default,stops:[]},n.push(a)),t[a].stops.push([o[0].value,o[1]])}const o=[];for(const i of n)o.push([t[i].zoom,e(t[i],r)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:Hr.interpolationFactor.bind(void 0,a),zoomStops:o.map(e=>e[0]),evaluate:({zoom:e},t)=>_n({stops:o,base:i.base},r,e).evaluate(e,t)}}if(o){const t="exponential"===a?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:Hr.interpolationFactor.bind(void 0,t),zoomStops:i.stops.map(e=>e[0]),evaluate:({zoom:e})=>s(i,r,e,l,c)}}return{kind:"source",evaluate(e,t){return void 0===(t=t&&t.properties?t.properties[i.property]:void 0)?fn(i.default,r.default):s(i,r,t,l,c)}}}(this._parameters,this._specification))}static deserialize(e){return new An(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}var Hi=Cn,En=3;function Cn(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(var o=0;o<this.d*this.d;o++){var a=n[En+o],s=n[En+o+1];r.push(a===s?null:n.subarray(a,s))}var l=n[En+r.length+1];this.keys=n.subarray(n[En+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;l=i/t*e;this.min=-l,this.max=e+l}Cn.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},Cn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Cn.prototype._insertCell=function(e,t,i,r,n,o){this.cells[n].push(o)},Cn.prototype.query=function(e,t,i,r,n){var o=this.min,a=this.max;return e<=o&&t<=o&&a<=i&&a<=r&&!n?Array.prototype.slice.call(this.keys):(this._forEachCell(e,t,i,r,this._queryCell,o=[],{},n),o)},Cn.prototype._queryCell=function(e,t,i,r,n,o,a,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,h=this.bboxes,u=0;u<l.length;u++){var d,p=l[u];void 0===a[p]&&(d=4*p,(s?s(h[0+d],h[1+d],h[2+d],h[3+d]):e<=h[2+d]&&t<=h[3+d]&&i>=h[0+d]&&r>=h[1+d])?(a[p]=!0,o.push(c[p])):a[p]=!1)}},Cn.prototype._forEachCell=function(e,t,i,r,n,o,a,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),h=this._convertToCellCoord(i),u=this._convertToCellCoord(r),d=l;d<=h;d++)for(var p=c;p<=u;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,i,r,f,o,a,s))return}},Cn.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Cn.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Cn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=En+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(t+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];n[En+a]=o,n.set(s,o),o+=s.length}return n[En+e.length]=o,n.set(this.keys,o),n[En+e.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var Mn=G(Hi);const In={};function n(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),In[t]={klass:e,omit:i.omit||[]}}n(Object,"Object"),Mn.serialize=function(e,t){e=e.toArrayBuffer();return t&&t.add(e),{buffer:e}},Mn.deserialize=function(e){return new Mn(e.buffer)},Object.defineProperty(Mn,"name",{value:"Grid"}),n(Mn,"Grid"),n(zt,"Color"),n(Error,"Error"),n(ti,"Formatted"),n(ei,"FormattedSection"),n(Qe,"AJAXError"),n(ii,"ResolvedImage"),n(An,"StylePropertyFunction"),n(vn,"StyleExpression",{omit:["_evaluator"]}),n(Tn,"ZoomDependentExpression"),n(wn,"ZoomConstantExpression"),n(xi,"CompoundExpression",{omit:["_evaluate"]});for(const Te in nn)In[nn[Te]._classRegistryKey]||n(nn[Te],"Expression"+Te);function Pn(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ln(e){return self.ImageBitmap&&e instanceof ImageBitmap}function Dn(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Pn(e)||Ln(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e))return o=e,t&&t.add(o.buffer),o;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){var i=[];for(const l of e)i.push(Dn(l,t));return i}if(e instanceof Map){const t={$name:"Map"};for(var[r,n]of e.entries())t[r]=Dn(n);return t}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);var o=e.constructor,a=o._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class "+a);var s=o.serialize?o.serialize(e,t):{};if(!o.serialize){for(const c in e)!e.hasOwnProperty(c)||0<=In[a].omit.indexOf(c)||(s[c]=Dn(e[c],t));e instanceof Error&&(s.message=e.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(s.$name=a),s}function kn(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Pn(e)||Ln(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(kn);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);var t=e.$name||"Object";if("Map"===t){var i=new Map;for(const o of Object.keys(e))"$name"!==o&&i.set(o,kn(e[o]));return i}var r=In[t]["klass"];if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);var n=Object.create(r.prototype);for(const a of Object.keys(e))"$name"!==a&&(n[a]=kn(e[a]));return n}const j={"Latin-1 Supplement":e=>128<=e&&e<=255,Arabic:e=>1536<=e&&e<=1791,"Arabic Supplement":e=>1872<=e&&e<=1919,"Arabic Extended-A":e=>2208<=e&&e<=2303,"Hangul Jamo":e=>4352<=e&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>5120<=e&&e<=5759,Khmer:e=>6016<=e&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>6320<=e&&e<=6399,"General Punctuation":e=>8192<=e&&e<=8303,"Letterlike Symbols":e=>8448<=e&&e<=8527,"Number Forms":e=>8528<=e&&e<=8591,"Miscellaneous Technical":e=>8960<=e&&e<=9215,"Control Pictures":e=>9216<=e&&e<=9279,"Optical Character Recognition":e=>9280<=e&&e<=9311,"Enclosed Alphanumerics":e=>9312<=e&&e<=9471,"Geometric Shapes":e=>9632<=e&&e<=9727,"Miscellaneous Symbols":e=>9728<=e&&e<=9983,"Miscellaneous Symbols and Arrows":e=>11008<=e&&e<=11263,"CJK Radicals Supplement":e=>11904<=e&&e<=12031,"Kangxi Radicals":e=>12032<=e&&e<=12255,"Ideographic Description Characters":e=>12272<=e&&e<=12287,"CJK Symbols and Punctuation":e=>12288<=e&&e<=12351,Hiragana:e=>12352<=e&&e<=12447,Katakana:e=>12448<=e&&e<=12543,Bopomofo:e=>12544<=e&&e<=12591,"Hangul Compatibility Jamo":e=>12592<=e&&e<=12687,Kanbun:e=>12688<=e&&e<=12703,"Bopomofo Extended":e=>12704<=e&&e<=12735,"CJK Strokes":e=>12736<=e&&e<=12783,"Katakana Phonetic Extensions":e=>12784<=e&&e<=12799,"Enclosed CJK Letters and Months":e=>12800<=e&&e<=13055,"CJK Compatibility":e=>13056<=e&&e<=13311,"CJK Unified Ideographs Extension A":e=>13312<=e&&e<=19903,"Yijing Hexagram Symbols":e=>19904<=e&&e<=19967,"CJK Unified Ideographs":e=>19968<=e&&e<=40959,"Yi Syllables":e=>40960<=e&&e<=42127,"Yi Radicals":e=>42128<=e&&e<=42191,"Hangul Jamo Extended-A":e=>43360<=e&&e<=43391,"Hangul Syllables":e=>44032<=e&&e<=55215,"Hangul Jamo Extended-B":e=>55216<=e&&e<=55295,"Private Use Area":e=>57344<=e&&e<=63743,"CJK Compatibility Ideographs":e=>63744<=e&&e<=64255,"Arabic Presentation Forms-A":e=>64336<=e&&e<=65023,"Vertical Forms":e=>65040<=e&&e<=65055,"CJK Compatibility Forms":e=>65072<=e&&e<=65103,"Small Form Variants":e=>65104<=e&&e<=65135,"Arabic Presentation Forms-B":e=>65136<=e&&e<=65279,"Halfwidth and Fullwidth Forms":e=>65280<=e&&e<=65519,"CJK Unified Ideographs Extension B":e=>131072<=e&&e<=173791};function zn(e){for(const t of e)if(On(t.charCodeAt(0)))return!0;return!1}function Rn(e){for(const i of e)if(t=i.charCodeAt(0),j.Arabic(t)||j["Arabic Supplement"](t)||j["Arabic Extended-A"](t)||j["Arabic Presentation Forms-A"](t)||j["Arabic Presentation Forms-B"](t))return;var t;return 1}function On(e){return 746===e||747===e||!(e<4352)&&(j["Bopomofo Extended"](e)||j.Bopomofo(e)||j["CJK Compatibility Forms"](e)&&!(65097<=e&&e<=65103)||j["CJK Compatibility Ideographs"](e)||j["CJK Compatibility"](e)||j["CJK Radicals Supplement"](e)||j["CJK Strokes"](e)||!(!j["CJK Symbols and Punctuation"](e)||12296<=e&&e<=12305||12308<=e&&e<=12319||12336===e)||j["CJK Unified Ideographs Extension A"](e)||j["CJK Unified Ideographs"](e)||j["Enclosed CJK Letters and Months"](e)||j["Hangul Compatibility Jamo"](e)||j["Hangul Jamo Extended-A"](e)||j["Hangul Jamo Extended-B"](e)||j["Hangul Jamo"](e)||j["Hangul Syllables"](e)||j.Hiragana(e)||j["Ideographic Description Characters"](e)||j.Kanbun(e)||j["Kangxi Radicals"](e)||j["Katakana Phonetic Extensions"](e)||j.Katakana(e)&&12540!==e||!(!j["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||65306<=e&&e<=65310||65339===e||65341===e||65343===e||65371<=e&&e<=65503||65507===e||65512<=e&&e<=65519)||!(!j["Small Form Variants"](e)||65112<=e&&e<=65118||65123<=e&&e<=65126)||j["Unified Canadian Aboriginal Syllabics"](e)||j["Unified Canadian Aboriginal Syllabics Extended"](e)||j["Vertical Forms"](e)||j["Yijing Hexagram Symbols"](e)||j["Yi Syllables"](e)||j["Yi Radicals"](e))}function Bn(e){return!(On(e)||(e=e,j["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e))||j["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||j["Letterlike Symbols"](e)||j["Number Forms"](e)||j["Miscellaneous Technical"](e)&&(8960<=e&&e<=8967||8972<=e&&e<=8991||8996<=e&&e<=9e3||9003===e||9085<=e&&e<=9114||9150<=e&&e<=9165||9167===e||9169<=e&&e<=9179||9186<=e&&e<=9215)||j["Control Pictures"](e)&&9251!==e||j["Optical Character Recognition"](e)||j["Enclosed Alphanumerics"](e)||j["Geometric Shapes"](e)||j["Miscellaneous Symbols"](e)&&!(9754<=e&&e<=9759)||j["Miscellaneous Symbols and Arrows"](e)&&(11026<=e&&e<=11055||11088<=e&&e<=11097||11192<=e&&e<=11243)||j["CJK Symbols and Punctuation"](e)||j.Katakana(e)||j["Private Use Area"](e)||j["CJK Compatibility Forms"](e)||j["Small Form Variants"](e)||j["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||9984<=e&&e<=10087||10102<=e&&e<=10131||65532===e||65533===e)}function Fn(e){return 1424<=e&&e<=2303||j["Arabic Presentation Forms-A"](e)||j["Arabic Presentation Forms-B"](e)}const Nn="deferred",Un="loading",jn="loaded";let Vn=null,Gn="unavailable",qn=null;function Wn(e){e&&"string"==typeof e&&-1<e.indexOf("NetworkError")&&(Gn="error"),Vn&&Vn(e)}function Hn(){Xn.fire(new At("pluginStateChange",{pluginStatus:Gn,pluginURL:qn}))}function Zn(){return Gn}function $n(){if(Gn!==Nn||!qn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gn=Un,Hn(),qn&&tt({url:qn},e=>{e?Wn(e):(Gn=jn,Hn())})}const Xn=new Ct,Yn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gn===jn||null!=Yn.applyArabicShaping,isLoading:()=>Gn===Un,setState(e){Gn=e.pluginStatus,qn=e.pluginURL},isParsed:()=>null!=Yn.applyArabicShaping&&null!=Yn.processBidirectionalText&&null!=Yn.processStyledBidirectionalText,getPluginURL:()=>qn};class Kn{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){var t,i,r=Yn.isLoaded();for(const n of e)if(t=n.charCodeAt(0),i=r,!i&&Fn(t)||2304<=t&&t<=3583||3840<=t&&t<=4255||j.Khmer(t))return!1;return!0}}class Jn{constructor(e,t,i,r){this.property=e,this.value=t,this.expression=function(t,i,e,r){if(dn(t))return new An(t,i);if(xn(t)||Array.isArray(t)&&0<t.length){e=Sn(t,i,e,r);if("error"===e.result)throw new Error(e.value.map(e=>e.key+": "+e.message).join(", "));return e.value}{let e=t;return"string"==typeof t&&"color"===i.type&&(e=zt.parse(t)),{kind:"constant",isConfigDependent:!1,evaluate:()=>e}}}(void 0===t?e.specification.default:t,e.specification,i,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Qn{constructor(e,t,i){this.property=e,this.value=new Jn(e,void 0,t,i)}transitioned(e,t){return new to(this.property,this.value,t,ne({},e.transition,this.transition),e.now)}untransitioned(){return new to(this.property,this.value,null,{},0)}}class eo{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=i,this.isConfigDependent=!1}getValue(e){return me(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Qn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Jn(this._values[e].property,null===t?void 0:me(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);var i=this._properties.properties;if(e)for(const t in e){var r=e[t];if(de(t,"-transition")){const e=t.slice(0,-11);i[e]&&this.setTransition(e,r)}else i[t]&&this.setValue(t,r)}}getTransition(e){return me(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Qn(this._values[e].property)),this._values[e].transition=me(t)||void 0}serialize(){var e={};for(const i of Object.keys(this._values)){var t=this.getValue(i),t=(void 0!==t&&(e[i]=t),this.getTransition(i));void 0!==t&&(e[i+"-transition"]=t)}return e}transitioned(e,t){var i=new io(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){var e=new io(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class to{constructor(e,t,i,r,n){var o=r.delay||0,a=r.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+o,this.end=this.begin+a,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){var r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),o=this.prior;return o?r>this.end||this.value.isDataDriven()?(this.prior=null,n):r<this.begin?o.possiblyEvaluate(e,t,i):(r=(r-this.begin)/(this.end-this.begin),this.property.interpolate(o.possiblyEvaluate(e,t,i),n,J(r))):n}}class io{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){var r=new oo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ro{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=i,this.isConfigDependent=!1}getValue(e){return me(this._values[e].value)}setValue(e,t){this._values[e]=new Jn(this._values[e].property,null===t?void 0:me(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){var e={};for(const i of Object.keys(this._values)){var t=this.getValue(i);void 0!==t&&(e[i]=t)}return e}possiblyEvaluate(e,t,i){var r=new oo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class no{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class oo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class a{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){var r=Ot[this.specification.type];return r?r(e,t,i):e}}class s{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new no(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){var r;return"constant"!==e.value.kind||"constant"!==t.value.kind?e:void 0===e.value.value||void 0===t.value.value?new no(this,{kind:"constant",value:void 0},e.parameters):(r=Ot[this.specification.type])?new no(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,r,n,o){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,o)}}class ao{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class d{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];var t=new Kn(0,{});for(const n in e){var i=e[n],r=(i.specification.overridable&&this.overridableProperties.push(n),this.defaultPropertyValues[n]=new Jn(i,void 0)),i=this.defaultTransitionablePropertyValues[n]=new Qn(i);this.defaultTransitioningPropertyValues[n]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=r.possiblyEvaluate(t)}}}function so(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function lo(e){if(Array.isArray(e))return e.map(lo);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(const i in e)t[i]=lo(e[i]);return t}return so(e)}n(s,"DataDrivenProperty"),n(a,"DataConstantProperty"),n(ao,"ColorRampProperty");var p=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function co(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return 2<=e.length&&"$id"!==e[1]&&"$type"!==e[1];case"in":return 3<=e.length&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!co(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ho(o,e="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};var t,i=o=co(o)?o:mo(o);let r=!0;try{r=uo(t=i)?(function t(i){let r=!1;const n=[];if("case"===i[0]){for(let e=1;e<i.length-1;e+=2)r=r||uo(i[e]),n.push(i[e+1]);n.push(i[i.length-1])}else if("match"===i[0]){r=r||uo(i[1]);for(let e=2;e<i.length-1;e+=2)n.push(i[e+1]);n.push(i[i.length-1])}else if("step"===i[0]){r=r||uo(i[1]);for(let e=1;e<i.length-1;e+=2)n.push(i[e+1])}r&&(i.length=0,i.push("any",...n));for(let e=1;e<i.length;e++)t(i[e])}(s=lo(t)),function t(e){if(!Array.isArray(e))return e;const i=function(t){if(po.has(t[0]))for(let e=1;e<t.length;e++)if(uo(t[e]))return!0;return t}(e);return!0===i?i:i.map(e=>t(e))}(s)):t}catch(o){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const n=p["filter_"+e],a=bn(r,n);var s;if("error"===a.result)throw new Error(a.value.map(e=>e.key+": "+e.message).join(", "));s=(e,t,i)=>a.value.evaluate(e,t,{},i);let l=null,c=null;if(r!==i){const o=bn(i,n);if("error"===o.result)throw new Error(o.value.map(e=>e.key+": "+e.message).join(", "));l=(e,t,i,r,n)=>o.value.evaluate(e,t,{},i,void 0,void 0,r,n),c=!br(o.value.expression)}return{filter:s,dynamicFilter:l||void 0,needGeometry:function t(i){if(!Array.isArray(i))return!1;if("within"===i[0]||"distance"===i[0])return!0;for(let e=1;e<i.length;e++)if(t(i[e]))return!0;return!1}(r),needFeature:!!c}}function uo(t){if(Array.isArray(t)){if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(uo(t[e]))return!0}return!1}const po=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fo(e,t){return e<t?-1:t<e?1:0}function mo(e){var t,i;return!e||(t=e[0],e.length<=1?"any"!==t:"=="===t?go(e[1],e[2],"=="):"!="===t?vo(go(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?go(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(mo))):"all"===t?["all"].concat(e.slice(1).map(mo)):"none"===t?["all"].concat(e.slice(1).map(mo).map(vo)):"in"===t?_o(e[1],e.slice(2)):"!in"===t?vo(_o(e[1],e.slice(2))):"has"===t?yo(e[1]):"!has"!==t||vo(yo(e[1])))}function go(e,t,i){switch(e){case"$type":return["filter-type-"+i,t];case"$id":return["filter-id-"+i,t];default:return["filter-"+i,e,t]}}function _o(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return 200<t.length&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(fo)]]:["filter-in-small",e,["literal",t]]}}function yo(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function vo(e){return["!",e]}function xo(e,t){return t?e+""+t:e}const bo="-transition";class wo extends Ct{constructor(e,t,i,r){if(super(),this.id=e.id,this.fqid=xo(this.id,i),this.type=e.type,this.scope=i,this.options=r,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new ro(t.layout,this.scope,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new eo(t.paint,this.scope,r);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new oo(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){var i;"custom"===this.type&&"visibility"===e?this.visibility=t:(i=this._unevaluatedLayout)._properties.properties[e]&&(i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===e)&&this.possiblyEvaluateVisibility()}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return de(e,bo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){var i=this._transitionablePaint,r=i._properties.properties;if(de(e,bo)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const n=i._values[e],o=n.value.isDataDriven(),a=n.value;i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);r=i._values[e].value,t=r.isDataDriven(),i=de(e,"pattern")||"line-dasharray"===e;return t||o||i||this._handleOverridablePaintPropertyUpdate(e,a,r)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return fe({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){var e=this.paint.get(t);if(e instanceof no&&ln(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ho(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const To={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class So{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){e>this.capacity&&(this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),e=this.uint8,this._refreshViews(),e)&&this.uint8.set(e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function m(e,n=1){let o=0,a=0;return{members:e.map(e=>{var t=To[e.type].BYTES_PER_ELEMENT,i=o=Ao(o,Math.max(n,t)),r=e.components||1;return a=Math.max(a,t),o+=t*r,{name:e.name,type:e.type,components:r,offset:i}}),size:Ao(o,Math.max(a,n)),alignment:n}}function Ao(e,t){return Math.ceil(e/t)*t}class Eo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){var i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){var r=2*e;return this.int16[0+r]=t,this.int16[1+r]=i,e}}Eo.prototype.bytesPerElement=4,n(Eo,"StructArrayLayout2i4");class Co extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){var n=3*e;return this.int16[0+n]=t,this.int16[1+n]=i,this.int16[2+n]=r,e}}Co.prototype.bytesPerElement=6,n(Co,"StructArrayLayout3i6");class Mo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){var o=4*e;return this.int16[0+o]=t,this.int16[1+o]=i,this.int16[2+o]=r,this.int16[3+o]=n,e}}Mo.prototype.bytesPerElement=8,n(Mo,"StructArrayLayout4i8");class Io extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){var a=5*e;return this.int16[0+a]=t,this.int16[1+a]=i,this.int16[2+a]=r,this.int16[3+a]=n,this.int16[4+a]=o,e}}Io.prototype.bytesPerElement=10,n(Io,"StructArrayLayout5i10");class Po extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o,a)}emplace(e,t,i,r,n,o,a,s){var l=6*e,c=12*e,h=3*e;return this.int16[0+l]=t,this.int16[1+l]=i,this.uint8[4+c]=r,this.uint8[5+c]=n,this.uint8[6+c]=o,this.uint8[7+c]=a,this.float32[2+h]=s,e}}Po.prototype.bytesPerElement=12,n(Po,"StructArrayLayout2i4ub1f12");class Lo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){var o=4*e;return this.float32[0+o]=t,this.float32[1+o]=i,this.float32[2+o]=r,this.float32[3+o]=n,e}}Lo.prototype.bytesPerElement=16,n(Lo,"StructArrayLayout4f16");class Do extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){var a=6*e,s=3*e;return this.uint16[0+a]=t,this.uint16[1+a]=i,this.uint16[2+a]=r,this.uint16[3+a]=n,this.float32[2+s]=o,e}}Do.prototype.bytesPerElement=12,n(Do,"StructArrayLayout4ui1f12");class ko extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){var o=4*e;return this.uint16[0+o]=t,this.uint16[1+o]=i,this.uint16[2+o]=r,this.uint16[3+o]=n,e}}ko.prototype.bytesPerElement=8,n(ko,"StructArrayLayout4ui8");class zo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,a){var s=6*e;return this.int16[0+s]=t,this.int16[1+s]=i,this.int16[2+s]=r,this.int16[3+s]=n,this.int16[4+s]=o,this.int16[5+s]=a,e}}zo.prototype.bytesPerElement=12,n(zo,"StructArrayLayout6i12");class Ro extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a,s,l,c,h,u){var d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,o,a,s,l,c,h,u)}emplace(e,t,i,r,n,o,a,s,l,c,h,u,d){var p=12*e;return this.int16[0+p]=t,this.int16[1+p]=i,this.int16[2+p]=r,this.int16[3+p]=n,this.uint16[4+p]=o,this.uint16[5+p]=a,this.uint16[6+p]=s,this.uint16[7+p]=l,this.int16[8+p]=c,this.int16[9+p]=h,this.int16[10+p]=u,this.int16[11+p]=d,e}}Ro.prototype.bytesPerElement=24,n(Ro,"StructArrayLayout4i4ui4i24");class Oo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,a){var s=10*e,l=5*e;return this.int16[0+s]=t,this.int16[1+s]=i,this.int16[2+s]=r,this.float32[2+l]=n,this.float32[3+l]=o,this.float32[4+l]=a,e}}Oo.prototype.bytesPerElement=20,n(Oo,"StructArrayLayout3i3f20");class Bo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[+e+0]=t,e}}Bo.prototype.bytesPerElement=4,n(Bo,"StructArrayLayout1ul4");class Fo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){var i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){var r=2*e;return this.uint16[0+r]=t,this.uint16[1+r]=i,e}}Fo.prototype.bytesPerElement=4,n(Fo,"StructArrayLayout2ui4");class No extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a,s,l,c,h,u,d){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,r,n,o,a,s,l,c,h,u,d)}emplace(e,t,i,r,n,o,a,s,l,c,h,u,d,p){var f=20*e,m=10*e;return this.int16[0+f]=t,this.int16[1+f]=i,this.int16[2+f]=r,this.int16[3+f]=n,this.int16[4+f]=o,this.float32[3+m]=a,this.float32[4+m]=s,this.float32[5+m]=l,this.float32[6+m]=c,this.int16[14+f]=h,this.uint32[8+m]=u,this.uint16[18+f]=d,this.uint16[19+f]=p,e}}No.prototype.bytesPerElement=40,n(No,"StructArrayLayout5i4f1i1ul2ui40");class Uo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o,a)}emplace(e,t,i,r,n,o,a,s){var l=8*e;return this.int16[0+l]=t,this.int16[1+l]=i,this.int16[2+l]=r,this.int16[4+l]=n,this.int16[5+l]=o,this.int16[6+l]=a,this.int16[7+l]=s,e}}Uo.prototype.bytesPerElement=16,n(Uo,"StructArrayLayout3i2i2i16");class jo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){var a=4*e,s=8*e;return this.float32[0+a]=t,this.float32[1+a]=i,this.float32[2+a]=r,this.int16[6+s]=n,this.int16[7+s]=o,e}}jo.prototype.bytesPerElement=16,n(jo,"StructArrayLayout2f1f2i16");class Vo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){var o=12*e,a=3*e;return this.uint8[0+o]=t,this.uint8[1+o]=i,this.float32[1+a]=r,this.float32[2+a]=n,e}}Vo.prototype.bytesPerElement=12,n(Vo,"StructArrayLayout2ub2f12");class Go extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){var n=3*e;return this.uint16[0+n]=t,this.uint16[1+n]=i,this.uint16[2+n]=r,e}}Go.prototype.bytesPerElement=6,n(Go,"StructArrayLayout3ui6");class qo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x){var b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x)}emplace(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b){var w=30*e,T=15*e,S=60*e;return this.int16[0+w]=t,this.int16[1+w]=i,this.int16[2+w]=r,this.float32[2+T]=n,this.float32[3+T]=o,this.uint16[8+w]=a,this.uint16[9+w]=s,this.uint32[5+T]=l,this.uint32[6+T]=c,this.uint32[7+T]=h,this.uint16[16+w]=u,this.uint16[17+w]=d,this.uint16[18+w]=p,this.float32[10+T]=f,this.float32[11+T]=m,this.uint8[48+S]=g,this.uint8[49+S]=_,this.uint8[50+S]=y,this.uint32[13+T]=v,this.int16[28+w]=x,this.uint8[58+S]=b,e}}qo.prototype.bytesPerElement=60,n(qo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,T,S,A,E,C,M,I,P,L){var D=this.length;return this.resize(D+1),this.emplace(D,e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,T,S,A,E,C,M,I,P,L)}emplace(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,T,S,A,E,C,M,I,P,L,D){var k=20*e,z=40*e,R=80*e;return this.float32[0+k]=t,this.float32[1+k]=i,this.int16[4+z]=r,this.int16[5+z]=n,this.int16[6+z]=o,this.int16[7+z]=a,this.int16[8+z]=s,this.int16[9+z]=l,this.int16[10+z]=c,this.int16[11+z]=h,this.int16[12+z]=u,this.uint16[13+z]=d,this.uint16[14+z]=p,this.uint16[15+z]=f,this.uint16[16+z]=m,this.uint16[17+z]=g,this.uint16[18+z]=_,this.uint16[19+z]=y,this.uint16[20+z]=v,this.uint16[21+z]=x,this.uint16[22+z]=b,this.uint16[23+z]=w,this.uint16[24+z]=T,this.uint16[25+z]=S,this.uint16[26+z]=A,this.uint16[27+z]=E,this.uint32[14+k]=C,this.float32[15+k]=M,this.float32[16+k]=I,this.float32[17+k]=P,this.float32[18+k]=L,this.uint8[76+R]=D,e}}Wo.prototype.bytesPerElement=80,n(Wo,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ho extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[+e+0]=t,e}}Ho.prototype.bytesPerElement=4,n(Ho,"StructArrayLayout1f4");class Zo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){var a=5*e;return this.float32[0+a]=t,this.float32[1+a]=i,this.float32[2+a]=r,this.float32[3+a]=n,this.float32[4+a]=o,e}}Zo.prototype.bytesPerElement=20,n(Zo,"StructArrayLayout5f20");class $o extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o,a)}emplace(e,t,i,r,n,o,a,s){var l=7*e;return this.float32[0+l]=t,this.float32[1+l]=i,this.float32[2+l]=r,this.float32[3+l]=n,this.float32[4+l]=o,this.float32[5+l]=a,this.float32[6+l]=s,e}}$o.prototype.bytesPerElement=28,n($o,"StructArrayLayout7f28");class Xo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){var o=6*e;return this.uint32[3*e+0]=t,this.uint16[2+o]=i,this.uint16[3+o]=r,this.uint16[4+o]=n,e}}Xo.prototype.bytesPerElement=12,n(Xo,"StructArrayLayout1ul3ui12");class Yo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[+e+0]=t,e}}Yo.prototype.bytesPerElement=2,n(Yo,"StructArrayLayout1ui2");class Ko extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){var n=3*e;return this.float32[0+n]=t,this.float32[1+n]=i,this.float32[2+n]=r,e}}Ko.prototype.bytesPerElement=12,n(Ko,"StructArrayLayout3f12");class Jo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){var i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){var r=2*e;return this.float32[0+r]=t,this.float32[1+r]=i,e}}Jo.prototype.bytesPerElement=8,n(Jo,"StructArrayLayout2f8");class Qo extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m){var g=this.length;return this.resize(g+1),this.emplace(g,e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m)}emplace(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g){var _=16*e;return this.float32[0+_]=t,this.float32[1+_]=i,this.float32[2+_]=r,this.float32[3+_]=n,this.float32[4+_]=o,this.float32[5+_]=a,this.float32[6+_]=s,this.float32[7+_]=l,this.float32[8+_]=c,this.float32[9+_]=h,this.float32[10+_]=u,this.float32[11+_]=d,this.float32[12+_]=p,this.float32[13+_]=f,this.float32[14+_]=m,this.float32[15+_]=g,e}}Qo.prototype.bytesPerElement=64,n(Qo,"StructArrayLayout16f64");class ea extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o,a)}emplace(e,t,i,r,n,o,a,s){var l=10*e,c=5*e;return this.uint16[0+l]=t,this.uint16[1+l]=i,this.uint16[2+l]=r,this.uint16[3+l]=n,this.float32[2+c]=o,this.float32[3+c]=a,this.float32[4+c]=s,e}}ea.prototype.bytesPerElement=20,n(ea,"StructArrayLayout4ui3f20");class ta extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[+e+0]=t,e}}ta.prototype.bytesPerElement=1,n(ta,"StructArrayLayout1ub1");class ia extends So{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ia.prototype.size=40;class ra extends No{get(e){return new ia(this,e)}}n(ra,"CollisionBoxArray");class na extends So{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}na.prototype.size=60;class oa extends qo{get(e){return new na(this,e)}}n(oa,"PlacedSymbolArray");class aa extends So{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}aa.prototype.size=80;class sa extends Wo{get(e){return new aa(this,e)}}n(sa,"SymbolInstanceArray");class la extends Ho{getoffsetX(e){return this.float32[+e+0]}}n(la,"GlyphOffsetArray");class ca extends Eo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}n(ca,"SymbolLineVertexArray");class ha extends So{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ha.prototype.size=12;class ua extends Xo{get(e){return new ha(this,e)}}n(ua,"FeatureIndexArray");class da extends Fo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}n(da,"FillExtrusionCentroidArray");const pa=m([{name:"a_pos",components:2,type:"Int16"}],4),fa=m([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ma{constructor(e=[]){this.segments=e}_prepareSegment(e,t,i,r){let n=this.segments[this.segments.length-1];return e>ma.MAX_VERTEX_ARRAY_LENGTH&&_e(`Max vertices per segment is ${ma.MAX_VERTEX_ARRAY_LENGTH}: bucket requested `+e),(!n||n.vertexLength+e>ma.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}prepareSegment(e,t,i,r){return this._prepareSegment(e,t.length,i.length,r)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new ma([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function ga(e,t){return 256*(e=S(Math.floor(e),0,255))+S(Math.floor(t),0,255)}ma.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,n(ma,"SegmentVector");const _a=m([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ya=m([{name:"a_dash",components:4,type:"Uint16"}]);function va(e,t){for(var i,r,n,o=e.length-(i=3&e.length),a=t,s=3432918353,l=461845907,c=0;c<o;)n=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,a=27492+(65535&(r=5*(65535&(a=(a^=n=(65535&(n=(n=(65535&n)*s+(((n>>>16)*s&65535)<<16)&4294967295)<<15|n>>>17))*l+(((n>>>16)*l&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(n=0,i){case 3:n^=(255&e.charCodeAt(c+2))<<16;case 2:n^=(255&e.charCodeAt(c+1))<<8;case 1:a^=n=(65535&(n=(n=(65535&(n^=255&e.charCodeAt(c)))*s+(((n>>>16)*s&65535)<<16)&4294967295)<<15|n>>>17))*l+(((n>>>16)*l&65535)<<16)&4294967295}return a=2246822507*(65535&(a=(a^=e.length)^a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,((a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295)^a>>>16)>>>0}function xa(e,t){for(var i,r=e.length,n=t^r,o=0;4<=r;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),r-=4,++o;switch(r){case 3:n^=(255&e.charCodeAt(o+2))<<16;case 2:n^=(255&e.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return((n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16))^n>>>15)>>>0}var i={exports:{}},t=va,ba=(i.exports=t,i.exports.murmur3=t,i.exports.murmur2=xa,G(i.exports));class wa{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(Ta(e)),this.positions.push(t,i,r)}eachPosition(e,t){var i=Ta(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=i?n=e:r=1+e}for(;this.ids[r]===i;)t(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,t){var i=new Float64Array(e.ids),e=new Uint32Array(e.positions);return function i(r,n,o,a){for(;o<a;){const s=r[o+a>>1];let e=o-1,t=a+1;for(;;){for(;e++,r[e]<s;);for(;t--,r[t]>s;);if(e>=t)break;Sa(r,e,t),Sa(n,3*e,3*t),Sa(n,3*e+1,3*t+1),Sa(n,3*e+2,3*t+2)}t-o<a-t?(i(r,n,o,t),o=t+1):(i(r,n,t+1,a),a=t)}}(i,e,0,i.length-1),t&&(t.add(i.buffer),t.add(e.buffer)),{ids:i,positions:e}}static deserialize(e){var t=new wa;let i;t.ids=e.ids,t.positions=e.positions;for(const e of t.ids)e!==i&&t.uniqueIds.push(e),i=e;return t.indexed=!0,t}}function Ta(e){var t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:ba(String(e))}function Sa(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}n(wa,"FeaturePositionMap");class Aa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Ea extends Aa{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class Ca extends Aa{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ma extends Aa{constructor(e){super(e),this.current=[0,0]}set(e,t,i){!this.fetchUniformLocation(e,t)||i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}}class Ia extends Aa{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){!this.fetchUniformLocation(e,t)||i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}}class Pa extends Aa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){!this.fetchUniformLocation(e,t)||i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class La extends Aa{constructor(e){super(e),this.current=zt.transparent}set(e,t,i){!this.fetchUniformLocation(e,t)||i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Da=new Float32Array(16);class ka extends Aa{constructor(e){super(e),this.current=Da}set(e,t,i){if(this.fetchUniformLocation(e,t))if(i[12]!==this.current[12]||i[0]!==this.current[0])this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);else for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}const za=new Float32Array(9),Ra=new Float32Array(4);class Oa extends Aa{constructor(e){super(e),this.current=Ra}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Ba(e){return[ga(255*e.r,255*e.g),ga(255*e.b,255*e.a)]}class Fa{constructor(e,t,i){this.value=e,this.uniformNames=t.map(e=>"u_"+e),this.type=i}setUniform(e,t,i,r,n){t.set(e,n,r.constantOr(this.value))}getBinding(e,t){return new("color"===this.type?La:Ca)(e)}}class Na{constructor(e,t){this.uniformNames=t.map(e=>"u_"+e),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,r,n){var o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&t.set(e,n,o)}getBinding(e,t){return new("u_pattern"===t||"u_dash"===t?Pa:Ca)(e)}}class Ua{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n,o,a){var s=this.paintVertexArray.length,o=this.expression.evaluate(new Kn(0,{brightness:o}),t,{},n,r,a);this.paintVertexArray.resize(e),this._setPaintValue(s,e,o)}updatePaintArray(e,t,i,r,n,o,a){a=this.expression.evaluate({zoom:0,brightness:a},i,r,void 0,n);this._setPaintValue(e,t,a)}_setPaintValue(t,i,r){if("color"===this.type){var n=Ba(r);for(let e=t;e<i;e++)this.paintVertexArray.emplace(e,n[0],n[1])}else{for(let e=t;e<i;e++)this.paintVertexArray.emplace(e,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ja{constructor(e,t,i,r,n,o){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,i,r,n,o,a){var s=this.expression.evaluate(new Kn(this.zoom,{brightness:o}),t,{},n,r,a),o=this.expression.evaluate(new Kn(this.zoom+1,{brightness:o}),t,{},n,r,a),t=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(t,e,s,o)}updatePaintArray(e,t,i,r,n,o,a){var s=this.expression.evaluate({zoom:this.zoom,brightness:a},i,r,void 0,n),a=this.expression.evaluate({zoom:this.zoom+1,brightness:a},i,r,void 0,n);this._setPaintValue(e,t,s,a)}_setPaintValue(t,i,r,n){if("color"===this.type){var o=Ba(r),a=Ba(n);for(let e=t;e<i;e++)this.paintVertexArray.emplace(e,o[0],o[1],a[0],a[1])}else{for(let e=t;e<i;e++)this.paintVertexArray.emplace(e,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,r,n){i=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,i=S(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(e,n,i)}getBinding(e,t){return new Ca(e)}}class Va{constructor(e,t,i,r,n){this.expression=e,this.layerId=n,this.paintVertexAttributes=("array"===i?ya:_a).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new r}populatePaintArray(e,t,i){var r=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n,o,a){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(t,i,e,r){if(r&&e){r=r[e];if(r){var{tl:n,br:o,pixelRatio:a}=r;for(let e=t;e<i;e++)this.paintVertexArray.emplace(e,n[0],n[1],o[0],o[1],a)}}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ga{constructor(e,t,i=()=>!0){this.binders={},this._buffers=[];var r=[];for(const h in e.paint._values){var n=e.paint.get(h);if(i(h)&&(n instanceof no&&ln(n.property.specification))){o=h,a=e.type;var o=Wa[o]||[o.replace(a+"-","").replace(/-/g,"_")],a=n.value,s=n.property.specification.type,n=!!n.property.useIntegerZoom,l="line-dasharray"===h||h.endsWith("pattern"),c="line-dasharray"===h&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||c)if("source"===a.kind||c||l){const t=$a(h,s,"source");this.binders[h]=l?new Va(a,o,s,t,e.id):new Ua(a,o,s,t),r.push("/a_"+h)}else{const e=$a(h,s,"composite");this.binders[h]=new ja(a,o,s,n,t,e),r.push("/z_"+h)}else this.binders[h]=l?new Na(a.value,o):new Fa(a.value,o,s),r.push("/u_"+h)}}this.cacheKey=r.sort().join("")}getMaxValue(e){e=this.binders[e];return e instanceof Ua||e instanceof ja?e.maxValue:0}populatePaintArrays(e,t,i,r,n,o,a){for(const l in this.binders){var s=this.binders[l];(s instanceof Ua||s instanceof ja||s instanceof Va)&&s.populatePaintArray(e,t,i,r,n,o,a)}}setConstantPatternPositions(e){for(const i in this.binders){var t=this.binders[i];t instanceof Na&&t.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,r,n,o,a,s){let l=!1;const c=Object.keys(e),h=0!==c.length,u=h?c:t.uniqueIds;for(const c in this.binders){const p=this.binders[c];if((p instanceof Ua||p instanceof ja||p instanceof Va)&&(!0===p.expression.isStateDependent||!1===p.expression.isLightConstant)){var d=n.paint.get(c);p.expression=d.value;for(const i of u){const n=e[i.toString()];t.eachPosition(i,(e,t,i)=>{e=r.feature(e);p.updatePaintArray(t,i,e,n,o,a,s)})}if(!h)for(const t of i.uniqueIds){const n=e[t.toString()];i.eachPosition(t,(e,t,i)=>{e=r.feature(e);p.updatePaintArray(t,i,e,n,o,a,s)})}l=!0}}return l}defines(){var e=[];for(const i in this.binders){var t=this.binders[i];(t instanceof Fa||t instanceof Na)&&e.push(...t.uniformNames.map(e=>"#define HAS_UNIFORM_"+e))}return e}getBinderAttributes(){var t=[];for(const e in this.binders){var i=this.binders[e];if(i instanceof Ua||i instanceof ja||i instanceof Va)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){var e=[];for(const i in this.binders){var t=this.binders[i];if(t instanceof Fa||t instanceof Na||t instanceof ja)for(const r of t.uniformNames)e.push(r)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){var t=[];for(const r in this.binders){var i=this.binders[r];if(i instanceof Fa||i instanceof Na||i instanceof ja)for(const n of i.uniformNames)t.push({name:n,property:r,binding:i.getBinding(e,n)})}return t}setUniforms(e,t,i,r,n){for(const{name:t,property:o,binding:a}of i)this.binders[o].setUniform(e,a,n,r.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){var e=this.binders[t];(e instanceof Ua||e instanceof ja||e instanceof Va)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(e){for(const i in this.binders){var t=this.binders[i];(t instanceof Ua||t instanceof ja||t instanceof Va)&&t.upload(e)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){var e=this.binders[t];(e instanceof Ua||e instanceof ja||e instanceof Va)&&e.destroy()}}}class qa{constructor(e,t,i=()=>!0){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new Ga(r,t,i);this.needsUpload=!1,this._featureMap=new wa,this._featureMapWithoutIds=new wa,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,i,r,n,o,a,s){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r,n,o,a,s);void 0!==t.id?this._featureMap.add(t.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r,n,o){for(const a of i)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,a,r,n,o||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Wa={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};const Ha={"line-pattern":{source:Do,composite:Do},"fill-pattern":{source:Do,composite:Do},"fill-extrusion-pattern":{source:Do,composite:Do},"line-dasharray":{source:ko,composite:ko}},Za={color:{source:Jo,composite:Lo},number:{source:Ho,composite:Jo}};function $a(e,t,i){e=Ha[e];return e&&e[i]||Za[t][i]}n(Fa,"ConstantBinder"),n(Na,"PatternConstantBinder"),n(Ua,"SourceExpressionBinder"),n(Va,"PatternCompositeBinder"),n(ja,"CompositeExpressionBinder"),n(Ga,"ProgramConfiguration",{omit:["_buffers"]}),n(qa,"ProgramConfigurationSet");const Xa=ue/Math.PI/2,Ya=5,Ka=6,Ja=16383,Qa=[64,32,16],es=-Xa,ts=Xa;function is(e,t,i,r=Xa){return i=_(i),[e*Math.sin(i)*r,-t*r,e*Math.cos(i)*r]}function rs(e,t,i){return is(Math.cos(_(e)),Math.sin(_(e)),t,i)}const ns=6371008.8,os=2*Math.PI*ns;class E{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new E(ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){var t=Math.PI/180,i=this.lat*t,r=e.lat*t,i=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return ns*Math.acos(Math.min(i,1))}toBounds(e=0){var e=360*e/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new as({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return rs(this.lat,this.lng,Xa+e*Xa/ns)}static convert(e){if(e instanceof E)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new E(Number(e[0]),Number(e[1]));if(Array.isArray(e)||"object"!=typeof e||null===e)throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");return new E(Number("lng"in e?e.lng:e.lon),Number(e.lat))}}class as{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof E?new E(e.lng,e.lat):E.convert(e),this}setSouthWest(e){return this._sw=e instanceof E?new E(e.lng,e.lat):E.convert(e),this}extend(e){var t=this._sw,i=this._ne;let r,n;if(e instanceof E)r=e,n=e;else{if(!(e instanceof as))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(as.convert(e)):this.extend(E.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(E.convert(e)):this;if(r=e._sw,n=e._ne,!r||!n)return this}return t||i?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new E(r.lng,r.lat),this._ne=new E(n.lng,n.lat)),this}getCenter(){return new E((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new E(this.getWest(),this.getNorth())}getSouthEast(){return new E(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){var{lng:e,lat:t}=E.convert(e);let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=t&&t<=this._ne.lat&&i}static convert(e){return!e||e instanceof as?e:new as(e)}}r={};function ss(e,t,i){var r=ls(256*e,256*(t=Math.pow(2,i)-t-1),i),e=ls(256*(e+1),256*(t+1),i);return r[0]+","+r[1]+","+e[0]+","+e[1]}function ls(e,t,i){i=2*Math.PI*6378137/256/Math.pow(2,i);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}(e=r).getURL=function(e,t,i,r,n,o){return o=o||{},e+"?"+["bbox="+ss(i,r,n),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+t].join("&")},e.getTileBBox=ss,e.getMercCoords=ls,Object.defineProperty(e,"__esModule",{value:!0});var cs=r;class hs{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=ps(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){var i=cs.getTileBBox(this.x,this.y,this.z),r=function(t,i,r){let n,o="";for(let e=t;0<e;e--)n=1<<e-1,o+=(i&n?1:0)+(r&n?2:0);return o}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/`+this.y}}class us{constructor(e,t){this.wrap=e,this.canonical=t,this.key=ps(e,t.z,t.z,t.x,t.y)}}class ds{constructor(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new hs(i,+r,+n),this.key=0===t&&e===i?this.canonical.key:ps(t,e,i,r,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){var t=this.canonical.z-e;return e>this.canonical.z?new ds(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ds(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){var i;return this.overscaledZ===e&&t?this.key:e>this.canonical.z?ps(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):(i=this.canonical.z-e,ps(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i))}isChildOf(e){var t;return e.wrap===this.wrap&&(t=this.canonical.z-e.canonical.z,0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t)}children(e){var t,i;return this.overscaledZ>=e?[new ds(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)]:(e=this.canonical.z+1,t=2*this.canonical.x,i=2*this.canonical.y,[new ds(e,this.wrap,e,t,i),new ds(e,this.wrap,e,1+t,i),new ds(e,this.wrap,e,t,1+i),new ds(e,this.wrap,e,1+t,1+i)])}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ds(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ds(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new us(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/`+this.canonical.y}}function ps(e,t,i,r,n){var o=1<<Math.min(i,22);let a=n%o*o+r%o;return e&&i<22&&(a+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*a+i)+(t-i)}var Hi=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new ds(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new ds(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new ds(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new ds(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];n(hs,"CanonicalTileID"),n(ds,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const fs=0,ms=25.5;function gs(e){return os*Math.cos(e*Math.PI/180)}function _s(e){return(180+e)/360}function ys(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function vs(e,t){return e/gs(t)}function xs(e){return 360*e-180}function bs(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ws(e,t){return e*gs(bs(t))}const y=85.051129;function Ts(e){return Math.cos(_(S(e,-y,y)))}function Ss(e,t){t=S(t,fs,ms),t=Math.pow(2,t);return Ts(e)*os/(512*t)}function As(e){return 1/Math.cos(e*Math.PI/180)}function Es(e,t=0){t=Math.exp(Math.PI*(1-(e.y+t/ue)/(1<<e.z)*2));return 80150034*t/(t*t+1)/ue/(1<<e.z)}class Cs{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){e=E.convert(e);return new Cs(_s(e.lng),ys(e.lat),vs(t,e.lat))}toLngLat(){return new E(xs(this.x),bs(this.y))}toAltitude(){return ws(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/os*As(bs(this.y))}}function Ms(t,i,r){let n=t[0],o=n.x,a=n.y;i(n);var s=[n];for(let e=1;e<t.length;e++){var l=t[e],{x:c,y:h}=l;i(l),function e(t,i,r,n,o,a,s,l,c){var h,u,d,p,f,m,g=(i+n)/2,_=(r+o)/2,y=new U(g,_);l(y),h=y.x,u=y.y,d=a.x,p=a.y,f=d-s.x,m=p-s.y,Math.abs((p-u)*f-(d-h)*m)/Math.hypot(f,m)>=c?(e(t,i,r,g,_,a,y,l,c),e(t,g,_,n,o,y,s,l,c)):t.push(s)}(s,o,a,c,h,n,l,i,r),o=c,a=h,n=l}return s}function Is(t,i){let r=t[0];var n=[r];for(let e=1;e<t.length;e++){var o=t[e];(function e(t,i,r,n){var o;n(i,r)?(o=i.add(r)._mult(.5),e(t,i,o,n),e(t,o,r,n)):t.push(r)})(n,r,o,i),r=o}return n}const Ps=Math.pow(2,14)-1,Ls=-Ps-1;function Ds(t,r,i){const n=t.loadGeometry(),o=t.extent,a=ue/o;if(r&&i&&i.projection.isReprojectedInTileSpace){const a=1<<r.z,{scale:c,x:h,y:u,projection:d}=i,p=e=>{var t=xs((r.x+e.x/o)/a),i=bs((r.y+e.y/o)/a),t=d.project(t,i);e.x=(t.x*c-h)*o,e.y=(t.y*c-u)*o};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=Ms(n[e],p,1);else{const t=[];for(const i of n[e])i.x<0||i.x>=o||i.y<0||i.y>=o||(p(i),t.push(i));n[e]=t}}for(const t of n)for(const r of t)e=r,s=a,l=void 0,l=Math.round(e.x*s),s=Math.round(e.y*s),e.x=S(l,Ls,Ps),e.y=S(s,Ls,Ps),(l<e.x||l>e.x+1||s<e.y||s>e.y+1)&&_e("Geometry exceeds allowed extent, reduce your vector tile buffer size");var e,s,l;return n}function ks(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ds(e):[]}}function zs(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}function Rs(e,t,i){e.emplaceBack(t.x,t.y,t.z,16384*i[0],16384*i[1],16384*i[2])}class Os{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Eo,this.indexArray=new Go,this.segments=new ma,this.programConfigurations=new qa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,i,r){const n=this.layers[0],o=[];let a=null;"circle"===n.type&&(a=n.layout.get("circle-sort-key"));for(const{feature:t,id:n,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,h=ks(t,e);var s;this.layers[0]._featureFilter.filter(new Kn(this.zoom),h,i)&&(s=a?a.evaluate(h,{},i):void 0,s={id:n,properties:t.properties,type:t.type,sourceLayerIndex:c,index:l,geometry:e?h.geometry:Ds(t,i,r),patterns:{},sortKey:s},o.push(s))}a&&o.sort((e,t)=>e.sortKey-t.sortKey);let l=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new zo,l=r.projection);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:a}=r,u=e[o].feature;this.addFeature(r,n,o,t.availableImages,i,l,t.brightness),t.featureIndex.insert(u,n,o,a,this.index)}}update(e,t,i,r,n){var o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pa.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,fa.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer)&&this.globeExtVertexBuffer.destroy()}addFeature(e,t,i,r,n,o,a){for(const i of t)for(const t of i){const i=t.x,r=t.y;if(!(i<0||i>=ue||r<0||r>=ue)){if(o){const e=o.projectTilePoint(i,r,n),t=o.upVector(n,i,r),a=this.globeExtVertexArray;Rs(a,e,t),Rs(a,e,t),Rs(a,e,t),Rs(a,e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=a.vertexLength;zs(this.layoutVertexArray,i,r,-1,-1),zs(this.layoutVertexArray,i,r,1,-1),zs(this.layoutVertexArray,i,r,1,1),zs(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r,n,a)}}function Bs(t,i){for(let e=0;e<t.length;e++)if(Gs(i,t[e]))return!0;for(let e=0;e<i.length;e++)if(Gs(t,i[e]))return!0;return!!Ns(t,i)}function Fs(t,i){if(1===t.length)return Vs(i,t[0]);for(let e=0;e<i.length;e++){var r=i[e];for(let e=0;e<r.length;e++)if(Gs(t,r[e]))return!0}for(let e=0;e<t.length;e++)if(Vs(i,t[e]))return!0;for(let e=0;e<i.length;e++)if(Ns(t,i[e]))return!0;return!1}function Ns(t,i){var r,n,o,a;if(0!==t.length&&0!==i.length)for(let e=0;e<t.length-1;e++){var s=t[e],l=t[e+1];for(let e=0;e<i.length-1;e++)if(r=s,n=l,o=i[e],a=i[e+1],ye(r,o,a)!==ye(n,o,a)&&ye(r,n,o)!==ye(r,n,a))return 1}}function Us(t,i,e){var r=e*e;if(1===i.length)return t.distSqr(i[0])<r;for(let e=1;e<i.length;e++)if(js(t,i[e-1],i[e])<r)return 1}function js(e,t,i){var r=t.distSqr(i);return 0===r?e.distSqr(t):(r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r,e.distSqr(r<0?t:1<r?i:i.sub(t)._mult(r)._add(t)))}function Vs(r,n){let o,a,s,l=!1;for(let i=0;i<r.length;i++)for(let e=0,t=(o=r[i]).length-1;e<o.length;t=e++)a=o[e],s=o[t],a.y>n.y!=s.y>n.y&&n.x<(s.x-a.x)*(n.y-a.y)/(s.y-a.y)+a.x&&(l=!l);return l}function Gs(i,r){let n=!1;for(let e=0,t=i.length-1;e<i.length;t=e++){var o=i[e],a=i[t];o.y>r.y!=a.y>r.y&&r.x<(a.x-o.x)*(r.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function qs(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new U(e,i),new U(e,n),new U(r,n),new U(r,i)];if(2<t.length)for(const e of o)if(Gs(t,e))return!0;for(let e=0;e<t.length-1;e++)if(function(e,t,i){var r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return;r=ye(e,t,i[0]);return r!==ye(e,t,i[1])||r!==ye(e,t,i[2])||r!==ye(e,t,i[3])}(t[e],t[e+1],o))return!0;return!1}function Ws(e,t,i,r,n,o){let a=t.y-e.y,s=e.x-t.x;if(o=o||0){const e=a*a+s*s;if(0==e)return 1;const t=Math.sqrt(e);a/=t,s/=t}return!((i.x-e.x)*a+(i.y-e.y)*s-o<0||(r.x-e.x)*a+(r.y-e.y)*s-o<0||(n.x-e.x)*a+(n.y-e.y)*s-o<0)}function Hs(e,t,i,r,n,o,a){return!(Ws(e,t,r,n,o,a)||Ws(t,i,r,n,o,a)||Ws(i,e,r,n,o,a)||Ws(r,n,e,t,i,a)||Ws(n,o,e,t,i,a)||Ws(o,r,e,t,i,a))}function Zs(e,t,i){var r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function $s(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Xs(t,e,i,r,n){if(!e[0]&&!e[1])return t;var o=U.convert(e)._mult(n),a=("viewport"===i&&o._rotate(-r),[]);for(let e=0;e<t.length;e++)a.push(t[e].sub(o));return a}function Ys(e,t,i,r){e=U.convert(e)._mult(r);return"viewport"===t&&e._rotate(-i),e}n(Os,"CircleBucket",{omit:["layers"]});var t=new d({"circle-sort-key":new s(p.layout_circle["circle-sort-key"]),visibility:new a(p.layout_circle.visibility)}),Ks={paint:new d({"circle-radius":new s(p.paint_circle["circle-radius"]),"circle-color":new s(p.paint_circle["circle-color"]),"circle-blur":new s(p.paint_circle["circle-blur"]),"circle-opacity":new s(p.paint_circle["circle-opacity"]),"circle-translate":new a(p.paint_circle["circle-translate"]),"circle-translate-anchor":new a(p.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new a(p.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new a(p.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new s(p.paint_circle["circle-stroke-width"]),"circle-stroke-color":new s(p.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new s(p.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new a(p.paint_circle["circle-emissive-strength"])}),layout:t},i={},Js={},Qs=(Object.defineProperty(Js,"__esModule",{value:!0}),Js.setMatrixArrayType=function(e){Js.ARRAY_TYPE=el=e},Js.toRadian=function(e){return e*tl},Js.equals=function(e,t){return Math.abs(e-t)<=Qs*Math.max(1,Math.abs(e),Math.abs(t))},Js.RANDOM=Js.ARRAY_TYPE=Js.EPSILON=void 0,1e-6),el=(Js.EPSILON=Qs,"undefined"!=typeof Float32Array?Float32Array:Array),e=(Js.ARRAY_TYPE=el,Math.random),tl=(Js.RANDOM=e,Math.PI/180),r=(Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),{});function il(e){return(il="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.create=function(){var e=new rl.ARRAY_TYPE(4);return rl.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},r.clone=function(e){var t=new rl.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},r.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},r.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},r.fromValues=function(e,t,i,r){var n=new rl.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},r.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},r.transpose=function(e,t){var i;return e===t?(i=t[1],e[1]=t[2],e[2]=i):(e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3]),e},r.invert=function(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=i*t-n*r;return o?(e[0]=t*(o=1/o),e[1]=-r*o,e[2]=-n*o,e[3]=i*o,e):null},r.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},r.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},r.multiply=ol,r.rotate=function(e,t,i){var r=t[0],n=t[1],o=t[2],t=t[3],a=Math.sin(i),i=Math.cos(i);return e[0]=r*i+o*a,e[1]=n*i+t*a,e[2]=r*-a+o*i,e[3]=n*-a+t*i,e},r.scale=function(e,t,i){var r=t[1],n=t[2],o=t[3],a=i[0],i=i[1];return e[0]=t[0]*a,e[1]=r*a,e[2]=n*i,e[3]=o*i,e},r.fromRotation=function(e,t){var i=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=i,e[2]=-i,e[3]=t,e},r.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},r.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},r.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},r.LDU=function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},r.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},r.subtract=al,r.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},r.equals=function(e,t){var i=e[0],r=e[1],n=e[2],e=e[3],o=t[0],a=t[1],s=t[2],t=t[3];return Math.abs(i-o)<=rl.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=rl.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=rl.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(e-t)<=rl.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},r.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},r.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},r.sub=r.mul=void 0;var rl=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==il(e)&&"function"!=typeof e)return{default:e};var t=nl(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function nl(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(nl=function(e){return e?i:t})(e))}function ol(e,t,i){var r=t[0],n=t[1],o=t[2],t=t[3],a=i[0],s=i[1],l=i[2],i=i[3];return e[0]=r*a+o*s,e[1]=n*a+t*s,e[2]=r*l+o*i,e[3]=n*l+t*i,e}function al(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}r.mul=ol,r.sub=al;t={};function sl(e){return(sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){var e=new ll.ARRAY_TYPE(6);return ll.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},t.clone=function(e){var t=new ll.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,i,r,n,o){var a=new ll.ARRAY_TYPE(6);return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a[4]=n,a[5]=o,a},t.set=function(e,t,i,r,n,o,a){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=a,e},t.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],t=t[5],s=i*o-r*n;return s?(e[0]=o*(s=1/s),e[1]=-r*s,e[2]=-n*s,e[3]=i*s,e[4]=(n*t-o*a)*s,e[5]=(r*a-i*t)*s,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=hl,t.rotate=function(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],t=t[5],l=Math.sin(i),i=Math.cos(i);return e[0]=r*i+o*l,e[1]=n*i+a*l,e[2]=r*-l+o*i,e[3]=n*-l+a*i,e[4]=s,e[5]=t,e},t.scale=function(e,t,i){var r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=i[0],i=i[1];return e[0]=t[0]*l,e[1]=r*l,e[2]=n*i,e[3]=o*i,e[4]=a,e[5]=s,e},t.translate=function(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],t=t[5],l=i[0],i=i[1];return e[0]=r,e[1]=n,e[2]=o,e[3]=a,e[4]=r*l+o*i+s,e[5]=n*l+a*i+t,e},t.fromRotation=function(e,t){var i=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=i,e[2]=-i,e[3]=t,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},t.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},t.subtract=ul,t.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},t.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],e=e[5],s=t[0],l=t[1],c=t[2],h=t[3],u=t[4],t=t[5];return Math.abs(i-s)<=ll.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-l)<=ll.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-c)<=ll.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-h)<=ll.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-u)<=ll.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(e-t)<=ll.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},t.sub=t.mul=void 0;var ll=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==sl(e)&&"function"!=typeof e)return{default:e};var t=cl(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function cl(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(cl=function(e){return e?i:t})(e))}function hl(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],t=t[5],l=i[0],c=i[1],h=i[2],u=i[3],d=i[4],i=i[5];return e[0]=r*l+o*c,e[1]=n*l+a*c,e[2]=r*h+o*u,e[3]=n*h+a*u,e[4]=r*d+o*i+s,e[5]=n*d+a*i+t,e}function ul(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}t.mul=hl,t.sub=ul;e={};function dl(e){return(dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var e=new pl.ARRAY_TYPE(9);return pl.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.clone=function(e){var t=new pl.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.fromValues=function(e,t,i,r,n,o,a,s,l){var c=new pl.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=n,c[5]=o,c[6]=a,c[7]=s,c[8]=l,c},e.set=function(e,t,i,r,n,o,a,s,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e},e.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.transpose=function(e,t){var i,r,n;return e===t?(i=t[1],r=t[2],n=t[5],e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},e.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],t=t[8],h=t*a-s*c,u=-t*o+s*l,d=c*o-a*l,p=i*h+r*u+n*d;return p?(e[0]=h*(p=1/p),e[1]=(-t*r+n*c)*p,e[2]=(s*r-n*a)*p,e[3]=u*p,e[4]=(t*i-n*l)*p,e[5]=(-s*i+n*o)*p,e[6]=d*p,e[7]=(-c*i+r*l)*p,e[8]=(a*i-r*o)*p,e):null},e.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],t=t[8];return e[0]=a*t-s*c,e[1]=n*c-r*t,e[2]=r*s-n*a,e[3]=s*l-o*t,e[4]=i*t-n*l,e[5]=n*o-i*s,e[6]=o*c-a*l,e[7]=r*l-i*c,e[8]=i*a-r*o,e},e.determinant=function(e){var t=e[3],i=e[4],r=e[5],n=e[6],o=e[7],a=e[8];return e[0]*(a*i-r*o)+e[1]*(-a*t+r*n)+e[2]*(o*t-i*n)},e.multiply=ml,e.translate=function(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],t=t[8],u=i[0],i=i[1];return e[0]=r,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=u*r+i*a+c,e[7]=u*n+i*s+h,e[8]=u*o+i*l+t,e},e.rotate=function(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],t=t[8],u=Math.sin(i),i=Math.cos(i);return e[0]=i*r+u*a,e[1]=i*n+u*s,e[2]=i*o+u*l,e[3]=i*a-u*r,e[4]=i*s-u*n,e[5]=i*l-u*o,e[6]=c,e[7]=h,e[8]=t,e},e.scale=function(e,t,i){var r=i[0],i=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},e.fromRotation=function(e,t){var i=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=i,e[2]=0,e[3]=-i,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},e.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=i+i,a=r+r,s=n+n,i=i*o,l=r*o,r=r*a,c=n*o,h=n*a,n=n*s,o=t*o,a=t*a,t=t*s;return e[0]=1-r-n,e[3]=l-t,e[6]=c+a,e[1]=l+t,e[4]=1-i-n,e[7]=h-o,e[2]=c-a,e[5]=h+o,e[8]=1-i-r,e},e.normalFromMat4=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],t=t[15],_=i*s-r*a,y=i*l-n*a,v=i*c-o*a,x=r*l-n*s,b=r*c-o*s,w=n*c-o*l,T=h*m-u*f,S=h*g-d*f,h=h*t-p*f,A=u*g-d*m,u=u*t-p*m,d=d*t-p*g,p=_*d-y*u+v*A+x*h-b*S+w*T;return p?(e[0]=(s*d-l*u+c*A)*(p=1/p),e[1]=(l*h-a*d-c*S)*p,e[2]=(a*u-s*h+c*T)*p,e[3]=(n*u-r*d-o*A)*p,e[4]=(i*d-n*h+o*S)*p,e[5]=(r*h-i*u-o*T)*p,e[6]=(m*w-g*b+t*x)*p,e[7]=(g*v-f*w-t*y)*p,e[8]=(f*b-m*v+t*_)*p,e):null},e.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},e.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},e.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},e.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},e.subtract=gl,e.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},e.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},e.equals=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],e=e[8],h=t[0],u=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=t[6],_=t[7],t=t[8];return Math.abs(i-h)<=pl.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-u)<=pl.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-d)<=pl.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=pl.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=pl.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=pl.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-g)<=pl.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=pl.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(e-t)<=pl.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},e.sub=e.mul=void 0;var pl=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==dl(e)&&"function"!=typeof e)return{default:e};var t=fl(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function fl(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(fl=function(e){return e?i:t})(e))}function ml(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],t=t[8],u=i[0],d=i[1],p=i[2],f=i[3],m=i[4],g=i[5],_=i[6],y=i[7],i=i[8];return e[0]=u*r+d*a+p*c,e[1]=u*n+d*s+p*h,e[2]=u*o+d*l+p*t,e[3]=f*r+m*a+g*c,e[4]=f*n+m*s+g*h,e[5]=f*o+m*l+g*t,e[6]=_*r+y*a+i*c,e[7]=_*n+y*s+i*h,e[8]=_*o+y*l+i*t,e}function gl(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}e.mul=ml,e.sub=gl;var g={};function _l(e){return(_l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(g,"__esModule",{value:!0}),g.create=function(){var e=new D.ARRAY_TYPE(16);return D.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},g.clone=function(e){var t=new D.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},g.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},g.fromValues=function(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m){var g=new D.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=n,g[5]=o,g[6]=a,g[7]=s,g[8]=l,g[9]=c,g[10]=h,g[11]=u,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},g.set=function(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=h,e[10]=u,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},g.identity=vl,g.transpose=function(e,t){var i,r,n,o,a,s;return e===t?(i=t[1],r=t[2],n=t[3],o=t[6],a=t[7],s=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=n,e[13]=a,e[14]=s):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]),e},g.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],t=t[15],_=i*s-r*a,y=i*l-n*a,v=i*c-o*a,x=r*l-n*s,b=r*c-o*s,w=n*c-o*l,T=h*m-u*f,S=h*g-d*f,A=h*t-p*f,E=u*g-d*m,C=u*t-p*m,M=d*t-p*g,I=_*M-y*C+v*E+x*A-b*S+w*T;return I?(e[0]=(s*M-l*C+c*E)*(I=1/I),e[1]=(n*C-r*M-o*E)*I,e[2]=(m*w-g*b+t*x)*I,e[3]=(d*b-u*w-p*x)*I,e[4]=(l*A-a*M-c*S)*I,e[5]=(i*M-n*A+o*S)*I,e[6]=(g*v-f*w-t*y)*I,e[7]=(h*w-d*v+p*y)*I,e[8]=(a*C-s*A+c*T)*I,e[9]=(r*A-i*C-o*T)*I,e[10]=(f*b-m*v+t*_)*I,e[11]=(u*v-h*b-p*_)*I,e[12]=(s*S-a*E-l*T)*I,e[13]=(i*E-r*S+n*T)*I,e[14]=(m*y-f*x-g*_)*I,e[15]=(h*x-u*y+d*_)*I,e):null},g.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],t=t[15];return e[0]=s*(d*t-p*g)-u*(l*t-c*g)+m*(l*p-c*d),e[1]=-(r*(d*t-p*g)-u*(n*t-o*g)+m*(n*p-o*d)),e[2]=r*(l*t-c*g)-s*(n*t-o*g)+m*(n*c-o*l),e[3]=-(r*(l*p-c*d)-s*(n*p-o*d)+u*(n*c-o*l)),e[4]=-(a*(d*t-p*g)-h*(l*t-c*g)+f*(l*p-c*d)),e[5]=i*(d*t-p*g)-h*(n*t-o*g)+f*(n*p-o*d),e[6]=-(i*(l*t-c*g)-a*(n*t-o*g)+f*(n*c-o*l)),e[7]=i*(l*p-c*d)-a*(n*p-o*d)+h*(n*c-o*l),e[8]=a*(u*t-p*m)-h*(s*t-c*m)+f*(s*p-c*u),e[9]=-(i*(u*t-p*m)-h*(r*t-o*m)+f*(r*p-o*u)),e[10]=i*(s*t-c*m)-a*(r*t-o*m)+f*(r*c-o*s),e[11]=-(i*(s*p-c*u)-a*(r*p-o*u)+h*(r*c-o*s)),e[12]=-(a*(u*g-d*m)-h*(s*g-l*m)+f*(s*d-l*u)),e[13]=i*(u*g-d*m)-h*(r*g-n*m)+f*(r*d-n*u),e[14]=-(i*(s*g-l*m)-a*(r*g-n*m)+f*(r*l-n*s)),e[15]=i*(s*d-l*u)-a*(r*d-n*u)+h*(r*l-n*s),e},g.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],e=e[15];return(t*a-i*o)*(u*e-d*m)-(t*s-r*o)*(h*e-d*f)+(t*l-n*o)*(h*m-u*f)+(i*s-r*a)*(c*e-d*p)-(i*l-n*a)*(c*m-u*p)+(r*l-n*s)*(c*f-h*p)},g.multiply=xl,g.translate=function(e,t,i){var r,n,o,a,s,l,c,h,u,d,p,f,m=i[0],g=i[1],i=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*i+t[12],e[13]=t[1]*m+t[5]*g+t[9]*i+t[13],e[14]=t[2]*m+t[6]*g+t[10]*i+t[14],e[15]=t[3]*m+t[7]*g+t[11]*i+t[15]):(n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+s*g+u*i+t[12],e[13]=n*m+l*g+d*i+t[13],e[14]=o*m+c*g+p*i+t[14],e[15]=a*m+h*g+f*i+t[15]),e},g.scale=function(e,t,i){var r=i[0],n=i[1],i=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},g.rotate=function(e,t,i,r){var n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,T,S=r[0],A=r[1],r=r[2],E=Math.hypot(S,A,r);return E<D.EPSILON?null:(S*=E=1/E,A*=E,r*=E,E=Math.sin(i),i=Math.cos(i),a=t[1],s=t[2],l=t[3],h=t[5],u=t[6],d=t[7],f=t[9],m=t[10],g=t[11],_=S*S*(n=1-i)+i,v=S*A*n-r*E,x=A*A*n+i,b=r*A*n+S*E,w=S*r*n+A*E,T=A*r*n-S*E,i=r*r*n+i,e[0]=(o=t[0])*_+(c=t[4])*(y=A*S*n+r*E)+(p=t[8])*(r=r*S*n-A*E),e[1]=a*_+h*y+f*r,e[2]=s*_+u*y+m*r,e[3]=l*_+d*y+g*r,e[4]=o*v+c*x+p*b,e[5]=a*v+h*x+f*b,e[6]=s*v+u*x+m*b,e[7]=l*v+d*x+g*b,e[8]=o*w+c*T+p*i,e[9]=a*w+h*T+f*i,e[10]=s*w+u*T+m*i,e[11]=l*w+d*T+g*i,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},g.rotateX=function(e,t,i){var r=Math.sin(i),i=Math.cos(i),n=t[4],o=t[5],a=t[6],s=t[7],l=t[8],c=t[9],h=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+l*r,e[5]=o*i+c*r,e[6]=a*i+h*r,e[7]=s*i+u*r,e[8]=l*i-n*r,e[9]=c*i-o*r,e[10]=h*i-a*r,e[11]=u*i-s*r,e},g.rotateY=function(e,t,i){var r=Math.sin(i),i=Math.cos(i),n=t[0],o=t[1],a=t[2],s=t[3],l=t[8],c=t[9],h=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-l*r,e[1]=o*i-c*r,e[2]=a*i-h*r,e[3]=s*i-u*r,e[8]=n*r+l*i,e[9]=o*r+c*i,e[10]=a*r+h*i,e[11]=s*r+u*i,e},g.rotateZ=function(e,t,i){var r=Math.sin(i),i=Math.cos(i),n=t[0],o=t[1],a=t[2],s=t[3],l=t[4],c=t[5],h=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+l*r,e[1]=o*i+c*r,e[2]=a*i+h*r,e[3]=s*i+u*r,e[4]=l*i-n*r,e[5]=c*i-o*r,e[6]=h*i-a*r,e[7]=u*i-s*r,e},g.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},g.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromRotation=function(e,t,i){var r,n=i[0],o=i[1],i=i[2],a=Math.hypot(n,o,i);return a<D.EPSILON?null:(n*=a=1/a,o*=a,i*=a,a=Math.sin(t),t=Math.cos(t),e[0]=n*n*(r=1-t)+t,e[1]=o*n*r+i*a,e[2]=i*n*r-o*a,e[3]=0,e[4]=n*o*r-i*a,e[5]=o*o*r+t,e[6]=i*o*r+n*a,e[7]=0,e[8]=n*i*r+o*a,e[9]=o*i*r-n*a,e[10]=i*i*r+t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},g.fromXRotation=function(e,t){var i=Math.sin(t),t=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromYRotation=function(e,t){var i=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromZRotation=function(e,t){var i=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.fromRotationTranslation=bl,g.fromQuat2=function(e,t){var i=new D.ARRAY_TYPE(3),r=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=r*r+n*n+o*o+a*a;return 0<u?(i[0]=2*(s*a+h*r+l*o-c*n)/u,i[1]=2*(l*a+h*n+c*r-s*o)/u,i[2]=2*(c*a+h*o+s*n-l*r)/u):(i[0]=2*(s*a+h*r+l*o-c*n),i[1]=2*(l*a+h*n+c*r-s*o),i[2]=2*(c*a+h*o+s*n-l*r)),bl(e,t,i),e},g.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},g.getScaling=wl,g.getRotation=function(e,t){var i=new D.ARRAY_TYPE(3),r=(wl(i,t),1/i[0]),n=1/i[1],i=1/i[2],o=t[0]*r,a=t[1]*n,s=t[2]*i,l=t[4]*r,c=t[5]*n,h=t[6]*i,r=t[8]*r,n=t[9]*n,t=t[10]*i,i=o+c+t,u=0;return 0<i?(u=2*Math.sqrt(1+i),e[3]=.25*u,e[0]=(h-n)/u,e[1]=(r-s)/u,e[2]=(a-l)/u):c<o&&t<o?(u=2*Math.sqrt(1+o-c-t),e[3]=(h-n)/u,e[0]=.25*u,e[1]=(a+l)/u,e[2]=(r+s)/u):t<c?(u=2*Math.sqrt(1+c-o-t),e[3]=(r-s)/u,e[0]=(a+l)/u,e[1]=.25*u,e[2]=(h+n)/u):(u=2*Math.sqrt(1+t-o-c),e[3]=(a-l)/u,e[0]=(r+s)/u,e[1]=(h+n)/u,e[2]=.25*u),e},g.fromRotationTranslationScale=function(e,t,i,r){var n=t[0],o=t[1],a=t[2],t=t[3],s=n+n,l=o+o,c=a+a,h=n*s,u=n*l,n=n*c,d=o*l,o=o*c,a=a*c,s=t*s,l=t*l,t=t*c,c=r[0],p=r[1],r=r[2];return e[0]=(1-(d+a))*c,e[1]=(u+t)*c,e[2]=(n-l)*c,e[3]=0,e[4]=(u-t)*p,e[5]=(1-(h+a))*p,e[6]=(o+s)*p,e[7]=0,e[8]=(n+l)*r,e[9]=(o-s)*r,e[10]=(1-(h+d))*r,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},g.fromRotationTranslationScaleOrigin=function(e,t,i,r,n){var o=t[0],a=t[1],s=t[2],t=t[3],l=o+o,c=a+a,h=s+s,u=o*l,d=o*c,o=o*h,p=a*c,a=a*h,s=s*h,l=t*l,c=t*c,t=t*h,h=r[0],f=r[1],r=r[2],m=n[0],g=n[1],n=n[2],_=(1-(p+s))*h,y=(d+t)*h,h=(o-c)*h,d=(d-t)*f,t=(1-(u+s))*f,s=(a+l)*f,f=(o+c)*r,o=(a-l)*r,c=(1-(u+p))*r;return e[0]=_,e[1]=y,e[2]=h,e[3]=0,e[4]=d,e[5]=t,e[6]=s,e[7]=0,e[8]=f,e[9]=o,e[10]=c,e[11]=0,e[12]=i[0]+m-(_*m+d*g+f*n),e[13]=i[1]+g-(y*m+t*g+o*n),e[14]=i[2]+n-(h*m+s*g+c*n),e[15]=1,e},g.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=i+i,a=r+r,s=n+n,i=i*o,l=r*o,r=r*a,c=n*o,h=n*a,n=n*s,o=t*o,a=t*a,t=t*s;return e[0]=1-r-n,e[1]=l+t,e[2]=c-a,e[3]=0,e[4]=l-t,e[5]=1-i-n,e[6]=h+o,e[7]=0,e[8]=c+a,e[9]=h-o,e[10]=1-i-r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.frustum=function(e,t,i,r,n,o,a){var s=1/(i-t),l=1/(n-r),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(n+r)*l,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},g.perspectiveNO=Tl,g.perspectiveZO=function(e,t,i,r,n){t=1/Math.tan(t/2);return e[0]=t/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=n*(i=1/(r-n)),e[14]=n*r*i):(e[10]=-1,e[14]=-r),e},g.perspectiveFromFieldOfView=function(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),t=Math.tan(t.rightDegrees*Math.PI/180),s=2/(a+t),l=2/(n+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-t)*s*.5,e[9]=(n-o)*l*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},g.orthoNO=Sl,g.orthoZO=function(e,t,i,r,n,o,a){var s=1/(t-i),l=1/(r-n),a=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=o*a,e[15]=1,e},g.lookAt=function(e,t,i,r){var n,o,a,s,l=t[0],c=t[1],t=t[2],h=r[0],u=r[1],r=r[2],d=i[0],p=i[1],i=i[2];return Math.abs(l-d)<D.EPSILON&&Math.abs(c-p)<D.EPSILON&&Math.abs(t-i)<D.EPSILON?vl(e):(d=l-d,p=c-p,i=t-i,n=u*(i*=s=1/Math.hypot(d,p,i))-r*(p*=s),r=r*(d*=s)-h*i,h=h*p-u*d,(s=Math.hypot(n,r,h))?(n*=s=1/s,r*=s,h*=s):h=r=n=0,u=p*h-i*r,o=i*n-d*h,a=d*r-p*n,(s=Math.hypot(u,o,a))?(u*=s=1/s,o*=s,a*=s):a=o=u=0,e[0]=n,e[1]=u,e[2]=d,e[3]=0,e[4]=r,e[5]=o,e[6]=p,e[7]=0,e[8]=h,e[9]=a,e[10]=i,e[11]=0,e[12]=-(n*l+r*c+h*t),e[13]=-(u*l+o*c+a*t),e[14]=-(d*l+p*c+i*t),e[15]=1,e)},g.targetTo=function(e,t,i,r){var n=t[0],o=t[1],t=t[2],a=r[0],s=r[1],r=r[2],l=n-i[0],c=o-i[1],i=t-i[2],h=l*l+c*c+i*i,u=(0<h&&(l*=h=1/Math.sqrt(h),c*=h,i*=h),s*i-r*c),r=r*l-a*i,a=a*c-s*l;return 0<(h=u*u+r*r+a*a)&&(u*=h=1/Math.sqrt(h),r*=h,a*=h),e[0]=u,e[1]=r,e[2]=a,e[3]=0,e[4]=c*a-i*r,e[5]=i*u-l*a,e[6]=l*r-c*u,e[7]=0,e[8]=l,e[9]=c,e[10]=i,e[11]=0,e[12]=n,e[13]=o,e[14]=t,e[15]=1,e},g.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},g.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},g.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},g.subtract=Al,g.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},g.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},g.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},g.equals=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],e=e[15],_=t[0],y=t[1],v=t[2],x=t[3],b=t[4],w=t[5],T=t[6],S=t[7],A=t[8],E=t[9],C=t[10],M=t[11],I=t[12],P=t[13],L=t[14],t=t[15];return Math.abs(i-_)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-y)<=D.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-v)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=D.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-b)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-w)<=D.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-T)<=D.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-S)<=D.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-A)<=D.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(u-E)<=D.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-C)<=D.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-M)<=D.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-I)<=D.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(m-P)<=D.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-L)<=D.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(e-t)<=D.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},g.sub=g.mul=g.ortho=g.perspective=void 0;var D=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_l(e)&&"function"!=typeof e)return{default:e};var t=yl(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function yl(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(yl=function(e){return e?i:t})(e))}function vl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xl(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],t=t[15],y=i[0],v=i[1],x=i[2],b=i[3];return e[0]=y*r+v*s+x*u+b*m,e[1]=y*n+v*l+x*d+b*g,e[2]=y*o+v*c+x*p+b*_,e[3]=y*a+v*h+x*f+b*t,e[4]=(y=i[4])*r+(v=i[5])*s+(x=i[6])*u+(b=i[7])*m,e[5]=y*n+v*l+x*d+b*g,e[6]=y*o+v*c+x*p+b*_,e[7]=y*a+v*h+x*f+b*t,e[8]=(y=i[8])*r+(v=i[9])*s+(x=i[10])*u+(b=i[11])*m,e[9]=y*n+v*l+x*d+b*g,e[10]=y*o+v*c+x*p+b*_,e[11]=y*a+v*h+x*f+b*t,e[12]=(y=i[12])*r+(v=i[13])*s+(x=i[14])*u+(b=i[15])*m,e[13]=y*n+v*l+x*d+b*g,e[14]=y*o+v*c+x*p+b*_,e[15]=y*a+v*h+x*f+b*t,e}function bl(e,t,i){var r=t[0],n=t[1],o=t[2],t=t[3],a=r+r,s=n+n,l=o+o,c=r*a,h=r*s,r=r*l,u=n*s,n=n*l,o=o*l,a=t*a,s=t*s,t=t*l;return e[0]=1-(u+o),e[1]=h+t,e[2]=r-s,e[3]=0,e[4]=h-t,e[5]=1-(c+o),e[6]=n+a,e[7]=0,e[8]=r+s,e[9]=n-a,e[10]=1-(c+u),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function wl(e,t){var i=t[4],r=t[5],n=t[6],o=t[8],a=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,r,n),e[2]=Math.hypot(o,a,s),e}function Tl(e,t,i,r,n){t=1/Math.tan(t/2);return e[0]=t/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(i=1/(r-n)),e[14]=2*n*r*i):(e[10]=-1,e[14]=-2*r),e}function Sl(e,t,i,r,n,o,a){var s=1/(t-i),l=1/(r-n),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=(a+o)*c,e[15]=1,e}function Al(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}g.perspective=Tl,g.ortho=Sl,g.mul=xl,g.sub=Al;var v={},x={};function El(e){return(El="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(x,"__esModule",{value:!0}),x.create=Il,x.clone=function(e){var t=new Cl.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},x.length=Pl,x.fromValues=function(e,t,i){var r=new Cl.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=i,r},x.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},x.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},x.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},x.subtract=Ll,x.multiply=Dl,x.divide=kl,x.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},x.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},x.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},x.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},x.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},x.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},x.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},x.distance=zl,x.squaredDistance=Rl,x.squaredLength=Ol,x.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},x.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},x.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],i=i*i+r*r+n*n;return 0<i&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},x.dot=Bl,x.cross=function(e,t,i){var r=t[0],n=t[1],t=t[2],o=i[0],a=i[1],i=i[2];return e[0]=n*i-t*a,e[1]=t*o-r*i,e[2]=r*a-n*o,e},x.lerp=function(e,t,i,r){var n=t[0],o=t[1],t=t[2];return e[0]=n+r*(i[0]-n),e[1]=o+r*(i[1]-o),e[2]=t+r*(i[2]-t),e},x.hermite=function(e,t,i,r,n,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),a=a*(3-2*o);return e[0]=t[0]*s+i[0]*l+r[0]*c+n[0]*a,e[1]=t[1]*s+i[1]*l+r[1]*c+n[1]*a,e[2]=t[2]*s+i[2]*l+r[2]*c+n[2]*a,e},x.bezier=function(e,t,i,r,n,o){var a=1-o,s=a*a,l=o*o,c=s*a,s=3*o*s,a=3*l*a,l=l*o;return e[0]=t[0]*c+i[0]*s+r[0]*a+n[0]*l,e[1]=t[1]*c+i[1]*s+r[1]*a+n[1]*l,e[2]=t[2]*c+i[2]*s+r[2]*a+n[2]*l,e},x.random=function(e,t){t=t||1;var i=2*Cl.RANDOM()*Math.PI,r=2*Cl.RANDOM()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e},x.transformMat4=function(e,t,i){var r=t[0],n=t[1],t=t[2],o=i[3]*r+i[7]*n+i[11]*t+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*t+i[12])/(o=o||1),e[1]=(i[1]*r+i[5]*n+i[9]*t+i[13])/o,e[2]=(i[2]*r+i[6]*n+i[10]*t+i[14])/o,e},x.transformMat3=function(e,t,i){var r=t[0],n=t[1],t=t[2];return e[0]=r*i[0]+n*i[3]+t*i[6],e[1]=r*i[1]+n*i[4]+t*i[7],e[2]=r*i[2]+n*i[5]+t*i[8],e},x.transformQuat=function(e,t,i){var r=i[0],n=i[1],o=i[2],a=t[0],s=t[1],t=t[2],l=n*t-o*s,c=o*a-r*t,h=r*s-n*a,u=n*h-o*c,o=o*l-r*h,r=r*c-n*l,n=2*i[3];return c*=n,h*=n,o*=2,r*=2,e[0]=a+(l*=n)+(u*=2),e[1]=s+c+o,e[2]=t+h+r,e},x.rotateX=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},x.rotateY=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},x.rotateZ=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},x.angle=function(e,t){var i=e[0],r=e[1],n=e[2],o=t[0],a=t[1],s=t[2],i=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(o*o+a*a+s*s),r=i&&Bl(e,t)/i;return Math.acos(Math.min(Math.max(r,-1),1))},x.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},x.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},x.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},x.equals=function(e,t){var i=e[0],r=e[1],e=e[2],n=t[0],o=t[1],t=t[2];return Math.abs(i-n)<=Cl.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Cl.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(e-t)<=Cl.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},x.forEach=x.sqrLen=x.len=x.sqrDist=x.dist=x.div=x.mul=x.sub=void 0;var Cl=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==El(e)&&"function"!=typeof e)return{default:e};var t=Ml(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function Ml(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(Ml=function(e){return e?i:t})(e))}function Il(){var e=new Cl.ARRAY_TYPE(3);return Cl.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Pl(e){return Math.hypot(e[0],e[1],e[2])}function Ll(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Dl(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function kl(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function zl(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function Rl(e,t){var i=t[0]-e[0],r=t[1]-e[1],t=t[2]-e[2];return i*i+r*r+t*t}function Ol(e){var t=e[0],i=e[1],e=e[2];return t*t+i*i+e*e}function Bl(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}x.sub=Ll,x.mul=Dl,x.div=kl,x.dist=zl,x.sqrDist=Rl,x.len=Pl,x.sqrLen=Ol;Fl=Il();x.forEach=function(e,t,i,r,n,o){var a,s;for(t=t||3,i=i||0,s=r?Math.min(r*t+i,e.length):e.length,a=i;a<s;a+=t)Fl[0]=e[a],Fl[1]=e[a+1],Fl[2]=e[a+2],n(Fl,Fl,o),e[a]=Fl[0],e[a+1]=Fl[1],e[a+2]=Fl[2];return e};var Fl,b={};function Nl(e){return(Nl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(b,"__esModule",{value:!0}),b.create=Vl,b.clone=function(e){var t=new Ul.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},b.fromValues=function(e,t,i,r){var n=new Ul.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},b.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},b.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},b.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},b.subtract=Gl,b.multiply=ql,b.divide=Wl,b.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},b.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},b.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},b.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},b.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},b.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},b.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},b.distance=Hl,b.squaredDistance=Zl,b.length=$l,b.squaredLength=Xl,b.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},b.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},b.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=i*i+r*r+n*n+t*t;return 0<o&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=t*o,e},b.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},b.cross=function(e,t,i,r){var n=i[0]*r[1]-i[1]*r[0],o=i[0]*r[2]-i[2]*r[0],a=i[0]*r[3]-i[3]*r[0],s=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],i=i[2]*r[3]-i[3]*r[2],r=t[0],c=t[1],h=t[2],t=t[3];return e[0]=c*i-h*l+t*s,e[1]=-r*i+h*a-t*o,e[2]=r*l-c*a+t*n,e[3]=-r*s+c*o-h*n,e},b.lerp=function(e,t,i,r){var n=t[0],o=t[1],a=t[2],t=t[3];return e[0]=n+r*(i[0]-n),e[1]=o+r*(i[1]-o),e[2]=a+r*(i[2]-a),e[3]=t+r*(i[3]-t),e},b.random=function(e,t){var i,r,n,o,a,s;for(t=t||1;1<=(a=(i=2*Ul.RANDOM()-1)*i+(r=2*Ul.RANDOM()-1)*r););for(;1<=(s=(n=2*Ul.RANDOM()-1)*n+(o=2*Ul.RANDOM()-1)*o););var l=Math.sqrt((1-a)/s);return e[0]=t*i,e[1]=t*r,e[2]=t*n*l,e[3]=t*o*l,e},b.transformMat4=function(e,t,i){var r=t[0],n=t[1],o=t[2],t=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*t,e[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*t,e[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*t,e[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*t,e},b.transformQuat=function(e,t,i){var r=t[0],n=t[1],o=t[2],a=i[0],s=i[1],l=i[2],i=i[3],c=i*r+s*o-l*n,h=i*n+l*r-a*o,u=i*o+a*n-s*r,r=-a*r-s*n-l*o;return e[0]=c*i+r*-a+h*-l-u*-s,e[1]=h*i+r*-s+u*-a-c*-l,e[2]=u*i+r*-l+c*-s-h*-a,e[3]=t[3],e},b.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},b.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},b.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},b.equals=function(e,t){var i=e[0],r=e[1],n=e[2],e=e[3],o=t[0],a=t[1],s=t[2],t=t[3];return Math.abs(i-o)<=Ul.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ul.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=Ul.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(e-t)<=Ul.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},b.forEach=b.sqrLen=b.len=b.sqrDist=b.dist=b.div=b.mul=b.sub=void 0;var Ul=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Nl(e)&&"function"!=typeof e)return{default:e};var t=jl(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function jl(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(jl=function(e){return e?i:t})(e))}function Vl(){var e=new Ul.ARRAY_TYPE(4);return Ul.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Gl(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function ql(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function Wl(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function Hl(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function Zl(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],t=t[3]-e[3];return i*i+r*r+n*n+t*t}function $l(e){return Math.hypot(e[0],e[1],e[2],e[3])}function Xl(e){var t=e[0],i=e[1],r=e[2],e=e[3];return t*t+i*i+r*r+e*e}b.sub=Gl,b.mul=ql,b.div=Wl,b.dist=Hl,b.sqrDist=Zl,b.len=$l,b.sqrLen=Xl;function Yl(e,t,i,r,n,o){var a,s;for(t=t||4,i=i||0,s=r?Math.min(r*t+i,e.length):e.length,a=i;a<s;a+=t)Kl[0]=e[a],Kl[1]=e[a+1],Kl[2]=e[a+2],Kl[3]=e[a+3],n(Kl,Kl,o),e[a]=Kl[0],e[a+1]=Kl[1],e[a+2]=Kl[2],e[a+3]=Kl[3];return e}var Kl;Kl=Vl();function Jl(e){return(Jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}b.forEach=Yl,Object.defineProperty(v,"__esModule",{value:!0}),v.create=rc,v.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},v.setAxisAngle=nc,v.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Ql.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i},v.getAngle=function(e,t){e=uc(e,t);return Math.acos(2*e*e-1)},v.multiply=oc,v.rotateX=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],t=t[3],a=Math.sin(i),i=Math.cos(i);return e[0]=r*i+t*a,e[1]=n*i+o*a,e[2]=o*i-n*a,e[3]=t*i-r*a,e},v.rotateY=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],t=t[3],a=Math.sin(i),i=Math.cos(i);return e[0]=r*i-o*a,e[1]=n*i+t*a,e[2]=o*i+r*a,e[3]=t*i-n*a,e},v.rotateZ=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],t=t[3],a=Math.sin(i),i=Math.cos(i);return e[0]=r*i+n*a,e[1]=n*i-r*a,e[2]=o*i+t*a,e[3]=t*i-o*a,e},v.calculateW=function(e,t){var i=t[0],r=t[1],t=t[2];return e[0]=i,e[1]=r,e[2]=t,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-t*t)),e},v.exp=ac,v.ln=sc,v.pow=function(e,t,i){return sc(e,t),hc(e,e,i),ac(e,e),e},v.slerp=lc,v.random=function(e){var t=Ql.RANDOM(),i=Ql.RANDOM(),r=Ql.RANDOM(),n=Math.sqrt(1-t),t=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=t*Math.sin(2*Math.PI*r),e[3]=t*Math.cos(2*Math.PI*r),e},v.invert=function(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=i*i+r*r+n*n+t*t,o=o?1/o:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=t*o,e},v.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},v.fromMat3=cc,v.fromEuler=function(e,t,i,r){var n=.5*Math.PI/180,n=(t*=n,i*=n,r*=n,Math.sin(t)),t=Math.cos(t),o=Math.sin(i),i=Math.cos(i),a=Math.sin(r),r=Math.cos(r);return e[0]=n*i*r-t*o*a,e[1]=t*o*r+n*i*a,e[2]=t*i*a-n*o*r,e[3]=t*i*r+n*o*a,e},v.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},v.setAxes=v.sqlerp=v.rotationTo=v.equals=v.exactEquals=v.normalize=v.sqrLen=v.squaredLength=v.len=v.length=v.lerp=v.dot=v.scale=v.mul=v.add=v.set=v.copy=v.fromValues=v.clone=void 0;var Ql=ic(Js),w=ic(e),ec=ic(x),T=ic(b);function tc(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(tc=function(e){return e?i:t})(e))}function ic(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Jl(e)&&"function"!=typeof e)return{default:e};t=tc(t);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}function rc(){var e=new Ql.ARRAY_TYPE(4);return Ql.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function nc(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function oc(e,t,i){var r=t[0],n=t[1],o=t[2],t=t[3],a=i[0],s=i[1],l=i[2],i=i[3];return e[0]=r*i+t*a+n*l-o*s,e[1]=n*i+t*s+o*a-r*l,e[2]=o*i+t*l+r*s-n*a,e[3]=t*i-r*a-n*s-o*l,e}function ac(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=Math.sqrt(i*i+r*r+n*n),t=Math.exp(t),a=0<o?t*Math.sin(o)/o:0;return e[0]=i*a,e[1]=r*a,e[2]=n*a,e[3]=t*Math.cos(o),e}function sc(e,t){var i=t[0],r=t[1],n=t[2],t=t[3],o=Math.sqrt(i*i+r*r+n*n),o=0<o?Math.atan2(o,t)/o:0;return e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=.5*Math.log(i*i+r*r+n*n+t*t),e}function lc(e,t,i,r){var n,o,a,s=t[0],l=t[1],c=t[2],t=t[3],h=i[0],u=i[1],d=i[2],i=i[3];return(a=s*h+l*u+c*d+t*i)<0&&(a=-a,h=-h,u=-u,d=-d,i=-i),a=1-a>Ql.EPSILON?(a=Math.acos(a),n=Math.sin(a),o=Math.sin((1-r)*a)/n,Math.sin(r*a)/n):(o=1-r,r),e[0]=o*s+a*h,e[1]=o*l+a*u,e[2]=o*c+a*d,e[3]=o*t+a*i,e}function cc(e,t){var i,r,n,o=t[0]+t[4]+t[8];return 0<o?(n=Math.sqrt(o+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n):(t[4]>t[o=0]&&(o=1),i=((o=t[8]>t[3*o+o]?2:o)+1)%3,r=(o+2)%3,n=Math.sqrt(t[3*o+o]-t[3*i+i]-t[3*r+r]+1),e[o]=.5*n,e[3]=(t[3*i+r]-t[3*r+i])*(n=.5/n),e[i]=(t[3*i+o]+t[3*o+i])*n,e[r]=(t[3*r+o]+t[3*o+r])*n),e}v.clone=T.clone,v.fromValues=T.fromValues,v.copy=T.copy,v.set=T.set,v.add=T.add,v.mul=oc;var hc=T.scale,uc=(v.scale=hc,T.dot),C=(v.dot=uc,v.lerp=T.lerp,T.length),C=(v.length=C,v.len=C,T.squaredLength),dc=(v.squaredLength=C,v.sqrLen=C,T.normalize);v.normalize=dc,v.exactEquals=T.exactEquals,v.equals=T.equals;var pc,fc,mc;pc=ec.create(),fc=ec.fromValues(1,0,0),mc=ec.fromValues(0,1,0);v.rotationTo=function(e,t,i){var r=ec.dot(t,i);return r<-.999999?(ec.cross(pc,fc,t),ec.len(pc)<1e-6&&ec.cross(pc,mc,t),ec.normalize(pc,pc),nc(e,pc,Math.PI),e):.999999<r?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ec.cross(pc,t,i),e[0]=pc[0],e[1]=pc[1],e[2]=pc[2],e[3]=1+r,dc(e,e))};var gc,_c;gc=rc(),_c=rc();v.sqlerp=function(e,t,i,r,n,o){return lc(gc,t,n,o),lc(_c,i,r,o),lc(e,gc,_c,2*o*(1-o)),e};yc=w.create();v.setAxes=function(e,t,i,r){return yc[0]=i[0],yc[3]=i[1],yc[6]=i[2],yc[1]=r[0],yc[4]=r[1],yc[7]=r[2],yc[2]=-t[0],yc[5]=-t[1],yc[8]=-t[2],dc(e,cc(e,yc))};var yc,C={};function vc(e){return(vc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(C,"__esModule",{value:!0}),C.create=function(){var e=new xc.ARRAY_TYPE(8);return xc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},C.clone=function(e){var t=new xc.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},C.fromValues=function(e,t,i,r,n,o,a,s){var l=new xc.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=i,l[3]=r,l[4]=n,l[5]=o,l[6]=a,l[7]=s,l},C.fromRotationTranslationValues=function(e,t,i,r,n,o,a){var s=new xc.ARRAY_TYPE(8),n=(s[0]=e,s[1]=t,s[2]=i,s[3]=r,.5*n),o=.5*o,a=.5*a;return s[4]=n*r+o*i-a*t,s[5]=o*r+a*e-n*i,s[6]=a*r+n*t-o*e,s[7]=-n*e-o*t-a*i,s},C.fromRotationTranslation=Ac,C.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},C.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},C.fromMat4=function(e,t){var i=bc.create(),r=(wc.getRotation(i,t),new xc.ARRAY_TYPE(3));return wc.getTranslation(r,t),Ac(e,i,r),e},C.copy=Ec,C.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},C.set=function(e,t,i,r,n,o,a,s,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e},C.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},C.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},C.getTranslation=function(e,t){var i=t[4],r=t[5],n=t[6],o=t[7],a=-t[0],s=-t[1],l=-t[2],t=t[3];return e[0]=2*(i*t+o*a+r*l-n*s),e[1]=2*(r*t+o*s+n*a-i*l),e[2]=2*(n*t+o*l+i*s-r*a),e},C.translate=function(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=.5*i[0],l=.5*i[1],i=.5*i[2],c=t[4],h=t[5],u=t[6],t=t[7];return e[0]=r,e[1]=n,e[2]=o,e[3]=a,e[4]=a*s+n*i-o*l+c,e[5]=a*l+o*s-r*i+h,e[6]=a*i+r*l-n*s+u,e[7]=-r*s-n*l-o*i+t,e},C.rotateX=function(e,t,i){var r=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*a+h*r+l*o-c*n,d=l*a+h*n+c*r-s*o,p=c*a+h*o+s*n-l*r,h=h*a-s*r-l*n-c*o;return bc.rotateX(e,t,i),e[4]=u*(a=e[3])+h*(r=e[0])+d*(o=e[2])-p*(n=e[1]),e[5]=d*a+h*n+p*r-u*o,e[6]=p*a+h*o+u*n-d*r,e[7]=h*a-u*r-d*n-p*o,e},C.rotateY=function(e,t,i){var r=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*a+h*r+l*o-c*n,d=l*a+h*n+c*r-s*o,p=c*a+h*o+s*n-l*r,h=h*a-s*r-l*n-c*o;return bc.rotateY(e,t,i),e[4]=u*(a=e[3])+h*(r=e[0])+d*(o=e[2])-p*(n=e[1]),e[5]=d*a+h*n+p*r-u*o,e[6]=p*a+h*o+u*n-d*r,e[7]=h*a-u*r-d*n-p*o,e},C.rotateZ=function(e,t,i){var r=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*a+h*r+l*o-c*n,d=l*a+h*n+c*r-s*o,p=c*a+h*o+s*n-l*r,h=h*a-s*r-l*n-c*o;return bc.rotateZ(e,t,i),e[4]=u*(a=e[3])+h*(r=e[0])+d*(o=e[2])-p*(n=e[1]),e[5]=d*a+h*n+p*r-u*o,e[6]=p*a+h*o+u*n-d*r,e[7]=h*a-u*r-d*n-p*o,e},C.rotateByQuatAppend=function(e,t,i){var r=i[0],n=i[1],o=i[2],i=i[3],a=t[0],s=t[1],l=t[2],c=t[3];return e[0]=a*i+c*r+s*o-l*n,e[1]=s*i+c*n+l*r-a*o,e[2]=l*i+c*o+a*n-s*r,e[3]=c*i-a*r-s*n-l*o,e[4]=(a=t[4])*i+(c=t[7])*r+(s=t[5])*o-(l=t[6])*n,e[5]=s*i+c*n+l*r-a*o,e[6]=l*i+c*o+a*n-s*r,e[7]=c*i-a*r-s*n-l*o,e},C.rotateByQuatPrepend=function(e,t,i){var r=t[0],n=t[1],o=t[2],t=t[3],a=i[0],s=i[1],l=i[2],c=i[3];return e[0]=r*c+t*a+n*l-o*s,e[1]=n*c+t*s+o*a-r*l,e[2]=o*c+t*l+r*s-n*a,e[3]=t*c-r*a-n*s-o*l,e[4]=r*(c=i[7])+t*(a=i[4])+n*(l=i[6])-o*(s=i[5]),e[5]=n*c+t*s+o*a-r*l,e[6]=o*c+t*l+r*s-n*a,e[7]=t*c-r*a-n*s-o*l,e},C.rotateAroundAxis=function(e,t,i,r){var n,o,a,s,l,c;return Math.abs(r)<xc.EPSILON?Ec(e,t):(l=Math.hypot(i[0],i[1],i[2]),r*=.5,n=(a=Math.sin(r))*i[0]/l,o=a*i[1]/l,a=a*i[2]/l,i=Math.cos(r),l=t[0],r=t[1],c=t[2],s=t[3],e[0]=l*i+s*n+r*a-c*o,e[1]=r*i+s*o+c*n-l*a,e[2]=c*i+s*a+l*o-r*n,e[3]=s*i-l*n-r*o-c*a,s=t[4],l=t[5],r=t[6],c=t[7],e[4]=s*i+c*n+l*a-r*o,e[5]=l*i+c*o+r*n-s*a,e[6]=r*i+c*a+s*o-l*n,e[7]=c*i-s*n-l*o-r*a,e)},C.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},C.multiply=Cc,C.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},C.lerp=function(e,t,i,r){var n=1-r;return Mc(t,i)<0&&(r=-r),e[0]=t[0]*n+i[0]*r,e[1]=t[1]*n+i[1]*r,e[2]=t[2]*n+i[2]*r,e[3]=t[3]*n+i[3]*r,e[4]=t[4]*n+i[4]*r,e[5]=t[5]*n+i[5]*r,e[6]=t[6]*n+i[6]*r,e[7]=t[7]*n+i[7]*r,e},C.invert=function(e,t){var i=Ic(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},C.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},C.normalize=function(e,t){var i,r,n,o,a,s,l,c,h=Ic(t);return 0<h&&(h=Math.sqrt(h),i=t[0]/h,r=t[1]/h,n=t[2]/h,o=t[3]/h,c=i*(a=t[4])+r*(s=t[5])+n*(l=t[6])+o*(t=t[7]),e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=(a-i*c)/h,e[5]=(s-r*c)/h,e[6]=(l-n*c)/h,e[7]=(t-o*c)/h),e},C.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},C.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},C.equals=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],e=e[7],c=t[0],h=t[1],u=t[2],d=t[3],p=t[4],f=t[5],m=t[6],t=t[7];return Math.abs(i-c)<=xc.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-h)<=xc.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-u)<=xc.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-d)<=xc.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=xc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-f)<=xc.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-m)<=xc.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(e-t)<=xc.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},C.sqrLen=C.squaredLength=C.len=C.length=C.dot=C.mul=C.setReal=C.getReal=void 0;var xc=Sc(Js),bc=Sc(v),wc=Sc(g);function Tc(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(Tc=function(e){return e?i:t})(e))}function Sc(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==vc(e)&&"function"!=typeof e)return{default:e};t=Tc(t);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}function Ac(e,t,i){var r=.5*i[0],n=.5*i[1],i=.5*i[2],o=t[0],a=t[1],s=t[2],t=t[3];return e[0]=o,e[1]=a,e[2]=s,e[3]=t,e[4]=r*t+n*s-i*a,e[5]=n*t+i*o-r*s,e[6]=i*t+r*a-n*o,e[7]=-r*o-n*a-i*s,e}function Ec(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Cc(e,t,i){var r=t[0],n=t[1],o=t[2],a=t[3],s=i[4],l=i[5],c=i[6],h=i[7],u=t[4],d=t[5],p=t[6],t=t[7],f=i[0],m=i[1],g=i[2],i=i[3];return e[0]=r*i+a*f+n*g-o*m,e[1]=n*i+a*m+o*f-r*g,e[2]=o*i+a*g+r*m-n*f,e[3]=a*i-r*f-n*m-o*g,e[4]=r*h+a*s+n*c-o*l+u*i+t*f+d*g-p*m,e[5]=n*h+a*l+o*s-r*c+d*i+t*m+p*f-u*g,e[6]=o*h+a*c+r*l-n*s+p*i+t*g+u*m-d*f,e[7]=a*h-r*s-n*l-o*c+t*i-u*f-d*m-p*g,e}C.getReal=bc.copy,C.setReal=bc.copy,C.mul=Cc;var Mc=bc.dot,T=(C.dot=Mc,bc.length),Ic=(C.length=T,C.len=T,bc.squaredLength),w=(C.squaredLength=Ic,C.sqrLen=Ic,{});function Pc(e){return(Pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(w,"__esModule",{value:!0}),w.create=kc,w.clone=function(e){var t=new Lc.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},w.fromValues=function(e,t){var i=new Lc.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},w.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},w.set=function(e,t,i){return e[0]=t,e[1]=i,e},w.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},w.subtract=zc,w.multiply=Rc,w.divide=Oc,w.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},w.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},w.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},w.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},w.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},w.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},w.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},w.distance=Bc,w.squaredDistance=Fc,w.length=Nc,w.squaredLength=Uc,w.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},w.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},w.normalize=function(e,t){var i=t[0],r=t[1],i=i*i+r*r;return 0<i&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},w.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},w.cross=function(e,t,i){t=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=t,e},w.lerp=function(e,t,i,r){var n=t[0],t=t[1];return e[0]=n+r*(i[0]-n),e[1]=t+r*(i[1]-t),e},w.random=function(e,t){t=t||1;var i=2*Lc.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},w.transformMat2=function(e,t,i){var r=t[0],t=t[1];return e[0]=i[0]*r+i[2]*t,e[1]=i[1]*r+i[3]*t,e},w.transformMat2d=function(e,t,i){var r=t[0],t=t[1];return e[0]=i[0]*r+i[2]*t+i[4],e[1]=i[1]*r+i[3]*t+i[5],e},w.transformMat3=function(e,t,i){var r=t[0],t=t[1];return e[0]=i[0]*r+i[3]*t+i[6],e[1]=i[1]*r+i[4]*t+i[7],e},w.transformMat4=function(e,t,i){var r=t[0],t=t[1];return e[0]=i[0]*r+i[4]*t+i[12],e[1]=i[1]*r+i[5]*t+i[13],e},w.rotate=function(e,t,i,r){var n=t[0]-i[0],t=t[1]-i[1],o=Math.sin(r),r=Math.cos(r);return e[0]=n*r-t*o+i[0],e[1]=n*o+t*r+i[1],e},w.angle=function(e,t){var i=e[0],e=e[1],r=t[0],t=t[1],n=Math.sqrt(i*i+e*e)*Math.sqrt(r*r+t*t);return Math.acos(Math.min(Math.max(n&&(i*r+e*t)/n,-1),1))},w.zero=function(e){return e[0]=0,e[1]=0,e},w.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},w.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},w.equals=function(e,t){var i=e[0],e=e[1],r=t[0],t=t[1];return Math.abs(i-r)<=Lc.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(e-t)<=Lc.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},w.forEach=w.sqrLen=w.sqrDist=w.dist=w.div=w.mul=w.sub=w.len=void 0;var Lc=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Pc(e)&&"function"!=typeof e)return{default:e};var t=Dc(void 0);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}(Js);function Dc(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(Dc=function(e){return e?i:t})(e))}function kc(){var e=new Lc.ARRAY_TYPE(2);return Lc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function zc(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function Rc(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function Oc(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function Bc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function Fc(e,t){var i=t[0]-e[0],t=t[1]-e[1];return i*i+t*t}function Nc(e){return Math.hypot(e[0],e[1])}function Uc(e){var t=e[0],e=e[1];return t*t+e*e}w.len=Nc,w.sub=zc,w.mul=Rc,w.div=Oc,w.dist=Bc,w.sqrDist=Fc,w.sqrLen=Uc;function jc(e,t,i,r,n,o){var a,s;for(t=t||2,i=i||0,s=r?Math.min(r*t+i,e.length):e.length,a=i;a<s;a+=t)Vc[0]=e[a],Vc[1]=e[a+1],n(Vc,Vc,o),e[a]=Vc[0],e[a+1]=Vc[1];return e}var Vc;Vc=kc();function Gc(e){return(Gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}w.forEach=jc,Object.defineProperty(i,"__esModule",{value:!0}),Te.a7=i.vec4=Te.N=i.vec3=i.vec2=i.quat2=Te.bi=i.quat=Te.a6=i.mat4=Te.co=i.mat3=i.mat2d=Te.b4=i.mat2=i.glMatrix=void 0;T=Wc(Js),i.glMatrix=T,T=Wc(r),Te.b4=i.mat2=T,r=Wc(t),i.mat2d=r,T=Wc(e),Te.co=i.mat3=T,t=Wc(g),Te.a6=i.mat4=t,r=Wc(v),Te.bi=i.quat=r,e=Wc(C),i.quat2=e,T=Wc(w),i.vec2=T,g=Wc(x),Te.N=i.vec3=g,t=Wc(b);function qc(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(qc=function(e){return e?i:t})(e))}function Wc(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Gc(e)&&"function"!=typeof e)return{default:e};t=qc(t);if(t&&t.has(e))return t.get(e);var i,r,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((r=o?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]);return n.default=e,t&&t.set(e,n),n}Te.a7=i.vec4=t;class Hc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){var r=Te.N.dot(t,this.dir);return!(Math.abs(r)<1e-6||(e=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/r,i[0]=this.pos[0]+this.dir[0]*e,i[1]=this.pos[1]+this.dir[1]*e,i[2]=this.pos[2]+this.dir[2]*e,0))}closestPointOnSphere(e,t,i){if(Te.N.equals(this.pos,e)||0===t)return i[0]=i[1]=i[2]=0,!1;const[r,n,o]=this.dir,a=this.pos[0]-e[0],s=this.pos[1]-e[1],l=this.pos[2]-e[2],c=r*r+n*n+o*o,h=2*(a*r+s*n+l*o),u=h*h-4*c*(a*a+s*s+l*l-t*t);if(u<0){const Te=Math.max(-h/2,0),e=a+r*Te,c=s+n*Te,u=l+o*Te,d=Math.hypot(e,c,u);return i[0]=e*t/d,i[1]=c*t/d,i[2]=u*t/d,!1}{const Te=(-h-Math.sqrt(u))/(2*c);if(Te<0){const Te=Math.hypot(a,s,l);return i[0]=a*t/Te,i[1]=s*t/Te,i[2]=l*t/Te,!1}return i[0]=a+r*Te,i[1]=s+n*Te,i[2]=l+o*Te,!0}}}function Zc(e,t,i){let r=1/0,n=-1/0;var o=[];for(const a of e){Te.N.sub(o,a,t);const e=Te.N.dot(o,i);r=Math.min(r,e),n=Math.max(n,e)}return[r,n]}function $c(i,r){let n=!0;for(let e=0;e<i.planes.length;e++){var o=i.planes[e];let t=0;for(let e=0;e<r.length;e++)t+=0<=Te.N.dot(o,r[e])+o[3];if(0===t)return 0;t!==r.length&&(n=!1)}return n?2:1}function Xc(e,t){for(const r of e.projections){var i=Zc(t,e.points[0],r.axis);if(r.projection[1]<i[0]||r.projection[0]>i[1])return 0}return 1}function Yc(t,i){let r=0;var n=[0,0,0,0];for(let e=0;e<t.length;e++)n[0]=t[e][0],n[1]=t[e][1],n[2]=t[e][2],n[3]=1,0<=Te.a7.dot(n,i)&&r++;return r}class M{static fromPoints(e){var t=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const r of e)Te.N.min(t,t,r),Te.N.max(i,i,r);return new M(t,i)}static fromTileIdAndHeight(e,t,i){var r=1<<e.canonical.z,n=e.canonical.x,e=e.canonical.y;return new M([n/r,e/r,t],[(n+1)/r,(e+1)/r,i])}static applyTransform(e,t){var i=e.getCorners();for(let e=0;e<i.length;++e)Te.N.transformMat4(i[e],i[e],t);return M.fromPoints(i)}static projectAabbCorners(e,t){var i=e.getCorners();for(let e=0;e<i.length;++e)Te.N.transformMat4(i[e],i[e],t);return i}constructor(e,t){this.min=e,this.max=t,this.center=Te.N.scale([],Te.N.add([],this.min,this.max),.5)}quadrant(e){var t=[e%2==0,e<2],i=Te.N.clone(this.min),r=Te.N.clone(this.max);for(let e=0;e<t.length;e++)i[e]=(t[e]?this.min:this.center)[e],r[e]=(t[e]?this.center:this.max)[e];return r[2]=this.max[2],new M(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){var e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?$c(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?$c(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Xc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Xc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}n(M,"Aabb");const Kc=m([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),Jc=Kc["members"],Qc=m([{name:"a_pos_3",components:3,type:"Int16"}]);var eh=m([{name:"a_pos",type:"Int16",components:2}]);function th(e){return e*Xa/ns}const ih=[new M([es,es,es],[ts,ts,ts]),new M([es,es,es],[0,0,ts]),new M([0,es,es],[ts,0,ts]),new M([es,0,es],[0,ts,ts]),new M([0,0,es],[ts,ts,ts])];function rh(e,t,i,r=!0){var n=Te.N.scale([],e._camera.position,e.worldSize),t=[t,i,1,1],i=(Te.a7.transformMat4(t,t,e.pixelMatrixInverse),Te.a7.scale(t,t,1/t[3]),Te.N.sub([],t,n)),i=Te.N.normalize([],i),t=e.globeMatrix,o=[t[12],t[13],t[14]],a=Te.N.sub([],o,n),s=Te.N.length(a),l=Te.N.normalize([],a),c=e.worldSize/(2*Math.PI),l=Te.N.dot(l,i),h=Math.asin(c/s);if(h<Math.acos(l)){if(!r)return null;const e=[],t=[];Te.N.scale(e,i,s/l),Te.N.normalize(t,Te.N.sub(t,e,a)),Te.N.normalize(i,Te.N.add(i,a,Te.N.scale(i,t,Math.tan(h)*s)))}var r=[],l=(new Hc(n,i).closestPointOnSphere(o,c,r),Te.N.normalize([],Le(t,0))),a=Te.N.normalize([],Le(t,1)),h=Te.N.normalize([],Le(t,2)),s=Te.N.dot(l,r),n=Te.N.dot(a,r),i=Te.N.dot(h,r),o=Y(Math.asin(-n/c)),u=Y(Math.atan2(s,i)),t=_s(e.center.lng+function(e){e=(u-e+180)%360-180;return e<-180?360+e:e}(e.center.lng)),l=S(ys(o),0,1);return new Cs(t,l)}class nh{constructor(e,t,i){this.a=Te.N.sub([],e,i),this.b=Te.N.sub([],t,i),this.center=i;e=Te.N.normalize([],this.a),t=Te.N.normalize([],this.b);this.angle=Math.acos(Te.N.dot(e,t))}}function oh(e,t){var i,r,n,o,a;return 0===e.angle||(o=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)))<0||1<o?null:(i=e.a[t],r=e.b[t],n=e.angle,o=S(o,0,1),a=Math.sin(n),i*(Math.sin((1-o)*n)/a)+r*(Math.sin(o*n)/a)+e.center[t])}function ah(e){return e.z<=1?ih[e.z+2*e.y+e.x]:(e=uh(hh(e)),M.fromPoints(e))}function sh(e,t,i){return Te.N.scale(e,e,1-i),Te.N.scaleAndAdd(e,e,t,i)}function lh(e,t,i){for(const r of e)Te.N.transformMat4(r,r,t),Te.N.scale(r,r,i)}function ch(i,r,n,o){const a=r/i.worldSize,s=i.globeMatrix;if(n.z<=1){const Te=ah(n).getCorners();return lh(Te,s,a),M.fromPoints(Te)}var o=hh(n,o),l=uh(o,Xa+th(i._tileCoverLift)),c=(lh(l,s,a),Number.MAX_VALUE),h=[-c,-c,-c],u=[c,c,c];if(o.contains(i.center)){for(const i of l)Te.N.min(u,u,i),Te.N.max(h,h,i);h[2]=0;const r=i.point,n=[r.x*a,r.y*a,0];Te.N.min(u,u,n),Te.N.max(h,h,n)}else if(0<i._tileCoverLift)for(const i of l)Te.N.min(u,u,i),Te.N.max(h,h,i);else{var c=[s[12]*a,s[13]*a,s[14]*a],d=o.getCenter(),p=S(i.center.lat,-y,y),f=S(d.lat,-y,y),m=_s(i.center.lng),p=ys(p);let e=m-_s(d.lng);d=p-ys(f);.5<e?--e:e<-.5&&(e+=1);let t=0;if(Math.abs(e)>Math.abs(d))t=0<=e?1:3;else{t=0<=d?0:2;const i=[s[4]*a,s[5]*a,s[6]*a],r=-Math.sin(_(0<=d?o.getSouth():o.getNorth()))*Xa;Te.N.scaleAndAdd(c,c,i,r)}var f=l[t],d=l[(t+1)%4],o=new nh(f,d,c),c=[oh(o,0)||f[0],oh(o,1)||f[1],oh(o,2)||f[2]],g=xh(i.zoom);if(0<g){const o=function({x:e,y:t,z:i},r,n,o,a){i=1/(1<<i);let s=e*i,l=s+i,c=t*i,h=c+i,u=0;e=(s+l)/2-o;return.5<e?u=-1:e<-.5&&(u=1),c=(c*r-(a*=r))*n+a,[[s=((s+u)*r-(o*=r))*n+o,h=(h*r-a)*n+a,0],[l=((l+u)*r-o)*n+o,h,0],[l,c,0],[s,c,0]]}(n,r,i._pixelsPerMercatorPixel,m,p);for(let e=0;e<l.length;e++)sh(l[e],o[e],g);const a=Te.N.add([],o[t],o[(t+1)%4]);Te.N.scale(a,a,.5),sh(c,a,g)}for(const i of l)Te.N.min(u,u,i),Te.N.max(h,h,i);u[2]=Math.min(f[2],d[2]),Te.N.min(u,u,c),Te.N.max(h,h,c)}return new M(u,h)}function hh({x:e,y:t,z:i},r=!1){var n=1/(1<<i),i=new E(xs(e*n),t===(1<<i)-1&&r?-90:bs((t+1)*n)),e=new E(xs((e+1)*n),0===t&&r?90:bs(t*n));return new as(i,e)}function uh(e,t=Xa){var i=_(e.getNorth()),r=_(e.getSouth()),n=Math.cos(i),o=Math.cos(r),i=Math.sin(i),r=Math.sin(r),a=e.getWest(),e=e.getEast();return[is(o,r,a,t),is(o,r,e,t),is(n,i,e,t),is(n,i,a,t)]}function dh(e,t,i,r){var n=1<<i.z,e=(e/ue+i.x)/n;return rs(bs((t/ue+i.y)/n),xs(e),r)}function ph({min:e,max:t}){return Ja/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const fh=new Float64Array(16);function mh(e){var t=ph(e),t=Te.a6.fromScaling(fh,[t,t,t]);return Te.a6.translate(t,t,Te.N.negate([],e.min))}function gh(e){var t=Te.a6.fromTranslation(fh,e.min),e=1/ph(e);return Te.a6.scale(t,t,[e,e,e])}function _h(e){var t=ue/(2*Math.PI);return e/(2*Math.PI)/t}function yh(e,t){return ue/(512*Math.pow(2,e))*ph(ah(t))}function vh(e,t,i,r,n){var o=_h(i),e=[e,t,-i/(2*Math.PI)],t=Te.a6.identity(new Float64Array(16));return Te.a6.translate(t,t,e),Te.a6.scale(t,t,[o,o,o]),Te.a6.rotateX(t,t,_(-n)),Te.a6.rotateY(t,t,_(-r)),t}function xh(e){return te(Ya,Ka,e)}function bh(e,t){var i,r,t=rs(t.lat,t.lng),e=(i=rs((e=e)._center.lat,e._center.lng),r=Te.N.fromValues(0,1,0),r=Te.N.cross([],r,i),n=Te.a6.fromRotation([],-e.angle,i),r=Te.N.transformMat4(r,r,n),Te.a6.fromRotation(n,-e._pitch,r),r=Te.N.normalize([],i),Te.N.scale(r,r,th(e.cameraToCenterDistance/e.pixelsPerMeter)),Te.N.transformMat4(r,r,n),Te.N.add([],i,r)),n=Te.N.subtract([],e,t);return Te.N.angle(n,t)}function wh(e,t){return bh(e,t)>Math.PI/2*1.01}const Th=85*$,Sh=Math.cos(Th),Ah=Math.sin(Th),Eh=Te.a6.create(),Ch=e=>{var t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Mh(e,t,i,r,n,o,a,s,l){if(!o||!e.queryGeometry.isAboveHorizon){o&&(l*=e.pixelToTileUnitsFactor);var c=e.tileID.canonical,h=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const f of t)for(const t of f){const m=t.add(s),g=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(m.x,m.y,!0):0,_=i.projection.projectTilePoint(m.x,m.y,c);if(0<g){const Te=i.projection.upVector(c,m.x,m.y);_.x+=Te[0]*h*g,_.y+=Te[1]*h*g,_.z+=Te[2]*h*g}var u=o?m:function(e,t,i,r){e=Te.a7.transformMat4([],[e,t,i,1],r);return new U(e[0]/e[3],e[1]/e[3])}(_.x,_.y,_.z,r),d=o?e.tilespaceRays.map(e=>{return e=e,t=g,i=Te.N.create(),Ih[2]=t,e.intersectsPlane(Ih,Ph,i),new U(i[0],i[1]);var t,i}):e.queryGeometry.screenGeometry,p=Te.a7.transformMat4([],[_.x,_.y,_.z,1],r);if(!a&&o?l*=p[3]/i.cameraToCenterDistance:a&&!o&&(l*=i.cameraToCenterDistance/p[3]),o){const Te=bs((t.y/ue+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(Te,1)/vs(1,Te)}if(p=l,Gs(d=d,u=u)||Us(u,d,p))return!0}}return!1}const Ih=Te.N.fromValues(0,0,0),Ph=Te.N.fromValues(0,0,1);class Lh extends Os{}function Dh(e,{width:t,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*i*r);e.width=t,e.height=i,e.data=n}function kh(e,t,i){var{width:r,height:n}=t;r===e.width&&n===e.height||(zh(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,n)},i),e.width=r,e.height=n,e.data=t.data)}function zh(t,i,r,n,o,a,e){if(0!==o.width&&0!==o.height){if(o.width>t.width||o.height>t.height||r.x>t.width-o.width||r.y>t.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>i.width||o.height>i.height||n.x>i.width-o.width||n.y>i.height-o.height)throw new RangeError("out of range destination coordinates for image copy");var s=t.data,l=i.data,c=4===a&&e;for(let e=0;e<o.height;e++){var h=((r.y+e)*t.width+r.x)*a,u=((n.y+e)*i.width+n.x)*a;if(c)for(let e=0;e<o.width;e++){const i=h+e*a+3,r=u+e*a;l[r]=255,l[1+r]=255,l[2+r]=255,l[3+r]=s[i]}else for(let e=0;e<o.width*a;e++)l[u+e]=s[h+e]}}}n(Lh,"HeatmapBucket",{omit:["layers"]});class Rh{constructor(e,t){Dh(this,e,1,t)}resize(e){kh(this,new Rh(e),1)}clone(){return new Rh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){zh(e,t,i,r,n,1)}}class Oh{constructor(e,t){Dh(this,e,4,t)}resize(e){kh(this,new Oh(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n,o){zh(e,t,i,r,n,4,o)}}class Bh{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}n(Rh,"AlphaImage"),n(Oh,"RGBAImage");var v=new d({visibility:new a(p.layout_heatmap.visibility)}),Fh={paint:new d({"heatmap-radius":new s(p.paint_heatmap["heatmap-radius"]),"heatmap-weight":new s(p.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new a(p.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ao(p.paint_heatmap["heatmap-color"]),"heatmap-opacity":new a(p.paint_heatmap["heatmap-opacity"])}),layout:v};function Nh(n){const r={},o=n.resolution||256,e=n.clips?n.clips.length:1,a=n.image||new Oh({width:o,height:e}),s=(e,t,i)=>{r[n.evaluationKey]=i;i=n.expression.evaluate(r);i&&(a.data[e+t+0]=Math.floor(255*i.r/i.a),a.data[e+t+1]=Math.floor(255*i.g/i.a),a.data[e+t+2]=Math.floor(255*i.b/i.a),a.data[e+t+3]=Math.floor(255*i.a))};if(n.clips)for(let i=0,r=0;i<e;++i,r+=4*o)for(let e=0,t=0;e<o;e++,t+=4){var l=e/(o-1),{start:c,end:h}=n.clips[i];s(r,t,c*(1-l)+h*l)}else for(let e=0,t=0;e<o;e++,t+=4)s(0,t,e/(o-1));return a}var r=new d({visibility:new a(p.layout_hillshade.visibility)}),Uh={paint:new d({"hillshade-illumination-direction":new a(p.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new a(p.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new a(p.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new a(p.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new a(p.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new a(p.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new a(p.paint_hillshade["hillshade-emissive-strength"])}),layout:r};const jh=m([{name:"a_pos",components:2,type:"Int16"}],4),Vh=jh["members"];C={exports:{}};function Gh(e,t,i){i=i||2;var r,n,o,a,s,l=t&&t.length,c=l?t[0]*i:e.length,h=qh(e,0,c,i,!0),u=[];if(h&&h.next!==h.prev){if(l&&(h=function(e,t,i,r){for(var n,o,a,s,l=[],c=0,h=t.length;c<h;c++)(n=qh(e,t[c]*r,c<h-1?t[c+1]*r:e.length,r,!1))===n.next&&(n.steiner=!0),l.push(function(e){var t=e,i=e;for(;(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next,t!==e;);return i}(n));for(l.sort(Zh),c=0;c<l.length;c++)s=void 0,i=(s=function(e,t){var i,r=t,n=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&a<s&&(i=r.x<r.next.x?r:r.next,(a=s)===n))return i}}while((r=r.next)!==t);if(!i)return null;for(var l,c,h,u=i,d=i.x,p=i.y,f=1/0,r=i;n>=r.x&&r.x>=d&&n!==r.x&&Xh(o<p?n:a,o,d,p,o<p?a:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),tu(r,e))&&(l<f||l===f&&(r.x>i.x||r.x===i.x&&(h=r,Yh((c=i).prev,c,h.prev)<0)&&Yh(h.next,c,c.next)<0))&&(i=r,f=l),(r=r.next)!==u;);return i}(o=l[c],a=i))?(Wh(o=iu(s,o),o.next),Wh(s,s.next)):a;return i}(e,t,h,i)),e.length>80*i){for(var d=r=e[0],p=n=e[1],f=i;f<c;f+=i)(o=e[f])<d&&(d=o),(a=e[f+1])<p&&(p=a),r<o&&(r=o),n<a&&(n=a);s=0!==(s=Math.max(r-d,n-p))?32767/s:0}Hh(h,u,i,d,p,s,0)}return u}function qh(e,t,i,r,n){var o,a;if(n===0<au(e,t,i,r))for(o=t;o<i;o+=r)a=ru(o,e[o],e[o+1],a);else for(o=i-r;t<=o;o-=r)a=ru(o,e[o],e[o+1],a);return a&&Kh(a,a.next)&&(nu(a),a=a.next),a}function Wh(e,t){if(!e)return e;t=t||e;var i,r=e;do{if(i=!1,r.steiner||!Kh(r,r.next)&&0!==Yh(r.prev,r,r.next))r=r.next;else{if(nu(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function Hh(e,t,i,r,n,o,a){if(e){if(!a&&o){var s=e;var l=r;var c=n;var h=o;for(var u=s;0===u.z&&(u.z=$h(u.x,u.y,l,c,h)),u.prevZ=u.prev,u.nextZ=u.next,(u=u.next)!==s;);u.prevZ.nextZ=null,u.prevZ=null;var d,p,f,m,g,_,y,v,x=u,b=1;do{for(p=x,g=x=null,_=0;p;){for(_++,f=p,d=y=0;d<b&&(y++,f=f.nextZ);d++);for(v=b;0<y||0<v&&f;)0!==y&&(0===v||!f||p.z<=f.z)?(p=(m=p).nextZ,y--):(f=(m=f).nextZ,v--),g?g.nextZ=m:x=m,m.prevZ=g,g=m;p=f}}while(g.nextZ=null,b*=2,1<_)}for(var w,T,S=e;e.prev!==e.next;)if(w=e.prev,T=e.next,o?function(e,t,i,r){var n=e.prev,o=e,a=e.next;if(0<=Yh(n,o,a))return;for(var s=n.x,l=o.x,c=a.x,h=n.y,u=o.y,d=a.y,p=s<l?s<c?s:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=l<s?c<s?s:c:c<l?l:c,g=u<h?d<h?h:d:d<u?u:d,_=$h(p,f,t,i,r),y=$h(m,g,t,i,r),v=e.prevZ,x=e.nextZ;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==a&&Xh(s,h,l,u,c,d,v.x,v.y)&&0<=Yh(v.prev,v,v.next))return;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==a&&Xh(s,h,l,u,c,d,x.x,x.y)&&0<=Yh(x.prev,x,x.next))return;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==a&&Xh(s,h,l,u,c,d,v.x,v.y)&&0<=Yh(v.prev,v,v.next))return;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==a&&Xh(s,h,l,u,c,d,x.x,x.y)&&0<=Yh(x.prev,x,x.next))return;x=x.nextZ}return 1}(e,r,n,o):function(e){var t=e.prev,i=e,e=e.next;if(0<=Yh(t,i,e))return;for(var r=t.x,n=i.x,o=e.x,a=t.y,s=i.y,l=e.y,c=r<n?r<o?r:o:n<o?n:o,h=a<s?a<l?a:l:s<l?s:l,u=n<r?o<r?r:o:o<n?n:o,d=s<a?l<a?a:l:l<s?s:l,p=e.next;p!==t;){if(p.x>=c&&p.x<=u&&p.y>=h&&p.y<=d&&Xh(r,a,n,s,o,l,p.x,p.y)&&0<=Yh(p.prev,p,p.next))return;p=p.next}return 1}(e))t.push(w.i/i|0),t.push(e.i/i|0),t.push(T.i/i|0),nu(e),e=T.next,S=T.next;else if((e=T)===S){a?1===a?Hh(e=function(e,t,i){var r=e;do{var n=r.prev,o=r.next.next}while(!Kh(n,o)&&Jh(n,r,r.next,o)&&tu(n,o)&&tu(o,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(o.i/i|0),nu(r),nu(r.next),r=e=o),r=r.next,r!==e);return Wh(r)}(Wh(e),t,i),t,i,r,n,o,2):2===a&&function(e,t,i,r,n,o){var a=e;do{for(var s,l=a.next.next;l!==a.prev;){if(a.i!==l.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Jh(i,i.next,e,t))return 1}while((i=i.next)!==e)}(e,t)&&(tu(e,t)&&tu(t,e)&&function(e,t){for(var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==e;);return r}(e,t)&&(Yh(e.prev,e,t.prev)||Yh(e,t.prev,t))||Kh(e,t)&&0<Yh(e.prev,e,e.next)&&0<Yh(t.prev,t,t.next))}(a,l))return s=iu(a,l),a=Wh(a,a.next),s=Wh(s,s.next),Hh(a,t,i,r,n,o,0),Hh(s,t,i,r,n,o,0);l=l.next}}while(a=a.next,a!==e)}(e,t,i,r,n,o):Hh(Wh(e),t,i,r,n,o,1);break}}}function Zh(e,t){return e.x-t.x}function $h(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Xh(e,t,i,r,n,o,a,s){return(e-a)*(o-s)<=(n-a)*(t-s)&&(i-a)*(t-s)<=(e-a)*(r-s)&&(n-a)*(r-s)<=(i-a)*(o-s)}function Yh(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Kh(e,t){return e.x===t.x&&e.y===t.y}function Jh(e,t,i,r){var n=eu(Yh(e,t,i)),o=eu(Yh(e,t,r)),a=eu(Yh(i,r,e)),s=eu(Yh(i,r,t));return n!==o&&a!==s||0===n&&Qh(e,i,t)||0===o&&Qh(e,r,t)||0===a&&Qh(i,e,r)||0===s&&Qh(i,t,r)}function Qh(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function eu(e){return 0<e?1:e<0?-1:0}function tu(e,t){return Yh(e.prev,e,e.next)<0?0<=Yh(e,t,e.next)&&0<=Yh(e,e.prev,t):Yh(e,t,e.prev)<0||Yh(e,e.next,t)<0}function iu(e,t){var i=new ou(e.i,e.x,e.y),r=new ou(t.i,t.x,t.y),n=e.next,o=t.prev;return(e.next=t).prev=e,(i.next=n).prev=i,(r.next=i).prev=r,(o.next=r).prev=o,r}function ru(e,t,i,r){e=new ou(e,t,i);return r?(e.next=r.next,(e.prev=r).next.prev=e,r.next=e):(e.prev=e).next=e,e}function nu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ou(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function au(e,t,i,r){for(var n=0,o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}C.exports=Gh,(C.exports.default=Gh).deviation=function(e,t,i,r){var n=t&&t.length,o=Math.abs(au(e,0,n?t[0]*i:e.length,i));if(n)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(au(e,t[a]*i,a<s-1?t[a+1]*i:e.length,i));for(var l=0,a=0;a<r.length;a+=3){var c=r[a]*i,h=r[a+1]*i,u=r[a+2]*i;l+=Math.abs((e[c]-e[u])*(e[1+h]-e[1+c])-(e[c]-e[h])*(e[1+u]-e[1+c]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Gh.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[n][o][a]);0<n&&i.holes.push(r+=e[n-1].length)}return i};var su=G(C.exports);function lu(t,i){const r=t.length;if(r<=1)return[t];var n=[];let o,a;for(let e=0;e<r;e++){const r=function(o){let a=0;for(let e,t,i=0,r=o.length,n=r-1;i<r;n=i++)e=o[i],t=o[n],a+=(t.x-e.x)*(e.y+t.y);return a}(t[e]);0!==r&&(t[e].area=Math.abs(r),(a=void 0===a?r<0:a)===r<0?(o&&n.push(o),o=[t[e]]):o.push(t[e]))}if(o&&n.push(o),1<i)for(let e=0;e<n.length;e++)n[e].length<=i||(Si(n[e],i,1,n[e].length-1,cu),n[e]=n[e].slice(0,i));return n}function cu(e,t){return t.area-e.area}function hu(e,t,i){var r=i.patternDependencies;let n=!1;for(const i of t){const t=i.paint.get(e+"-pattern");t.isConstant()||(n=!0);var o=t.constantOr(null);o&&(n=!0,r[o]=!0)}return n}function uu(e,t,i,r,n){var o,a=n.patternDependencies;for(const s of t){const t=s.paint.get(e+"-pattern").value;"constant"!==t.kind&&(a[o=(o=t.evaluate({zoom:r},i,{},n.availableImages))&&o.name?o.name:o]=!0,i.patterns[s.id]=o)}return i}class du{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Eo,this.indexArray=new Go,this.indexArray2=new Fo,this.programConfigurations=new qa(e.layers,e.zoom),this.segments=new ma,this.segments2=new ma,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection}populate(e,t,i,r){this.hasPattern=hu("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(var{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=ks(a,e);var h;this.layers[0]._featureFilter.filter(new Kn(this.zoom),u,i)&&(h=n?n.evaluate(u,{},i,t.availableImages):void 0,s={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Ds(a,i,r),patterns:{},sortKey:h},o.push(s))}n&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:d}=r;if(this.hasPattern){const e=uu("fill",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.availableImages,t.brightness);t.featureIndex.insert(e[o].feature,n,o,d,this.index)}}update(e,t,i,r,n){var o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(e,t,i,r,n,o){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,r,n,o,a=[],s){for(const t of lu(i,500)){let e=0;for(const r of t)e+=r.length;const r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=r.vertexLength,o=[],a=[];for(const i of t)if(0!==i.length){i!==t[0]&&a.push(o.length/2);const r=this.segments2.prepareSegment(i.length,this.layoutVertexArray,this.indexArray2),n=r.vertexLength;this.layoutVertexArray.emplaceBack(i[0].x,i[0].y),this.indexArray2.emplaceBack(n+i.length-1,n),o.push(i[0].x),o.push(i[0].y);for(let e=1;e<i.length;e++)this.layoutVertexArray.emplaceBack(i[e].x,i[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),o.push(i[e].x),o.push(i[e].y);r.vertexLength+=i.length,r.primitiveLength+=i.length}const s=su(o,a);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(n+s[e],n+s[e+1],n+s[e+2]);r.vertexLength+=e,r.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,o,a,n,s)}}n(du,"FillBucket",{omit:["layers","patternFeatures"]});var e=new d({"fill-sort-key":new s(p.layout_fill["fill-sort-key"]),visibility:new a(p.layout_fill.visibility)}),pu={paint:new d({"fill-antialias":new a(p.paint_fill["fill-antialias"]),"fill-opacity":new s(p.paint_fill["fill-opacity"]),"fill-color":new s(p.paint_fill["fill-color"]),"fill-outline-color":new s(p.paint_fill["fill-outline-color"]),"fill-translate":new a(p.paint_fill["fill-translate"]),"fill-translate-anchor":new a(p.paint_fill["fill-translate-anchor"]),"fill-pattern":new s(p.paint_fill["fill-pattern"]),"fill-emissive-strength":new a(p.paint_fill["fill-emissive-strength"])}),layout:e};const fu=m([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),mu=m([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),gu=m([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_u=m([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),yu=m([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),vu=fu["members"];var w={},xu=q,T=bu;function bu(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(wu,this,t)}function wu(e,t,i){if(1==e)t.id=i.readVarint();else if(2!=e)3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos);else for(var r=i,n=t,o=r.readVarint()+r.pos;r.pos<o;){var a=n._keys[r.readVarint()],s=n._values[r.readVarint()];n.properties[a]=s}}bu.types=["Unknown","Point","LineString","Polygon"],bu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i,r=e.readVarint()+e.pos,n=1,o=0,a=0,s=0,l=[];e.pos<r;)if(o<=0&&(n=7&(i=e.readVarint()),o=i>>3),o--,1===n||2===n)a+=e.readSVarint(),s+=e.readSVarint(),1===n&&(t&&l.push(t),t=[]),t.push(new xu(a,s));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}return t&&l.push(t),l},bu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,n=0,o=0,a=0,s=1/0,l=-1/0,c=1/0,h=-1/0;e.pos<i;)if(n<=0&&(r=7&(t=e.readVarint()),n=t>>3),n--,1===r||2===r)(o+=e.readSVarint())<s&&(s=o),l<o&&(l=o),(a+=e.readSVarint())<c&&(c=a),h<a&&(h=a);else if(7!==r)throw new Error("unknown command "+r);return[s,c,l,h]},bu.prototype.toGeoJSON=function(e,t,i){var r,n=this.extent*Math.pow(2,i),o=this.extent*e,a=this.extent*t,s=this.loadGeometry(),i=bu.types[this.type];function l(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+o)/n-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/n)*Math.PI/180))-90]}}switch(this.type){case 1:for(var c=[],h=0;h<s.length;h++)c[h]=s[h][0];l(s=c);break;case 2:for(h=0;h<s.length;h++)l(s[h]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],o=0;o<t;o++){var a=function(e){for(var t,i,r=0,n=0,o=e.length,a=o-1;n<o;a=n++)r+=((i=e[a]).x-(t=e[n]).x)*(t.y+i.y);return r}(e[o]);0!==a&&((r=void 0===r?a<0:r)===a<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}return i&&n.push(i),n}(s),h=0;h<s.length;h++)for(r=0;r<s[h].length;r++)l(s[h][r])}1===s.length?s=s[0]:i="Multi"+i;e={type:"Feature",geometry:{type:i,coordinates:s},properties:this.properties};return"id"in this&&(e.id=this.id),e};var Tu=T,x=Su;function Su(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Au,this,t),this.length=this._features.length}function Au(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;)var r=e.readVarint()>>3,t=1==r?e.readString():2==r?e.readFloat():3==r?e.readDouble():4==r?e.readVarint64():5==r?e.readVarint():6==r?e.readSVarint():7==r?e.readBoolean():null;return t}(i))}Su.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];e=this._pbf.readVarint()+this._pbf.pos;return new Tu(this._pbf,e,this.extent,this._keys,this._values)};var Eu=x;function Cu(e,t,i){3===e&&(e=new Eu(i,i.readVarint()+i.pos)).length&&(t[e.name]=e)}var Mu=w.VectorTile=function(e,t){this.layers=e.readFields(Cu,{},t)},g=w.VectorTileFeature=T;function Iu(e,t,i,r){const n=[],o=0===r?(e,t,i,r,n,o)=>{e.push(new U(o,i+(o-t)/(r-t)*(n-i)))}:(e,t,i,r,n,o)=>{e.push(new U(t+(o-i)/(n-i)*(r-t),o))};for(const m of e){const e=[];for(const n of m)if(!(n.length<=2)){var a=[];for(let e=0;e<n.length-1;e++){var s=n[e].x,l=n[e].y,c=n[e+1].x,h=n[e+1].y,u=0===r?s:l,d=0===r?c:h;u<t?t<d&&o(a,s,l,c,h,t):i<u?d<i&&o(a,s,l,c,h,i):a.push(n[e]),d<t&&t<=u&&o(a,s,l,c,h,t),i<d&&u<=i&&o(a,s,l,c,h,i)}var p=n[n.length-1],f=0===r?p.x:p.y;t<=f&&f<=i&&a.push(p),a.length&&(p=a[a.length-1],a[0].x===p.x&&a[0].y===p.y||a.push(a[0]),e.push(a))}e.length&&n.push(e)}return n}function Pu(e,t){return e.x-t.x||e.y-t.y}function Lu(e,t){return 0===Pu(e.min,t.min)&&0===Pu(e.max,t.max)}function Du(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function ku(e,t,i){var r=1/ue,n=1/(1<<i.canonical.z),o=(t.x*r+i.canonical.x)*n+i.wrap,t=(t.y*r+i.canonical.y)*n;return{min:new U((e.x*r+i.canonical.x)*n+i.wrap,(e.y*r+i.canonical.y)*n),max:new U(o,t)}}function zu(t,i,r,n,o,a,s){var l=t.indices,c=t.vertices,h=[];for(let e=n;e<n+o;e+=3){const n=i[r[e+0]+a],o=i[r[e+1]+a],u=i[r[e+2]+a],d=Math.min(n.x,o.x,u.x),p=Math.max(n.x,o.x,u.x),f=Math.min(n.y,o.y,u.y),m=Math.max(n.y,o.y,u.y);h.length=0,t.grid.query(new U(d,f),new U(p,m),h);for(let e=0;e<h.length;e++){const i=h[e];if(Hs(c[l[3*i+0]],c[l[3*i+1]],c[l[3*i+2]],n,o,u,s))return!0}}return!1}w.VectorTileLayer=x;class Ru{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){e=this.toIdx(e,t);return{min:this.minimums[e],max:this.maximums[e]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Ou(r,n,o,a){let s=0,l=Number.MAX_VALUE;for(let i=0;i<3;i++)if(Math.abs(a[i])<1e-15){if(o[i]<r[i]||o[i]>n[i])return null}else{var c=1/a[i];let e=(r[i]-o[i])*c,t=(n[i]-o[i])*c;if(e>t){const r=e;e=t,t=r}if(e>s&&(s=e),t<l&&(l=t),s>l)return null}return s}function Bu(e,t,i,r,n,o,a,s,l,c,h){var r=r-e,n=n-t,o=o-i,a=a-e,s=s-t,l=l-i,u=h[1]*l-h[2]*s,d=h[2]*a-h[0]*l,p=h[0]*s-h[1]*a,f=r*u+n*d+o*p;return Math.abs(f)<1e-15||(c=((e=c[0]-e)*u+(u=c[1]-t)*d+(t=c[2]-i)*p)*(d=1/f))<0||1<c||(t=(h[0]*(i=u*o-t*n)+h[1]*(p=t*r-e*o)+h[2]*(f=e*n-u*r))*d)<0||1<c+t?null:(a*i+s*p+l*f)*d}function Fu(e,t,i){return(e-t)/(i-t)}function Nu(e,t,i,r,n,o,a,s,l){var i=1<<i,o=o-r,a=a-n,c=(e+1)/i*o+r,h=(t+0)/i*a+n,t=(t+1)/i*a+n;s[0]=(e+0)/i*o+r,s[1]=h,l[0]=c,l[1]=t}class Uu{constructor(e){var t,i;this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem&&(i=(e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let r=Math.ceil(Math.pow(2,e));const n=1/r,o=(e,t,i,r,n)=>{var r=r?1:0,o=(e+1)*i-r,a=t*i,t=(t+1)*i-r;n[0]=e*i,n[1]=a,n[2]=o,n[3]=t};let a=new Ru(r);var s=[];for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),n,!1,s);const i=Vu(s[0],s[1],t),l=Vu(s[2],s[1],t),c=Vu(s[2],s[3],t),h=Vu(s[0],s[3],t);a.minimums.push(Math.min(i,l,c,h)),a.maximums.push(Math.max(i,l,c,h)),a.leaves.push(1)}for(i.push(a),r/=2;1<=r;r/=2){const t=i[i.length-1];a=new Ru(r);for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),2,!0,s);const i=t.getElevation(s[0],s[1]),n=t.getElevation(s[2],s[1]),u=t.getElevation(s[2],s[3]),d=t.getElevation(s[0],s[3]),p=t.isLeaf(s[0],s[1]),f=t.isLeaf(s[2],s[1]),m=t.isLeaf(s[2],s[3]),g=t.isLeaf(s[0],s[3]),_=Math.min(i.min,n.min,u.min,d.min),y=Math.max(i.max,n.max,u.max,d.max),v=p&&f&&m&&g;a.maximums.push(y),a.minimums.push(_),a.leaves.push(y-_<=5&&v?1:0)}i.push(a)}return i}(this.dem))[t=e.length-1],this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(e,0,0,t,0))}raycastRoot(e,t,i,r,n,o,a=1){return Ou([e,t,-100],[i,r,this.maximums[0]*a],n,o)}raycast(n,e,t,o,a,s,l=1){if(this.nodeCount){const c=this.raycastRoot(n,e,t,o,a,s,l);if(null!=c){const h=[],u=[],d=[],p=[],f=[{idx:0,t:c,nodex:0,nodey:0,depth:0}];for(;0<f.length;){const{idx:c,t:i,nodex:m,nodey:g,depth:_}=f.pop();if(this.leaves[c]){Nu(m,g,_,n,e,t,o,d,p);const c=1<<_,h=(m+0)/c,u=(m+1)/c,f=(g+0)/c,r=(g+1)/c,y=Vu(h,f,this.dem)*l,v=Vu(u,f,this.dem)*l,x=Vu(u,r,this.dem)*l,b=Vu(h,r,this.dem)*l,w=Bu(d[0],d[1],y,p[0],d[1],v,p[0],p[1],x,a,s),T=Bu(p[0],p[1],x,d[0],p[1],b,d[0],d[1],y,a,s),S=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const n=Te.N.scaleAndAdd([],a,s,i);if(ju(y,v,b,x,Fu(n[0],d[0],p[0]),Fu(n[1],d[1],p[1]))>=n[2])return i}}else{let r=0;for(let i=0;i<this._siblingOffset.length;i++){Nu((m<<1)+this._siblingOffset[i][0],(g<<1)+this._siblingOffset[i][1],_+1,n,e,t,o,d,p),d[2]=-100,p[2]=this.maximums[this.childOffsets[c]+i]*l;const f=Ou(d,p,a,s);if(null!=f){const n=f;h[i]=n;let t=!1;for(let e=0;e<r&&!t;e++)n>=h[u[e]]&&(u.splice(e,0,i),t=!0);t||(u[r]=i),r++}}for(let e=0;e<r;e++){const n=u[e];f.push({idx:this.childOffsets[c]+n,t:h[n],nodex:(m<<1)+this._siblingOffset[n][0],nodey:(g<<1)+this._siblingOffset[n][1],depth:_+1})}}}}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(r,n,o,a,s){if(1!==r[a].isLeaf(n,o)){this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const l=a-1,c=r[l];let t=0,i=0;for(let e=0;e<this._siblingOffset.length;e++){const a=2*n+this._siblingOffset[e][0],s=2*o+this._siblingOffset[e][1],l=c.getElevation(a,s),h=c.isLeaf(a,s),u=this._addNode(l.min,l.max,h);h&&(t|=1<<e),i=i||u}for(let e=0;e<this._siblingOffset.length;e++)t&1<<e||this._construct(r,2*n+this._siblingOffset[e][0],2*o+this._siblingOffset[e][1],l,i+e)}}}function ju(e,t,i,r,n,o){return A(A(e,i,o),A(t,r,o),n)}function Vu(e,t,i){var r=i.dim,e=S(e*r-.5,0,r-1),t=S(t*r-.5,0,r-1),n=Math.floor(e),o=Math.floor(t),a=Math.min(n+1,r-1),r=Math.min(o+1,r-1);return ju(i.get(n,o),i.get(a,o),i.get(n,r),i.get(a,r),e-n,t-o)}const Gu={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function qu(e,t,i){return(256*e*256+256*t+i)/10-1e4}function Wu(e,t,i){return 256*e+t+i/256-32768}class Hu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return _e(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;var n=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let e=0;e<n;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(n,e)]=o[this._idx(n-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,n)]=o[this._idx(e,n-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(n,-1)]=o[this._idx(n-1,0)],o[this._idx(-1,n)]=o[this._idx(0,n-1)],o[this._idx(n,n)]=o[this._idx(n-1,n-1)]}var a="terrarium"===i?Wu:qu;for(let e=0;e<o.length;++e){const t=4*e;this.floatView[e]=a(this.pixels[t],this.pixels[1+t],this.pixels[2+t])}this._timestamp=Re.now()}_buildQuadTree(){this._tree=new Uu(this)}get(e,t,i=!1){i&&(e=S(e,-1,this.dim),t=S(t,-1,this.dim));i=this._idx(e,t);return this.floatView[i]}set(e,t,i){e=this._idx(e,t),t=this.floatView[e];return(this.floatView[e]=i)-t}static getUnpackVector(e){return Gu[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){var i=[0,0,0,0],t=Hu.getUnpackVector(t),e=Math.floor((e+t[3])/t[2]);return i[2]=e%256,e=Math.floor(e/256),i[1]=e%256,e=Math.floor(e/256),i[0]=e,i}getPixels(){return new Bh({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,e,t){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=t*this.dim,a=t*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(t){case-1:o=a-1;break;case 1:a=o+1}var s=-e*this.dim,l=-t*this.dim;for(let t=o;t<a;t++)for(let e=r;e<n;e++){const r=4*this._idx(e,t),n=4*this._idx(e+s,t+l);this.pixels[0+r]=i.pixels[0+n],this.pixels[1+r]=i.pixels[1+n],this.pixels[2+r]=i.pixels[2+n],this.pixels[3+r]=i.pixels[3+n]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}n(Hu,"DEMData"),n(Uu,"DemMinMaxQuadTree",{omit:["dem"]});class Zu{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){var r,n,i=i||e.findDEMTileFor(t);if(i&&i.dem)return e=i.dem,r=i.tileID,n=1<<t.canonical.z-r.canonical.z,new Zu(i,e.dim/ue/n,[(t.canonical.x/n-r.canonical.x)*e.dim,(t.canonical.y/n-r.canonical.y)*e.dim])}tileCoordToPixel(e,t){t=t*this._scale+this._offset[1],e=Math.floor(e*this._scale+this._offset[0]),t=Math.floor(t);return new U(e,t)}getElevationAt(e,t,i,r){var e=e*this._scale+this._offset[0],t=t*this._scale+this._offset[1],n=Math.floor(e),o=Math.floor(t),a=this._dem;return r=!!r,i?A(A(a.get(n,o,r),a.get(n,o+1,r),t-o),A(a.get(n+1,o,r),a.get(n+1,o+1,r),t-o),e-n):a.get(n,o,r)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*vs(1,e)*this._dem.stride}}const $u=g.types,Xu=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Yu=["fill-extrusion-flood-light-ground-radius"],Ku=Math.pow(2,13),Ju=Math.pow(2,15)-1,Qu=new U(0,1),ed=2147483648;function td(e,t,i,r,n,o,a,s){e.emplaceBack((t<<1)+a,(i<<1)+o,(Math.floor(r*Ku)<<1)+n,Math.round(s))}function id(e,t,i,r,n,o){e.emplaceBack(t.x,t.y,(i.x<<1)+r,(i.y<<1)+n,o)}function rd(e,t,i){e.emplaceBack(t.x,t.y,t.z,16384*i[0],16384*i[1],16384*i[2])}class nd{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class od{constructor(){this.centroidXY=new U(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new U(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new U(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new U(this.max.x-this.min.x,this.max.y-this.min.y)}}class ad{constructor(){this.acc=new U(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,i){this.accCount++,this.acc._add(t);let r=!!this.borders;t.x<e.min.x?(e.min.x=t.x,r=!0):t.x>e.max.x&&(e.max.x=t.x,r=!0),t.y<e.min.y?(e.min.y=t.y,r=!0):t.y>e.max.y&&(e.max.y=t.y,r=!0),((0===t.x||t.x===ue)&&t.x===i.x)!=((0===t.y||t.y===ue)&&t.y===i.y)&&this.processBorderOverlap(t,i),r&&this.checkBorderIntersection(t,i)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,A(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ue!=e.x>ue&&this.addBorderIntersection(1,A(t.y,e.y,(ue-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,A(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ue!=e.y>ue&&this.addBorderIntersection(3,A(t.x,e.x,(ue-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);e=this.borders[e];t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t)}processBorderOverlap(e,t){var i;e.x===t.x?e.y!==t.y&&(i=0===e.x?0:1,this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)):(i=0===e.y?2:3,this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x))}centroid(){return 0===this.accCount?new U(0,0):new U(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function sd(e,t){var i=e.add(t)._unit(),i=S(e.x*i.x+e.y*i.y,-1,1),i=Math.acos(i);return Math.min(4,Math.max(-4,Math.tan(i)))/4*Ju*(e.x*t.y-e.y*t.x<0?-1:1)}const ld=[e=>e.x<0,e=>e.x>ue,e=>e.y<0,e=>e.y>ue];class cd{constructor(e){this.vertexArray=new Io,this.indexArray=new Go,this.programConfigurations=new qa(e.layers,e.zoom,e=>Yu.includes(e)),this._segments=new ma,this.hiddenByLandmarkVertexArray=new ta,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ma}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(r,n,o,a=!1){var s=r.length;if(2<s){let t=Math.max(0,this._segments.get().length-1);var l=this._segments._prepareSegment(4*s,this.vertexArray.length,2*this._segmentToGroundQuads[t].length);let i;t!==this._segments.get().length-1&&(t++,this._segmentToGroundQuads[t]=[],this._segmentToRegionTriCounts[t]=[0,0,0,0,0]);{const n=r[0],o=r[1];i=sd(n.sub(r[s-1])._perp()._unit(),o.sub(n)._perp()._unit())}for(let e=0;e<s;e++){var c=e===s-1?0:e+1,h=r[e],u=r[c],c=r[c===s-1?0:c+1],d=u.sub(h)._perp()._unit(),c=sd(d,c.sub(u)._perp()._unit()),p=i,f=c;if(pd(h,u,n)||a&&fd(h,n)&&fd(u,n));else{var m=l.vertexLength,p=(id(this.vertexArray,h,u,1,1,p),id(this.vertexArray,h,u,1,0,p),id(this.vertexArray,h,u,0,1,f),id(this.vertexArray,h,u,0,0,f),l.vertexLength+=4,function(e,t,i,r){var n=[4];if(0!==r){i._mult(r);var r=e.sub(i),i=t.sub(i),o=[e,t,r,i];for(let e=0;e<4;e++)for(const t of o)if(ld[e](t)){n.push(e);break}}return n}(h,u,d,o));for(const r of p)this._segmentToGroundQuads[t].push({id:m,region:r}),this._segmentToRegionTriCounts[t][r]+=2,l.primitiveLength+=2}i=c}}}prepareBorderSegments(){if(this.hasData()){const n=this._segments.get(),o=n.length;for(let e=0;e<o;e++)this._segmentToGroundQuads[e].sort((e,t)=>e.region-t.region);for(let e=0;e<o;e++){const o=this._segmentToGroundQuads[e],a=n[e],s=this._segmentToRegionTriCounts[e];s.reduce((e,t)=>e+t,0);let i=0;for(let t=0;t<=4;t++){const o=s[t];if(0!==o){let e=this.regionSegments[t];e=e||(this.regionSegments[t]=new ma);var r={vertexOffset:a.vertexOffset,primitiveOffset:a.primitiveOffset+i,vertexLength:a.vertexLength,primitiveLength:o};e.get().push(r)}i+=o}for(let e=0;e<o.length;e++){var t=o[e].id;this.indexArray.emplaceBack(t,t+1,t+3),this.indexArray.emplaceBack(t,t+3,t+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}}addPaintPropertiesData(e,t,i,r,n,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,i,r,n,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,mu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,i,r,n,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,i,r,n,o)}updateHiddenByLandmark(t){if(this.hasData()){var i=t.groundVertexCount+t.groundVertexArrayOffset;if(0!==t.groundVertexCount){var r=t.flags&ed?1:0;for(let e=t.groundVertexArrayOffset;e<i;++e)this.hiddenByLandmarkVertexArray.emplace(e,r);this._needsHiddenByLandmarkUpdate=!0}}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&0<this.hiddenByLandmarkVertexArray.length?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_u.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){var t=this.regionSegments[e];t&&t.destroy()}}}}class hd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Go,this.footprintVertices=new Eo,this.footprintSegments=[],this.layoutVertexArray=new Mo,this.centroidVertexArray=new da,this.indexArray=new Go,this.programConfigurations=new qa(e.layers,e.zoom,e=>Xu.includes(e)),this.segments=new ma,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new cd(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,i,r){this.features=[],this.hasPattern=hu("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Es(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(var{feature:n,id:o,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,c=ks(n,e);var l;this.layers[0]._featureFilter.filter(new Kn(this.zoom),c,i)&&(o={id:o,sourceLayerIndex:s,index:a,geometry:e?c.geometry:Ds(n,i,r),properties:n.properties,type:n.type,patterns:{}},l=this.layoutVertexArray.length,this.hasPattern?this.features.push(uu("fill-extrusion",this.layers,o,this.zoom,t)):this.addFeature(o,o.geometry,a,i,{},t.availableImages,r,t.brightness),t.featureIndex.insert(n,o.geometry,a,s,this.index,l))}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,i,r,n,o){for(const e of this.features){var a=e["geometry"];this.addFeature(e,a,e.index,t,i,r,n,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,i,r,n){var o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||(o=o?this.stateDependentLayers:this.layers,this.programConfigurations.updatePaintArrays(e,t,o,i,r,n),this.groundEffect.update(e,t,o,i,r,n))}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yu.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&0<this.centroidVertexArray.length?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gu.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,d,p,f,m,g,_,r){const y=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(u,{})/this.tileToMeter,n=[new U(0,0),new U(ue,ue)],v=_.projection,x="globe"===v.name,b="Polygon"===$u[u.type],w=new ad,T=(w.centroidDataIndex=this.centroidData.length,new od),S=this.layers[0].paint.get("fill-extrusion-base").evaluate(u,{},f)<=0,A=this.layers[0].paint.get("fill-extrusion-height").evaluate(u,{},f);T.height=A,T.vertexArrayOffset=this.layoutVertexArray.length,T.groundVertexArrayOffset=this.groundEffect.vertexArray.length,x&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new zo);var t,i,E,C,M,I,P,o=lu(d,500);for(let e=o.length-1;0<=e;e--){const d=o[e];(0===d.length||(t=d[0]).every(e=>e.x<=0)||t.every(e=>e.x>=ue)||t.every(e=>e.y<=0)||t.every(e=>e.y>=ue))&&o.splice(e,1)}let e;if(x)e=yd(o,n,f);else{e=[];for(const u of o)e.push({polygon:u,bounds:n})}const L=b?this.edgeRadius:0,D=0<L&&this.zoom<17,k=(e,t)=>{return 0!==e.length&&(e=e[e.length-1],t.x===e.x)&&t.y===e.y};for(const{polygon:u,bounds:d}of e){let h=0,e=0;for(const d of u)b&&!d[0].equals(d[d.length-1])&&d.push(d[0]),e+=b?d.length-1:d.length;const g=this.segments.prepareSegment((b?5:4)*e,this.layoutVertexArray,this.indexArray),_=(T.footprintSegIdx<0&&(T.footprintSegIdx=this.footprintSegments.length),T.polygonSegIdx<0&&(T.polygonSegIdx=this.polygonSegments.length),{triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1}),r=new nd;if(r.vertexOffset=this.footprintVertices.length,r.indexOffset=3*this.footprintIndices.length,r.ringIndices=[],b){const m=[],_=[];h=g.vertexLength;for(let e=0;e<u.length;e++){const n=u[e],b=(n.length&&0!==e&&_.push(m.length/2),[]);let t,i;t=n[1].sub(n[0])._perp()._unit(),r.ringIndices.push(n.length-1);for(let e=1;e<n.length;e++){const d=n[e],p=n[e===n.length-1?1:e+1],_=d.clone();if(L){i=p.sub(d)._perp()._unit();const u=t.add(i)._unit(),f=L*Math.min(4,1/(t.x*u.x+t.y*u.y));_.x+=f*u.x,_.y+=f*u.y,_.x=Math.round(_.x),_.y=Math.round(_.y),t=i}!S||0!==L&&!D||k(b,_)||b.push(_),td(this.layoutVertexArray,_.x,_.y,0,0,1,1,0),g.vertexLength++,this.footprintVertices.emplaceBack(d.x,d.y),m.push(d.x,d.y),x&&rd(this.layoutVertexExtArray,v.projectTilePoint(_.x,_.y,f),v.upVector(f,_.x,_.y))}S&&(0===L||D)&&(0!==b.length&&k(b,b[0])&&b.pop(),this.groundEffect.addData(b,d,y))}const n=su(m,_);for(let e=0;e<n.length;e+=3)this.footprintIndices.emplaceBack(r.vertexOffset+n[e+0],r.vertexOffset+n[e+1],r.vertexOffset+n[e+2]),this.indexArray.emplaceBack(h+n[e],h+n[e+2],h+n[e+1]),g.primitiveLength++;r.indexCount+=n.length,r.vertexCount+=this.footprintVertices.length-r.vertexOffset}for(let e=0;e<u.length;e++){const _=u[e];w.startRing(T,_[0]);let n=4<_.length&&md(_[_.length-2],_[0],_[1]),o=L?(i=_[_.length-2],E=_[0],C=_[1],M=L,P=I=void 0,I=E.sub(i)._perp()._unit(),P=C.sub(E)._perp()._unit(),dd(i,E,C,ud(I,P),M)):0;const A=[];let a,s,l,c=(s=_[1].sub(_[0])._perp()._unit(),!0);for(let e=1,r=0;e<_.length;e++){let t=_[e-1],i=_[e];const D=_[e===_.length-1?1:e+1];if(w.appendEdge(T,i,t),pd(i,t,d))L&&(s=D.sub(i)._perp()._unit(),c=!c);else{var z=i.sub(t)._perp(),R=z.x/(Math.abs(z.x)+Math.abs(z.y)),z=0<z.y?1:0,O=t.dist(i);if(32768<r+O&&(r=0),L){l=D.sub(i)._perp()._unit();let e=dd(t,i,D,ud(s,l),L);isNaN(e)&&(e=0);const d=i.sub(t)._unit();t=t.add(d.mult(o))._round(),i=i.add(d.mult(-e))._round(),o=e,s=l,S&&17<=this.zoom&&(k(A,t)||A.push(t),k(A,i)||A.push(i))}var B=g.vertexLength,F=4<_.length&&md(t,i,D),N=gd(r,n,c);if(td(this.layoutVertexArray,t.x,t.y,R,z,0,0,N),td(this.layoutVertexArray,t.x,t.y,R,z,0,1,N),N=gd(r+=O,F,!c),n=F,td(this.layoutVertexArray,i.x,i.y,R,z,0,0,N),td(this.layoutVertexArray,i.x,i.y,R,z,0,1,N),g.vertexLength+=4,this.indexArray.emplaceBack(B+0,B+1,B+2),this.indexArray.emplaceBack(B+1,B+3,B+2),g.primitiveLength+=2,L){const f=h+(1===e?_.length-2:e-2),m=1===e?h:f+1;if(this.indexArray.emplaceBack(B+1,f,B+3),this.indexArray.emplaceBack(f,m,B+3),g.primitiveLength+=2,void 0===a&&(a=B),!pd(D,_[e],d)){const d=e===_.length-1?a:g.vertexLength;this.indexArray.emplaceBack(B+2,B+3,d),this.indexArray.emplaceBack(B+3,d+1,d),this.indexArray.emplaceBack(B+3,m,d+1),g.primitiveLength+=3}c=!c}if(x){const u=this.layoutVertexExtArray,d=v.projectTilePoint(t.x,t.y,f),p=v.projectTilePoint(i.x,i.y,f),m=v.upVector(f,t.x,t.y),g=v.upVector(f,i.x,i.y);rd(u,d,m),rd(u,d,m),rd(u,p,g),rd(u,p,g)}}}b&&(h+=_.length-1),S&&L&&17<=this.zoom&&(0!==A.length&&k(A,A[0])&&A.pop(),this.groundEffect.addData(A,d,y,0<L))}this.footprintSegments.push(r),_.triangleCount=this.indexArray.length-_.triangleArrayOffset,this.polygonSegments.push(_),++T.footprintSegLen,++T.polygonSegLen}if(T.vertexCount=this.layoutVertexArray.length-T.vertexArrayOffset,T.groundVertexCount=this.groundEffect.vertexArray.length-T.groundVertexArrayOffset,0!==T.vertexCount){if(T.centroidXY=w.borders?Qu:this.encodeCentroid(w,T),this.centroidData.push(T),w.borders){this.featuresOnBorder.push(w);const u=this.featuresOnBorder.length-1;for(let e=0;e<w.borders.length;e++)w.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(u)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,p,m,g,f,r),this.groundEffect.addPaintPropertiesData(u,p,m,g,f,r),this.maxHeight=Math.max(this.maxHeight,A)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((e,t)=>this.featuresOnBorder[e].borders[i][0]-this.featuresOnBorder[t].borders[i][0])}splitToSubtiles(){var n=[];for(let t=0;t<this.centroidData.length;t++){const a=this.centroidData[t],s=+(a.min.y+a.max.y>ue),l=2*s+(+(a.min.x+a.max.x>ue)^s);for(let e=0;e<a.polygonSegLen;e++){const c=a.polygonSegIdx+e;n.push({centroidIdx:t,subtile:l,polygonSegmentIdx:c,triangleSegmentIdx:this.polygonSegments[c].triangleSegIdx})}}const o=new Go;n.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let a=0,s=0,l=0;for(const o of n){if(o.triangleSegmentIdx!==a)break;l++}const c=n.length;for(;s!==n.length;){a=n[s].triangleSegmentIdx;let t=0,i=s,r=s;for(let e=i;e<l&&n[e].subtile===t;e++)r++;for(;i!==l;){const s=n[i],c=(t=s.subtile,this.centroidData[s.centroidIdx].min.clone()),h=this.centroidData[s.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let e=i;e<r;e++){const s=n[e],l=this.polygonSegments[s.polygonSegmentIdx],d=this.centroidData[s.centroidIdx].min,p=this.centroidData[s.centroidIdx].max,f=this.indexArray.uint16;for(let e=l.triangleArrayOffset;e<l.triangleArrayOffset+l.triangleCount;e++)o.emplaceBack(f[3*e],f[3*e+1],f[3*e+2]);u.primitiveLength+=l.triangleCount,c.x=Math.min(c.x,d.x),c.y=Math.min(c.y,d.y),h.x=Math.max(h.x,p.x),h.y=Math.max(h.y,p.y)}0<u.primitiveLength&&this.triangleSubSegments.push({segment:u,min:c,max:h});for(let e=i=r;e<l&&n[e].subtile===n[i].subtile;e++)r++}for(let e=s=l;e<c&&n[e].triangleSegmentIdx===n[s].triangleSegmentIdx;e++)l++}o._trim(),this.indexArray=o}getVisibleSegments(e,t,i){let r=0,n=0;const o=1<<e.canonical.z;if(t){const i=t.getMinMaxForTile(e);i&&(r=i.min,n=i.max)}n+=this.maxHeight;const a=e.toUnwrapped();let s;var l=[a.canonical.x/o+a.wrap,a.canonical.y/o],c=[(a.canonical.x+1)/o+a.wrap,(a.canonical.y+1)/o],h=new ma,u=(e,t,i)=>[e[0]*(1-i[0])+t[0]*i[0],e[1]*(1-i[1])+t[1]*i[1]],d=[],p=[];for(const e of this.triangleSubSegments){d[0]=e.min.x/ue,d[1]=e.min.y/ue,p[0]=e.max.x/ue,p[1]=e.max.y/ue;const t=u(l,c,d),o=u(l,c,p);if(0===new M([t[0],t[1],r],[o[0],o[1],n]).intersectsPrecise(i))s&&(h.segments.push(s),s=void 0);else{const a=e.segment;s&&s.vertexOffset!==a.vertexOffset&&(h.segments.push(s),s=void 0),s?(s.vertexLength+=a.vertexLength,s.primitiveLength+=a.primitiveLength):s={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}}return s&&h.segments.push(s),h}encodeCentroid(e,t){var e=e.centroid(),t=t.span(),i=Math.min(7,Math.round(t.x*this.tileToMeter/10)),t=Math.min(7,Math.round(t.y*this.tileToMeter/10));return new U(S(e.x,1,ue-1)<<3|i,S(e.y,1,ue-1)<<3|t)}encodeBorderCentroid(e){if(!e.borders)return new U(0,0);var t=e.borders,i=Number.MAX_VALUE;if(t[0][0]!==i||t[1][0]!==i){const e=t[0][0]!==i?0:1;return new U(6|(t[0][0]!==i?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==i?2:3;return new U((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==i?0:65528))}}showCentroid(e){e=this.centroidData[e.centroidDataIndex];e.flags&=ed,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);var t=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,r=e.flags&ed?Qu:e.centroidXY,e=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==r.y||e!==r.x){for(let e=t;e<i;++e)this.centroidVertexArray.emplace(e,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(t,i){if(i.updateTime!==this.replacementUpdateTime){this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(t.toUnwrapped());if(!function(t,i){if(t.length===i.length){for(let e=0;e<t.length;e++)if(t[e].sourceId!==i[e].sourceId||!Lu(t[e],i[e]))return;return 1}}(this.activeReplacements,f)){if(this.activeReplacements=f,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;var r=[];for(const i of this.activeReplacements){const f=Math.pow(2,i.footprintTileId.canonical.z-t.canonical.z);for(const m of this.centroidData)if(!(m.flags&ed||i.min.x>m.max.x||m.min.x>i.max.x||i.min.y>m.max.y||m.min.y>i.max.y))for(let e=0;e<m.footprintSegLen;e++){var n=this.footprintSegments[m.footprintSegIdx+e],o=(p=d=u=h=c=l=s=a=o=void(r.length=0),this.footprintVertices),a=n.vertexOffset,s=n.vertexCount,l=i.footprintTileId.canonical,c=t.canonical,h=r,u=Math.pow(2,l.z-c.z);for(let e=0;e<s;e++){var d=o.int16[2*(e+a)+0],p=o.int16[2*(e+a)+1];d=(d+c.x*ue)*u-l.x*ue,p=(p+c.y*ue)*u-l.y*ue,h.push(new U(d,p))}if(zu(i.footprint,r,this.footprintIndices.uint16,n.indexOffset,n.indexCount,-n.vertexOffset,-f)){m.flags|=ed;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}}}footprintContainsPoint(r,n,o){let a=!1;for(let e=0;e<o.footprintSegLen;e++){var s=this.footprintSegments[o.footprintSegIdx+e];let i=0;for(const o of s.ringIndices){for(let e=i,t=o+i-1;e<o+i;t=e++){const o=this.footprintVertices.int16[2*(e+s.vertexOffset)+0],l=this.footprintVertices.int16[2*(e+s.vertexOffset)+1],c=this.footprintVertices.int16[2*(t+s.vertexOffset)+1];n<l!=n<c&&r<(this.footprintVertices.int16[2*(t+s.vertexOffset)+0]-o)*(n-l)/(c-l)+o&&(a=!a)}i=o}}return a}getHeightAtTileCoord(e,t){let i=Number.NEGATIVE_INFINITY,r=!0;var n=4*(e+ue)*ue+(t+ue);if(this.partLookup.hasOwnProperty(n)){const e=this.partLookup[n];return e?{height:e.height,hidden:!!(e.flags&ed)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>i&&(i=o.height,this.partLookup[n]=o,r=!!(o.flags&ed));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[n]=void 0}}function ud(e,t){t=e.add(t)._unit();return e.x*t.x+e.y*t.y}function dd(e,t,i,r,n){var o=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(i)/3,n*o/r)}function pd(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function fd(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function md(e,t,i){var r;return!(e.x<0||e.x>=ue||t.x<0||t.x>=ue||i.x<0||i.x>=ue)&&(r=(i=i.sub(t)).perp(),e=e.sub(t),-.866<(i.x*e.x+i.y*e.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y)))&&r.x*e.x+r.y*e.y<0}function gd(e,t,i){t=t?2|e:-3&e;return i?1|t:-2&t}function _d(){var e=Math.PI/32,e=Math.tan(e),t=ns;return t*Math.sqrt(1+2*e*e)-t}function yd(e,t,r){const n=1<<r.z,i=xs(r.x/n),o=xs((r.x+1)/n),a=bs(r.y/n),s=bs((r.y+1)/n);{var l=e,c=t,h=Math.ceil((o-i)/11.25),u=Math.ceil((a-s)/11.25),d=(e,t,i)=>{if(0===e)return.5*(t+i);{const e=bs((r.y+t/ue)/n);return(ys(.5*(bs((r.y+i/ue)/n)+e))*n-r.y)*ue}};const f=[];if(l.length&&h&&u){const m=(e,t)=>{for(const i of e)f.push({polygon:i,bounds:t})},g=Math.ceil(Math.log2(h)),_=Math.ceil(Math.log2(u)),y=g-_,v=[];for(let e=0;e<Math.abs(y);e++)v.push(0<y?0:1);for(let e=0;e<Math.min(g,_);e++)v.push(0),v.push(1);let e=l;if(e=Iu(e,c[0].y-1,c[1].y+1,1),(e=Iu(e,c[0].x-1,c[1].x+1,0)).length){var p=[];for(v.length?p.push({polygons:e,bounds:c,depth:0}):m(e,c);p.length;){const l=p.pop(),c=l.depth,h=v[c],u=l.bounds[0],f=l.bounds[1],g=0===h?u.x:u.y,_=0===h?f.x:f.y,y=d(h,g,_),e=Iu(l.polygons,g-1,y+1,h),x=Iu(l.polygons,y-1,_+1,h);if(e.length){const l=[u,new U(0===h?y:f.x,1===h?y:f.y)];v.length>c+1?p.push({polygons:e,bounds:l,depth:c+1}):m(e,l)}if(x.length){const l=[new U(0===h?y:u.x,1===h?y:u.y),f];v.length>c+1?p.push({polygons:x,bounds:l,depth:c+1}):m(x,l)}}}}return f}}n(hd,"FillExtrusionBucket",{omit:["layers","features"]}),n(od,"PartData"),n(nd,"FootprintSegment"),n(ad,"BorderCentroidData"),n(cd,"GroundEffect");var b=new d({visibility:new a(p["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new a(p["layout_fill-extrusion"]["fill-extrusion-edge-radius"])}),vd={paint:new d({"fill-extrusion-opacity":new a(p["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new s(p["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new a(p["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new a(p["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new s(p["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new s(p["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new s(p["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new a(p["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new a(p["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new a(p["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new a(p["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new a(p["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new a(p["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new a(p["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new a(p["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new s(p["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new s(p["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new a(p["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new a(p["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new a(p["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new a(p["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new a(p["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:b};class xd extends U{constructor(e,t,i){super(e,t),this.z=i}}function bd(e,t){return e.x*t.x+e.y*t.y}function wd(i,r){if(1===i.length){let e=0;var n=r[e++];let t;for(;!t||n.equals(t);)if(!(t=r[e++]))return 1/0;for(;e<r.length;e++){var o=r[e],a=i[0],s=t.sub(n),l=o.sub(n),a=a.sub(n),c=bd(s,s),h=bd(s,l),u=bd(l,l),s=bd(a,s),a=bd(a,l),l=c*u-h*h,u=(u*s-h*a)/l,c=(c*a-h*s)/l,a=n.z*(1-u-c)+t.z*u+o.z*c;if(isFinite(a))return a}return 1/0}{let e=1/0;for(const t of r)e=Math.min(e,t.z);return e}}function Td(e,t,i,r,n,o,a,s){var l,c,h,u,d,p,e=a*n.getElevationAt(e,t,!0,!0),t=0!==o[0],f=t?0===o[1]?a*(o[0]/7-450):a*(a=n,n=o,o=s,s=Math.floor(n[0]/8),l=Math.floor(n[1]/8),c=10*(n[0]-8*s),n=10*(n[1]-8*l),h=a.getElevationAt(s,l,!0,!0),o=a.getMeterToDEM(o),f=Math.floor(.5*(c*o-1)),u=Math.floor(.5*(n*o-1)),s=a.tileCoordToPixel(s,l),l=2*f+1,d=2*u+1,a=a,f=s.x-f,s=s.y-u,u=l,p=d,a=[a.getElevationAtPixel(f,s,!0),a.getElevationAtPixel(f+p,s,!0),a.getElevationAtPixel(f,s+p,!0),a.getElevationAtPixel(f+u,s+p,!0)],f=Math.abs(a[0]-a[1]),u=Math.abs(a[2]-a[3]),s=Math.abs(a[0]-a[2])+Math.abs(a[1]-a[3]),p=Math.min(.25,.5*o*(f+u)/l),a=Math.min(.25,.5*o*s/d),h+Math.max(p*c,a*n)):e;return{base:e+(0===i)?-1:i,top:t?Math.max(f+r,e+i+2):e+r}}const Sd=m([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Ad=Sd["members"],Ed=m([{name:"a_packed",components:4,type:"Float32"}]),Cd=Ed["members"];class Md{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Rh({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){e=this.getKey(e,t);return this.positions[e]}trim(){var e=this.width,t=this.height=le(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(t,e,i){var r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,a=!0,s=(r.push({left:n,right:o,isDash:a,zeroLength:0===t[0]}),t[0]);for(let e=1;e<t.length;e++){a=!a;var l=t[e];n=s*i,o=(s+=l)*i,r.push({left:n,right:o,isDash:a,zeroLength:0===l})}return r}addRoundDash(o,e,a){var s=e/2;for(let n=-a;n<=a;n++){var l=this.width*(this.nextRow+a+n);let i=0,r=o[i];for(let t=0;t<this.width;t++){1<t/r.right&&(r=o[++i]);var c=Math.abs(t-r.left),h=Math.abs(t-r.right),c=Math.min(c,h);let e;h=n/a*(1+s);if(r.isDash){const o=s-Math.abs(h);e=Math.sqrt(c*c+o*o)}else e=s-Math.sqrt(c*c+h*h);this.image.data[l+t]=Math.max(0,Math.min(255,e+128))}}}addRegularDash(t,i){for(let e=t.length-1;0<=e;--e){const r=t[e],n=t[e+1];r.zeroLength?t.splice(e,1):n&&n.isDash===r.isDash&&(n.left=r.left,t.splice(e,1))}const r=t[0],n=t[t.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);var o=this.width*this.nextRow;let a=0,s=t[a];for(let e=0;e<this.width;e++){1<e/s.right&&(s=t[++a]);const n=Math.abs(e-s.left),l=Math.abs(e-s.right),c=Math.min(n,l);this.image.data[o+e]=Math.max(0,Math.min(255,(s.isDash?c:-c)+i+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const r="round"===e,n=r?7:0,o=2*n+1;if(this.nextRow+o>this.height)return _e("LineAtlas out of space"),null;0===t.length&&t.push(1);let a=0;for(let e=0;e<t.length;e++)t[e]<0&&(_e("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),a+=t[e];if(0!==a){const i=this.width/a,o=this.getDashRanges(t,this.width,i);r?this.addRoundDash(o,i,n):this.addRegularDash(o,"square"===e?.5*i:0)}e=this.nextRow+n,this.nextRow+=o,e={tl:[e,n],br:[a,0]};return this.positions[i]=e}}n(Md,"LineAtlas");const Id=g.types,Pd=Math.cos(Math.PI/180*37.5);class Ld{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new Po,this.layoutVertexArray2=new Lo,this.indexArray=new Go,this.programConfigurations=new qa(e.layers,e.zoom),this.segments=new ma,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,i,r){this.hasPattern=hu("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,h=ks(t,e);var a;this.layers[0]._featureFilter.filter(new Kn(this.zoom),h,i)&&(a=n?n.evaluate(h,{},i):void 0,a={id:s,properties:t.properties,type:t.type,sourceLayerIndex:c,index:l,geometry:e?h.geometry:Ds(t,i,r),patterns:{},sortKey:a},o.push(a))}n&&o.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:s,featureIndex:l}=t,c=this.addConstantDashes(s);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:u}=r;if(c&&this.addFeatureDashes(r,s),this.hasPattern){const e=uu("line",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,s.positions,t.availableImages,t.brightness);l.insert(e[o].feature,n,o,u,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){var i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,o=i.value;o&&e.addDash(o,t)}}return t}addFeatureDashes(i,r){var n=this.zoom;for(const s of this.layers){var o=s.paint.get("line-dasharray").value,a=s.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==a.kind){let e,t;if("constant"===o.kind){if(!(e=o.value))continue}else e=o.evaluate({zoom:n},i);t="constant"===a.kind?a.value:a.evaluate({zoom:n},i),r.addDash(e,t),i.patterns[s.id]=r.getKey(e,t)}}}update(e,t,i,r,n){var o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(e,t,i,r,n,o){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ad),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,o,a){var s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),c=s.get("line-cap").evaluate(e,{}),h=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,l,c,h,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,o,r,a)}addLine(l,c,h,u,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<l.length-1;e++)this.totalDistance+=l[e].dist(l[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var f="Polygon"===Id[c.type];let m=l.length;for(;2<=m&&l[m-1].equals(l[m-2]);)m--;let g=0;for(;g<m-1&&l[g].equals(l[g+1]);)g++;if(!(m<(f?3:2))){"bevel"===h&&(d=1.05);var _=this.overscaling<=16?15*ue/(512*this.overscaling):0,y=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let r,n,o,a,s;this.e1=this.e2=-1,f&&(r=l[m-2],s=l[g].sub(r)._unit()._perp());for(let i=g;i<m;i++)if(!(o=i===m-1?f?l[g+1]:void 0:l[i+1])||!l[i].equals(o)){s&&(a=s),r&&(n=r),r=l[i],s=o?o.sub(r)._unit()._perp():a;let e=(a=a||s).add(s);0===e.x&&0===e.y||e._unit();var v=a.x*s.x+a.y*s.y,x=e.x*s.x+e.y*s.y,b=0!=x?1/x:1/0,w=2*Math.sqrt(2-2*x),x=x<Pd&&n&&o,T=0<a.x*s.y-a.y*s.x;if(x&&i>g){const l=r.dist(n);if(l>2*_){const c=r.sub(r.sub(n)._mult(_/l)._round());this.updateDistance(n,c),this.addCurrentVertex(c,a,0,0,y),n=c}}var S=n&&o;let t=S?h:f?"butt":u;if(S&&"round"===t&&(b<p?t="miter":b<=2&&(t="fakeround")),"bevel"===(t="miter"===t&&d<b?"bevel":t)&&(2<b&&(t="flipbevel"),b<d)&&(t="miter"),n&&this.updateDistance(n,r),"miter"===t)e._mult(b),this.addCurrentVertex(r,e,0,0,y);else if("flipbevel"===t){if(100<b)e=s.mult(-1);else{const l=b*a.add(s).mag()/a.sub(s).mag();e._perp()._mult(l*(T?-1:1))}this.addCurrentVertex(r,e,0,0,y),this.addCurrentVertex(r,e.mult(-1),0,0,y)}else if("bevel"===t||"fakeround"===t){const l=-Math.sqrt(b*b-1),c=T?l:0,h=T?0:l;if(n&&this.addCurrentVertex(r,a,c,h,y),"fakeround"===t){const l=Math.round(180*w/Math.PI/20);for(let t=1;t<l;t++){let e=t/l;if(.5!==e){const l=e-.5;e+=e*l*(e-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*l*l+(.848013+v*(.215638*v-1.06021)))}const u=s.sub(a)._mult(e)._add(a)._unit()._mult(T?-1:1);this.addHalfVertex(r,u.x,u.y,!1,T,0,y)}}o&&this.addCurrentVertex(r,s,-c,-h,y)}else if("butt"===t)this.addCurrentVertex(r,e,0,0,y);else if("square"===t){const l=n?1:-1;n||this.addCurrentVertex(r,e,l,l,y),this.addCurrentVertex(r,e,0,0,y),n&&this.addCurrentVertex(r,e,l,l,y)}else"round"===t&&(n&&(this.addCurrentVertex(r,a,0,0,y),this.addCurrentVertex(r,a,1,1,y,!0)),o)&&(this.addCurrentVertex(r,s,-1,-1,y,!0),this.addCurrentVertex(r,s,0,0,y));if(x&&i<m-1){const l=r.dist(o);if(l>2*_){const c=r.add(o.sub(r)._mult(_/l)._round());this.updateDistance(r,c),this.addCurrentVertex(c,s,0,0,y),r=c}}}}}addCurrentVertex(e,t,i,r,n,o=!1){var a=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,n),this.addHalfVertex(e,a,s,o,!0,-r,n)}addHalfVertex({x:e,y:t},i,r,n,o,a,s){this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);e=s.vertexLength++;0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,e),s.primitiveLength++),o?this.e2=e:this.e1=e}updateScaledDistance(){var e;this.lineClips?(e=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}n(Ld,"LineBucket",{omit:["layers","patternFeatures"]});var i=new d({"line-cap":new s(p.layout_line["line-cap"]),"line-join":new s(p.layout_line["line-join"]),"line-miter-limit":new a(p.layout_line["line-miter-limit"]),"line-round-limit":new a(p.layout_line["line-round-limit"]),"line-sort-key":new s(p.layout_line["line-sort-key"]),visibility:new a(p.layout_line.visibility)}),Dd={paint:new d({"line-opacity":new s(p.paint_line["line-opacity"]),"line-color":new s(p.paint_line["line-color"]),"line-translate":new a(p.paint_line["line-translate"]),"line-translate-anchor":new a(p.paint_line["line-translate-anchor"]),"line-width":new s(p.paint_line["line-width"]),"line-gap-width":new s(p.paint_line["line-gap-width"]),"line-offset":new s(p.paint_line["line-offset"]),"line-blur":new s(p.paint_line["line-blur"]),"line-dasharray":new s(p.paint_line["line-dasharray"]),"line-pattern":new s(p.paint_line["line-pattern"]),"line-gradient":new ao(p.paint_line["line-gradient"]),"line-trim-offset":new a(p.paint_line["line-trim-offset"]),"line-emissive-strength":new a(p.paint_line["line-emissive-strength"]),"line-border-width":new s(p.paint_line["line-border-width"]),"line-border-color":new s(p.paint_line["line-border-color"])}),layout:i};function kd(e,t,i){return t*(ue/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function zd(e,t){return 1/kd(e,1,t.tileZoom)}function Rd(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Od=e=>{var t=[],i=(Bd(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),e.paint.get("line-trim-offset"));return 0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Bd(e){e=e.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Fd=new class extends s{possiblyEvaluate(e,t){return t=new Kn(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=ne({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}(Dd.paint.properties["line-width"].specification);function Nd(e,t){return 0<t?t+2*e:e}Fd.useIntegerZoom=!0;const Ud=m([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jd=m([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vd=m([{name:"a_projected_pos",components:4,type:"Float32"}],4),Gd=(m([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),m([{name:"a_z_offset",components:1,type:"Float32"}],4)),qd=m([{name:"a_texb",components:2,type:"Uint16"}]),Wd=m([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Hd=m([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]),Zd=(m([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),m([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),$d=m([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);m([{name:"triangle",components:3,type:"Uint16"}]),m([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),m([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),m([{type:"Float32",name:"offsetX"}]),m([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xd=24;const Yd=128;function Kd(i,r){var n=r["expression"];if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Kn(i+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:r,interpolationType:s}=n;let e=0;for(;e<r.length&&r[e]<=i;)e++;let t=e=Math.max(0,e-1);for(;t<r.length&&r[t]<i+1;)t++;t=Math.min(r.length-1,t);var o=r[e],a=r[t];return"composite"===n.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:s}:{kind:"camera",minZoom:o,maxZoom:a,minSize:n.evaluate(new Kn(o)),maxSize:n.evaluate(new Kn(a)),interpolationType:s}}}function Jd(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===e.kind?r/Yd:"composite"===e.kind?A(r/Yd,n/Yd,i):t}function Qd(e,t){let i=0,r=0;var n,o,a;return"constant"===e.kind?r=e.layoutSize:"source"!==e.kind&&({interpolationType:a,minZoom:n,maxZoom:o}=e,a=a?S(Hr.interpolationFactor(a,t,n,o),0,1):0,"camera"===e.kind?r=A(e.minSize,e.maxSize,a):i=a),{uSizeT:i,uSize:r}}t=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Yd,evaluateSizeForFeature:Jd,evaluateSizeForZoom:Qd,getSizeData:Kd});const ep={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};var v=I,tp={read:function(e,t,i,r,n){var o,a,s=8*n-r-1,l=(1<<s)-1,c=l>>1,h=-7,u=i?n-1:0,d=i?-1:1,n=e[t+u];for(u+=d,o=n&(1<<-h)-1,n>>=-h,h+=s;0<h;o=256*o+e[t+u],u+=d,h-=8);for(a=o&(1<<-h)-1,o>>=-h,h+=r;0<h;a=256*a+e[t+u],u+=d,h-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(n?-1:1);a+=Math.pow(2,r),o-=c}return(n?-1:1)*a*Math.pow(2,o-r)},write:function(e,t,i,r,n,o){var a,s,l=8*o-n-1,c=(1<<l)-1,h=c>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-a))<1&&(a--,r*=2),2<=(t+=1<=a+h?u/r:u*Math.pow(2,1-h))*r&&(a++,r/=2),c<=a+h?(s=0,a=c):1<=a+h?(s=(t*r-1)*Math.pow(2,n),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),a=0));8<=n;e[i+d]=255&s,d+=p,s/=256,n-=8);for(a=a<<n|s,l+=n;0<l;e[i+d]=255&a,d+=p,a/=256,l-=8);e[i+d-p]|=128*o}};function I(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}I.Varint=0,I.Fixed64=1,I.Bytes=2,I.Fixed32=5;var ip=4294967296,rp=1/ip,np="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function op(e){return e.type===I.Bytes?e.readVarint()+e.pos:e.pos+1}function ap(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function sp(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;e<=n;n--)i.buf[n+r]=i.buf[n]}function lp(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function cp(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function hp(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function up(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function dp(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function pp(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function fp(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function mp(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function gp(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function _p(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function yp(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function vp(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}I.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=_p(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=vp(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=_p(this.buf,this.pos)+_p(this.buf,this.pos+4)*ip;return this.pos+=8,e},readSFixed64:function(){var e=_p(this.buf,this.pos)+vp(this.buf,this.pos+4)*ip;return this.pos+=8,e},readFloat:function(){var e=tp.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=tp.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,i=127&(n=t[this.pos++]);if(n<128||(i|=(127&(n=t[this.pos++]))<<7,n<128)||(i|=(127&(n=t[this.pos++]))<<14,n<128)||(i|=(127&(n=t[this.pos++]))<<21,n<128))return i;var r,n=i|=(15&t[this.pos])<<28,t=e,i=this,e=i.buf,o=(112&(r=e[i.pos++]))>>4;if(r<128)return ap(n,o,t);if(o|=(127&(r=e[i.pos++]))<<3,r<128)return ap(n,o,t);if(o|=(127&(r=e[i.pos++]))<<10,r<128)return ap(n,o,t);if(o|=(127&(r=e[i.pos++]))<<17,r<128)return ap(n,o,t);if(o|=(127&(r=e[i.pos++]))<<24,r<128)return ap(n,o,t);if(o|=(1&(r=e[i.pos++]))<<31,r<128)return ap(n,o,t);throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e,t=this.readVarint()+this.pos,i=this.pos;if(12<=(this.pos=t)-i&&np)return e=this.buf,np.decode(e.subarray(i,t));for(var r=this.buf,n=t,o="",a=i;a<n;){var s,l,c,h=r[a],u=null,d=239<h?4:223<h?3:191<h?2:1;if(n<a+d)break;1===d?h<128&&(u=h):2===d?128==(192&(s=r[a+1]))&&(u=(31&h)<<6|63&s)<=127&&(u=null):3===d?(l=r[a+2],128==(192&(s=r[a+1]))&&128==(192&l)&&((u=(15&h)<<12|(63&s)<<6|63&l)<=2047||55296<=u&&u<=57343)&&(u=null)):4===d&&(l=r[a+2],c=r[a+3],128==(192&(s=r[a+1])))&&128==(192&l)&&128==(192&c)&&((u=(15&h)<<18|(63&s)<<12|(63&l)<<6|63&c)<=65535||1114112<=u)&&(u=null),null===u?(u=65533,d=1):65535<u&&(u-=65536,o+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),o+=String.fromCharCode(u),a+=d}return o},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==I.Bytes)return e.push(this.readVarint(t));var i=op(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==I.Bytes)return e.push(this.readSVarint());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==I.Bytes)return e.push(this.readBoolean());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==I.Bytes)return e.push(this.readFloat());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==I.Bytes)return e.push(this.readDouble());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==I.Bytes)return e.push(this.readFixed32());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==I.Bytes)return e.push(this.readSFixed32());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==I.Bytes)return e.push(this.readFixed64());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==I.Bytes)return e.push(this.readSFixed64());var t=op(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){e&=7;if(e===I.Varint)for(;127<this.buf[this.pos++];);else if(e===I.Bytes)this.pos=this.readVarint()+this.pos;else if(e===I.Fixed32)this.pos+=4;else{if(e!==I.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t,i=this.length||16;i<this.pos+e;)i*=2;i!==this.length&&((t=new Uint8Array(i)).set(this.buf),this.buf=t,this.length=i)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),yp(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),yp(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),yp(this.buf,-1&e,this.pos),yp(this.buf,Math.floor(e*rp),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),yp(this.buf,-1&e,this.pos),yp(this.buf,Math.floor(e*rp),this.pos+4),this.pos+=8},writeVarint:function(e){if(268435455<(e=+e||0)||e<0){var t,i,r,n,o=this;if(0<=e?(r=e%4294967296|0,t=e/4294967296|0):(t=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:t=t+1|(r=0)),0x10000000000000000<=e||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),r=r,(n=o).buf[n.pos++]=127&r|128,r>>>=7,n.buf[n.pos++]=127&r|128,r>>>=7,n.buf[n.pos++]=127&r|128,r>>>=7,n.buf[n.pos++]=127&r|128,n.buf[n.pos]=127&(r>>>=7),i=(7&(n=t))<<4,(o=o).buf[o.pos++]|=i|((n>>>=3)?128:0),n&&(o.buf[o.pos++]=127&n|((n>>>=7)?128:0),n)&&(o.buf[o.pos++]=127&n|((n>>>=7)?128:0),n)&&(o.buf[o.pos++]=127&n|((n>>>=7)?128:0),n)&&(o.buf[o.pos++]=127&n|((n>>>=7)?128:0),n)&&(o.buf[o.pos++]=127&n)}else this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127)||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127)||(this.buf[this.pos++]=e>>>7&127)},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos,e=(this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if(55295<(r=t.charCodeAt(o))&&r<57344){if(!n){56319<r||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos),this.pos-t);128<=e&&sp(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(e){this.realloc(4),tp.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),tp.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos,e=(e(t,this),this.pos-i);128<=e&&sp(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeMessage:function(e,t,i){this.writeTag(e,I.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,lp,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,cp,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,dp,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,hp,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,up,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,pp,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,fp,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,mp,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,gp,t)},writeBytesField:function(e,t){this.writeTag(e,I.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,I.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,I.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,I.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,I.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,I.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,I.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,I.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,I.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,I.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var xp=G(v);const bp=3;function wp(e,t,i){t.glyphs=[],1===e&&i.readMessage(Tp,t)}function Tp(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:o,left:a,top:s,advance:l}=i.readMessage(Sp,{});t.glyphs.push({id:e,bitmap:new Rh({width:n+2*bp,height:o+2*bp},r),metrics:{width:n,height:o,left:a,top:s,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function Sp(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const Ap=bp,Ep={horizontal:1,vertical:2,horizontalOnly:3};class Cp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){var i=new Cp;return i.scale=e||1,i.fontStack=t,i}static forImage(e){var t=new Cp;return t.imageName=e,t}}class Mp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){var r=new Mp;for(let e=0;e<t.sections.length;e++){var n=t.sections[e];n.image?r.addImageSection(n):r.addTextSection(n,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(t,i){let r="";for(let e=0;e<t.length;e++){var n=t.charCodeAt(e+1)||null,o=t.charCodeAt(e-1)||null;r+=!i&&(n&&Bn(n)&&!ep[t[e+1]]||o&&Bn(o)&&!ep[t[e-1]])||!ep[t[e]]?t[e]:ep[t[e]]}return r}(this.text,e)}trim(){let t=0;for(let e=0;e<this.text.length&&Pp[this.text.charCodeAt(e)];e++)t++;let i=this.text.length;for(let e=this.text.length-1;0<=e&&e>=t&&Pp[this.text.charCodeAt(e)];e--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(e,t){var i=new Mp;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Cp.forText(t.scale,t.fontStack||e));var i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(e){var t,e=e.image?e.image.namePrimary:"";0===e.length?_e("Can't add FormattedSection with an empty image."):(t=this.getNextImageSectionCharCode())?(this.text+=String.fromCodePoint(t),this.sections.push(Cp.forImage(e)),this.sectionIndex.push(this.sections.length-1)):_e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ip(i,r,n,o,e,p,a,s,l,c,t,h,f,u,m){var d=Mp.fromFeature(i,e);h===Ep.vertical&&d.verticalizePunctuation(f);let g=[];var _=function(t,i,r,n,o){if(!t)return[];var a,s=[],l=function(t,i,e,r,n,o){let a=0;for(let e=0;e<t.length();e++){var s=t.getSection(e);a+=Dp(t.getCodePoint(e),s,r,n,i,o)}return a/Math.max(1,Math.ceil(a/e))}(t,i,p,r,n,o),c=0<=t.text.indexOf("​");let h=0;for(let e=0;e<t.length();e++){var u=t.getSection(e),d=t.getCodePoint(e);if(Pp[d]||(h+=Dp(d,u,r,n,i,o)),e<t.length()-1){const i=!((a=d)<11904||!(j["Bopomofo Extended"](a)||j.Bopomofo(a)||j["CJK Compatibility Forms"](a)||j["CJK Compatibility Ideographs"](a)||j["CJK Compatibility"](a)||j["CJK Radicals Supplement"](a)||j["CJK Strokes"](a)||j["CJK Symbols and Punctuation"](a)||j["CJK Unified Ideographs Extension A"](a)||j["CJK Unified Ideographs"](a)||j["Enclosed CJK Letters and Months"](a)||j["Halfwidth and Fullwidth Forms"](a)||j.Hiragana(a)||j["Ideographic Description Characters"](a)||j["Kangxi Radicals"](a)||j["Katakana Phonetic Extensions"](a)||j.Katakana(a)||j["Vertical Forms"](a)||j["Yi Radicals"](a)||j["Yi Syllables"](a)));(Lp[d]||i||u.imageName)&&s.push(zp(e+1,h,l,s,function(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}(d,t.getCodePoint(e+1),i&&c),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(zp(t.length(),h,l,s,0,!0))}(d,c,r,o,u),{processBidirectionalText:e,processStyledBidirectionalText:u}=Yn;if(e&&1===d.sections.length){const i=e(d.toString(),_);for(const r of i){const i=new Mp;i.text=r,i.sections=d.sections;for(let e=0;e<r.length;e++)i.sectionIndex.push(0);g.push(i)}}else if(u){const i=u(d.text,d.sectionIndex,_);for(const r of i){const i=new Mp;i.text=r[0],i.sectionIndex=r[1],i.sections=d.sections,g.push(i)}}else g=function(e){const t=[],i=e.text;let r=0;for(const i of _)t.push(e.substring(r,i)),r=i;return r<i.length&&t.push(e.substring(r,i.length)),t}(d);var y,v=[],i={positionedLines:v,text:d.toString(),top:t[1],bottom:t[1],left:t[0],right:t[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};{var x=i,b=r,w=n,T=o,S=g,A=a,E=s,C=l,O=h,M=c,I=f,B=m;let u=0,d=0,e=0;const D="right"===C?1:"left"===C?0:.5;let p=!1;for(const x of S){const w=x.getSections();for(const x of w)if(!x.imageName){const w=b[x.fontStack];if(w&&!(p=void 0!==w.ascender&&void 0!==w.descender))break}if(!p)break}let t=0;for(const E of S){E.trim();const S=E.getMaxScale(),C=(S-1)*Xd,k={positionedGlyphs:[],lineOffset:0},z=(x.positionedLines[t]=k).positionedGlyphs;let h=0;if(E.length()){let l=0,c=0;for(let s=0;s<E.length();s++){const C=E.getSection(s),e=E.getSectionIndex(s),D=E.getCodePoint(s);let t=C.scale,i=null,r=null,n=null,o=Xd,a=0;y=!(O===Ep.horizontal||!I&&!On(D)||I&&(Pp[D]||(y=D,j.Arabic(y))||j["Arabic Supplement"](y)||j["Arabic Extended-A"](y)||j["Arabic Presentation Forms-A"](y)||j["Arabic Presentation Forms-B"](y)));if(C.imageName){const b=T[C.imageName];if(!b)continue;n=C.imageName,x.iconsInText=x.iconsInText||!0,r=b.paddedRect;const w=b.displaySize,A=(t=t*Xd/B,i={width:w[0],height:w[1],left:0,top:-Ap,advance:y?w[1]:w[0],localGlyph:!1},a=p?-i.height*t:S*Xd-17-w[1]*t,o=i.advance,(y?w[0]:w[1])*t-Xd*S);0<A&&A>h&&(h=A)}else{const x=w[C.fontStack];if(!x)continue;x[D]&&(r=x[D]);const T=b[C.fontStack];if(!T)continue;const A=T.glyphs[D];if(!A)continue;if(i=A.metrics,o=8203!==D?Xd:0,p){const x=void 0!==T.ascender?Math.abs(T.ascender):0,b=void 0!==T.descender?Math.abs(T.descender):0,w=(x+b)*t;l<w&&(l=w,c=(x-b)/2*t),a=-x*t}else a=(S-t)*Xd-17}y?(x.verticalizable=!0,z.push({glyph:D,imageName:n,x:u,y:d+a,vertical:y,scale:t,localGlyph:i.localGlyph,fontStack:C.fontStack,sectionIndex:e,metrics:i,rect:r}),u+=o*t+M):(z.push({glyph:D,imageName:n,x:u,y:d+a,vertical:y,scale:t,localGlyph:i.localGlyph,fontStack:C.fontStack,sectionIndex:e,metrics:i,rect:r}),u+=i.advance*t+M)}0!==z.length&&(e=Math.max(u-M,e),p?Op(z,D,h,c,A*S/2):Op(z,D,h,0,A/2)),u=0;var F=A*S+h;k.lineOffset=Math.max(h,C),d+=F}else d+=A;++t}const k=d,{horizontalAlign:z,verticalAlign:R}=Rp(E);var P=x.positionedLines,L=D,C=z,N=(L-C)*e,U=-k*R;for(const L of P)for(const P of L.positionedGlyphs)P.x+=N,P.y+=U;x.top+=-R*k,x.bottom=x.top+k,x.left+=-z*e,x.right=x.left+e,x.hasBaseline=p}return!function(){for(const e of v)if(0!==e.positionedGlyphs.length)return;return 1}()&&i}const Pp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dp(e,t,i,r,n,o){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*Xd/o+n:0}{const r=i[t.fontStack],o=r&&r.glyphs[e];return o?o.metrics.advance*t.scale+n:0}}function kp(e,t,i,r){var n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function zp(e,t,i,r,n,o){let a=null,s=kp(t,i,n,o);for(const e of r){const r=kp(t-e.x,i,n,o)+e.badness;r<=s&&(a=e,s=r)}return{index:e,x:t,priorBreak:a,badness:s}}function Rp(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Op(t,e,i,r,n){if(e||i||r||n){var o=t.length-1,a=t[o],s=(a.x+a.metrics.advance*a.scale)*e;for(let e=0;e<=o;e++)t[e].x-=s,t[e].y+=i+r+n}}function Bp(e,t,i,r,n,o){var a=e.imagePrimary;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}var e=t.left*o,l=t.right*o;let c,h,u,d;h="width"===i||"both"===i?(d=n[0]+e-r[3],n[0]+l+r[1]):(d=n[0]+(e+l-a.displaySize[0])/2)+a.displaySize[0];e=t.top*o,l=t.bottom*o;return u="height"===i||"both"===i?(c=n[1]+e-r[0],n[1]+l+r[2]):(c=n[1]+(e+l-a.displaySize[1])/2)+a.displaySize[1],{imagePrimary:a,imageSecondary:void 0,top:c,right:h,bottom:u,left:d,collisionPadding:s}}class Fp extends U{constructor(e,t,i,r,n){super(e,t),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new Fp(this.x,this.y,this.z,this.angle,this.segment)}}function Np(n,o,a,s,l){if(void 0!==o.segment){let e=o,t=o.segment+1,i=0;for(;i>-a/2;){if(--t<0)return;i-=n[t].dist(e),e=n[t]}i+=n[t].dist(n[t+1]),t++;var c=[];let r=0;for(;i<a/2;){const o=n[t],a=n[t+1];if(!a)return;var h=n[t-1].angleTo(o)-o.angleTo(a),h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI);for(c.push({distance:i,angleDelta:h}),r+=h;i-c[0].distance>s;)r-=c.shift().angleDelta;if(r>l)return;t++,i+=o.dist(a)}}return 1}function Up(t){let i=0;for(let e=0;e<t.length-1;e++)i+=t[e].dist(t[e+1]);return i}function jp(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Vp(e,t,i,r,n,o,a,s,l){var c=r?.6*o*a:0,r=jp(r,n),n=r*a,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-n<t/4&&(t=n+t/4),function e(t,i,r,n,o,a,s,l,c){const h=a/2,u=Up(t);let d=0,p=i-r,f=[];for(let e=0;e<t.length-1;e++){const s=t[e],l=t[e+1],m=s.dist(l),g=l.angleTo(s);for(;p+r<d+m;){const _=((p+=r)-d)/m,y=A(s.x,l.x,_),v=A(s.y,l.y,_);if(0<=y&&y<c&&0<=v&&v<c&&0<=p-h&&p+h<=u){const r=new Fp(y,v,0,g,e);n&&!Np(t,r,a,n,o)||f.push(r)}}d+=m}return l||f.length||s||(f=e(t,d/2,r,n,o,a,s,!0,c)),f}(e,h?t/2*s%t:(r/2+2*o)*a*s%t,t,c,i,n,h,!1,l)}function Gp(t,n,o,a,s){var l=[];for(let e=0;e<t.length;e++){var c=t[e];let r;for(let i=0;i<c.length-1;i++){let e=c[i],t=c[i+1];e.x<n&&t.x<n||(e.x<n?e=new U(n,e.y+(n-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x<n&&(t=new U(n,e.y+(n-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y<o&&t.y<o)||(e.y<o?e=new U(e.x+(o-e.y)/(t.y-e.y)*(t.x-e.x),o)._round():t.y<o&&(t=new U(e.x+(o-e.y)/(t.y-e.y)*(t.x-e.x),o)._round()),e.x>=a&&t.x>=a)||(e.x>=a?e=new U(a,e.y+(a-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x>=a&&(t=new U(a,e.y+(a-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y>=s&&t.y>=s)||(e.y>=s?e=new U(e.x+(s-e.y)/(t.y-e.y)*(t.x-e.x),s)._round():t.y>=s&&(t=new U(e.x+(s-e.y)/(t.y-e.y)*(t.x-e.x),s)._round()),r&&e.equals(r[r.length-1])||(r=[e],l.push(r)),r.push(t))}}return l}function qp(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort((e,t)=>t.h-e.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,o=0;for(const t of e)for(let e=r.length-1;0<=e;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):(t.w!==i.w&&r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:n,h:o,fill:t/(n*o)||0}}n(Fp,"Anchor");const Wp=1;class Hp{constructor(e,{pixelRatio:t,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+Wp,this.paddedRect.y+Wp]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wp,this.paddedRect.y+this.paddedRect.h-Wp]}get displaySize(){return[(this.paddedRect.w-2*Wp)/this.pixelRatio,(this.paddedRect.h-2*Wp)/this.pixelRatio]}}class Zp{constructor(e,t){const i={},r={},n=(this.haveRenderCallbacks=[],[]),{w:o,h:a}=(this.addImages(e,i,n),this.addImages(t,r,n),qp(n)),s=new Oh({width:o||1,height:a||1});for(const t in e){const r=e[t],n=i[t].paddedRect;Oh.copy(r.data,s,{x:0,y:0},{x:n.x+Wp,y:n.y+Wp},r.data,r.sdf)}for(const e in t){const i=t[e],n=r[e].paddedRect,o=n.x+Wp,a=n.y+Wp,l=i.data.width,c=i.data.height;Oh.copy(i.data,s,{x:0,y:0},{x:o,y:a},i.data),Oh.copy(i.data,s,{x:0,y:c-1},{x:o,y:a-1},{width:l,height:1}),Oh.copy(i.data,s,{x:0,y:0},{x:o,y:a+c},{width:l,height:1}),Oh.copy(i.data,s,{x:l-1,y:0},{x:o-1,y:a},{width:1,height:c}),Oh.copy(i.data,s,{x:0,y:0},{x:o+l,y:a},{width:1,height:c})}this.image=s,this.iconPositions=i,this.patternPositions=r}addImages(e,t,i){for(const o in e){var r=e[o],n={x:0,y:0,w:r.data.width+2*Wp,h:r.data.height+2*Wp};i.push(n),t[o]=new Hp(n,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(t,e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(e=>t.hasImage(e,i)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const r in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[r],t.getImage(r,i),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r,i),e)}patchUpdatedImage(e,t,i){var r,n;e&&t&&e.version!==t.version&&(e.version=t.version,[e,r]=e.tl,n=!!Object.keys(this.patternPositions).length,i.update(t.data,{useMipmap:n},{x:e,y:r}))}}n(Hp,"ImagePosition"),n(Zp,"ImageAtlas");const $p=1e20;function Xp(t,i,r,n,o,a,s,l,c){for(let e=i;e<i+n;e++)Yp(t,r*a+e,a,o,s,l,c);for(let e=r;e<r+o;e++)Yp(t,e*a+i,1,n,s,l,c)}function Yp(r,n,o,a,s,l,c){c[l[0]=0]=-$p,c[1]=$p,s[0]=r[n];for(let e=1,t=0,i=0;e<a;e++){s[e]=r[n+e*o];const a=e*e;do{const r=l[t];i=(s[e]-s[r]+a-r*r)/(e-r)/2}while(i<=c[t]&&-1<--t);l[++t]=e,c[t]=i,c[t+1]=$p}for(let e=0,t=0;e<a;e++){for(;c[t+1]<e;)t++;const a=l[t],i=e-a;r[n+e*o]=s[a]+i*i}}const Kp=2,Jp={none:0,ideographs:1,all:2};class Qp{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,n){const i=[],l=this.urls[t]||o.GLYPHS_URL;for(const t in e)for(const n of e[t])i.push({stack:t,id:n});re(i,({stack:i,id:n},o)=>{let a=this.entries[i];var e=(a=a||(this.entries[i]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0})).glyphs[n];if(void 0!==e)o(null,{stack:i,id:n,glyph:e});else if(e=this._tinySDF(a,i,n))a.glyphs[n]=e,o(null,{stack:i,id:n,glyph:e});else{const s=Math.floor(n/256);if(65535<256*s)o(new Error("glyphs > 65535 not supported"));else if(a.ranges[s])o(null,{stack:i,id:n,glyph:e});else{let r=a.requests[s];r||(r=a.requests[s]=[],Qp.loadGlyphRange(i,s,l,this.requestManager,(e,t)=>{if(t){a.ascender=t.ascender,a.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(a.glyphs[+e]=t.glyphs[+e]);a.ranges[s]=!0}for(const i of r)i(e,t);delete a.requests[s]})),r.push((e,t)=>{e?o(e):t&&o(null,{stack:i,id:n,glyph:t.glyphs[n]||null})})}}},(e,t)=>{if(e)n(e);else if(t){const e={};for(const{stack:n,id:i,glyph:r}of t)void 0===e[n]&&(e[n]={}),void 0===e[n].glyphs&&(e[n].glyphs={}),e[n].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[n].ascender=this.entries[n].ascender,e[n].descender=this.entries[n].descender;n(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Jp.none&&(this.localGlyphMode===Jp.all?!!this.localFontFamily:!!this.localFontFamily&&(j["CJK Unified Ideographs"](e)||j["Hangul Syllables"](e)||j.Hiragana(e)||j.Katakana(e)||j["CJK Symbols and Punctuation"](e)||j["CJK Unified Ideographs Extension A"](e)||j["CJK Unified Ideographs Extension B"](e)))}_tinySDF(i,r,e){var n,o,a,s,l,c=this.localFontFamily;if(c&&this._doesCharSupportLocalGlyph(e)){let t=i.tinySDF;if(!t){let e="400";/bold/i.test(r)?e="900":/medium/i.test(r)?e="500":/light/i.test(r)&&(e="200"),(t=i.tinySDF=new Qp.TinySDF({fontFamily:c,fontWeight:e,fontSize:24*Kp,buffer:3*Kp,radius:8*Kp})).fontWeight=e}return this.localGlyphs[t.fontWeight][e]||(r=String.fromCodePoint(e),{data:i,width:c,height:r,glyphWidth:n,glyphHeight:o,glyphLeft:a,glyphTop:s,glyphAdvance:l}=t.draw(r),this.localGlyphs[t.fontWeight][e]={id:e,bitmap:new Rh({width:c,height:r},i),metrics:{width:n/Kp,height:o/Kp,left:a/Kp,top:s/Kp-27,advance:l/Kp,localGlyph:!0}})}}}Qp.loadGlyphRange=function(e,t,i,r,n){var t=256*t,o=255+t,r=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",t+"-"+o),Je.Glyphs);tt(r,(e,t)=>{if(e)n(e);else if(t){const e={},i=new xp(t).readFields(wp,{});for(const t of i.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}})},Qp.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;r=this.size=e+4*t,i=this._createCanvas(r),t=this.ctx=i.getContext("2d",{willReadFrequently:!0});t.font=a+` ${o} ${e}px `+n,t.textBaseline="alphabetic",t.textAlign="left",t.fillStyle="black",this.gridOuter=new Float64Array(r*r),this.gridInner=new Float64Array(r*r),this.f=new Float64Array(r),this.z=new Float64Array(r+1),this.v=new Uint16Array(r)}_createCanvas(e){var t=document.createElement("canvas");return t.width=t.height=e,t}draw(i){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:e,actualBoundingBoxRight:o}=this.ctx.measureText(i),a=Math.ceil(r),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-e))),l=Math.min(this.size-this.buffer,a+Math.ceil(n)),c=s+2*this.buffer,h=l+2*this.buffer,u=Math.max(c*h,0),d=new Uint8ClampedArray(u),p={data:d,width:c,height:h,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0!==s&&0!==l){var{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this,y=(f.clearRect(m,m,s,l),f.fillText(i,m,m+a),f.getImageData(m,m,s,l));_.fill($p,0,u),g.fill(0,0,u);for(let t=0;t<l;t++)for(let e=0;e<s;e++){const r=y.data[4*(t*s+e)+3]/255;if(0!=r){const n=(t+m)*c+e+m;if(1==r)_[n]=0,g[n]=$p;else{const i=.5-r;_[n]=0<i?i*i:0,g[n]=i<0?i*i:0}}}Xp(_,0,0,c,h,c,this.f,this.v,this.z),Xp(g,m,m,s,l,c,this.f,this.v,this.z);for(let e=0;e<u;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}}return p}};const ef=Wp;function tf(p,f,m,t){const i=[],g=p.imagePrimary,_=g.pixelRatio,e=g.paddedRect.w-2*ef,r=g.paddedRect.h-2*ef,y=p.right-p.left,v=p.bottom-p.top,n=g.stretchX||[[0,e]],o=g.stretchY||[[0,r]],a=(e,t)=>e+t[1]-t[0],x=n.reduce(a,0),b=o.reduce(a,0),s=e-x,l=r-b;let w=0,T=x,S=0,A=b,E=0,C=s,M=0,I=l;if(g.content&&t){const p=g.content;w=rf(n,0,p[0]),S=rf(o,0,p[1]),T=rf(n,p[0],p[2]),A=rf(o,p[1],p[3]),E=p[0]-w,M=p[1]-S,C=p[2]-p[0]-T,I=p[3]-p[1]-A}var c=(e,t,i,r)=>{var n=(e.stretch-w)/T*y+p.left,o=e.fixed-E-C*e.stretch/x,a=(t.stretch-S)/A*v+p.top,s=t.fixed-M-I*t.stretch/b,l=(i.stretch-w)/T*y+p.left,c=i.fixed-E-C*i.stretch/x,h=(r.stretch-S)/A*v+p.top,u=r.fixed-M-I*r.stretch/b,d=new U(n,a),a=new U(l,a),l=new U(l,h),n=new U(n,h),h=new U(o/_,s/_),o=new U(c/_,u/_),s=f*Math.PI/180;if(s){const p=Math.sin(s),f=Math.cos(s),m=[f,-p,p,f];d._matMult(m),a._matMult(m),n._matMult(m),l._matMult(m)}c=e.stretch+e.fixed,u=i.stretch+i.fixed,s=t.stretch+t.fixed,e=r.stretch+r.fixed,i=p.imageSecondary;return{tl:d,tr:a,bl:n,br:l,texPrimary:{x:g.paddedRect.x+ef+c,y:g.paddedRect.y+ef+s,w:u-c,h:e-s},texSecondary:i?{x:i.paddedRect.x+ef+c,y:i.paddedRect.y+ef+s,w:u-c,h:e-s}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:h,pixelOffsetBR:o,minFontScaleX:C/_/y,minFontScaleY:I/_/v,isSDF:m}};if(t&&(g.stretchX||g.stretchY)){const p=nf(n,s,x),f=nf(o,l,b);for(let e=0;e<p.length-1;e++){const t=p[e],g=p[e+1];for(let e=0;e<f.length-1;e++)i.push(c(t,f[e],g,f[e+1]))}}else i.push(c({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+e},{fixed:0,stretch:1+r}));return i}function rf(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function nf(e,t,i){var r=[{fixed:-ef,stretch:0}];for(const[t,i]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return r.push({fixed:t+ef,stretch:i}),r}function of(e,t){return t.max-e.max}class af{constructor(e,t,i,r){this.p=new U(e,t),this.h=i,this.d=function(r,t){let n=!1,o=1/0;for(let e=0;e<t.length;e++){var a=t[e];for(let e=0,t=a.length,i=t-1;e<t;i=e++){var s=a[e],l=a[i];s.y>r.y!=l.y>r.y&&r.x<(l.x-s.x)*(r.y-s.y)/(l.y-s.y)+s.x&&(n=!n),o=Math.min(o,js(r,s,l))}}return(n?1:-1)*Math.sqrt(o)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const sf=Number.POSITIVE_INFINITY,lf=Math.sqrt(2);function cf(e,[t,i]){let r=0,n=0;if(i===sf){const i=(t=t<0?0:t)/lf;switch(e){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-t;break;case"top":n=t-7}switch(e){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=t;break;case"right":r=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}}return[r,n]}function hf(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uf(Z,$,X,Y,K,J,e,t,Q,ee,te,ie,i,re,ne){let r=J.textMaxSize.evaluate($,{},ie);void 0===r&&(r=e);const n=Z.layers[0].layout,oe=n.get("icon-offset").evaluate($,{},ie),o=mf(X.horizontal)||X.vertical,a="globe"===i.name,s=Xd,l=e/s,c=Z.tilePixelRatio*r/s,h=(e=Z.overscaling,18<Z.zoom&&2<e&&(e>>=1),Math.max(ue/(512*e),1)*n.get("symbol-spacing")),ae=n.get("text-padding")*Z.tilePixelRatio,se=n.get("icon-padding")*Z.tilePixelRatio,u=_(n.get("text-max-angle")),le="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement"),ce="map"===n.get("icon-rotation-alignment")&&"point"!==n.get("symbol-placement"),d=n.get("symbol-placement"),p=h/2;var e=n.get("icon-text-fit").evaluate($,{},ie),f=n.get("icon-text-fit-padding").evaluate($,{},ie),m="none"!==e;let he;!1===Z.hasAnyIconTextFit&&m&&(Z.hasAnyIconTextFit=!0),Y&&m&&(Z.allowVerticalPlacement&&X.vertical&&(he=Bp(Y,X.vertical,e,f,oe,l)),o)&&(Y=Bp(Y,o,e,f,oe,l));var g=(_,y,v)=>{if(!(y.x<0||y.x>=ue||y.y<0||y.y>=ue)){let g=null;if(a){const{x:Z,y:$,z:X}=i.projectTilePoint(y.x,y.y,v);g={anchor:new Fp(Z,$,X,0,void 0),up:i.upVector(v,y.x,y.y)}}{var x=Z;var b=y;var w=g;var T=_;var S=X;var A=Y;var E=K;var C=he;var M=Z.layers[0];var I=Z.collisionBoxArray;var P=$.index;var L=$.sourceLayerIndex;var D=Z.index;var k=ae;var z=le;var R=Q;v=se;y=ce;_=oe;var O=$;var B=J;var F=ee;var N=te;var U=ie;var j=re;var V=ne;var G=x.addToLineVertexArray(b,T);let e,t,i,r,n,o,a,s=0,l=0,c=0,h=0,u=-1,d=-1;var q={};let p=ba("");var W=w?w.anchor:b,H="none"!==M.layout.get("icon-text-fit").evaluate(O,{},U);let f=0,m=0;if(void 0===M._unevaluatedLayout.getValue("text-radial-offset")?[f,m]=M.layout.get("text-offset").evaluate(O,{},U).map(e=>e*Xd):(f=M.layout.get("text-radial-offset").evaluate(O,{},U)*Xd,m=sf),x.allowVerticalPlacement&&S.vertical){const x=S.vertical;if(z)o=_f(x),C&&(a=_f(C));else{const w=M.layout.get("text-rotate").evaluate(O,{},U)+90;i=gf(I,W,b,P,L,D,x,k,w,R),C&&(r=gf(I,W,b,P,L,D,C,v,w))}}if(A){const T=M.layout.get("icon-rotate").evaluate(O,{},U),S=tf(A,T,F,H),E=C?tf(C,T,F,H):void 0,k=(t=gf(I,W,b,P,L,D,A,v,T),s=4*S.length,x.iconSizeData);let e=null;"source"===k.kind?(e=[Yd*M.layout.get("icon-size").evaluate(O,{},U)])[0]>pf&&_e(`${x.layerIds[0]}: Value for "icon-size" is >= ${df}. Reduce your "icon-size".`):"composite"===k.kind&&((e=[Yd*B.compositeIconSizes[0].evaluate(O,{},U),Yd*B.compositeIconSizes[1].evaluate(O,{},U)])[0]>pf||e[1]>pf)&&_e(`${x.layerIds[0]}: Value for "icon-size" is >= ${df}. Reduce your "icon-size".`),x.addSymbols(x.icon,S,e,_,y,O,!1,w,b,G.lineStartIndex,G.lineLength,-1,N,U,j,V),u=x.icon.placedSymbolArray.length-1,E&&(l=4*E.length,x.addSymbols(x.icon,E,e,_,y,O,Ep.vertical,w,b,G.lineStartIndex,G.lineLength,-1,N,U,j,V),d=x.icon.placedSymbolArray.length-1)}for(const T in S.horizontal){const A=S.horizontal[T],C=(e||(p=ba(A.text),z?n=_f(A):e=gf(I,W,b,P,L,D,A,k,M.layout.get("text-rotate").evaluate(O,{},U),R)),1===A.positionedLines.length);if(c+=ff(x,w,b,A,E,M,z,O,R,G,S.vertical?Ep.horizontal:Ep.horizontalOnly,C?Object.keys(S.horizontal):[T],q,u,B,N,U,j),C)break}S.vertical&&(h+=ff(x,w,b,S.vertical,E,M,z,O,R,G,Ep.vertical,["vertical"],q,d,B,N,U,j));T=(e,t)=>e?Math.max(e,t):t,C=T(n,-1),C=T(o,C),F=-1<(C=T(a,C))?1:0;65535<=x.glyphOffsetArray.length&&_e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==O.sortKey&&x.addToSortKeyRanges(x.symbolInstances.length,O.sortKey),x.symbolInstances.emplaceBack(b.x,b.y,W.x,W.y,W.z,0<=q.right?q.right:-1,0<=q.center?q.center:-1,0<=q.left?q.left:-1,0<=q.vertical?q.vertical:-1,u,d,p,void 0!==e?e:x.collisionBoxArray.length,void 0!==e?e+1:x.collisionBoxArray.length,void 0!==i?i:x.collisionBoxArray.length,void 0!==i?i+1:x.collisionBoxArray.length,void 0!==t?t:x.collisionBoxArray.length,void 0!==t?t+1:x.collisionBoxArray.length,r||x.collisionBoxArray.length,r?r+1:x.collisionBoxArray.length,P,c,h,s,l,F,0,f,m,C,0,H?1:0)}}};if("line"===d)for(const K of Gp($.geometry,0,0,ue,ue)){const $=Vp(K,h,u,X.vertical||o,Y,s,c,Z.overscaling,ue);for(const X of $)o&&function(t,e,i,r){var n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;0<=e;e--)if(r.dist(t[e])<i)return 1}else n[e]=[];return n[e].push(r),0}(Z,o.text,p,X)||g(K,X,ie)}else if("line-center"===d){for(const Z of $.geometry)if(1<Z.length){const $=function(t,i,e,r,n,o){var a=e?.6*n*o:0,s=jp(e,r)*o;let l=0;var c,h,u=Up(t)/2;for(let e=0;e<t.length-1;e++){const r=t[e],n=t[e+1],o=r.dist(n);if(l+o>u)return c=(u-l)/o,h=A(r.x,n.x,c),c=A(r.y,n.y,c),h=new Fp(h,c,0,n.angleTo(r),e),!a||Np(t,h,s,a,i)?h:void 0;l+=o}}(Z,u,X.vertical||o,Y,s,c);$&&g(Z,$,ie)}}else if("Polygon"===$.type)for(const Z of lu($.geometry,0)){const $=function(i,t,e=!1){let r=1/0,n=1/0,o=-1/0,a=-1/0;var s=i[0];for(let e=0;e<s.length;e++){const t=s[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<n)&&(n=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>a)&&(a=t.y)}var l=Math.min(o-r,a-n);let c=l/2;var h=new Xi([],of);if(0===l)return new U(r,n);for(let t=r;t<o;t+=l)for(let e=n;e<a;e+=l)h.push(new af(t+c,e+c,c,i));let u=function(e){let r=0,n=0,o=0;var a=e[0];for(let e=0,t=a.length,i=t-1;e<t;i=e++){var s=a[e],l=a[i],c=s.x*l.y-l.x*s.y;n+=(s.x+l.x)*c,o+=(s.y+l.y)*c,r+=3*c}return new af(n/r,o/r,0,e)}(i),d=h.length;for(;h.length;){const r=h.pop();(r.d>u.d||!u.d)&&(u=r,e)&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d),r.max-u.d<=t||(c=r.h/2,h.push(new af(r.p.x-c,r.p.y-c,c,i)),h.push(new af(r.p.x+c,r.p.y-c,c,i)),h.push(new af(r.p.x-c,r.p.y+c,c,i)),h.push(new af(r.p.x+c,r.p.y+c,c,i)),d+=4)}return e&&(console.log("num probes: "+d),console.log("best distance: "+u.d)),u.p}(Z,16);g(Z[0],new Fp($.x,$.y,0,0,void 0),ie)}else if("LineString"===$.type)for(const Z of $.geometry)g(Z,new Fp(Z[0].x,Z[0].y,0,0,void 0),ie);else if("Point"===$.type)for(const Z of $.geometry)for(const $ of Z)g([$],new Fp($.x,$.y,0,0,void 0),ie)}const df=255,pf=df*Yd;function ff(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_){r=function(d,p,f,m,t,g,_){var y=[];if(0!==d.positionedLines.length){var i,v=f.layout.get("text-rotate").evaluate(t,{})*Math.PI/180,x=(f=p[0],t=p[1],0<(i=f*t)?[f,-t]:i<0?[-f,t]:0===f?[t,f]:[t,-f]);let e=Math.abs(d.top-d.bottom);for(const M of d.positionedLines)e-=M.lineOffset;var r,n,o,a,s,l=d.positionedLines.length,c=e/l;let u=d.top-p[1];for(let e=0;e<l;++e){const f=d.positionedLines[e];u=(r=d,n=c,o=u,a=e,s=void 0,s=n+r.positionedLines[a].lineOffset,0===a?o+s/2:o+(s+(n+r.positionedLines[a-1].lineOffset))/2);for(const M of f.positionedGlyphs)if(M.rect){const f=M.rect||{};let s=Ap+1,l=!0,c=1,h=0;if(M.imageName){const d=g[M.imageName];if(!d)continue;if(d.sdf){_e("SDF images are not supported in formatted text and will be ignored.");continue}l=!1,c=d.pixelRatio,s=Wp/c}var b=(m||_)&&M.vertical,w=M.metrics.advance*M.scale/2,T=M.metrics,S=M.rect;if(null!==S){_&&d.verticalizable&&(h=M.imageName?w-M.metrics.width*M.scale/2:0);var A=m?[M.x+w,M.y]:[0,0];let e=[0,0],t=[0,0],i=!1;m||(b?(t=[M.x+w+x[0],M.y+x[1]-h],i=!0):e=[M.x+w+p[0],M.y+p[1]-h]);var E=S.w*M.scale/(c*(M.localGlyph?Kp:1)),C=S.h*M.scale/(c*(M.localGlyph?Kp:1));let r,n,o,a;if(b){const d=M.y-u,p=new U(-w,w-d),f=-Math.PI/2,m=new U(...t),g=((r=new U(-w+e[0],e[1]))._rotateAround(f,p)._add(m),r.x+=-d+w,r.y-=(T.left-s)*M.scale,M.imageName?T.advance*M.scale:Xd*M.scale),_=String.fromCodePoint(M.glyph);"︶"===(b=_)||"﹈"===b||"︸"===b||"﹄"===b||"﹂"===b||"︾"===b||"︼"===b||"︺"===b||"︘"===b||"﹀"===b||"︐"===b||"︓"===b||"︔"===b||"｀"===b||"￣"===b||"︑"===b||"︒"===b?r.x+=(1-s)*M.scale:(b=_,r.x+="︵"===b||"﹇"===b||"︷"===b||"﹃"===b||"﹁"===b||"︽"===b||"︻"===b||"︹"===b||"︗"===b||"︿"===b?g-T.height*M.scale+(-s-1)*M.scale:M.imageName||T.width+2*s===S.w&&T.height+2*s===S.h?(g-C)/2:(g-(T.height+2*s)*M.scale)/2),n=new U(r.x,r.y-E),o=new U(r.x+C,r.y),a=new U(r.x+C,r.y-E)}else{const d=(T.left-s)*M.scale-w+e[0],p=(-T.top-s)*M.scale+e[1],f=d+E,m=p+C;r=new U(d,p),n=new U(f,p),o=new U(d,m),a=new U(f,m)}v&&(b=m?new U(0,0):i?new U(x[0],x[1]):new U(p[0],p[1]),r._rotateAround(v,b),n._rotateAround(v,b),o._rotateAround(v,b),a._rotateAround(v,b));S=new U(0,0),w=new U(0,0);y.push({tl:r,tr:n,bl:o,br:a,texPrimary:f,texSecondary:void 0,writingMode:d.writingMode,glyphOffset:A,sectionIndex:M.sectionIndex,isSDF:l,pixelOffsetTL:S,pixelOffsetBR:w,minFontScaleX:0,minFontScaleY:0})}}}}return y}(r,l,o,a,s,n,e.allowVerticalPlacement),n=e.textSizeData;let y=null;"source"===n.kind?(y=[Yd*o.layout.get("text-size").evaluate(s,{},g)])[0]>pf&&_e(`${e.layerIds[0]}: Value for "text-size" is >= ${df}. Reduce your "text-size".`):"composite"===n.kind&&((y=[Yd*f.compositeTextSizes[0].evaluate(s,{},g),Yd*f.compositeTextSizes[1].evaluate(s,{},g)])[0]>pf||y[1]>pf)&&_e(`${e.layerIds[0]}: Value for "text-size" is >= ${df}. Reduce your "text-size".`),e.addSymbols(e.text,r,y,l,a,s,h,t,i,c.lineStartIndex,c.lineLength,p,m,g,_,!1);for(const t of u)d[t]=e.text.placedSymbolArray.length-1;return 4*r.length}function mf(e){for(const t in e)return e[t];return null}function gf(t,i,r,n,o,e,a,s,l,c){let h=a.top,u=a.bottom,d=a.left,p=a.right;a=a.collisionPadding;if(a&&(d-=a[0],h-=a[1],p+=a[2],u+=a[3]),l){const t=new U(d,h),i=new U(p,h),r=new U(d,u),n=new U(p,u),o=_(l);let e=new U(0,0);c&&(e=new U(c[0],c[1])),t._rotateAround(o,e),i._rotateAround(o,e),r._rotateAround(o,e),n._rotateAround(o,e),d=Math.min(t.x,i.x,r.x,n.x),p=Math.max(t.x,i.x,r.x,n.x),h=Math.min(t.y,i.y,r.y,n.y),u=Math.max(t.y,i.y,r.y,n.y)}return t.emplaceBack(i.x,i.y,i.z,r.x,r.y,d,h,p,u,s,n,o,e),t.length-1}function _f(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);e=e.bottom-e.top;return 0<e?Math.max(10,e):null}function yf(e,t){var i=e.fovAboveCenter,t=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,t=(e._camera.position[2]*e.worldSize-t)/Math.cos(e._pitch),i=Math.sin(i)*t/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),i=Math.sin(e._pitch)*i+t;return Math.min(1.01*i,t*(1/e._horizonShift))}function vf(e,h){if(!h.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:h};var t=Math.pow(2,-e.z),i=e.x*t,r=(e.x+1)*t,n=e.y*t,e=(e.y+1)*t,o=xs(i),a=xs(r),s=bs(n),l=bs(e),c=h.project(o,s),s=h.project(a,s),a=h.project(a,l),o=h.project(o,l);let u=Math.min(c.x,s.x,a.x,o.x),d=Math.min(c.y,s.y,a.y,o.y),p=Math.max(c.x,s.x,a.x,o.x),f=Math.max(c.y,s.y,a.y,o.y);const m=t/16;function g(e,t,i,r,n,o){var a=(i+n)/2,s=(r+o)/2,l=h.project(xs(a),bs(s)),c=Math.max(0,u-l.x,d-l.y,l.x-p,l.y-f);u=Math.min(u,l.x),p=Math.max(p,l.x),d=Math.min(d,l.y),f=Math.max(f,l.y),c>m&&(g(e,l,i,r,a,s),g(l,t,a,s,n,o))}g(c,s,i,n,r,n),g(s,a,r,n,r,e),g(a,o,r,e,i,e),g(o,c,i,e,i,n),u-=m,d-=m,p+=m,f+=m;l=1/Math.max(p-u,f-d);return{scale:l,x:u*l,y:d*l,x2:p*l,y2:f*l,projection:h}}function xf(e,{x:t,y:i},r=0){return new U(((t-r)*e.scale-e.x)*ue,(i*e.scale-e.y)*ue)}const bf=Te.a6.identity(new Float32Array(16));class wf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new E(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i=!0){return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return vs(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return yf(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,r){var n=e.horizonLineFromTop(!1),t=new U(t,Math.max(n,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(t,r))}pointCoordinate3D(e,t,i){i=new U(t,i);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){return e.elevation?!this.pointCoordinate3D(e,t.x,t.y):(e=e.horizonLineFromTop(),t.y<e)}createInversionMatrix(e,t){return bf}createTileMatrix(e,t,i){let r,n,o;var a,s=i.canonical,l=Te.a6.identity(new Float64Array(16));return this.isReprojectedInTileSpace?(a=vf(s,this),r=1,n=a.x+i.wrap*a.scale,o=a.y,Te.a6.scale(l,l,[r/a.scale,r/a.scale,e.pixelsPerMeter/t])):(r=t/e.zoomScale(s.z),n=(s.x+Math.pow(2,s.z)*i.wrap)*r,o=s.y*r),Te.a6.translate(l,l,[n,o,0]),Te.a6.scale(l,l,[r/ue,r/ue,1]),l}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class Tf extends wf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];var[e,t]=this.parallels=e.parallels||[29.5,45.5],e=Math.sin(_(e));this.n=(e+Math.sin(_(t)))/2,this.c=1+e*(2*this.n-e),this.r0=Math.sqrt(this.c)/this.n}project(e,t){var{n:i,c:r,r0:n}=this,e=_(e-this.center[0]),t=_(t),r=Math.sqrt(r-2*i*Math.sin(t))/i;return{x:r*Math.sin(e*i),y:r*Math.cos(e*i)-n,z:0}}unproject(e,t){var{n:i,c:r,r0:n}=this,n=n+t;let o=Math.atan2(e,Math.abs(n))*Math.sign(n);n*i<0&&(o-=Math.PI*Math.sign(e)*Math.sign(n));t=_(this.center[0])*i,t=S(Y((o=ie(o,-Math.PI-t,Math.PI-t))/i)+this.center[0],-180,180),r=Math.asin(S((r-(e*e+n*n)*i*i)/(2*i),-1,1)),e=S(Y(r),-y,y);return new E(t,e)}}const Sf=1.340264,Af=-.081106,Ef=893e-6,Cf=.003796,Mf=Math.sqrt(3)/2;class If extends wf{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;var t=Math.asin(Mf*Math.sin(t)),i=t*t,r=i*i*i;return{x:.5*(e*Math.cos(t)/(Mf*(Sf+3*Af*i+r*(7*Ef+9*Cf*i)))/Math.PI+.5),y:1-.5*(t*(Sf+Af*i+r*(Ef+Cf*i))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=r*r,o=n*n*n;for(let e,t=0;t<12&&(e=(r*(Sf+Af*n+o*(Ef+Cf*n))-i)/(Sf+3*Af*n+o*(7*Ef+9*Cf*n)),r=S(r-e,-Math.PI/3,Math.PI/3),n=r*r,o=n*n*n,!(Math.abs(e)<1e-12));++t);var e=Mf*e*(Sf+3*Af*n+o*(7*Ef+9*Cf*n))/Math.cos(r),t=Math.asin(Math.sin(r)/Mf),e=S(180*e/Math.PI,-180,180),t=S(180*t/Math.PI,-y,y);return new E(e,t)}}class Pf extends wf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){e=360*(e-.5),t=S(360*(.5-t),-y,y);return new E(e,t)}}const Lf=Math.PI/2;function Df(e){return Math.tan((Lf+e)/2)}class kf extends wf{constructor(e){super(e),this.center=e.center||[0,30];var[e,t]=this.parallels=e.parallels||[30,30];let i=_(e),r=_(t);this.southernCenter=i+r<0,this.southernCenter&&(i=-i,r=-r);e=Math.cos(i),t=Df(i);this.n=i===r?Math.sin(i):Math.log(e/Math.cos(r))/Math.log(Df(r)/t),this.f=e*Math.pow(Df(i),this.n)/this.n}project(e,t){t=_(t),this.southernCenter&&(t=-t),e=_(e-this.center[0]);var{n:i,f:r}=this,t=(0<r?t<1e-6-Lf&&(t=1e-6-Lf):t>Lf-1e-6&&(t=Lf-1e-6),r/Math.pow(Df(t),i)),n=t*Math.sin(i*e),r=r-t*Math.cos(i*e),n=.5*(n/Math.PI+.5),r=.5*(r/Math.PI+.5);return{x:n,y:this.southernCenter?r:1-r,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;var{n:i,f:r}=this,t=r-(t=(2*(1-(t=this.southernCenter?1-t:t))-.5)*Math.PI),n=Math.sign(t),o=Math.sign(i)*Math.sqrt(e*e+t*t);let a=Math.atan2(e,Math.abs(t))*n;t*i<0&&(a-=Math.PI*Math.sign(e)*n);t=S(Y(a/i)+this.center[0],-180,180),e=S(Y(2*Math.atan(Math.pow(r/o,1/i))-Lf),-y,y);return new E(t,this.southernCenter?-e:e)}}class zf extends wf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:_s(e),y:ys(t),z:0}}unproject(e,t){e=xs(e),t=bs(t);return new E(e,t)}}const Rf=_(y);class Of extends wf{project(e,t){var i=(t=_(t))*t,r=i*i;return{x:.5*((e=_(e))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=25,n,o=i*i;do{const e=(o=i*i)*o;n=(i*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),i=S(i-n,-Rf,Rf)}while(1e-6<Math.abs(n)&&0<--r);var e=S(Y(e/(.8707+(o=i*i)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=Y(i);return new E(e,a)}}const Bf=_(y);class Ff extends wf{project(e,t){t=_(t),e=_(e);var i=Math.cos(t),r=2/Math.PI,n=Math.acos(i*Math.cos(e/2)),n=Math.sin(n)/n,r=.5*(e*r+2*i*Math.sin(e/2)/n)||0,i=.5*(t+Math.sin(t)/n)||0;return{x:.5*(r/Math.PI+.5),y:1-.5*(i/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,n=25;const o=1e-6;var a,s;do{const n=Math.cos(r),o=Math.sin(r),l=2*o*n,c=o*o,h=n*n,u=Math.cos(i/2),d=Math.sin(i/2),p=2*u*d,f=d*d,m=1-h*u*u,g=m?1/m:0,_=m?Math.acos(n*u)*Math.sqrt(1/m):0,y=.5*(2*_*n*d+2*i/Math.PI)-e,v=.5*(_*o+r)-t,x=.5*g*(h*f+_*n*u*c)+1/Math.PI,Y=g*(p*l/4-_*o*d),b=.125*g*(l*d-_*o*h*p),w=.5*g*(c*u+_*f*n)+.5,T=Y*b-w*x;a=(v*Y-y*w)/T,s=(y*b-v*x)/T,i=S(i-a,-Math.PI,Math.PI),r=S(r-s,-Bf,Bf)}while((Math.abs(a)>o||Math.abs(s)>o)&&0<--n);return new E(Y(i),Y(r))}}class Nf extends wf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){var{scale:i,cosPhi:r}=this;return{x:_(e)*r*i+.5,y:-Math.sin(_(t))/r*i+.5,z:0}}unproject(e,t){var{scale:i,cosPhi:r}=this,t=-(t-.5)/i,e=S(Y((e-.5)/i)/r,-180,180),i=Math.asin(S(t*r,-1,1)),t=S(Y(i),-y,y);return new E(e,t)}}class Uf extends zf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,i){e=dh(e,t,i),t=mh(ah(i));return Te.N.transformMat4(e,e,t),{x:e[0],y:e[1],z:e[2]}}locationPoint(e,t){var i=rs(t.lat,t.lng),r=Te.N.normalize([],i),t=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,t=1/gs(0)*ue*t,r=(Te.N.scaleAndAdd(i,i,r,t),Te.a6.identity(new Float64Array(16)));return Te.a6.multiply(r,e.pixelMatrix,e.globeMatrix),Te.N.transformMat4(i,i,r),new U(i[0],i[1])}pixelsPerMeter(e,t){return 1/gs(0)*t}pixelSpaceConversion(e,t,i){var r=vs(1,e)*t,r=A(1/gs(45)*t,r,i);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,i){i=gh(ah(i.canonical));return Te.a6.multiply(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){var i=e["center"],t=mh(ah(t));return Te.a6.rotateY(t,t,_(i.lng)),Te.a6.rotateX(t,t,_(i.lat)),Te.a6.scale(t,t,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(t)}pointCoordinate(e,t,i,r){return rh(e,t,i,!0)||new Cs(0,0)}pointCoordinate3D(e,t,i){e=this.pointCoordinate(e,t,i,0);return[e.x,e.y,e.z]}isPointAboveHorizon(e,t){return!rh(e,t.x,t.y,!1)}farthestPixelDistance(e){var t=function(e,t){const i=e.cameraToCenterDistance,r=e._centerAltitude*t,n=e._camera,o=e._camera.forward(),a=Te.N.add([],Te.N.scale([],o,-i),[0,0,r]),s=e.worldSize/(2*Math.PI),l=[0,0,-s],c=e.width/e.height,h=Math.tan(e.fovAboveCenter),u=Te.N.scale([],n.up(),h),d=Te.N.scale([],n.right(),h*c),p=Te.N.normalize([],Te.N.add([],Te.N.add([],o,u),d)),f=[];let m;if(new Hc(a,p).closestPointOnSphere(l,s,f)){const t=Te.N.add([],f,l),i=Te.N.sub([],t,a);m=Math.cos(e.fovAboveCenter)*Te.N.length(i)}else{const e=Te.N.sub([],a,l),t=Te.N.sub([],l,a),i=(Te.N.normalize(t,t),Te.N.length(e)-s),r=(m=Math.sqrt(i*(i+2*s)),Math.acos(m/(s+i))-Math.acos(Te.N.dot(o,t)));m*=Math.cos(r)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=xh(e.zoom);if(0<i){const Te=yf(e,vs(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),n=Math.max(e.width,e.height)/e.worldSize*Math.PI;return A(t,Te+r*(1-Math.cos(n)),Math.pow(i,10))}return t}upVector(e,t,i){return dh(t,i,e,1)}upVectorScale(e){return{metersToTile:th(ph(ah(e)))}}}function jf(e){var t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new zf(e);case"equirectangular":return new Pf(e);case"naturalEarth":return new Of(e);case"equalEarth":return new If(e);case"winkelTripel":return new Ff(e);case"albers":return new(i?Nf:Tf)(e);case"lambertConformalConic":return new(i?Nf:kf)(e);case"globe":return new Uf(e)}throw new Error("Invalid projection name: "+e.name)}const Vf=g.types,Gf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qf(e,t,i,r,n,o,a,s,l,c,h,u,d){var p=s?Math.min(pf,Math.round(s[0])):0,s=s?Math.min(pf,Math.round(s[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),o,a,(p<<1)+(l?1:0),s,16*c,16*h,256*u,256*d)}function Wf(e,t,i){e.emplaceBack(t,i)}function Hf(e,t,i,r,n,o,a){e.emplaceBack(t,i,r,n,o,a)}function Zf(e,t,i,r,n){e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n)}function $f(e){for(const t of e.sections)if(function(e){for(const t of e)if(Fn(t.charCodeAt(0)))return 1}(t.text))return 1}class Xf{constructor(e){this.layoutVertexArray=new Ro,this.indexArray=new Go,this.programConfigurations=e,this.segments=new ma,this.dynamicLayoutVertexArray=new Lo,this.opacityVertexArray=new Bo,this.placedSymbolArray=new oa,this.iconTransitioningVertexArray=new Fo,this.globeExtVertexArray=new Oo,this.zOffsetVertexArray=new Ho}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,i,r,n){!this.isEmpty()&&(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ud.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Vd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Gf,!0),0<this.iconTransitioningVertexArray.length&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,qd.members,!0)),0<this.globeExtVertexArray.length&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,jd.members,!0)),!this.zOffsetVertexBuffer&&(0<this.zOffsetVertexArray.length||n)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Gd.members,!0)),this.opacityVertexBuffer.itemSize=1),i||r)&&this.programConfigurations.upload(e)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer)&&this.zOffsetVertexBuffer.destroy()}}n(Xf,"SymbolBuffers");class Yf{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new ma,this.collisionVertexArray=new Vo,this.collisionVertexArrayExt=new Lo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wd.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Hd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}n(Yf,"CollisionBuffers");class Kf{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Te.a6.identity([]),this.placementViewportMatrix=Te.a6.identity([]);var t=this.layers[0]._unevaluatedLayout._values,t=(this.textSizeData=Kd(this.zoom,t["text-size"]),this.iconSizeData=Kd(this.zoom,t["icon-size"]),this.layers[0].layout),i=t.get("symbol-sort-key"),r=t.get("symbol-z-order");this.canOverlap=t.get("text-allow-overlap")||t.get("icon-allow-overlap")||t.get("text-ignore-placement")||t.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=t.get("text-writing-mode").map(e=>Ep[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=t.get("symbol-z-elevate")}createArrays(){this.text=new Xf(new qa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Xf(new qa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new la,this.lineVertexArray=new ca,this.symbolInstances=new sa}calculateGlyphDependencies(t,i,e,r,n){for(let e=0;e<t.length;e++){var o=t.codePointAt(e);if(void 0===o)break;if(i[o]=!0,r&&n&&o<=65535){const r=ep[t.charAt(e)];r&&(i[r.charCodeAt(0)]=!0)}}}populate(i,r,n,o){const a=this.layers[0],s=a.layout,l="globe"===this.projection.name,c=s.get("text-font"),h=s.get("text-field"),u=s.get("icon-image"),d=("constant"!==h.value.kind||h.value.value instanceof ti&&!h.value.value.isEmpty()||0<h.value.value.toString().length)&&("constant"!==c.value.kind||0<c.value.value.length),p="constant"!==u.value.kind||!!u.value.value||0<Object.keys(u.parameters).length,f=s.get("symbol-sort-key");if(this.features=[],d||p){var m=r.iconDependencies,g=r.glyphDependencies,_=r.availableImages,e=new Kn(this.zoom);for(const{feature:r,id:h,index:u,sourceLayerIndex:v}of i){const i=a._featureFilter.needGeometry,x=ks(r,i);if(a._featureFilter.filter(e,x,n)){if(i||(x.geometry=Ds(r,n,o)),l&&1!==r.type&&n.z<=5){const i=x.geometry,r=.98078528056,o=(e,t)=>{e=dh(e.x,e.y,n,1),t=dh(t.x,t.y,n,1);return Te.N.dot(e,t)<r};for(let e=0;e<i.length;e++)i[e]=Is(i[e],o)}let e,t;if(d){const Te=a.getValueAndResolveTokens("text-field",x,n,_),i=ti.factory(Te);$f(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Gn||this.hasRTLText&&Yn.isParsed())&&(e=function(e,i,t){return e.sections.forEach(e=>{e.text=function(e,t){t=i.layout.get("text-transform").evaluate(t,{});return"uppercase"===t?e=e.toLocaleUpperCase():"lowercase"===t&&(e=e.toLocaleLowerCase()),e=Yn.applyArabicShaping?Yn.applyArabicShaping(e):e}(e.text,t)}),e}(i,a,x))}if(p){const Te=a.getValueAndResolveTokens("icon-image",x,n,_);t=Te instanceof ii?Te:ii.fromString(Te)}if(e||t){var y=this.sortFeaturesByKey?f.evaluate(x,{},n):void 0;if(this.features.push({id:h,text:e,icon:t,index:u,sourceLayerIndex:v,geometry:x.geometry,properties:r.properties,type:Vf[r.type],sortKey:y}),t&&(m[t.namePrimary]=!0,t.nameSecondary)&&(m[t.nameSecondary]=!0),e){const Te=c.evaluate(x,{},n).join(","),i="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(Ep.vertical);for(const r of e.sections)if(r.image)m[r.image.namePrimary]=!0;else{const n=zn(e.toString()),o=r.fontStack||Te,a=g[o]=g[o]||{};this.calculateGlyphDependencies(r.text,a,i,this.allowVerticalPlacement,n)}}}}}"line"===s.get("symbol-placement")&&(this.features=function(t){const n={},o={},a=[];let i=0;function r(e){a.push(t[e]),i++}function s(e,t,i){var r=o[e];return delete o[e],o[t]=r,a[r].geometry[0].pop(),a[r].geometry[0]=a[r].geometry[0].concat(i[0]),r}function l(e,t,i){var r=n[t];return delete n[t],n[e]=r,a[r].geometry[0].shift(),a[r].geometry[0]=i[0].concat(a[r].geometry[0]),r}function c(e,t,i){i=i?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:`+i.y}for(let e=0;e<t.length;e++){var h=t[e],u=h.geometry,h=h.text?h.text.toString():null;if(h){var d=c(h,u),p=c(h,u,!0);if(d in o&&p in n&&o[d]!==n[p]){const t=l(d,p,u),i=s(d,p,a[t].geometry);delete n[d],delete o[p],o[c(h,a[i].geometry,!0)]=i,a[t].geometry=null}else d in o?s(d,p,u):p in n?l(d,p,u):(r(e),n[d]=i-1,o[p]=i-1)}else r(e)}return a.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}}update(e,t,i,r,n){var o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||(o=o?this.stateDependentLayers:this.layers,this.text.programConfigurations.updatePaintArrays(e,t,o,i,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,o,i,r,n))}updateZOffset(){const t=(t,i,r)=>{(n+=i)>t.length&&t.resize(n);for(let e=-i;e<0;e++)t.emplace(e+n,r)},i=(t,i,r)=>{(o+=i)>t.length&&t.resize(o);for(let e=-i;e<0;e++)t.emplace(e+o,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,o=0;for(let e=0;e<this.symbolInstances.length;e++){const o=this.symbolInstances.get(e),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:a,numIconVertices:s}=o,l=o.zOffset,c=0<s;if((0<r||0<a)&&(t(this.text.zOffsetVertexArray,r,l),t(this.text.zOffsetVertexArray,a,l)),c){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:n}=o;0<=t&&i(this.icon.zOffsetVertexArray,s,l),0<=n&&i(this.icon.zOffsetVertexArray,o.numVerticalIconVertices,l)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=jf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:i}of t)this.lineVertexArray.emplaceBack(e,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g){const _=t.indexArray,y=t.layoutVertexArray,v=t.globeExtVertexArray,x=t.segments.prepareSegment(4*i.length,y,_,this.canOverlap?a.sortKey:void 0),b=this.glyphOffsetArray.length,w=x.vertexLength,T=this.allowVerticalPlacement&&s===Ep.vertical?Math.PI/2:0,S=a.text&&a.text.sections;for(let e=0;e<i.length;e++){const{tl:o,tr:s,bl:h,br:u,texPrimary:d,texSecondary:b,pixelOffsetTL:w,pixelOffsetBR:A,minFontScaleX:E,minFontScaleY:C,glyphOffset:M,isSDF:I,sectionIndex:P}=i[e],L=x.vertexLength,D=M[1];if(qf(y,c.x,c.y,o.x,D+o.y,d.x,d.y,r,I,w.x,w.y,E,C),qf(y,c.x,c.y,s.x,D+s.y,d.x+d.w,d.y,r,I,A.x,w.y,E,C),qf(y,c.x,c.y,h.x,D+h.y,d.x,d.y+d.h,r,I,w.x,A.y,E,C),qf(y,c.x,c.y,u.x,D+u.y,d.x+d.w,d.y+d.h,r,I,A.x,A.y,E,C),l){const{x:i,y:r,z:n}=l.anchor,[o,a,s]=l.up;Hf(v,i,r,n,o,a,s),Hf(v,i,r,n,o,a,s),Hf(v,i,r,n,o,a,s),Hf(v,i,r,n,o,a,s),Zf(t.dynamicLayoutVertexArray,i,r,n,T)}else Zf(t.dynamicLayoutVertexArray,c.x,c.y,c.z,T);if(g){const i=b||d;Wf(t.iconTransitioningVertexArray,i.x,i.y),Wf(t.iconTransitioningVertexArray,i.x+i.w,i.y),Wf(t.iconTransitioningVertexArray,i.x,i.y+i.h),Wf(t.iconTransitioningVertexArray,i.x+i.w,i.y+i.h)}_.emplaceBack(L,L+1,L+2),_.emplaceBack(L+1,L+2,L+3),x.vertexLength+=4,x.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),e!==i.length-1&&P===i[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(y.length,a,a.index,{},p,f,m,S&&S[P])}const A=l?l.anchor:c;t.placedSymbolArray.emplaceBack(A.x,A.y,A.z,c.x,c.y,b,this.glyphOffsetArray.length-b,w,h,u,c.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],s,0,!1,0,d,0)}_commitLayoutVertex(e,t,i,r,n,o,a){e.emplaceBack(t,i,r,n,o,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,i,r,n,o,a){var s=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=s.vertexLength,c=a.tileAnchorX,h=a.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,t,e.padding,a.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,h,new U(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,h,new U(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,h,new U(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,h,new U(e.x1,e.y2)),s.vertexLength+=4;t=i.indexArray;t.emplaceBack(l,l+1),t.emplaceBack(l+1,l+2),t.emplaceBack(l+2,l+3),t.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,r,n,o,a){for(let e=n;e<o;e++){const n=r.get(e),o=this.getSymbolInstanceTextSize(t,a,i,e);this._addCollisionDebugVertices(n,o,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(t,i,r,n,o,a){for(let e=n;e<o;e++){const n=r.get(e),o=this.getSymbolInstanceIconSize(t,i,a.placedIconSymbolIndex);this._addCollisionDebugVertices(n,o,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,a)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yf(Uo,Zd.members,Fo),this.iconCollisionBox=new Yf(Uo,Zd.members,Fo);var r=Qd(this.iconSizeData,t),n=Qd(this.textSizeData,t);for(let e=0;e<this.symbolInstances.length;e++){var o=this.symbolInstances.get(e);this._addTextDebugCollisionBoxes(n,t,i,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,t,i,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,t,i,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,t,i,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,i,r){t=this.text.placedSymbolArray.get(0<=t.rightJustifiedTextSymbolIndex?t.rightJustifiedTextSymbolIndex:0<=t.centerJustifiedTextSymbolIndex?t.centerJustifiedTextSymbolIndex:0<=t.leftJustifiedTextSymbolIndex?t.leftJustifiedTextSymbolIndex:0<=t.verticalPlacedTextSymbolIndex?t.verticalPlacedTextSymbolIndex:r),r=Jd(this.textSizeData,e,t)/Xd;return this.tilePixelRatio*r}getSymbolInstanceIconSize(e,t,i){i=this.icon.placedSymbolArray.get(i),e=Jd(this.iconSizeData,e,i);return this.tilePixelRatio*e}_commitDebugCollisionVertexUpdate(e,t,i,r){e.emplaceBack(t,-i,-i,r),e.emplaceBack(t,i,-i,r),e.emplaceBack(t,i,i,r),e.emplaceBack(t,-i,i,r)}_updateTextDebugCollisionBoxes(t,i,r,n,o,a){for(let e=n;e<o;e++){const n=r.get(e),o=this.getSymbolInstanceTextSize(t,a,i,e);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,o,n.padding,a.zOffset)}}_updateIconDebugCollisionBoxes(t,i,r,n,o,a){for(let e=n;e<o;e++){const n=r.get(e),o=this.getSymbolInstanceIconSize(t,i,a.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,o,n.padding,a.zOffset)}}updateCollisionDebugBuffers(t,i){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();var r=Qd(this.iconSizeData,t),n=Qd(this.textSizeData,t);for(let e=0;e<this.symbolInstances.length;e++){var o=this.symbolInstances.get(e);this._updateTextDebugCollisionBoxes(n,t,i,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,t,i,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,t,i,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,t,i,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,o,a,s,l){var c={};if(t<i){const{x1:i,y1:r,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:r,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.textFeatureIndex=p}if(r<n){const{x1:t,y1:i,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:f,tileAnchorX:m,tileAnchorY:g,featureIndex:_}=e.get(r);c.verticalTextBox={x1:t,y1:i,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:f,tileAnchorX:m,tileAnchorY:g},c.verticalTextFeatureIndex=_}if(o<a){const{x1:t,y1:i,x2:r,y2:n,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:y,tileAnchorX:v,tileAnchorY:x,featureIndex:b}=e.get(o);c.iconBox={x1:t,y1:i,x2:r,y2:n,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:y,tileAnchorX:v,tileAnchorY:x},c.iconFeatureIndex=b}if(s<l){const{x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:w,tileAnchorX:T,tileAnchorY:S,featureIndex:A}=e.get(s);c.verticalIconBox={x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:w,tileAnchorX:T,tileAnchorY:S},c.verticalIconFeatureIndex=A}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){var i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){var i=t.placedSymbolArray.get(i),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);var a=this.symbolInstances.get(e);r.push(0|Math.round(t*a.tileAnchorX+i*a.tileAnchorY)),n.push(a.featureIndex)}return o.sort((e,t)=>r[e]-r[t]||n[t]-n[e]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){var i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){var t=this.symbolInstances.get(e),{rightJustifiedTextSymbolIndex:t,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:n,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:a}=(this.featureSortOrder.push(t.featureIndex),t);0<=t&&this.addIndicesForPlacedSymbol(this.text,t),0<=i&&i!==t&&this.addIndicesForPlacedSymbol(this.text,i),0<=r&&r!==i&&r!==t&&this.addIndicesForPlacedSymbol(this.text,r),0<=n&&this.addIndicesForPlacedSymbol(this.text,n),0<=o&&this.addIndicesForPlacedSymbol(this.icon,o),0<=a&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}n(Kf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Kf.addDynamicAttributes=Zf;var r=new d({"symbol-placement":new a(p.layout_symbol["symbol-placement"]),"symbol-spacing":new a(p.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new a(p.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new s(p.layout_symbol["symbol-sort-key"]),"symbol-z-order":new a(p.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new a(p.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new a(p.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new a(p.layout_symbol["icon-ignore-placement"]),"icon-optional":new a(p.layout_symbol["icon-optional"]),"icon-rotation-alignment":new a(p.layout_symbol["icon-rotation-alignment"]),"icon-size":new s(p.layout_symbol["icon-size"]),"icon-text-fit":new s(p.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new s(p.layout_symbol["icon-text-fit-padding"]),"icon-image":new s(p.layout_symbol["icon-image"]),"icon-rotate":new s(p.layout_symbol["icon-rotate"]),"icon-padding":new a(p.layout_symbol["icon-padding"]),"icon-keep-upright":new a(p.layout_symbol["icon-keep-upright"]),"icon-offset":new s(p.layout_symbol["icon-offset"]),"icon-anchor":new s(p.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new a(p.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new a(p.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new a(p.layout_symbol["text-rotation-alignment"]),"text-field":new s(p.layout_symbol["text-field"]),"text-font":new s(p.layout_symbol["text-font"]),"text-size":new s(p.layout_symbol["text-size"]),"text-max-width":new s(p.layout_symbol["text-max-width"]),"text-line-height":new s(p.layout_symbol["text-line-height"]),"text-letter-spacing":new s(p.layout_symbol["text-letter-spacing"]),"text-justify":new s(p.layout_symbol["text-justify"]),"text-radial-offset":new s(p.layout_symbol["text-radial-offset"]),"text-variable-anchor":new a(p.layout_symbol["text-variable-anchor"]),"text-anchor":new s(p.layout_symbol["text-anchor"]),"text-max-angle":new a(p.layout_symbol["text-max-angle"]),"text-writing-mode":new a(p.layout_symbol["text-writing-mode"]),"text-rotate":new s(p.layout_symbol["text-rotate"]),"text-padding":new a(p.layout_symbol["text-padding"]),"text-keep-upright":new a(p.layout_symbol["text-keep-upright"]),"text-transform":new s(p.layout_symbol["text-transform"]),"text-offset":new s(p.layout_symbol["text-offset"]),"text-allow-overlap":new a(p.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new a(p.layout_symbol["text-ignore-placement"]),"text-optional":new a(p.layout_symbol["text-optional"]),visibility:new a(p.layout_symbol.visibility)}),Jf={paint:new d({"icon-opacity":new s(p.paint_symbol["icon-opacity"]),"icon-emissive-strength":new s(p.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new s(p.paint_symbol["text-emissive-strength"]),"icon-color":new s(p.paint_symbol["icon-color"]),"icon-halo-color":new s(p.paint_symbol["icon-halo-color"]),"icon-halo-width":new s(p.paint_symbol["icon-halo-width"]),"icon-halo-blur":new s(p.paint_symbol["icon-halo-blur"]),"icon-translate":new a(p.paint_symbol["icon-translate"]),"icon-translate-anchor":new a(p.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new s(p.paint_symbol["icon-image-cross-fade"]),"text-opacity":new s(p.paint_symbol["text-opacity"]),"text-color":new s(p.paint_symbol["text-color"],{runtimeType:Vt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new s(p.paint_symbol["text-halo-color"]),"text-halo-width":new s(p.paint_symbol["text-halo-width"]),"text-halo-blur":new s(p.paint_symbol["text-halo-blur"]),"text-translate":new a(p.paint_symbol["text-translate"]),"text-translate-anchor":new a(p.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new a(p.paint_symbol["icon-color-saturation"])}),layout:r};class Qf{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:jt,this.defaultValue=e}evaluate(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}n(Qf,"FormatSectionOverride",{omit:["defaultValue"]});class em extends wo{constructor(e,t,i){super(e,Jf,t,i)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));var i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,r){var n,i=this.layout.get(e).evaluate(t,{},i,r),r=this._unevaluatedLayout._values[e];return r.isDataDriven()||xn(r.value)||!i?i:(n=t.properties,i.replace(/{([^{}]+)}/g,(e,t)=>t in n?String(n[t]):""))}createBucket(e){return new Kf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Jf.paint.overridableProperties){var e,t,i;em.hasPaintOverride(this.layout,r)&&(e=this.paint.get(r),t=new Qf(e),t=new vn(t,e.property.specification,this.scope,this.options),i=null,i="constant"===e.value.kind||"source"===e.value.kind?new wn("source",t):new Tn("composite",t,e.value.zoomStops,e.value._interpolationType),this.paint._values[r]=new no(e.property,i,e.parameters))}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&em.hasPaintOverride(this.layout,e)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=Jf.paint.properties[e];let n=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof ti)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof si&&oi(e.value)===Wt?o(e.value.sections):e instanceof ui?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}getProgramIds(){var e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),t&&i.push("symbolSDF"),i}getDefaultProgramParams(e,t){return{config:new Ga(this,t),overrideFog:!1}}}var C=new d({visibility:new a(p.layout_background.visibility)}),tm={paint:new d({"background-color":new a(p.paint_background["background-color"]),"background-pattern":new a(p.paint_background["background-pattern"]),"background-opacity":new a(p.paint_background["background-opacity"]),"background-emissive-strength":new a(p.paint_background["background-emissive-strength"])}),layout:C},e=new d({visibility:new a(p.layout_raster.visibility)}),im={paint:new d({"raster-opacity":new a(p.paint_raster["raster-opacity"]),"raster-color":new ao(p.paint_raster["raster-color"]),"raster-color-mix":new a(p.paint_raster["raster-color-mix"]),"raster-color-range":new a(p.paint_raster["raster-color-range"]),"raster-hue-rotate":new a(p.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new a(p.paint_raster["raster-brightness-min"]),"raster-brightness-max":new a(p.paint_raster["raster-brightness-max"]),"raster-saturation":new a(p.paint_raster["raster-saturation"]),"raster-contrast":new a(p.paint_raster["raster-contrast"]),"raster-resampling":new a(p.paint_raster["raster-resampling"]),"raster-fade-duration":new a(p.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new a(p.paint_raster["raster-emissive-strength"]),"raster-array-band":new a(p.paint_raster["raster-array-band"]),"raster-elevation":new a(p.paint_raster["raster-elevation"])}),layout:e},rm=m([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class nm{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(r,i,e){const{width:n,height:o}=r,a=this["context"],s=a["gl"];if(s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!i||!1!==i.premultiply)),e||this.size&&this.size[0]===n&&this.size[1]===o){const{x:i,y:a}=e||{x:0,y:0};if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap)s.texSubImage2D(s.TEXTURE_2D,0,i,a,s.RGBA,s.UNSIGNED_BYTE,r);else{let e=this.format,t=s.UNSIGNED_BYTE;this.format===s.R32F&&(e=s.RED,t=s.FLOAT),s.texSubImage2D(s.TEXTURE_2D,0,i,a,n,o,e,t,r.data)}}else if(this.size=[n,o],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap){let e=this.format;this.format===s.R8&&(e=s.RED),s.texImage2D(s.TEXTURE_2D,0,this.format,e,s.UNSIGNED_BYTE,r)}else{let e=this.format,t=this.format,i=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(e=s.DEPTH_COMPONENT16,i=s.UNSIGNED_SHORT),this.format===s.R8&&(t=s.RED),this.format===s.R32F&&(i=s.FLOAT,t=s.RED),s.texImage2D(s.TEXTURE_2D,0,e,n,o,0,t,i,r.data)}this.useMipmap=Boolean(i&&i.useMipmap),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t,i=!1){var r=this["context"],r=r["gl"];r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,i,r){var n=this["context"],n=n["gl"];n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.magFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){var e=this.context["gl"];e.deleteTexture(this.texture),this.texture=null}}class om{constructor(e,t){this.context=e,this.texture=t}bind(e,t){var i=this["context"],i=i["gl"];i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}function am(e,t,i,r,n,o,a,s){var e=[e,t,1,i,r,1,n,o,1],t=[a,s,1],i=Te.co.adjoint([],e),[r,n,o]=Te.N.transformMat3(t,t,i);return Te.co.multiply(e,e,[r,0,0,0,n,0,0,0,o])}function sm(e,t,i,r,n,o,a,s){e=e,t=t,i=i,r=r,n=n,o=o,a=a,s=s,l=am(0,0,1,0,1,1,0,1),e=am(e,t,i,r,n,o,a,s),t=Te.co.adjoint([],l);var l,i=Te.co.multiply(e,e,t);return[i[2]/i[8]/ue,i[5]/i[8]/ue]}function lm(e){return[e[0],Math.min(Math.max(e[1],-y),y)]}class cm extends Ct{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=t,this._dirty=!1}load(i,e){this._loaded=e||!1,this.fire(new At("dataloading",{dataType:"source"})),this.url=this.options.url,this.url?this._imageRequest=at(this.map._requestManager.transformRequest(this.url,Je.Image),(e,t)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new Et(e)):t&&(this.image=t instanceof HTMLImageElement?Re.getImageData(t):t,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())}):(i&&(this.coordinates=i),this._loaded=!0,this._finishLoading())}loaded(){return this._loaded}updateImage(e){return e.url&&(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded)),this}setTexture(e){if(e.handle instanceof WebGLTexture)return this.texture=new om(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this;throw new Error("The provided handle is not a WebGLTexture instance")}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new At("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof om||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer)&&this.elevatedGlobeIndexBuffer.destroy()}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,i.length){this.onNorthPole=!1,this.onSouthPole=!1;let e=i[0][1],t=i[0][1];for(const r of i)r[1]>t&&(t=r[1]),r[1]<e&&(e=r[1]);const r=(t+e)/2;if(r>y?this.onNorthPole=!0:r<-y&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=i.map(Cs.fromLngLat);this.tileID=function(){let e=1/0,t=1/0,i=-1/0,r=-1/0;for(const n of l)e=Math.min(e,n.x),t=Math.min(t,n.y),i=Math.max(i,n.x),r=Math.max(r,n.y);const n=Math.max(i-e,r-t),o=Math.max(0,Math.floor(-Math.log(n)/Math.LN2)),a=Math.pow(2,o);let s=Math.floor((e+i)/2*a);return 1<s&&--s,new hs(o,s,Math.floor((t+r)/2*a))}(),this.minzoom=this.maxzoom=this.tileID.z}this.fire(new At("data",{dataType:"source",sourceDataType:"content"}))}return this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const Te in this.tiles){const t=this.tiles[Te];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(!(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)){const g=vf(new hs(0,0,0),this.map.transform.projection),_=[g.projection.project(this.coordinates[0][0],this.coordinates[0][1]),g.projection.project(this.coordinates[1][0],this.coordinates[1][1]),g.projection.project(this.coordinates[2][0],this.coordinates[2][1]),g.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(a=_,o=a[1].x-a[0].x,n=a[1].y-a[0].y,l=a[2].x-a[1].x,c=a[2].y-a[1].y,h=a[3].x-a[2].x,i=a[3].y-a[2].y,r=a[0].x-a[3].x,a=a[0].y-a[3].y,s=o*c-l*n,l=l*i-h*c,c=h*a-r*i,h=r*n-o*a,0<s&&0<l&&0<c&&0<h||s<0&&l<0&&c<0&&h<0){var e,i,r,n,o,a,s,l,c,h;const y=vf(this.tileID,this.map.transform.projection),[v,x,b,w]=this.coordinates.map(e=>{e=y.projection.project(e[0],e[1]);return xf(y,e)._round()}),T=(this.perspectiveTransform=sm(v.x,v.y,x.x,x.y,b.x,b.y,w.x,w.y),this._boundsArray=new Mo),S=(T.emplaceBack(v.x,v.y,0,0),T.emplaceBack(x.x,x.y,ue,0),T.emplaceBack(w.x,w.y,0,ue),T.emplaceBack(b.x,b.y,ue,ue),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer)&&this.elevatedGlobeIndexBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(T,rm.members),this.boundsSegments=ma.simpleSegment(0,0,4,2),[]),A=[lm((e=this.coordinates)[0]),lm(e[1]),lm(e[2]),lm(e[3])],[E,C,M,I]=function(t){let i=t[0][0],r=i,n=t[0][1],o=n;for(let e=1;e<t.length;e++)t[e][0]<i?i=t[e][0]:t[e][0]>r&&(r=t[e][0]),t[e][1]<n?n=t[e][1]:t[e][1]>o&&(o=t[e][1]);return[i,n,r-i,o-n]}(A);{const y=new Mo,[v,x,b,w]=function(t){let i=t[0].x,r=i,n=t[0].y,o=n;for(let e=1;e<t.length;e++)t[e].x<i?i=t[e].x:t[e].x>r&&(r=t[e].x),t[e].y<n?n=t[e].y:t[e].y>o&&(o=t[e].y);return[i,n,r-i,o-n]}(_),T=e=>[(e.x-v)/b,(e.y-x)/w],[A,e,P,L]=_.map(T),D=(i=A[0],r=A[1],n=e[0],o=e[1],a=P[0],s=P[1],l=L[0],c=L[1],h=am(0,0,1,0,1,1,0,1),i=am(i,r,n,o,a,s,l,c),r=Te.co.adjoint([],i),Te.co.multiply(h,h,r));this.elevatedGlobePerspectiveTransform=sm(A[0],A[1],e[0],e[1],P[0],P[1],L[0],L[1]);var u=(e,t)=>{S.push(e.lng);var i=Math.round((e.lng-E)/M*ue),e=Math.round((e.lat-C)/I*ue),t=T(t),t=Te.N.transformMat3([],[t[0],t[1],1],D),r=Math.round(t[0]/t[2]*ue),t=Math.round(t[1]/t[2]*ue);y.emplaceBack(i,e,r,t)},d=_[3].x-_[0].x,p=_[3].y-_[0].y,f=_[2].x-_[1].x,m=_[2].y-_[1].y;for(let e=0;e<65;e++){const t=e/64,y=[_[0].x+t*d,_[0].y+t*p],v=[_[1].x+t*f,_[1].y+t*m],x=v[0]-y[0],b=v[1]-y[1];for(let e=0;e<65;e++){const t=e/64,_={x:y[0]+x*t,y:y[1]+b*t,z:0};u(g.projection.unproject(_.x,_.y),_)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(y,rm.members)}{this.maxLongitudeTriangleSize=0;let n=[],o=new Go;const _=(e,t,i)=>{o.emplaceBack(e,t,i);var e=S[e],t=S[t],i=S[i],r=Math.min(Math.min(e,t),i),e=Math.max(Math.max(e,t),i)-r;e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=e),n.push(r+e/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const g=65*t+e,y=g+1,v=g+65,x=v+1;_(g,v,y),_(y,v,x)}[n,o]=function(i,t){var r=Array.from({length:i.length},(e,t)=>t),n=(r.sort((e,t)=>i[e]-i[t]),[]),o=new Go;for(let e=0;e<r.length;e++){var a=r[e],a=(n.push(i[a]),3*a),s=1+a;o.emplaceBack(t.uint16[a],t.uint16[s],t.uint16[1+s])}return[n,o]}(n,o),this.elevatedGlobeTrianglesCenterLongitudes=n,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(o)}this.elevatedGlobeSegments=ma.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,M/ue,0,I/ue,0,0,C,E,0])}else console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),this._unsupportedCoords=!0}}prepare(){var e,t,i=0!==Object.keys(this.tiles).length;this.tileID&&!i||(t=(e=this.map.painter.context).gl,!this._dirty||this.texture instanceof om||(this.texture?this.texture.update(this.image):(this.texture=new nm(e,this.image,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(e))}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e).buckets={}:e.state="errored",t(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;var t=this.elevatedGlobeTrianglesCenterLongitudes;e=e+180,s=t[0];let r=e+360*Math.round((s-e)/360);const n=new ma,o=(e,t)=>{n.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:i.segments[0].vertexLength,primitiveLength:t,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(t[0]-r)<=a){const e=ke(t,0,t.length,r+a);e!==t.length&&o(e,De(t,e+1,t.length,r+360-a)-e)}else{r<t[0]&&(r+=360);var s=De(t,0,t.length,r-a);s===t.length?o(0,t.length):(o(0,+s),(e=ke(t,s+1,t.length,r+a))!==t.length&&o(e,t.length-e))}return n}}T=(Math.pow(256,2)-1)/16907520;class hm extends wo{constructor(e,t,i){super(e,im,t,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof cm&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){var t,i;this.hasColorMap()&&this._curRampRange&&(t=this._transitionablePaint._values["raster-color"].value.expression,[e,i]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN],isNaN(e)&&isNaN(i)||e===this._curRampRange[0]&&i===this._curRampRange[1]||(this.colorRamp=Nh({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:i}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[e,i]))}}var x=new d({visibility:new a(p["layout_raster-particle"].visibility)}),um={paint:new d({"raster-particle-array-band":new a(p["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new a(p["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ao(p["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new a(p["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new a(p["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new a(p["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new a(p["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:x};class dm extends wo{constructor(e,t,i){super(e,um,t,i),this._updateColorRamp(),this.onRemove=e=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&e.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=Re.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){var e,t;this.hasColorMap()&&(e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0}),this.colorRamp=Nh({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null)}_invalidateAnimationState(){this.lastInvalidatedAt=Re.now()}}class pm extends wo{constructor(e,t){super(e,{},t),(this.implementation=e).slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var b=new d({visibility:new a(p.layout_sky.visibility)}),fm={paint:new d({"sky-type":new a(p.paint_sky["sky-type"]),"sky-atmosphere-sun":new a(p.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new a(p.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new a(p.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new a(p.paint_sky["sky-gradient-radius"]),"sky-gradient":new ao(p.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new a(p.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new a(p.paint_sky["sky-atmosphere-color"]),"sky-opacity":new a(p.paint_sky["sky-opacity"])}),layout:b};function mm(e,t,i){var r=[0,0,1],n=Te.bi.identity([]);return Te.bi.rotateY(n,n,i?-_(e)+Math.PI:_(e)),Te.bi.rotateX(n,n,-_(t)),Te.N.transformQuat(r,r,n),Te.N.normalize(r,r)}var gm={paint:new d({})};function _m(e,t){var i,r,n,o,a=vm(e.projection,e.zoom,e.width,e.height),t=(s=e.projection,i=e.center,a=a,t=t,r=new E(i.lng-180*xm,i.lat),n=new E(i.lng+180*xm,i.lat),r=s.project(r.lng,r.lat),n=s.project(n.lng,n.lat),n=-Math.atan2(n.y-r.y,n.x-r.x),(r=Cs.fromLngLat(i)).y=S(r.y,-1+xm,1-xm),i=r.toLngLat(),r=s.project(i.lng,i.lat),(o=Cs.fromLngLat(i)).x+=xm,o=o.toLngLat(),o=wm((o=s.project(o.lng,o.lat)).x-r.x,o.y-r.y,n),(i=Cs.fromLngLat(i)).y+=xm,i=i.toLngLat(),s=s.project(i.lng,i.lat),i=wm(s.x-r.x,s.y-r.y,n),s=Math.abs(o.x)/Math.abs(i.y),r=Te.a6.identity([]),Te.a6.rotateZ(r,r,-n*(1-(t?0:a))),o=Te.a6.identity([]),Te.a6.scale(o,o,[1,1-(1-s)*a,1]),o[4]=-i.x/i.y*a,Te.a6.rotateZ(o,o,n),Te.a6.multiply(o,r,o),o),s=ym(e);return Te.a6.scale(t,t,[s,s,1]),t}function ym(e){var t=e.projection,i=vm(e.projection,e.zoom,e.width,e.height),e=bm(t,e.center),t=bm(t,E.convert(t.center));return Math.pow(2,e*i+(1-i)*t)}function vm(e,t,i,r,n=1/0){e=e.range;return e?(n=Math.min(n,Math.max(i,r)),i=Math.log(n/1024)/Math.LN2,te(e[0]+i,e[1]+i,t)):0}const xm=25e-6;function bm(e,t){var i=S(t.lat,-y,y),r=new E(t.lng-180*xm,i),t=new E(t.lng+180*xm,i),n=e.project(r.lng,i),e=e.project(t.lng,i),i=Cs.fromLngLat(r),r=Cs.fromLngLat(t),t=e.x-n.x,e=e.y-n.y,n=r.x-i.x,r=r.y-i.y,i=Math.sqrt((n*n+r*r)/(t*t+e*e));return Math.log(i)/Math.LN2}function wm(e,t,i){var r=Math.cos(i),i=Math.sin(i);return{x:e*r-t*i,y:e*i+t*r}}function Tm(e,t,i){Te.a6.identity(e),Te.a6.rotateZ(e,e,_(t[2])),Te.a6.rotateX(e,e,_(t[0])),Te.a6.rotateY(e,e,_(t[1])),Te.a6.scale(e,e,i),Te.a6.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Sm(e,t,i,r,n,o,a,s){var i=[i[0]-t[0],i[1]-t[1],0],l=[r[0]-t[0],r[1]-t[1],0];if(Te.N.length(i)<1e-12||Te.N.length(l)<1e-12)return Te.bi.identity(e);var c=Te.N.cross([],i,l),r=(Te.N.normalize(c,c),Te.N.subtract(l,r,t),i[2]=(o-n)*s,l[2]=(a-n)*s,i);Te.N.cross(r,i,l),Te.N.normalize(r,r),Te.bi.rotationTo(e,c,r)}function Am(e,t,i=!1){var r,n,o,a,s=xh(t.zoom),l=function(e,t,i){var r=t.worldSize,n=[e[12],e[13],e[14]],o=bs(n[1]/r),a=xs(n[0]/r),s=Te.a6.identity([]),l=vs(1,o)*r,c=1/gs(0)*r*Ss(o,t.zoom),h=1/_h(r);let u=c*h;if(i){const Te=vm(t.projection,t.zoom,t.width,t.height,1024);u=h*t.projection.pixelSpaceConversion(t.center.lat,r,Te)}c=rs(o,a),Te.N.add(c,c,Te.N.scale([],Te.N.normalize([],c),l*u*n[2])),i=function(e){var t=[e[0],e[1],e[2]];let i=[0,1,0];var r=Te.N.cross([],i,t);return Te.N.cross(i,t,r),0===Te.N.squaredLength(i)&&(i=[0,1,0],Te.N.cross(r,t,i)),Te.N.normalize(r,r),Te.N.normalize(i,i),Te.N.normalize(t,t),[r[0],r[1],r[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(c),Te.a6.scale(s,s,[u,u,u*l]),Te.a6.translate(s,s,[-n[0],-n[1],-n[2]]),h=Te.a6.multiply([],t.globeMatrix,i);return Te.a6.multiply(h,h,s),Te.a6.multiply(h,h,e),h}(e,t,i);if(0<s){e=e,r=(t=t).worldSize,n=1/gs(0)*r*Ss(t.center.lat,t.zoom)/_h(r),o=vs(1,t.center.lat)*r,a=Te.a6.identity([]),Te.a6.rotateY(a,a,_(t.center.lng)),Te.a6.rotateX(a,a,_(t.center.lat)),Te.a6.translate(a,a,[0,0,Xa]),Te.a6.scale(a,a,[n,n,n*o]),Te.a6.translate(a,a,[t.point.x-.5*r,t.point.y-.5*r,0]),Te.a6.multiply(a,a,e);const i=Te.a6.multiply(a,t.globeMatrix,a);return n=i,o=s,t=(r=(e,t,i)=>{var r=Te.N.length(e),n=Te.N.length(t),e=sh(e,t,i);return Te.N.scale(e,e,1/Te.N.length(e)*A(r,n,i))})([(e=l)[0],e[1],e[2]],[n[0],n[1],n[2]],o),a=r([e[4],e[5],e[6]],[n[4],n[5],n[6]],o),r=r([e[8],e[9],e[10]],[n[8],n[9],n[10]],o),e=sh([e[12],e[13],e[14]],[n[12],n[13],n[14]],o),[t[0],t[1],t[2],0,a[0],a[1],a[2],0,r[0],r[1],r[2],0,e[0],e[1],e[2],1]}return l}function Em(e,t,i,r){const n=M.projectAabbCorners(r,i);let o=Number.MAX_VALUE,a=-1;for(let e=0;e<n.length;++e){const i=n[e];i[0]=(.5*i[0]+.5)*t.width,i[1]=(.5-.5*i[1])*t.height,i[2]<o&&(a=e,o=i[2])}var s=e=>new U(n[e][0],n[e][1]);let l;switch(a){case 0:case 6:l=[s(1),s(5),s(4),s(7),s(3),s(2),s(1)];break;case 1:case 7:l=[s(0),s(4),s(5),s(6),s(2),s(3),s(0)];break;case 3:case 5:l=[s(1),s(0),s(4),s(7),s(6),s(2),s(1)];break;default:l=[s(1),s(5),s(6),s(7),s(3),s(0),s(1)]}if(Bs(e,l))return o}const Cm=m([{name:"a_pos_3f",components:3,type:"Float32"}]),Mm=m([{name:"a_color_3f",components:3,type:"Float32"}]),Im=m([{name:"a_color_4f",components:4,type:"Float32"}]),Pm=m([{name:"a_uv_2f",components:2,type:"Float32"}]),Lm=m([{name:"a_normal_3f",components:3,type:"Float32"}]),Dm=m([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),km=m([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class zm{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Rm{constructor(){this.instancedDataArray=new Qo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Om{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:15<this.zoom?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,i,r){this.tileToMeter=Es(i);var n,o,a,s,l,c,h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for({feature:n,id:o,index:a,sourceLayerIndex:s}of e){const e=ks(n,h);this.layers[0]._featureFilter.filter(new Kn(this.zoom),e,i)&&(l={id:o,sourceLayerIndex:s,index:a,geometry:h?e.geometry:Ds(n,i,r),properties:n.properties,type:n.type,patterns:{}},c=this.addFeature(l,l.geometry,e))&&t.featureIndex.insert(n,l.geometry,a,s,this.index,this.instancesPerModel[c].instancedDataArray.length,ue/32)}this.lookup=null}update(e,t,i,r){for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];for(const t in e)i.idToFeaturesIndex.hasOwnProperty(t)&&this.evaluate(i.features[i.idToFeaturesIndex[t]],e[t],i,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const s in this.instancesPerModel){var t=this.instancesPerModel[s];for(const l of t.features){var i=this.layers[0],r=l.feature,n=this.canonical,o=i.paint.get("model-rotation").evaluate(r,{},n),a=i.paint.get("model-scale").evaluate(r,{},n),i=i.paint.get("model-translation").evaluate(r,{},n);Te.N.exactEquals(l.rotation,o)&&Te.N.exactEquals(l.scale,a)&&Te.N.exactEquals(l.translation,i)||(this.evaluate(l,l.featureStates,t,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){var t=this.instancesPerModel[i];t.instancedDataArray.length<0||0===t.instancedDataArray.length||(t.instancedDataBuffer?t.instancedDataBuffer.updateData(t.instancedDataArray):t.instancedDataBuffer=e.createVertexBuffer(t.instancedDataArray,Dm.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){var e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}}addFeature(e,t,i){const r=this.layers[0],n=r.layout.get("model-id").evaluate(i,{},this.canonical);if(n){this.instancesPerModel[n]||(this.instancesPerModel[n]=new Rm);var o=this.instancesPerModel[n],a=o.instancedDataArray,i=new zm(i,a.length);for(const e of t)for(const t of e)if(!(t.x<0||t.x>=ue||t.y<0||t.y>=ue)){const e=(this.lookupDim-1)/ue,i=this.lookupDim*(t.y*e|0)+t.x*e|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const r=a.length;a.resize(r+1),o.instancesEvaluatedElevation.push(0),a.float32[16*r]=t.x,a.float32[16*r+1]=t.y}i.instancedDataCount=o.instancedDataArray.length-i.instancedDataOffset,0<i.instancedDataCount&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(i),this.evaluate(i,{},o,!1))}else _e(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`);return n}evaluate(i,e,r,n){const o=this.layers[0],a=i.feature,s=this.canonical,l=i.rotation=o.paint.get("model-rotation").evaluate(a,e,s),t=i.scale=o.paint.get("model-scale").evaluate(a,e,s),c=i.translation=o.paint.get("model-translation").evaluate(a,e,s),h=o.paint.get("model-color").evaluate(a,e,s);h.a=o.paint.get("model-color-mix-intensity").evaluate(a,e,s);var u=[],d=(this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,t[0]),Math.max(t[1],t[2])),Tm(u,l,t),Math.round(100*h.a)+h.b/1.05);for(let t=0;t<i.instancedDataCount;++t){const o=i.instancedDataOffset+t,a=16*o,l=r.instancedDataArray.float32;let e=0;n&&(e=l[6+a]-r.instancesEvaluatedElevation[o]);var p=0|l[1+a];l[a]=(0|l[a])+h.r/1.05,l[1+a]=p+h.g/1.05,l[2+a]=d,l[3+a]=1/(10<s.z?this.tileToMeter:Es(s,p)),l[4+a]=c[0],l[5+a]=c[1],l[6+a]=c[2]+e,l[7+a]=u[0],l[8+a]=u[1],l[9+a]=u[2],l[10+a]=u[4],l[11+a]=u[5],l[12+a]=u[6],l[13+a]=u[8],l[14+a]=u[9],l[15+a]=u[10],r.instancesEvaluatedElevation[o]=c[2]}}}n(Om,"ModelBucket",{omit:["layers"]}),n(Rm,"PerModelAttributes"),n(zm,"ModelFeature");var i=new d({visibility:new a(p.layout_model.visibility),"model-id":new s(p.layout_model["model-id"])}),Bm={paint:new d({"model-opacity":new a(p.paint_model["model-opacity"]),"model-rotation":new s(p.paint_model["model-rotation"]),"model-scale":new s(p.paint_model["model-scale"]),"model-translation":new s(p.paint_model["model-translation"]),"model-color":new s(p.paint_model["model-color"]),"model-color-mix-intensity":new s(p.paint_model["model-color-mix-intensity"]),"model-type":new a(p.paint_model["model-type"]),"model-cast-shadows":new a(p.paint_model["model-cast-shadows"]),"model-receive-shadows":new a(p.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new a(p.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new s(p.paint_model["model-emissive-strength"]),"model-roughness":new s(p.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new s(p.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new a(p.paint_model["model-cutoff-fade-range"])}),layout:i};const Fm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Nm(t,i,r,n,o,a,s,l,c,h=!1){var u=r.zoom,d=r.project(n),p=Ss(n.lat,u),f=1/p;Te.a6.identity(t),Te.a6.translate(t,t,[d.x+s[0]*f,d.y+s[1]*f,s[2]]);let m=1,g=1;var _=r.worldSize;if(h){if("mercator"===r.projection.name){let e=0;r.elevation&&(e=r.elevation.getAtPointOrZero(new Cs(d.x/_,d.y/_),0));const i=Te.a7.transformMat4([],[d.x,d.y,e,1],r.projMatrix)[3]/r.cameraToCenterDistance;m=i,g=i*Ss(r.center.lat,u)}else if("globe"===r.projection.name){const i=Am(t,r),o=Te.a6.multiply([],r.projMatrix,i),a=[0,0,0,1],s=(Te.a7.transformMat4(a,a,o),a[3]/r.cameraToCenterDistance),l=xh(u),c=r.projection.pixelsPerMeter(n.lat,_)*Ss(n.lat,u),h=r.projection.pixelsPerMeter(r.center.lat,_)*Ss(r.center.lat,u);m=s/A(c,Ts(r.center.lat),l),g=s*p/c,m*=h,g*=h}}else m=f;Te.a6.scale(t,t,[m,m,g]);var y,v,x,b,w,T,h=[...t],s=i.orientation,u=[];if(Tm(u,[s[0]+o[0],s[1]+o[1],s[2]+o[2]],a),Te.a6.multiply(t,h,u),l&&r.elevation){let e=0;const a=[];if(c&&r.elevation){e=(p=a,f=r,o=i.aabb,c=t,i=n,(n=f.elevation)?(y=(o=M.projectAabbCorners(o,c))[(i=function(e,t){const i=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const n of r){const r=e[n.corners[0]],o=e[n.corners[1]],a=e[n.corners[2]],s=[o[0]-r[0],o[1]-r[1],t*(o[2]-r[2])],l=Te.N.cross(s,s,[a[0]-r[0],a[1]-r[1],t*(a[2]-r[2])]);Te.N.normalize(l,l),n.dotProductWithUp=Te.N.dot(l,i)}return r.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),r[0].corners}(o,c=vs(1,i.lat)*f.worldSize))[0]],v=o[i[1]],x=o[i[2]],o=o[i[3]],i=n.getAtPointOrZero(new Cs(y[0]/f.worldSize,y[1]/f.worldSize),0),(T=((b=n.getAtPointOrZero(new Cs(v[0]/f.worldSize,v[1]/f.worldSize),0))+(w=n.getAtPointOrZero(new Cs(x[0]/f.worldSize,x[1]/f.worldSize),0)))/2)<(f=(i+(n=n.getAtPointOrZero(new Cs(o[0]/f.worldSize,o[1]/f.worldSize),0)))/2)?b<w?Sm(p,v,o,y,b,n,i,c):Sm(p,x,y,o,w,i,n,c):i<n?Sm(p,y,v,x,i,b,w,c):Sm(p,o,x,v,n,w,b,c),Math.max(f,T)):0);const s=Te.a6.fromQuat([],a),l=Te.a6.multiply([],s,u);Te.a6.multiply(t,h,l)}else e=r.elevation.getAtPointOrZero(new Cs(d.x/_,d.y/_),0);0!==e&&(t[14]+=e)}}function Um(e,t,i=!1){e.uploaded||(e.gfxTexture=new nm(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function jm(e,t,i){if(e.meshes)for(const a of e.meshes)r=a,n=t,o=i,r.indexBuffer=n.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=n.createVertexBuffer(r.vertexArray,Cm.members,!1,!0),r.normalArray&&(r.normalBuffer=n.createVertexBuffer(r.normalArray,Lm.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=n.createVertexBuffer(r.texcoordArray,Pm.members,!1,!0)),r.colorArray&&(r.colorBuffer=n.createVertexBuffer(r.colorArray,(12===r.colorArray.bytesPerElement?Mm:Im).members,!1,!0)),r.featureArray&&(r.pbrBuffer=n.createVertexBuffer(r.featureArray,km.members,!0)),r.segments=ma.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length),(r=r.material).pbrMetallicRoughness.baseColorTexture&&Um(r.pbrMetallicRoughness.baseColorTexture,n),r.pbrMetallicRoughness.metallicRoughnessTexture&&Um(r.pbrMetallicRoughness.metallicRoughnessTexture,n),r.normalTexture&&Um(r.normalTexture,n),r.occlusionTexture&&Um(r.occlusionTexture,n,o),r.emissionTexture&&Um(r.emissionTexture,n);var r,n,o;if(e.children)for(const s of e.children)jm(s,t,i)}function Vm(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const i of e.children)Vm(i)}function Gm(e){if(e.meshes)for(const i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material)&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture)&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy();var t;if(e.children)for(const t of e.children)Gm(t)}class qm{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Wm{constructor(){this.tasks={},this.taskQueue=[],he(["process"],this),this.invoker=new qm(this.process),this.nextId=0}add(e,t){const i=this.nextId++,r=({type:n,isSymbolTile:o,zoom:a}=[t][0],a=a||0,"message"===n?0:"maybePrepare"!==n||o?"parseTile"!==n||o?"parseTile"===n&&o?300-a:"maybePrepare"===n&&o?400-a:500:200-a:100-a);var n,o,a;return 0==r?(xe(),e(),null):(this.tasks[i]={fn:e,metadata:t,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}})}process(){var e,t;xe(),this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),this.taskQueue.length&&null!==(e=this.pick())&&(t=this.tasks[e],delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t)&&t.fn()}pick(){let t=null,i=1/0;for(let e=0;e<this.taskQueue.length;e++){var r=this.tasks[this.taskQueue[e]];r.priority<i&&(i=r.priority,t=e)}var e;return null===t?null:(e=this.taskQueue[t],this.taskQueue.splice(t,1),e)}remove(){this.invoker.remove()}}class Hm{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},he(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Wm}send(e,t,i,r,n=!1,o){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[a]=i);o=new Set;return this.target.postMessage({id:a,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Dn(t,o)},o),{cancel:()=>{i&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||xe()){const e=this.callbacks[i],r=this.scheduler.add(()=>this.processTask(i,t),e&&e.metadata||{type:"message"});r&&(this.cancelCallbacks[i]=r)}else this.processTask(i,t)}processTask(i,e){if(delete this.cancelCallbacks[i],"<response>"===e.type){var t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(kn(e.error)):t(null,kn(e.data)))}else{const r=new Set,n=e.hasCallback?(e,t)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:e?Dn(e):null,data:Dn(t,r)},r)}:e=>{},o=kn(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,o,n);else if(this.parent.getWorkerSource){const i=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,i[0],o.source,o.scope)[i[1]](o,n)}else n(new Error("Could not find function "+e.type))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Zm{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=oe++;var i=this.workerPool.acquire(this.id);for(let e=0;e<i.length;e++){var r=new Zm.Actor(i[e],t,this.id);r.name="Worker "+e,this.actors.push(r)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,r,e){re(this.actors,(e,t)=>{e.send(i,r,t)},e=e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Zm.Actor=Hm;var $m={workerUrl:"",workerClass:null,workerParams:void 0};function Xm(){return null!=$m.workerClass?new $m.workerClass:new self.Worker($m.workerUrl,$m.workerParams)}const Ym="mapboxgl_preloaded_worker_pool";class Km{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Km.workerCount;)this.workers.push(new Xm);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ym]}numActive(){return Object.keys(this.active).length}}let Jm;function Qm(){return Jm=Jm||new Km}Km.workerCount=2;let eg,tg,ig,rg,ng,og=null;function ag(){return xe()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:tg||o.DRACO_URL}function sg(){if(xe()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(!rg){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");rg=WebAssembly.validate(e)?o.MESHOPT_SIMD_URL:o.MESHOPT_URL}return rg}const lg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},cg={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},hg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function ug(e,t,i){var r=i.json.bufferViews.length,n=i.buffers.length;t.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:e.byteLength},i.buffers[n]=e}const dg="KHR_draco_mesh_compression";const pg="EXT_meshopt_compression";const fg=new TextDecoder("utf8");function mg(e,t){return new URL(e,t).href}function gg(e,t){t=e.json.bufferViews[t];return new Uint8Array(e.buffers[t.buffer],t.byteOffset||0,t.byteLength)}function _g(t,e=0,i){const x={json:null,images:[],buffers:[]};if(1179937895===new Uint32Array(t,e,1)[0]){const i=new Uint32Array(t,e);var r=2;const o=(i[r++]>>2)-3,b=i[r++]>>2;if(r++,x.json=JSON.parse(fg.decode(i.subarray(5,5+b))),(r+=b)<o){const o=i[r++],b=e+(++r<<2);x.buffers[0]=t.slice(b,b+o)}}else x.json=JSON.parse(fg.decode(new Uint8Array(t,e)));const{buffers:n,images:o,meshes:b,extensionsUsed:a,bufferViews:w}=x.json;let s=Promise.resolve();if(n){const t=[];for(let e=0;e<n.length;e++){const o=n[e];o.uri?t.push(function(e,t,i,r){return fetch(mg(e.uri,r)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[i]=e})}(o,x,e,i)):x.buffers[e]||(x.buffers[e]=null)}s=Promise.all(t)}return s.then(()=>{const t=[],y=a&&a.includes(dg),v=a&&a.includes(pg);if(y&&t.push(function(){if(!ig)return eg||(eg=function(e){let w,T=null;function S(){w=new Uint8Array(T.buffer)}function t(){throw new Error("Unexpected Draco error.")}const i={a:{a:t,d:function(e,t,i){return w.copyWithin(e,t,t+i)},c:function(e){var t=w.length,i=Math.max(e>>>0,Math.ceil(1.2*t)),i=Math.ceil((i-t)/65536);try{return T.grow(i),S(),!0}catch(e){return!1}},b:t}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,i):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,i))).then(e=>{const{Rb:s,Qb:l,P:t,T:i,X:r,Ja:n,La:o,Qa:a,Va:c,Wa:h,eb:u,jb:d,f:p,e:f,yb:m,zb:g,Ab:_,Bb:y,Db:v,Gb:x}=e.instance.exports,b=(T=f,(()=>{let r=0,n=0,o=0,a=0;return t=>{o&&(s(a),s(r),n+=o,o=r=0),r||(n+=128,r=l(n));var e=t.length+7&-8;let i=r;e>=n&&(o=e,i=a=l(e));for(let e=0;e<t.length;e++)w[i+e]=t[e];return i}})());return S(),p(),{memory:f,_free:s,_malloc:l,Mesh:class{constructor(){this.ptr=t()}destroy(){i(this.ptr)}},Decoder:class{constructor(){this.ptr=n()}destroy(){d(this.ptr)}DecodeArrayToMesh(e,t,i){e=b(e),e=o(this.ptr,e,t,i.ptr);return!!r(e)}GetAttributeByUniqueId(e,t){return{ptr:a(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,i){c(this.ptr,e.ptr,t,i)}GetTrianglesUInt32Array(e,t,i){h(this.ptr,e.ptr,t,i)}GetAttributeDataArrayForAllPoints(e,t,i,r,n){u(this.ptr,e.ptr,t.ptr,i,r,n)}},DT_INT8:m(),DT_UINT8:g(),DT_INT16:_(),DT_UINT16:y(),DT_UINT32:v(),DT_FLOAT32:x()}})}(fetch(ag()))).then(e=>{ig=e,eg=void 0})}()),v&&t.push(function(){if(!ng){const e=function(e){let u;const t=WebAssembly.instantiateStreaming(e,{}).then(e=>{(u=e.instance).exports.__wasm_call_ctors()}),d={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},p={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:t,supported:!0,decodeGltfBuffer(e,t,i,r,n,o){var a=u,n=u.exports[p[n]],o=u.exports[d[o]],s=a.exports.sbrk,l=t+3&-4,c=s(l*i),h=s(r.length);if((a=new Uint8Array(a.exports.memory.buffer)).set(r,h),0===(n=n(c,t,i,h,r.length))&&o&&o(c,l,i),e.set(a.subarray(c,c+t*i)),s(c-s(0)),0!==n)throw new Error("Malformed buffer data: "+n)}}}(fetch(sg()));return e.ready.then(()=>{ng=e})}}()),o)for(let e=0;e<o.length;e++)t.push(function(e,t,i,r){if(e.uri)return r=mg(e.uri,r),fetch(r).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{t.images[i]=e});if(void 0!==e.bufferView){const r=gg(t,e.bufferView),n=new Blob([r],{type:e.mimeType});return createImageBitmap(n).then(e=>{t.images[i]=e})}}(o[e],x,e,i));return(t.length?Promise.all(t):Promise.resolve()).then(()=>{if(y&&b)for(var{primitives:e}of b)for(const y of e){t=void 0;i=void 0;r=void 0;var t=y;var i=x;var r=t.extensions&&t.extensions[dg];if(r){const c=new ig.Decoder,h=gg(i,r.bufferView),u=new ig.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,u))throw new Error("Failed to decode Draco mesh");const d=i.json.accessors[t.indices],p=lg[d.componentType],f=d.count*p.BYTES_PER_ELEMENT,m=ig._malloc(f);p===Uint16Array?c.GetTrianglesUInt16Array(u,f,m):c.GetTrianglesUInt32Array(u,f,m),ug(ig.memory.buffer.slice(m,m+f),d,i),ig._free(m);for(const h of Object.keys(r.attributes)){const d=c.GetAttributeByUniqueId(u,r.attributes[h]),p=i.json.accessors[t.attributes[h]],f=cg[p.componentType],m=p.count*hg[p.type]*lg[p.componentType].BYTES_PER_ELEMENT,g=ig._malloc(m);c.GetAttributeDataArrayForAllPoints(u,d,ig[f],m,g),ug(ig.memory.buffer.slice(g,g+m),p,i),ig._free(g)}c.destroy(),u.destroy(),delete t.extensions[dg]}}if(v&&b&&w)for(const _ of w)n=_,o=x,a=void 0,s=void 0,l=void 0,n.extensions&&n.extensions[pg]&&(a=n.extensions[pg],s=new Uint8Array(o.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),l=new Uint8Array(a.count*a.byteStride),ng.decodeGltfBuffer(l,a.count,a.byteStride,s,a.mode,a.filter),n.buffer=o.buffers.length,n.byteOffset=0,o.buffers[n.buffer]=l.buffer,delete n.extensions[pg]);var n,o,a,s,l;return x})})}class yg{constructor(t,r,e){if(this.triangleCount=r.length/3,this.min=new U(0,0),this.max=new U(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0!==this.triangleCount&&0!==t.length&&0!==e){const a=t.map(e=>e.x),s=t.map(e=>e.y),l=(this.min=new U(Math.min(...a),Math.min(...s)),this.max=new U(Math.max(...a),Math.max(...s)),this.max.sub(this.min));l.x=Math.max(l.x,1),l.y=Math.max(l.y,1);var n=Math.max(l.x,l.y)/e,o=(this.cellsX=Math.max(1,Math.ceil(l.x/n)),this.cellsY=Math.max(1,Math.ceil(l.y/n)),this.xScale=1/n,this.yScale=1/n,[]);for(let i=0;i<this.triangleCount;i++){const a=t[r[3*i+0]].sub(this.min),s=t[r[3*i+1]].sub(this.min),l=t[r[3*i+2]].sub(this.min),c=vg(Math.floor(Math.min(a.x,s.x,l.x)),this.xScale,this.cellsX),h=vg(Math.floor(Math.max(a.x,s.x,l.x)),this.xScale,this.cellsX),u=vg(Math.floor(Math.min(a.y,s.y,l.y)),this.yScale,this.cellsY),d=vg(Math.floor(Math.max(a.y,s.y,l.y)),this.yScale,this.cellsY),p=new U(0,0),f=new U(0,0),m=new U(0,0),g=new U(0,0);for(let t=u;t<=d;++t){p.y=f.y=t*n,m.y=g.y=(t+1)*n;for(let e=c;e<=h;++e)p.x=m.x=e*n,f.x=g.x=(e+1)*n,(Hs(a,s,l,p,f,g)||Hs(a,s,l,p,g,m))&&o.push({cellIdx:t*this.cellsX+e,triIdx:i})}}if(0!==o.length){o.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let e=0;for(;e<o.length;){const t=o[e].cellIdx,r={start:this.payload.length,len:0};for(;e<o.length&&o[e].cellIdx===t;)++r.len,this.payload.push(o[e++].triIdx);this.cells[t]=r}}}}query(e,i,r){if(0!==this.triangleCount&&0!==this.cells.length&&!(e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let e=0;e<this.lookup.length;e++)this.lookup[e]=0;const n=vg(e.x-this.min.x,this.xScale,this.cellsX),o=vg(i.x-this.min.x,this.xScale,this.cellsX),a=vg(e.y-this.min.y,this.yScale,this.cellsY),s=vg(i.y-this.min.y,this.yScale,this.cellsY);for(let t=a;t<=s;t++)for(let e=n;e<=o;e++){const n=this.cells[t*this.cellsX+e];if(n)for(let e=0;e<n.len;e++){const i=this.payload[n.start+e],o=Math.floor(i/8),a=1<<i%8;if(!(this.lookup[o]&a)&&(this.lookup[o]|=a,r.push(i),r.length===this.triangleCount))return}}}}}function vg(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function xg(e,t){var i=e.json.bufferViews[t.bufferView],r=lg[t.componentType];return new r(e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==hg[t.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:hg[t.type]))}function bg(e,r,t,n){const i=lg[r.componentType],o=function(){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(),a=e.json.bufferViews[r.bufferView],s=a.byteStride?a.byteStride/i.BYTES_PER_ELEMENT:hg[r.type],l=t.float32,c=l.length/t.capacity;for(let t=0,i=0;t<r.count*s;t+=s,i+=c)for(let e=0;e<c;e++)l[i+e]=n[t+e]*o;t._trim()}function wg(e){const t=function(e,t){var i=[],r=WebGL2RenderingContext;if(e.json.textures)for(const o of e.json.textures){var n={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==o.sampler&&Object.assign(n,e.json.samplers[o.sampler]),i.push({image:t[o.source],sampler:n,uploaded:!1})}return i}(e,e.images),i=function(e,t){const i=[];for(const n of e.json.meshes){var r=[];for(const i of n.primitives)r.push(function(e,t,i){const r=e.indices,n=e.attributes,o={};o.indexArray=new Go;var a=t.json.accessors[r],s=a.count/3,l=(o.indexArray.reserve(s),xg(t,a));for(let e=0;e<s;e++)o.indexArray.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);o.indexArray._trim(),o.vertexArray=new Ko;var c=t.json.accessors[n.POSITION],h=(o.vertexArray.reserve(c.count),xg(t,c));for(let e=0;e<c.count;e++)o.vertexArray.emplaceBack(h[3*e],h[3*e+1],h[3*e+2]);if(o.vertexArray._trim(),o.aabb=new M(c.min,c.max),o.centroid=function(t,i){const r=[0,0,0],n=t.length;if(0<n){for(let e=0;e<n;e++){const n=3*t[e];r[0]+=i[n],r[1]+=i[1+n],r[2]+=i[2+n]}r[0]/=n,r[1]/=n,r[2]/=n}return r}(l,h),void 0!==n.COLOR_0){const e=t.json.accessors[n.COLOR_0],i=hg[e.type],r=xg(t,e);o.colorArray=new(3===i?Ko:Lo),o.colorArray.resize(e.count),bg(t,e,o.colorArray,r)}if(void 0!==n.NORMAL){o.normalArray=new Ko;const e=t.json.accessors[n.NORMAL],i=(o.normalArray.resize(e.count),xg(t,e));bg(t,e,o.normalArray,i)}if(void 0!==n.TEXCOORD_0&&0<i.length){o.texcoordArray=new Jo;const e=t.json.accessors[n.TEXCOORD_0],i=(o.texcoordArray.resize(e.count),xg(t,e));bg(t,e,o.texcoordArray,i)}if(void 0!==n._FEATURE_ID_RGBA4444){const e=t.json.accessors[n._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=xg(t,e))}return void 0!==n._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(xg(t,t.json.accessors[n._FEATURE_RGBA4444]).buffer)),a=e.material,o.material=function(e,t){var{emissiveFactor:i=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:n=.5,normalTexture:o,occlusionTexture:a,emissiveTexture:s,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:h=1,roughnessFactor:u=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},f=a?t[a.index]:void 0;if(a&&a.extensions&&a.extensions.KHR_texture_transform&&f){const e=a.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new zt(...c),metallicFactor:h,roughnessFactor:u,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:r,alphaCutoff:n,normalTexture:o?t[o.index]:void 0,occlusionTexture:f,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==a?t.json.materials[a]:{defined:!1},i),o}(i,e,t));i.push(r)}return i}(e,t),{scenes:r,scene:n,nodes:o}=e.json,a=r?r[n||0].nodes:o,s=[];for(const t of a)s.push(function e(t,i,r){var{matrix:t,rotation:n,translation:o,scale:a,mesh:s,extras:l,children:c}=t,h={};if(h.matrix=t||Te.a6.fromRotationTranslationScale([],n||[0,0,0,1],o||[0,0,0],a||[1,1,1]),void 0!==s){h.meshes=r[s];const Te=h.anchor=[0,0];for(const t of h.meshes){const{min:i,max:r}=t.aabb;Te[0]+=i[0]+r[0],Te[1]+=i[1]+r[1]}Te[0]=Math.floor(Te[0]/h.meshes.length/2),Te[1]=Math.floor(Te[1]/h.meshes.length/2)}if(l&&(l.id&&(h.id=l.id),l.lights)&&(h.lights=function(e){if(!e.length)return[];const t=function(){var t=atob(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.codePointAt(e);return i}(),i=[],r=t.length/24,n=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let e=0;e<r;e++){const t=n[2*e*6]/30,r=n[2*e*6+1]/30,a=n[2*e*6+10]/100,s=o[6*e+1],l=o[6*e+2],c=o[6*e+3],h=o[6*e+4],u=c-s,d=h-l,p=Math.hypot(u,d);i.push({pos:[s+.5*u,l+.5*d,r],normal:[d/p,-u/p,0],width:p,height:t,depth:a,points:[s,l,c,h]})}return i}(l.lights)),c){const Te=[];for(const t of c)Te.push(e(i.json.nodes[t],i,r));h.children=Te}return h}(o[t],e,i));var l,c,h=s,u=a,d=e.json.nodes,p={},f=new Set;for(let e=0;e<h.length;e++){const h=d[u[e]];h.extras&&(l=h.extras["mapbox:footprint:version"],c=h.extras["mapbox:footprint:id"],(l||c)&&f.add(e),"1.0.0"===l)&&c&&(p[c]=e)}for(let e=0;e<h.length;e++)if(!f.has(e)){var m=h[e],g=d[u[e]];if(g.extras){let e=null;(e=(e=m.id in p?function(t){var i=[],r=[];let n=0;for(const o of t){n=i.length;const t=o.vertexArray.float32,a=o.indexArray.uint16;for(let e=0;e<o.vertexArray.length;e++)i.push(new U(t[3*e+0],t[3*e+1]));for(let e=0;e<3*o.indexArray.length;e++)r.push(a[e]+n)}if(r.length%3!=0)return null;for(let e=0;e<r.length;e+=3){const n=i[r[e+0]],s=i[r[e+1]],l=i[r[e+2]];0<(n.x-s.x)*(l.y-s.y)-(l.x-s.x)*(n.y-s.y)&&([r[e+1],r[e+2]]=[r[e+2],r[e+1]])}return{vertices:i,indices:r}}(h[p[m.id]].meshes):e)||function(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const i=t[0];if(!i||!Array.isArray(i)||0===i.length)return null;var r=[];for(const e of i)if(Array.isArray(e)&&2===e.length){const t=e[0],i=e[1];"number"==typeof t&&"number"==typeof i&&r.push(new U(t,i))}if(r.length<3)return null;1<r.length&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let e=0;e<r.length;e++){const t=r[e],i=r[(e+1)%r.length],o=r[(e+2)%r.length];n+=(t.x-i.x)*(o.y-i.y)-(o.x-i.x)*(t.y-i.y)}0<n&&r.reverse();const o=su(r.flatMap(e=>[e.x,e.y]),[]);return 0===o.length?null:{vertices:r,indices:o}}(g))&&(m.footprint=function(t){if(0===t.vertices.length||0===t.indices.length)return null;var[i,r]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let e=1;e<t.vertices.length;++e){const n=t.vertices[e];i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r.x=Math.max(r.x,n.x),r.y=Math.max(r.y,n.y)}const e=Math.ceil(Math.max(r.x-i.x,r.y-i.y)/256),n=Math.max(8,e),o=new yg(t.vertices,t.indices,n);return{vertices:t.vertices,indices:t.indices,grid:o,min:i,max:r}}(e))}}if(0<f.size){const u=Array.from(f.values()).sort((e,t)=>e-t);for(let e=u.length-1;0<=e;e--)h.splice(u[e],1)}return s}n(yg,"TriangleGridIndex");class Tg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Sg=["tile","layer","source","sourceLayer","state"];class Ag{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){var e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Sg)void 0!==this[t]&&(e[t]=this[t]);return e}}class Eg{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Mn(ue,16,0),this.featureIndexArray=new ua,this.promoteId=t,this.is3DTile=!1}insert(e,t,i,r,n,o=0,a=0){var s=this.featureIndexArray.length,l=(this.featureIndexArray.emplaceBack(i,r,n,o),this.grid);for(let e=0;e<t.length;e++){const i=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}0!==a&&(r[0]-=a,r[1]-=a,r[2]+=a,r[3]+=a),r[0]<ue&&r[1]<ue&&0<=r[2]&&0<=r[3]&&l.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Mu(new xp(this.rawTileData)).layers,this.sourceLayerCoder=new Tg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(o,t,i,r){this.loadVTLayers();const a=o.params||{},s=ho(a.filter),l=o.tileResult,c=o.transform,e=l.bufferedTilespaceBounds,n=this.grid.query(e.min.x,e.min.y,e.max.x,e.max.y,(e,t,i,r)=>qs(l.bufferedTilespaceGeometry,e,t,i,r));n.sort(Mg);let h=null;c.elevation&&0<n.length&&(h=Zu.create(c.elevation,this.tileID));var u={};let d;for(let e=0;e<n.length;e++){var p=n[e];if(p!==d){d=p;p=this.featureIndexArray.get(p);let n=null;if(this.is3DTile){const o=this.bucketLayerIDs[0][0],i=t[o];if("model"===i.type){const{queryFeature:r,intersectionZ:a}=i.queryIntersectsMatchingFeature(l,p.featureIndex,s,c);r&&this.appendToResult(u,o,p.featureIndex,r,a)}}else this.loadMatchingFeature(u,p,s,a.layers,a.availableImages,t,i,r,(e,t,i,r=0)=>(n=n||Ds(e,this.tileID.canonical,o.tileTransform),t.queryIntersectsFeature(l,e,i,n,this.z,o.transform,o.pixelPosMatrix,h,r)))}}return u}loadMatchingFeature(t,e,i,r,n,o,a,s,l){const{featureIndex:c,bucketIndex:h,sourceLayerIndex:u,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[h];if(!r||function(t,i){for(let e=0;e<t.length;e++)if(0<=i.indexOf(t[e]))return 1}(r,p)){const _=this.sourceLayerCoder.decode(u),y=this.vtLayers[_].feature(c);if(i.needGeometry){const t=ks(y,!0);if(!i.filter(new Kn(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new Kn(this.tileID.overscaledZ),y))return;var f,m,g=this.getId(y,_);for(let e=0;e<p.length;e++){const i=p[e];if(!(r&&r.indexOf(i)<0)){const h=o[i];if(h){let e={};void 0!==g&&s&&(e=s.getState(h.sourceLayer||"_geojsonTileLayer",g));const _=!l||l(y,h,e,d);_&&(f=new Ag(y,this.z,this.x,this.y,g),(m=ne({},a[i])).paint=Cg(m.paint,h.paint,y,e,n),m.layout=Cg(m.layout,h.layout,y,e,n),f.layer=m,this.appendToResult(t,i,c,f,_))}}}}}appendToResult(e,t,i,r,n){let o=e[t];(o=void 0===o?e[t]=[]:o).push({featureIndex:i,feature:r,intersectionZ:n})}lookupSymbolFeatures(e,t,i,r,n,o,a,s){var l={},c=(this.loadVTLayers(),ho(n));for(const n of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:n,layoutVertexArrayOffset:0},c,o,a,s,t);return l}loadFeature(e){var{featureIndex:e,sourceLayerIndex:t}=e,t=(this.loadVTLayers(),this.sourceLayerCoder.decode(t)),i=this.vtFeatures[t];return i[e]||(t=this.vtLayers[t].feature(e),i[e]=t)}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;return i=this.promoteId&&(t="string"==typeof this.promoteId?this.promoteId:this.promoteId[t],"boolean"==typeof(i=null!=t?e.properties[t]:i))?Number(i):i}}function Cg(e,i,r,n,o){return pe(e,(e,t)=>{t=i instanceof oo?i.get(t):null;return t&&t.evaluate?t.evaluate(r,n,o):t})}function Mg(e,t){return t-e}n(Eg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ig=new Float32Array(262144),Pg=new Uint8Array(262144);const Lg=["","wall","door","roof","window","lamp","logo"];class Dg{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:function e(t){let i=0;if(t.meshes)for(const r of t.meshes)i=Math.max(i,r.aabb.max[2]);if(t.children)for(const n of t.children)i=Math.max(i,e(n));return i}(e)}}}getLocalBounds(){if(!this.node.meshes)return new M([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;var t=new M([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==e&&t.encapsulate(i.aabb),e++;this.aabb=t}return this.aabb}}class kg{constructor(e,t,i,r,n,o){this.id=t,this.modelTraits|=Fm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=Fm.HasMapboxMeshFeatures),r&&(this.modelTraits|=Fm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const t of e)this.nodesInfo.push(new Dg(t)),function e(t,i,r){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&r.insert(i,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const o of t.children)e(o,i,r)}(t,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(this.needsUpload){const t=this.getNodesInfo();for(const i of t){const t=i.node;this.uploaded?this.updatePbrBuffer(t):jm(t,e,!0)}for(const e of t)Vm(e.node);this.uploaded=!0,this.needsUpload=!1}}updatePbrBuffer(e){let t=!1;if(e.meshes)for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),t=!0);return t}needsReEvaluation(e,t,i){var r=e.transform.projectionOptions,e=e.style.getBrightness(),n=this.brightness!==e;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||zg(i.paint.get("model-color").value,n)||zg(i.paint.get("model-color-mix-intensity").value,n)||zg(i.paint.get("model-roughness").value,n)||zg(i.paint.get("model-emissive-strength").value,n)||zg(i.paint.get("model-height-based-emissive-strength-multiplier").value,n))&&(this.projection=r,this.brightness=e,!0)}evaluateScale(e,t){if(e.transform.zoom!==this.zoom){this.zoom=e.transform.zoom;const i=this.getNodesInfo(),r=this.id.canonical;for(const e of i){const i=e.feature;e.evaluatedScale=t.paint.get("model-scale").evaluate(i,{},r)}}}evaluate(t){const i=this.getNodesInfo();for(const h of i)if(h.node.meshes){const i=h.feature,e=h.node.meshes&&h.node.meshes[0].featureData,u=h.evaluatedColor[2],d=h.evaluatedRMEA[2],p=this.id.canonical;if(h.hasTranslucentParts=!1,e){for(let e=0;e<Lg.length;e++){var r=Lg[e],r=(r.length&&(i.properties.part=r),t.paint.get("model-color").evaluate(i,{},p)),n=t.paint.get("model-color-mix-intensity").evaluate(i,{},p);h.evaluatedColor[e]=[r.r,r.g,r.b,n],h.evaluatedRMEA[e][0]=t.paint.get("model-roughness").evaluate(i,{},p),h.evaluatedRMEA[e][2]=t.paint.get("model-emissive-strength").evaluate(i,{},p),h.evaluatedRMEA[e][3]=r.a,h.emissionHeightBasedParams[e]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(i,{},p),!h.hasTranslucentParts&&r.a<1&&(h.hasTranslucentParts=!0)}delete i.properties.part;{o=void 0;a=void 0;s=void 0;l=void 0;c=void 0;var o=h;var a=u!==h.evaluatedColor[2]||d!==h.evaluatedRMEA[2];var s=this.modelTraits;var l=o.node;let e=0;var c=s&Fm.HasMeshoptCompression;for(const s of l.meshes)if((!l.lights||l.lightMeshIndex!==e)&&s.featureData){s.featureArray=new ea,s.featureArray.reserve(s.featureData.length);let i=a;for(const a of s.featureData){const e=c?65535&a:a>>16&65535,f=c?a>>16&65535:65535&a,m=(15&f)<8?15&f:0,g=o.evaluatedRMEA[m],_=o.evaluatedColor[m],y=o.emissionHeightBasedParams[m];let t;if(i&&2==m&&l.lights&&(t=new ea).resize(10*l.lights.length),function(t,e,i,r,n,o,a,s){let l=(61440&e|(61440&e)>>4)>>8,c=(3840&e|(3840&e)>>4)>>4,h=240&e|(240&e)>>4;0<i[3]&&(l=A(l,255*i[0],i[3]),c=A(c,255*i[1],i[3]),h=A(h,255*i[2],i[3]));var u=l<<8|c,d=h<<8|Math.floor(255*r[3]),p=function(){var e=S(r[2],0,2);return Math.min(Math.round(.5*e*255),255)}()<<8|15*r[0]<<4|15*r[1],i=S(n[0],0,1),f=S(n[1],0,1),m=S(n[2],0,1),g=S(n[3],0,1);let _,y,v,x;if(i!==f&&a!==o&&f!==i){const t=a-o,e=(y=1/(t*(f-i)),v=-(o+t*i)/(t*(f-i)),S(n[4],-1,1));x=Math.pow(10,e),_=255*m<<8|255*g}else _=65535,y=0,v=1,x=1;if(t.emplaceBack(u,d,p,_,y,v,x),s){const t=s.length;s.clear();for(let e=0;e<t;e++)s.emplaceBack(u,d,p,_,y,v,x)}}(s.featureArray,e,_,g,y,s.aabb.min[2],s.aabb.max[2],t),t&&i){i=!1;const o=l.meshes[l.lightMeshIndex];o.featureArray=t,o.featureArray._trim()}}s.featureArray._trim(),e++}}}else h.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(i,{},p);h.evaluatedScale=t.paint.get("model-scale").evaluate(i,{},p),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,r,n){var t=e.findDEMTileFor(r);if(t&&(t.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(t.dem&&t.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=t.tileID.overscaledZ;const i=Zu.create(e,r,t);if(!i)return;this.modelTraits&Fm.HasMapboxMeshFeatures&&this.updateDEM(e,i,r,n);for(const e of this.getNodesInfo()){const r=e.node;if(r.footprint&&r.footprint.vertices&&r.footprint.vertices.length){const n=r.footprint.vertices;let t=i.getElevationAt(n[0].x,n[0].y,!0,!0);for(let e=1;e<n.length;e++)t=Math.min(t,i.getElevationAt(n[e].x,n[e].y,!0,!0));r.elevation=t}}}this.terrainTile=t.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,c,i,s){let h=c._dem._modifiedForSources[s];if(void 0===h&&(c._dem._modifiedForSources[s]=[],h=c._dem._modifiedForSources[s]),!h.includes(i.canonical)){const g=c._dem.dim;h.push(i.canonical);let t=!1;for(const e of this.getNodesInfo()){const i=e.node;if(i.footprint&&i.footprint.grid){const s=i.footprint.grid,h=c.tileCoordToPixel(s.min.x,s.min.y),_=c.tileCoordToPixel(s.max.x,s.max.y),y=Math.min(Math.min(g-_.y,h.x),Math.min(h.y,g-_.x));if(!(y<0)){var u=S(y,2,5);let i=Math.max(0,h.x-u),e=Math.max(0,h.y-u),r=Math.min(_.x+u,g-1),n=Math.min(_.y+u,g-1);for(let t=e;t<=n;++t)for(let e=i;e<=r;++e)Pg[t*g+e]=255;let o=0,a=0;for(let t=0;t<s.cellsY;++t)for(let e=0;e<s.cellsX;++e)if(s.cells[t*s.cellsX+e]){const h=c.tileCoordToPixel(s.min.x+e/s.xScale,s.min.y+t/s.yScale),i=c.tileCoordToPixel(s.min.x+(e+1)/s.xScale,s.min.y+(t+1)/s.yScale);for(let t=h.y;t<=Math.min(i.y+1,g-1);++t)for(let e=h.x;e<=Math.min(i.x+1,g-1);++e)255===Pg[t*g+e]&&(Pg[t*g+e]=0,o+=c.getElevationAtPixel(e,t),a++)}var l=o/a;i=Math.max(1,h.x-u),e=Math.max(1,h.y-u),r=Math.min(_.x+u,g-2),n=Math.min(_.y+u,g-2),t=!0;for(let t=e;t<=n;++t)for(let e=i;e<=r;++e)0===Pg[t*g+e]&&(Ig[t*g+e]=c._dem.set(e,t,l));for(let l=1;l<u;++l){i=Math.max(1,h.x-l),e=Math.max(1,h.y-l),r=Math.min(_.x+l,g-2),n=Math.min(_.y+l,g-2);for(let s=e;s<=n;++s)for(let a=i;a<=r;++a){const h=s*g+a;if(255===Pg[h]){let i=0,r=0,n=-1,o=-1;for(let t=-1;t<=1;++t)for(let e=-1;e<=1;++e){var d,p=(s+t)*g+a+e;Pg[p]>=l||(p=Ig[p],(d=Math.abs(p))>r&&(i=p,r=d,n=e,o=t))}if(.1<r){const g=1-(l+.5*Math.abs(n*o))/u;let e=c._dem.get(a,s)+i*g;var f=c._dem.get(a+n,s+o),m=c._dem.get(a-n,s-o,!0);0<(e-f)*(e-m)&&(e=(f+m)/2),Ig[h]=c._dem.set(a,s,e),Pg[h]=l}}}}}}}t&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Re.now())}}getNodesInfo(){return this.nodesInfo}destroy(){for(const e of this.getNodesInfo())Vm(e.node),Gm(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime!==this.replacementUpdateTime){this.replacementUpdateTime=t.updateTime;var i=t.getReplacementRegionsForTile(e.toUnwrapped()),r=this.getNodesInfo();for(let e=0;e<this.nodesInfo.length;e++){const t=r[e].node;r[e].hiddenByReplacement=!!t.footprint&&!i.find(e=>e.footprint===t.footprint)}}}getHeightAtTileCoord(t,i){var r=this.getNodesInfo(),n=[];for(let e=0;e<this.nodesInfo.length;e++){var o=r[e],a=o.node.meshes[0];if(!(t<a.aabb.min[0]||i<a.aabb.min[1]||t>a.aabb.max[0]||i>a.aabb.max[1])){var s=(t-a.aabb.min[0])/(a.aabb.max[0]-a.aabb.min[0])*64|0,s=64*Math.min(63,(i-a.aabb.min[1])/(a.aabb.max[1]-a.aabb.min[1])*64|0)+Math.min(63,s);if(!(a.heightmap[s]<0&&o.node.footprint))return o.hiddenByReplacement?void 0:{height:a.heightmap[s],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]};if(o.node.footprint.grid.query(new U(t,i),new U(t,i),n),0<n.length)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}}function zg(e,t){return!e.isLightConstant&&t}function Rg(e,t,i,r){var n=1<<e.z;t.lat=bs((r/ue+e.y)/n),t.lng=xs((i/ue+e.x)/n)}n(kg,"Tiled3dModelBucket",{omit:["layers"]}),n(Dg,"Tiled3dModelFeature");const Og={circle:class extends wo{constructor(e,t,i){super(e,Ks,t,i)}createBucket(e){return new Os(e)}queryRadius(e){return Zs("circle-radius",this,e)+Zs("circle-stroke-width",this,e)+$s(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,n,o,a,s){var l=Ys(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),t=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Mh(e,r,o,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,t)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){var i=Ch(this);return{config:new Ga(this,t),defines:i,overrideFog:!1}}},heatmap:class extends wo{createBucket(e){return new Lh(e)}constructor(e,t,i){super(e,Fh,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Zs("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,r,n,o,a,s){t=this.paint.get("heatmap-radius").evaluate(t,i);return Mh(e,r,o,a,s,!0,!0,new U(0,0),t)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Ga(this,t),overrideFog:!1}:{}}},hillshade:class extends wo{constructor(e,t,i){super(e,Uh,t,i)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends wo{constructor(e,t,i){super(e,pu,t,i)}getProgramIds(){var e=this.paint.get("fill-pattern"),e=e&&e.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getDefaultProgramParams(e,t){return{config:new Ga(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new du(e)}queryRadius(){return $s(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,n,o){return!e.queryGeometry.isAboveHorizon&&Fs(Xs(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends wo{constructor(e,t,i){super(e,vd,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new hd(e)}queryRadius(){return $s(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,r,n,o,a,s,l){var c=Ys(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,i),t=this.paint.get("fill-extrusion-base").evaluate(t,i),i=[0,0],u=s&&o.elevation,d=o.elevation?o.elevation.exaggeration():1,p=e.tile.getBucket(this);if(u&&p instanceof hd){const Te=p.centroidVertexArray,e=l+1;e<Te.length&&(i[0]=Te.geta_centroid_pos0(e),i[1]=Te.geta_centroid_pos1(e))}if(0===i[0]&&1===i[1])return!1;var[p,l]=function(O,e,t,i,r,n,o,B,F,N,U){if("globe"===O.projection.name){var a=O,s=e,l=t,c=i,j=r,V=n,G=o,q=B,W=F,H=N,h=U;const g=[],_=[],y=a.projection.upVectorScale(h,a.center.lat,a.worldSize).metersToTile,v=[0,0,0,1],x=[0,0,0,1],b=(e,t,i,r)=>{e[0]=t,e[1]=i,e[2]=r,e[3]=1},w=_d();0<l&&(l+=w),c+=w;for(const w of s){const s=[],T=[];for(const g of w){const _=g.x+j.x,w=g.y+j.y,S=a.projection.projectTilePoint(_,w,h),A=a.projection.upVector(h,g.x,g.y);let e=l,t=c;if(G){const Te=Td(_,w,l,c,G,q,W,H);e+=Te.base,t+=Te.top}0!==l?b(v,S.x+A[0]*y*e,S.y+A[1]*y*e,S.z+A[2]*y*e):b(v,S.x,S.y,S.z),b(x,S.x+A[0]*y*t,S.y+A[1]*y*t,S.z+A[2]*y*t),Te.N.transformMat4(v,v,V),Te.N.transformMat4(x,x,V),s.push(new xd(v[0],v[1],v[2])),T.push(new xd(x[0],x[1],x[2]))}g.push(s),_.push(T)}return[g,_]}if(o){var u=e,Z=t,$=i,X=r,Y=n,K=o,J=B,Q=F,ee=N;const E=[],C=[],M=[0,0,0,1];for(const ne of u){const u=[],I=[];for(const E of ne){const C=E.x+X.x,P=E.y+X.y,L=Td(C,P,Z,$,K,J,Q,ee);M[0]=C,M[1]=P,M[2]=L.base,M[3]=1,Te.a7.transformMat4(M,M,Y),M[3]=Math.max(M[3],1e-5);var te=new xd(M[0]/M[3],M[1]/M[3],M[2]/M[3]),ie=(M[0]=C,M[1]=P,M[2]=L.top,M[3]=1,Te.a7.transformMat4(M,M,Y),M[3]=Math.max(M[3],1e-5),new xd(M[0]/M[3],M[1]/M[3],M[2]/M[3]));u.push(te),I.push(ie)}E.push(u),C.push(I)}return[E,C]}{var d=e,p=t,f=i,re=r,m=n;const D=[],k=[],oe=m[8]*p,ae=m[9]*p,se=m[10]*p,le=m[11]*p,ce=m[8]*f,he=m[9]*f,ue=m[10]*f,de=m[11]*f;for(const p of d){const d=[],f=[];for(const D of p){const p=D.x+re.x,k=D.y+re.y,pe=m[0]*p+m[4]*k+m[12],fe=m[1]*p+m[5]*k+m[13],me=m[2]*p+m[6]*k+m[14],ge=m[3]*p+m[7]*k+m[15],_e=pe+oe,ye=fe+ae,ve=me+se,z=Math.max(ge+le,1e-5),xe=pe+ce,be=fe+he,we=me+ue,R=Math.max(ge+de,1e-5);d.push(new xd(_e/z,ye/z,ve/z)),f.push(new xd(xe/R,be/R,we/R))}D.push(d),k.push(f)}return[D,k]}}(o,r="globe"===o.projection.name?yd([r],[new U(0,0),new U(ue,ue)],e.tileID.canonical).map(e=>e.polygon).flat():r,t,h,c,a,u?s:null,i,d,o.center.lat,e.tileID.canonical),r=e.queryGeometry;{var f=p,m=l,g=r.isPointQuery()?r.screenBounds:r.screenGeometry;let t=1/0;Fs(g,m)&&(t=wd(g,m[0]));for(let e=0;e<m.length;e++){var _=m[e],y=f[e];for(let e=0;e<_.length-1;e++){const m=_[e],v=[m,_[e+1],y[e+1],y[e],m];Bs(g,v)&&(t=Math.min(t,wd(g,v)))}}return t!==1/0&&t}}},line:class extends wo{constructor(e,t,i){super(e,Dd,t,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Fd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Ld(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){var i=Od(this);return{config:new Ga(this,t),defines:i,overrideFog:!1}}queryRadius(e){var t=Nd(Zs("line-width",this,e),Zs("line-gap-width",this,e)),e=Zs("line-offset",this,e);return t/2+Math.abs(e)+$s(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,r,n,o){if(!e.queryGeometry.isAboveHorizon){var o=Xs(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Nd(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),t=this.paint.get("line-offset").evaluate(t,i),s=(t&&(r=function(t,i){const r=[],n=new U(0,0);for(let e=0;e<t.length;e++){var o=t[e],a=[];for(let e=0;e<o.length;e++){const r=o[e],s=o[e+1],l=0===e?n:r.sub(o[e-1])._unit()._perp(),c=e===o.length-1?n:s.sub(r)._unit()._perp(),h=l._add(c)._unit();h._mult(1/(h.x*c.x+h.y*c.y)),a.push(h._mult(i)._add(r))}r.push(a)}return r}(r,t*e.pixelToTileUnitsFactor)),o),l=r,c=a;for(let e=0;e<l.length;e++){var h=l[e];if(3<=s.length)for(let e=0;e<h.length;e++)if(Gs(s,h[e]))return!0;if(function(t,i,r){if(1<t.length){if(Ns(t,i))return 1;for(let e=0;e<i.length;e++)if(Us(i[e],t,r))return 1}for(let e=0;e<t.length;e++)if(Us(t[e],i,r))return 1}(s,h,c))return!0}}return!1}isTileClipped(){return!0}},symbol:em,background:class extends wo{constructor(e,t,i){super(e,tm,t,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:hm,"raster-particle":dm,sky:class extends wo{constructor(e,t,i){super(e,fm,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Nh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){return!(!this._skyboxInvalidated&&this.skyboxTexture&&this.skyboxGeometry)||!this.paint.get("sky-atmosphere-sun")&&(e=e.style.light.properties.get("position"),this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar)}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=e.style.light,o=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&_e("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?mm(o.azimuthal,90-o.polar,t):mm(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return mm(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){var e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends wo{constructor(e,t,i){super(e,gm,t)}},model:class extends wo{constructor(e,t,i){super(e,Bm,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Om(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof kg?ue-1:0}queryIntersectsFeature(r,e,n,o,a,s){if(this.modelManager){const d=this.modelManager,p=r.tile.getBucket(this);if(p&&p instanceof Om){const f=p;for(const n in f.instancesPerModel){const o=f.instancesPerModel[n];if(o.idToFeaturesIndex.hasOwnProperty(e.id)){const a=o.features[o.idToFeaturesIndex[e.id]],p=d.getModel(n,this.scope);if(!p)return!1;let t=Te.a6.create();var l=new E(0,0),c=f.canonical;let i=Number.MAX_VALUE;for(let e=0;e<a.instancedDataCount;++e){const n=16*(a.instancedDataOffset+e),d=o.instancedDataArray.float32,f=[d[4+n],d[5+n],d[6+n]];Rg(c,l,d[n],0|d[1+n]),Nm(t,p,s,l,a.rotation,a.scale,f,!1,!1,!1),"globe"===s.projection.name&&(t=Am(t,s));var h=Te.a6.multiply([],s.projMatrix,t),u=r.queryGeometry,u=Em(u.isPointQuery()?u.screenBounds:u.screenGeometry,s,h,p.aabb);null!=u&&(i=Math.min(u,i))}return i!==Number.MAX_VALUE&&i}}}}return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){e=this._transitionablePaint._values[e];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Tn}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(e,t,i,o){var r=e.tile,n=r.getBucket(this);let a=Number.MAX_VALUE;if(!(n&&n instanceof kg))return{queryFeature:null,intersectionZ:a};n=n.getNodesInfo()[t];if(n.hiddenByReplacement||!n.node.meshes||!i.filter(new Kn(r.tileID.overscaledZ),n.feature,r.tileID.canonical))return{queryFeature:null,intersectionZ:a};const s=n.node,l=o.calculatePosMatrix(r.tileID.toUnwrapped(),o.worldSize),c=n.evaluatedScale;let h=0;o.elevation&&s.elevation&&(h=s.elevation*o.elevation.exaggeration()),Te.a6.translate(l,l,[(s.anchor?s.anchor[0]:0)*(c[0]-1),(s.anchor?s.anchor[1]:0)*(c[1]-1),h]),Te.a6.scale(l,l,c),Te.a6.multiply(l,l,s.matrix);const u=e.queryGeometry,d=u.isPointQuery()?u.screenBounds:u.screenGeometry,p=function(t){const i=Te.a6.multiply([],l,t.matrix),r=Te.a6.multiply(i,o.expandedFarZProjMatrix,i);for(let e=0;e<t.meshes.length;++e){const i=t.meshes[e];var n;e!==t.lightMeshIndex&&null!=(n=Em(d,o,r,i.aabb))&&(a=Math.min(n,a))}if(t.children)for(const Te of t.children)p(Te)};return p(s),a===Number.MAX_VALUE?{queryFeature:null,intersectionZ:a}:(t=new E(0,0),Rg(r.tileID.canonical,t,n.node.anchor[0],n.node.anchor[1]),{queryFeature:{type:"Feature",geometry:{type:"Point",coordinates:[t.lng,t.lat]},properties:n.feature.properties,id:n.feature.id,state:{},layer:this.serialize()},intersectionZ:a})}}},P={read:function(e,t){return e.readFields(P._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(e,t,i){1===e?t.header_length=i.readFixed32():2===e?t.x=i.readVarint():3===e?t.y=i.readVarint():4===e?t.z=i.readVarint():5===e&&t.layers.push(P.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}},Bg=(P.Filter.read=function(e,t){return e.readFields(P.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},P.Filter._readField=function(e,t,i){1===e?(t.delta_filter=P.Filter.Delta.read(i,i.readVarint()+i.pos),t.filter="delta_filter"):2===e?(t.zigzag_filter=P.Filter.Zigzag.read(i,i.readVarint()+i.pos),t.filter="zigzag_filter"):3===e?(t.bitshuffle_filter=P.Filter.BitShuffle.read(i,i.readVarint()+i.pos),t.filter="bitshuffle_filter"):4===e&&(t.byteshuffle_filter=P.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),t.filter="byteshuffle_filter")},P.Filter.Delta={},P.Filter.Delta.read=function(e,t){return e.readFields(P.Filter.Delta._readField,{block_size:0},t)},P.Filter.Delta._readField=function(e,t,i){1===e&&(t.block_size=i.readVarint())},P.Filter.Zigzag={},P.Filter.Zigzag.read=function(e,t){return e.readFields(P.Filter.Zigzag._readField,{},t)},P.Filter.Zigzag._readField=function(e,t,i){},P.Filter.BitShuffle={},P.Filter.BitShuffle.read=function(e,t){return e.readFields(P.Filter.BitShuffle._readField,{},t)},P.Filter.BitShuffle._readField=function(e,t,i){},P.Filter.ByteShuffle={},P.Filter.ByteShuffle.read=function(e,t){return e.readFields(P.Filter.ByteShuffle._readField,{},t)},P.Filter.ByteShuffle._readField=function(e,t,i){},P.Codec={},P.Codec.read=function(e,t){return e.readFields(P.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},P.Codec._readField=function(e,t,i){1===e?(t.gzip_data=P.Codec.GzipData.read(i,i.readVarint()+i.pos),t.codec="gzip_data"):2===e?(t.jpeg_image=P.Codec.JpegImage.read(i,i.readVarint()+i.pos),t.codec="jpeg_image"):3===e?(t.webp_image=P.Codec.WebpImage.read(i,i.readVarint()+i.pos),t.codec="webp_image"):4===e&&(t.png_image=P.Codec.PngImage.read(i,i.readVarint()+i.pos),t.codec="png_image")},P.Codec.GzipData={},P.Codec.GzipData.read=function(e,t){return e.readFields(P.Codec.GzipData._readField,{},t)},P.Codec.GzipData._readField=function(e,t,i){},P.Codec.JpegImage={},P.Codec.JpegImage.read=function(e,t){return e.readFields(P.Codec.JpegImage._readField,{},t)},P.Codec.JpegImage._readField=function(e,t,i){},P.Codec.WebpImage={},P.Codec.WebpImage.read=function(e,t){return e.readFields(P.Codec.WebpImage._readField,{},t)},P.Codec.WebpImage._readField=function(e,t,i){},P.Codec.PngImage={},P.Codec.PngImage.read=function(e,t){return e.readFields(P.Codec.PngImage._readField,{},t)},P.Codec.PngImage._readField=function(e,t,i){},P.DataIndexEntry={},P.DataIndexEntry.read=function(e,t){return e.readFields(P.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},P.DataIndexEntry._readField=function(e,t,i){1===e?t.first_byte=i.readFixed64():2===e?t.last_byte=i.readFixed64():3===e?t.filters.push(P.Filter.read(i,i.readVarint()+i.pos)):4===e?t.codec=P.Codec.read(i,i.readVarint()+i.pos):5===e?t.offset=i.readFloat():6===e?t.scale=i.readFloat():7===e&&t.bands.push(i.readString())},P.Layer={},P.Layer.read=function(e,t){return e.readFields(P.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},P.Layer._readField=function(e,t,i){1===e?t.version=i.readVarint():2===e?t.name=i.readString():3===e?t.units=i.readString():4===e?t.tilesize=i.readVarint():5===e?t.buffer=i.readVarint():6===e?t.pixel_format=i.readVarint():7===e&&t.data_index.push(P.DataIndexEntry.read(i,i.readVarint()+i.pos))},{read:function(e,t){return e.readFields(Bg._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(e,t,i){2===e?(t.uint32_values=Bg.Uint32Values.read(i,i.readVarint()+i.pos),t.values="uint32_values"):3===e&&(t.fixed32_values=Bg.Fixed32Values.read(i,i.readVarint()+i.pos),t.values="fixed32_values")},Uint32Values:{}});Bg.Uint32Values.read=function(e,t){return e.readFields(Bg.Uint32Values._readField,{values:[]},t)},Bg.Uint32Values._readField=function(e,t,i){1===e&&(t.readValuesInto=function(i){if(2!==i.type)throw new Error(`Unsupported pbf type "${i.type}"`);const r=2===(e=i).type?e.readVarint()+e.pos:e.pos+1,n=i.pos;var e;return i.pos=r,function(e){i.pos=n;let t=0;for(;i.pos<r;){const r=i.readVarint();e[t++]=r}return e}}(i))},Bg.Fixed32Values={},Bg.Fixed32Values.read=function(e,t){return e.readFields(Bg.Fixed32Values._readField,{values:[]},t)},Bg.Fixed32Values._readField=function(e,t,i){throw new Error("Not implemented")};class Fg{constructor(e=0,t=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=i,this.size=0,this.ttl=t}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){var t;return this.has(e)&&(t=this.items[e],delete this.items[e],this.size--,null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),this.last===t)&&(this.last=t.prev),this}entries(e=this.keys()){return e.map(e=>[e,this.get(e)])}evict(e=!1){if(e||0<this.size){const e=this.first;delete this.items[e.key],0==--this.size?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(e){let t;return t=this.has(e)?this.items[e].expiry:t}get(e){let t;var i;return this.has(e)&&(i=this.items[e],0<this.ttl&&i.expiry<=Date.now()?this.delete(e):(t=i.value,this.set(e,t,!0))),t}has(e){return e in this.items}keys(){var e=[];let t=this.first;for(;null!==t;)e.push(t.key),t=t.next;return e}set(e,t,i=!1,r=this.resetTtl){let n;if(i||this.has(e)){if((n=this.items[e]).value=t,!1===i&&r&&(n.expiry=0<this.ttl?Date.now()+this.ttl:this.ttl),this.last!==n){const e=this.last,t=n.next,i=n.prev;this.first===n&&(this.first=n.next),n.next=null,n.prev=this.last,e.next=n,null!==i&&(i.next=t),null!==t&&(t.prev=i)}}else 0<this.max&&this.size===this.max&&this.evict(!0),n=this.items[e]={expiry:0<this.ttl?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:t},1==++this.size?this.first=n:this.last.next=n;return this.last=n,this}values(e=this.keys()){return e.map(e=>this.get(e))}}class Ng extends Error{constructor(e){super(e),this.name="MRTError"}}function Ug(e,t){for(var i=new Vg(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];for(var n=new Gg(i[30]),r=1;r<30;++r)for(var o=i[r];o<i[r+1];++o)n[o]=o-i[r]<<5|r;return{b:i,r:n}}var jg=Uint8Array,Vg=Uint16Array,Gg=Int32Array,qg=new jg([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Wg=new jg([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hg=new jg([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=Ug(qg,2),Zg=r.b;r.r[Zg[28]=258]=28;for(var $g=Ug(Wg,0).b,Xg=new Vg(32768),Yg=0;Yg<32768;++Yg){var Kg=(43690&Yg)>>1|(21845&Yg)<<1;Xg[Yg]=((65280&(Kg=(61680&(Kg=(52428&Kg)>>2|(13107&Kg)<<2))>>4|(3855&Kg)<<4))>>8|(255&Kg)<<8)>>1}for(var Jg=function(e,t,i){for(var r=e.length,n=0,o=new Vg(t);n<r;++n)e[n]&&++o[e[n]-1];var a=new Vg(t);for(n=1;n<t;++n)a[n]=a[n-1]+o[n-1]<<1;if(i){for(var s=new Vg(1<<t),l=15-t,n=0;n<r;++n)if(e[n])for(var c=n<<4|e[n],h=t-e[n],u=a[e[n]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)s[Xg[u]>>l]=c}else for(s=new Vg(r),n=0;n<r;++n)e[n]&&(s[n]=Xg[a[e[n]-1]++]>>15-e[n]);return s},Qg=new jg(288),Yg=0;Yg<144;++Yg)Qg[Yg]=8;for(Yg=144;Yg<256;++Yg)Qg[Yg]=9;for(Yg=256;Yg<280;++Yg)Qg[Yg]=7;for(Yg=280;Yg<288;++Yg)Qg[Yg]=8;var e_=new jg(32);for(Yg=0;Yg<32;++Yg)e_[Yg]=5;function t_(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t}function i_(e,t,i){var r=t/8|0;return(e[r]|e[1+r]<<8)>>(7&t)&i}function r_(e,t){var i=t/8|0;return(e[i]|e[1+i]<<8|e[2+i]<<16)>>(7&t)}function n_(e,t,i){if((t=new Error(t||s_[e])).code=e,Error.captureStackTrace&&Error.captureStackTrace(t,n_),i)return t;throw t}var o_=Jg(Qg,9,1),a_=Jg(e_,5,1),s_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=new jg(0),e="undefined"!=typeof TextDecoder&&new TextDecoder;try{e.decode(C,{stream:!0})}catch(Te){}const l_={gzip_data:"gzip"},c_={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},h_={uint32:1,uint16:2,uint8:4},u_={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class d_{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){var t=new Uint8Array(e),e=new DataView(e);if(13!==t[0])throw new Ng("File is not a valid MRT.");return e.getUint32(1,!0)}parseHeader(e){var t=new Uint8Array(e),e=this.getHeaderLength(e);if(t.length<e)throw new Ng(`Expected header with length >= ${e} but got buffer of length `+t.length);t=new xp(t.subarray(0,e)),t=P.read(t);if(!isNaN(this.x)&&(this.x!==t.x||this.y!==t.y||this.z!==t.z))throw new Ng(`Invalid attempt to parse header ${t.z}/${t.x}/${t.y} for tile ${this.z}/${this.x}/`+this.y);this.x=t.x,this.y=t.y,this.z=t.z;for(const e of t.layers)this.layers[e.name]=new p_(e,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const i=[],r=this.getLayer(t.layerName);for(let e=0;e<r.dataIndex.length;e++){var n=r.dataIndex[e],o=n.first_byte-t.firstByte,a=n.last_byte+1-t.firstByte;e<t.firstBlock||e>t.lastBlock||r._blocksInProgress.has(e)||(o={layerName:r.name,firstByte:o,lastByte:a,pixelFormat:r.pixelFormat,blockIndex:e,blockShape:[n.bands.length].concat(r.bandShape),buffer:r.buffer,codec:n.codec.codec,filters:n.filters.map(e=>e.filter)},r._blocksInProgress.add(e),i.push(o))}return new f_(i,()=>{i.forEach(e=>r._blocksInProgress.delete(e.blockIndex))},(e,t)=>{if(i.forEach(e=>r._blocksInProgress.delete(e.blockIndex)),e)throw e;t.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class p_{constructor({version:e,name:t,units:i,tilesize:r,pixel_format:n,buffer:o,data_index:a},s){if(this.version=e,1!==this.version)throw new Ng("Cannot parse raster layer encoded with MRT version "+e);this.name=t,this.units=i,this.tileSize=r,this.buffer=o,this.pixelFormat=c_[n],this.dataIndex=a,this.bandShape=[r+2*o,r+2*o,h_[this.pixelFormat]],this._decodedBlocks=function(e=1e3){if(isNaN(e)||e<0)throw new TypeError("Invalid max value");if(isNaN(0))throw new TypeError("Invalid ttl value");return new Fg(e,0,!1)}(s?s.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){var t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.set(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(var[i,r]of this.dataIndex.entries()){for(var[n,o]of r.bands.entries())if(o===e)return{bandIndex:t+n,blockIndex:i,blockBandIndex:n};t+=r.bands.length}break;case"number":for(var[a,s]of this.dataIndex.entries()){if(e>=t&&e<t+s.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-t};t+=s.bands.length}break;default:throw new Ng(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ng("Band not found: "+JSON.stringify(e))}getDataRange(e){let t=1/0,i=-1/0,r=1/0,n=-1/0;for(const a of e){const e=this.getBlockForBand(a)["blockIndex"];if(e<0)throw new Ng("Invalid band: "+JSON.stringify(a));var o=this.dataIndex[e];r=Math.min(r,e),n=Math.max(n,e),t=Math.min(t,o.first_byte),i=Math.max(i,o.last_byte)}return{layerName:this.name,firstByte:t,lastByte:i,firstBlock:r,lastBlock:n}}hasBand(e){e=this.getBlockForBand(e).blockIndex;return 0<=e}hasDataForBand(e){e=this.getBlockForBand(e).blockIndex;return 0<=e&&!!this._decodedBlocks.get(e.toString())}getBandView(e){var t,{blockIndex:i,blockBandIndex:r}=this.getBlockForBand(e),n=this._decodedBlocks.get(i.toString());if(n)return i=this.dataIndex[i],t=this.bandShape.reduce((e,t)=>e*t,1),{data:r=n.subarray(n=r*t,n+t),bytes:new Uint8Array(r.buffer).subarray(r.byteOffset,r.byteOffset+r.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:i.offset,scale:i.scale};throw new Ng(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`)}}class f_{constructor(e,t,i){this.tasks=e,this._onCancel=t,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}d_.performDecoding=function(s,e){return Promise.all(e.tasks.map(e=>{const{layerName:t,firstByte:i,lastByte:r,pixelFormat:u,blockShape:d,blockIndex:p,filters:f,codec:n}=e,o=new Uint8Array(s).subarray(i,r+1),a=new Uint32Array(d[0]*d[1]*d[2]);if("gzip_data"!==n)throw new Error("Unhandled codec: "+n);return function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((r=function(e){31==e[0]&&139==e[1]&&8==e[2]||n_(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);0<r;r-=!e[i++]);return i+(2&t)}(i=e))+8>i.length&&n_(6,"invalid gzip data"),function(e,t,i){var r=e.length;if(!r||t.f&&!t.l)return i||new jg(0);function n(e){var t=i.length;t<e&&((t=new jg(Math.max(2*t,e))).set(i),i=t)}var o,a,s=!i,l=s||2!=t.i,c=t.i,h=(s&&(i=new jg(3*r)),t.f||0),u=t.p||0,d=t.b||0,p=t.l,f=t.d,m=t.m,g=t.n,_=8*r;do{if(!p){var h=i_(e,u,1),y=i_(e,u+1,3);if(u+=3,!y){var v=e[(E=4+((u+7)/8|0))-4]|e[E-3]<<8,x=E+v;if(r<x){c&&n_(0);break}l&&n(d+v),i.set(e.subarray(E,x),d),t.b=d+=v,t.p=u=8*x,t.f=h;continue}if(1==y)p=o_,f=a_,m=9,g=5;else if(2==y){var v=i_(e,u,31)+257,b=i_(e,u+10,15)+4,w=v+i_(e,u+5,31)+1;u+=14;for(var T=new jg(w),S=new jg(19),A=0;A<b;++A)S[Hg[A]]=i_(e,u+3*A,7);u+=3*b;for(var x=t_(S),O=(1<<x)-1,B=Jg(S,x,1),A=0;A<w;){var E,C=B[i_(e,u,O)];if(u+=15&C,(E=C>>4)<16)T[A++]=E;else{var M=0,I=0;for(16==E?(I=3+i_(e,u,3),u+=2,M=T[A-1]):17==E?(I=3+i_(e,u,7),u+=3):18==E&&(I=11+i_(e,u,127),u+=7);I--;)T[A++]=M}}var y=T.subarray(0,v),P=T.subarray(v),m=t_(y),g=t_(P),p=Jg(y,m,1),f=Jg(P,g,1)}else n_(1);if(_<u){c&&n_(0);break}}l&&n(d+131072);for(var F=(1<<m)-1,N=(1<<g)-1,L=u;;L=u){var D=(M=p[r_(e,u)&F])>>4;if((u+=15&M)>_){c&&n_(0);break}if(M||n_(2),D<256)i[d++]=D;else{if(256==D){L=u,p=null;break}var k,z=D-254,D=(264<D&&(z=i_(e,u,(1<<(k=qg[A=D-257]))-1)+Zg[A],u+=k),f[r_(e,u)&N]),R=D>>4;if(D||n_(3),u+=15&D,P=$g[R],3<R&&(k=Wg[R],P+=r_(e,u)&(1<<k)-1,u+=k),_<u){c&&n_(0);break}l&&n(d+131072);var U=d+z;if(d<P){var j=0-P,V=Math.min(P,U);for(j+d<0&&n_(3);d<V;++d)i[d]=(void 0)[j+d]}for(;d<U;++d)i[d]=i[d-P]}}t.l=p,t.p=L,t.b=d,t.f=h,p&&(h=1,t.m=m,t.d=f,t.n=g)}while(!h);return d!=i.length&&s?(s=i,o=0,(null==(a=d)||a>s.length)&&(a=s.length),new jg(s.subarray(o=null==o||o<0?0:o,a))):i.subarray(0,d)}(i.subarray(r,-8),{i:2},new jg(((r=i)[(i=r.length)-4]|r[i-3]<<8|r[i-2]<<16|r[i-1]<<24)>>>0))));var i,r=l_[t];if(r)return i=new globalThis.DecompressionStream(r),new Response(new Blob([e]).stream().pipeThrough(i)).arrayBuffer().then(e=>new Uint8Array(e));throw new Error("Unhandled codec: "+t)}(o,n).then(e=>{e=Bg.read(new xp(e));if("uint32_values"===e.values)return e.uint32_values.readValuesInto(a),new u_[u](a.buffer);throw new Error(`Unhandled numeric data "${e.values}"`)}).then(i=>{for(let e=f.length-1;0<=e;e--)switch(f[e]){case"delta_filter":{r=void 0;n=void 0;o=void 0;a=void 0;s=void 0;l=void 0;c=void 0;var r=i;var n=d;if(4!==n.length)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let t=n[3];for(let e=2;1<=e;e--){var o=1===e?1:0,a=2===e?1:0;for(let e=0;e<n[0];e++){var s=n[1]*e;for(let e=o;e<n[1];e++){var l=n[2]*(e+s);for(let e=a;e<n[2];e++){var c=n[3]*(e+l);for(let e=0;e<n[3];e++){const n=c+e;r[n]+=r[n-t]}}}}t*=n[e]}}break;case"zigzag_filter":h=void 0;var h=i;for(let e=0,t=h.length;e<t;e++)h[e]=h[e]>>>1^-(1&h[e]);break;case"bitshuffle_filter":!function(t,e){switch(e){case"uint32":return;case"uint16":for(let e=0;e<t.length;e+=2){var i=t[e],r=t[e+1];t[e]=(240&i)>>4|(61440&i)>>8|(240&r)<<4|61440&r,t[e+1]=15&i|(3840&i)>>4|(15&r)<<8|(3840&r)<<4}return;case"uint8":for(let e=0;e<t.length;e+=4){var n=t[e],o=t[e+1],a=t[e+2],s=t[e+3];t[e+0]=(192&n)>>6|(192&o)>>4|(192&a)>>2|192&s,t[e+1]=(48&n)>>4|(48&o)>>2|48&a|(48&s)<<2,t[e+2]=(12&n)>>2|12&o|(12&a)<<2|(12&s)<<4,t[e+3]=3&n|(3&o)<<2|(3&a)<<4|(3&s)<<6}return;default:throw new Error(`Invalid pixel format, "${e}"`)}}(i,u);break;default:throw new Error(`Unhandled filter "${f[e]}"`)}return{layerName:t,blockIndex:p,data:i}}).catch(e=>{throw e})}))},n(f_,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const m_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function g_(i,r,n,o,a,s){for(;o<a;){600<a-o&&(l=a-o+1,c=n-o+1,u=Math.log(l),h=.5*Math.exp(2*u/3),u=.5*Math.sqrt(u*h*(l-h)/l)*(c-l/2<0?-1:1),g_(i,r,n,Math.max(o,Math.floor(n-c*h/l+u)),Math.min(a,Math.floor(n+(l-c)*h/l+u)),s));var l,c,h,u,d=r[2*n+s];let e=o,t=a;for(__(i,r,o,n),r[2*a+s]>d&&__(i,r,o,a);e<t;){for(__(i,r,e,t),e++,t--;r[2*e+s]<d;)e++;for(;r[2*t+s]>d;)t--}r[2*o+s]===d?__(i,r,o,t):__(i,r,++t,a),t<=n&&(o=t+1),n<=t&&(a=t-1)}}function __(e,t,i,r){y_(e,i,r),y_(t,2*i,2*r),y_(t,2*i+1,2*r+1)}function y_(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function v_(e,t,i,r){e-=i,i=t-r;return e*e+i*i}Te.$=xf,Te.A=dn,Te.B=cn,Te.C=xi,Te.D=p,Te.E=Ct,Te.F=d,Te.G=a,Te.H=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return ve(e.expression.evaluate(t))}interpolate(e,t,i){return{x:A(e.x,t.x,i),y:A(e.y,t.y,i),z:A(e.z,t.z,i),azimuthal:A(e.azimuthal,t.azimuthal,i),polar:A(e.polar,t.polar,i)}}},Te.I=Hp,Te.J=eo,Te.K=Kn,Te.L=Cs,Te.M=class{constructor(e,t,i,r){this.id=e,this.position=null!=t?new E(t[0],t[1]):new E(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new M([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(Te.a6.multiply(e.matrix,t,e.matrix),e.meshes)for(const Te of e.meshes){const t=M.applyTransform(Te.aabb,e.matrix);this.aabb.encapsulate(t)}if(e.children)for(const Te of e.children)this._applyTransformations(Te,e.matrix)}computeBoundsAndApplyParent(){var e=Te.a6.identity([]);for(const Te of this.nodes)this._applyTransformations(Te,e)}computeModelMatrix(e,t,i,r,n,o,a=!1){Nm(this.matrix,this,e.transform,this.position,t,i,r,n,o,a)}upload(e){if(!this.uploaded){for(const t of this.nodes)jm(t,e);for(const e of this.nodes)Vm(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Gm(e)}},Te.O=te,Te.P=U,Te.Q=oo,Te.R=Je,Te.S=xh,Te.T=nm,Te.U=A,Te.V=ue,Te.W=Rt,Te.X=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){var[e,t]=e.expression.evaluate(t);return{x:(e=ve([1,e,t])).x,y:e.y,z:e.z}}interpolate(e,t,i){return{x:A(e.x,t.x,i),y:A(e.y,t.y,i),z:A(e.z,t.z,i)}}},Te.Y=function(e,t,i=0,r=!0){i=new U(i,i),e=e.sub(i),t=t.add(i),i=[e,new U(t.x,e.y),t,new U(e.x,t.y)];return r&&i.push(e.clone()),i},Te.Z=Tn,Te._=function(t,i){var r=[];for(let e=0;e<t.length;e++){var n=ie(e-1,-1,t.length-1),o=ie(e+1,-1,t.length-1),a=t[e],o=t[o],n=t[n].sub(a).unit(),o=o.sub(a).unit(),s=o.angleWithSep(n.x,n.y),n=n.add(o).unit().mult(-1*i/Math.sin(s/2));r.push(a.add(n))}return r},Te.a=Et,Te.a$=function(e){var t=[];for(const i in e)t.push(e[i]);return t},Te.a0=qs,Te.a1=function(e,t,i=0){return Te.N.fromValues(((t.x-i)*e.scale-e.x)*ue,(t.y*e.scale-e.y)*ue,ws(t.z,t.y))},Te.a2=Hc,Te.a3=kd,Te.a4=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{min:new U(t,i),max:new U(r,n)}},Te.a5=_s,Te.a8=Gs,Te.a9=Ms,Te.aA=Jr,Te.aB=ma,Te.aC=ae,Te.aD=ra,Te.aE=Kf,Te.aF=function(){Yn.isLoading()||Yn.isLoaded()||"deferred"!==Gn||$n()},Te.aG=ho,Te.aH=ks,Te.aI=Ag,Te.aJ=be,Te.aK=Ld,Te.aL=du,Te.aM=Ds,Te.aN=Eo,Te.aO=Yo,Te.aP=eh,Te.aQ=su,Te.aR=rm,Te.aS=function(e,t){var i,r,n,o,a,s=xh(t.zoom);return 0===s?ah(e):(i=uh(e=hh(e)),a=_s(e.getWest())*t.worldSize,o=_s(e.getEast())*t.worldSize,r=[a,n=ys(e.getNorth())*t.worldSize,0],n=[o,n,0],e=[a,a=ys(e.getSouth())*t.worldSize,0],o=[o,a,0],a=Te.a6.invert([],t.globeMatrix),Te.N.transformMat4(r,r,a),Te.N.transformMat4(n,n,a),Te.N.transformMat4(e,e,a),Te.N.transformMat4(o,o,a),i[0]=sh(i[0],e,s),i[1]=sh(i[1],o,s),i[2]=sh(i[2],n,s),i[3]=sh(i[3],r,s),M.fromPoints(i))},Te.aT=mh,Te.aU=dh,Te.aV=sh,Te.aW=Co,Te.aX=Qc,Te.aY=he,Te.aZ=d_,Te.a_=tt,Te.aa=S,Te.ab=Xa,Te.ac=function(t,i){var r={};for(let e=0;e<i.length;e++){var n=i[e];n in t&&(r[n]=t[n])}return r},Te.ad=as,Te.ae=ys,Te.af=class{constructor(e){this.entries={},this.scheduler=e}request(i,r,e,t){const n=this.entries[i]=this.entries[i]||{callbacks:[]};if(n.result){const[i,e]=n.result;return this.scheduler?this.scheduler.add(()=>{t(i,e)},r):t(i,e),()=>{}}return n.callbacks.push(t),n.cancel||(n.cancel=e((e,t)=>{n.result=[e,t];for(const i of n.callbacks)this.scheduler?this.scheduler.add(()=>{i(e,t)},r):i(e,t);setTimeout(()=>delete this.entries[i],3e3)})),()=>{n.result||(n.callbacks=n.callbacks.filter(e=>e!==t),n.callbacks.length)||(n.cancel(),delete this.entries[i])}}},Te.ag=xo,Te.ah=function(t,e,o){var i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},n=>{const e=tt(t.request,(e,t,i,r)=>{e?n(e):t&&n(null,{vectorTile:o?void 0:new Mu(new xp(t)),rawData:t,cacheControl:i,expires:r})});return()=>{e.cancel(),n()}},e)},Te.ai=function(e){++We>Fe&&(e.getActor().send("enforceCacheSizeLimit",Be),We=0)},Te.aj=mt,Te.ak=ze,Te.al=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},Te.am=ds,Te.an=hm,Te.ao=dm,Te.ap=cm,Te.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let e=0;e<t.length;e++){var r=document.createElement("source");n=t[e],o=void 0,(o=document.createElement("a")).href=n,o.protocol===location.protocol&&o.host===location.host||(i.crossOrigin="Anonymous"),r.src=t[e],i.appendChild(r)}var n,o;return{cancel:()=>{}}},Te.ar=om,Te.as=vf,Te.at=xs,Te.au=bs,Te.av=Mo,Te.aw=Go,Te.ax=zt,Te.ay=m,Te.az=Ko,Te.b=At,Te.b$=Wn,Te.b0=function(e,t){var i=[];for(const r in e)r in t||i.push(r);return i},Te.b1=re,Te.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],Te.b3=function(e,t){var{x:i,y:r}=e.point,i=vh(i,r,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Te.a6.multiply(i,i,gh(ah(t)))},Te.b5=Qd,Te.b6=Ep,Te.b7=Jd,Te.b8=function(e,t,i,r,n){t=5*t+2;e.float32[t]=i,e.float32[1+t]=r,e.float32[2+t]=n},Te.b9=Zf,Te.bA=vm,Te.bB=_m,Te.bC=function(e){e=_m(e,!0);return Te.b4.invert([],[e[0],e[1],e[4],e[5]])},Te.bD=class U_{constructor(e,t,i,r,n){this.TL=e,this.TR=t,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(e,t,i){var r=[-1,1,1],n=[1,1,1],o=[1,-1,1],a=[-1,-1,1],r=Te.N.transformMat4(r,r,e),n=Te.N.transformMat4(n,n,e),o=Te.N.transformMat4(o,o,e),a=Te.N.transformMat4(a,a,e);return new U_(r,n,o,a,t/i)}},Te.bE=function(e){var{x:t,y:i}=e.point,{lng:r,lat:n}=e._center;return vh(t,i,e.worldSize,r,n)},Te.bF=Y,Te.bG=Ya,Te.bH=function(e){e=Math.round((e+45+360)%360/90)%4;return K[e]},Te.bI=45,Te.bJ=gs,Te.bK=ka,Te.bL=Ma,Te.bM=Ia,Te.bN=Ca,Te.bO=Ea,Te.bP=Pa,Te.bQ=function(e,t,i){var r=Math.sqrt(e*e+t*t+i*i),i=0<r?Math.acos(i/r)*X:0;let n=0!==e||0!==t?Math.atan2(-t,-e)*X+90:0;return n<0&&(n+=360),[r,n,i]},Te.bR=Es,Te.bS=M,Te.bT=ve,Te.bU=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},Te.bV=function(e){return e({pluginStatus:Gn,pluginURL:qn}),Xn.on("pluginStateChange",e),e},Te.bW=Zm,Te.bX=Qm,Te.bY=Qp,Te.bZ=Jp,Te.b_=it,Te.ba=Gp,Te.bb=Bs,Te.bc=Xd,Te.bd=cf,Te.be=hf,Te.bf=Rp,Te.bg=class j_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var t,[i,r]=new Uint8Array(e,0,2);if(219!==i)throw new Error("Data does not appear to be in a KDBush format.");if(1!=(i=r>>4))throw new Error(`Got v${i} data when expected v1.`);if(i=m_[15&r])return[r]=new Uint16Array(e,2,1),[t]=new Uint32Array(e,4,1),new j_(t,r,i,e);throw new Error("Unrecognized array type.")}constructor(e,t=64,i=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;var n=m_.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-a%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+a+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){var i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){var e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,i,r,n,o,a){if(!(o-n<=r)){const s=n+o>>1;g_(t,i,s,n,o,a),e(t,i,r,n,s-1,1-a),e(t,i,r,1+s,o,1-a)}}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:a,nodeSize:e}=this,s=[0,o.length-1,0],l=[];for(;s.length;){var c=s.pop()||0,h=s.pop()||0,u=s.pop()||0;if(h-u<=e)for(let e=u;e<=h;e++){const s=a[2*e],m=a[2*e+1];s>=t&&s<=r&&i<=m&&m<=n&&l.push(o[e])}else{var d=u+h>>1,p=a[2*d],f=a[2*d+1];t<=p&&p<=r&&i<=f&&f<=n&&l.push(o[d]),(0===c?t<=p:i<=f)&&(s.push(u),s.push(d-1),s.push(1-c)),(0===c?p<=r:f<=n)&&(s.push(1+d),s.push(h),s.push(1-c))}}return l}within(t,i,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:r,coords:n,nodeSize:o}=this,a=[0,r.length-1,0],s=[],l=e*e;a.length;){var c=a.pop()||0,h=a.pop()||0,u=a.pop()||0;if(h-u<=o)for(let e=u;e<=h;e++)v_(n[2*e],n[2*e+1],t,i)<=l&&s.push(r[e]);else{var d=u+h>>1,p=n[2*d],f=n[2*d+1];v_(p,f,t,i)<=l&&s.push(r[d]),(0===c?t-e<=p:i-e<=f)&&(a.push(u),a.push(d-1),a.push(1-c)),(0===c?p<=t+e:f<=i+e)&&(a.push(1+d),a.push(h),a.push(1-c))}}return s}},Te.bh=ie,Te.bj=_,Te.bk=Le,Te.bl=vs,Te.bm=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},Te.bn=E,Te.bo=jf,Te.bp=us,Te.bq=class V_{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=M.fromPoints(this.points),this.projections=[],this.frustumEdges=[Te.N.sub([],this.points[2],this.points[3]),Te.N.sub([],this.points[0],this.points[3]),Te.N.sub([],this.points[4],this.points[0]),Te.N.sub([],this.points[5],this.points[1]),Te.N.sub([],this.points[6],this.points[2]),Te.N.sub([],this.points[7],this.points[3])];for(const Te of this.frustumEdges){const e=[0,-Te[2],Te[1]],t=[Te[2],0,-Te[0]];this.projections.push({axis:e,projection:Zc(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Zc(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(i,r,e,n){const o=Math.pow(2,e),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(e=>{var t=1/(e=Te.a7.transformMat4([],e,i))[3]/r*o;return Te.a7.mul(e,e,[t,t,n?1/e[3]:t,t])}),t=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{var t=Te.N.sub([],a[e[0]],a[e[1]]),i=Te.N.sub([],a[e[2]],a[e[1]]),t=Te.N.normalize([],Te.N.cross([],t,i)),i=-Te.N.dot(t,a[e[1]]);return t.concat(i)}),s=[];for(let e=0;e<a.length;e++)s.push([a[e][0],a[e][1],a[e][2]]);return new V_(s,t)}intersectsPrecise(t,i,e){for(let e=0;e<i.length;e++)if(!Yc(t,i[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!Yc(t,this.planes[e]))return 0;for(const i of e)for(const e of this.frustumEdges){var r=Te.N.cross([],i,e),n=Te.N.length(r);if(0!==n&&(Te.N.scale(r,r,1/n),n=Zc(this.points,this.points[0],r),r=Zc(t,this.points[0],r),n[0]>r[1]||r[0]>n[1]))return 0}return 1}},Te.br=ym,Te.bs=hs,Te.bt=ch,Te.bu=function(e,t,i,r,n,o,a,s,l){return"globe"===l.name?ch(e,t,new hs(i,r,n),!1):(e=vf({z:i,x:r,y:n},l),new M([(o+e.x/e.scale)*t,t*(e.y/e.scale),a],[(o+e.x2/e.scale)*t,t*(e.y2/e.scale),s]))},Te.bv=function(t,i,r){let n=0;for(let e=0;e<2;++e){var o=r?r[e]:0;t[e]>o&&(n+=(t[e]-o)*(t[e]-o)),i[e]<o&&(n+=(o-i[e])*(o-i[e]))}return n},Te.bw=y,Te.bx=Ka,Te.by=function(e){var t=Te.a6.identity(new Float64Array(16)),i=(Te.a6.multiply(t,e.pixelMatrix,e.globeMatrix),[0,es,0]),r=[0,ts,0];return Te.N.transformMat4(i,i,t),Te.N.transformMat4(r,r,t),[0<i[0]&&i[0]<=e.width&&0<i[1]&&i[1]<=e.height&&!wh(e,new E(e.center.lat,90)),0<r[0]&&r[0]<=e.width&&0<r[1]&&r[1]<=e.height&&!wh(e,new E(e.center.lat,-90))]},Te.bz=function(e,t){var i=e.tileTransform["scale"],i=i*ue/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return Te.b4.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[i,i])},Te.c=wg,Te.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},Te.c0=R,Te.c1=me,Te.c2=function(e,t,i){return"custom"===e.type?new pm(e,t):new Og[e.type](e,t,i)},Te.c3=function(e){var t=e.indexOf("");return 0<=t?e.slice(0,t):e},Te.c4=function(e){return 0<=e.indexOf("")},Te.c5=function(e){var t=e.indexOf("");return 0<=t?e.slice(t+1):""},Te.c6=function(e){var t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},Te.c7=fe,Te.c8=Xn,Te.c9=et,Te.cA=Od,Te.cB=(e,t,i,r,n,o)=>{var a=e.transform;return{u_matrix:Rd(e,t,i,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:zd(t,a),u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:o}},Te.cC=(e,t,i,r,n,o,a)=>{var s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Rd(e,t,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Bd(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zd(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:a,u_emissive_strength:i.paint.get("line-emissive-strength")}},Te.cD=le,Te.cE=Nh,Te.cF=_d,Te.cG=Hi,Te.cH=hd,Te.cI=ed,Te.cJ=450,Te.cK=7,Te.cL=T,Te.cM=256,Te.cN=gh,Te.cO=Zo,Te.cP=$o,Te.cQ=function(e,t,i,r,n){return S((e-t)/(i-t)*(n-r)+r,r,n)},Te.cR=Ss,Te.cS=Am,Te.cT=[1,1,1],Te.cU=Zu,Te.cV=Fm,Te.cW=Fo,Te.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){0<this._activeRegions.length&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){var t,i,r,n,o=ku(new U(0,0),new U(ue,ue),e),a=[];for(const s of this._activeRegions)s.hiddenByOverlap||Du(o,s)&&(t=s.min,i=s.max,n=r=void 0,r=1<<e.canonical.z,n=((i.x-e.wrap)*r-e.canonical.x)*ue,i=(i.y*r-e.canonical.y)*ue,t={min:new U(((t.x-e.wrap)*r-e.canonical.x)*ue,(t.y*r-e.canonical.y)*ue),max:new U(n,i)},a.push({min:t.min,max:t.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId}));return a}setSources(e){this._setSources(e.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{var e=[];for(const r of n.cache.getVisibleCoordinates()){var t=n.cache.getTile(r).buckets[n.layer];if(t)for(const n of t.getNodesInfo()){var i=n.node;i.footprint&&e.push({footprint:i.footprint,id:r.toUnwrapped()})}}return e}})))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t)if(e.footprint){const t=ku(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||Pu(e.min,t.min)||Pu(e.max,t.max));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0,t=0;for(;!r&&e!==this._activeRegions.length;){var i=this._activeRegions[e],n=this._prevRegions[t];r=i.priority!==n.priority||!Lu(i,n),++e,++t}}if(r){++this._updateTime;const r=e=>{var t=this._activeRegions;if(!(e>=t.length))for(var i=t[e].priority;e<t.length&&t[e].priority===i;)++e;return e};if(1<this._sourceIds.length){let t=0,i=r(t);for(;t!==i;){let e=t;for(var o=t;e!==i;){const r=this._activeRegions[e];r.hiddenByOverlap=!1;for(let e=0;e<o;e++){var a=this._activeRegions[e];if(!a.hiddenByOverlap&&Du(r,a)&&(r.hiddenByOverlap=function e(t,i,r,n){if(!t||!r)return!1;let o=t.vertices;if(!i.canonical.equals(n.canonical)||i.wrap!==n.wrap){if(r.vertices.length<t.vertices.length)return e(r,n,t,i);const a=i.canonical,s=n.canonical,l=Math.pow(2,s.z-a.z);o=t.vertices.map(e=>new U(e.x*a.x*ue*l-s.x*ue,e.y*a.y*ue*l-s.y*ue))}return zu(r,o,t.indices,0,t.indices.length,0,0)}(r.footprint,r.tileId,a.footprint,a.tileId),r.hiddenByOverlap))break}++e}i=r(t=i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;0<=e;e--)this._addSource(t[e]);this._computeReplacement()}},Te.cY=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(e,i){const r=new Eo,n=new Go,o=[],a=e+1+2,s=i[0]+1,l=i[0]+1+(1+i.length),c=(e,t,i)=>{e=e===a-1?e-2:0===e?e:e-1;return[e+=i?24575:0,t]};for(let e=0;e<a;++e)r.emplaceBack(...c(e,0,!0));for(let t=0;t<s;++t)for(let e=0;e<a;++e)r.emplaceBack(...c(e,t,(0===e||e===a-1)&&!0));for(let e=0;e<i.length;++e){const n=i[e];for(let e=0;e<a;++e)r.emplaceBack(...c(e,n,!0))}for(let e=0;e<i.length;++e){const s=n.length,c=i[e]+1+2,u=new Go;for(let t=0;t<c-1;t++){const o=t===c-2,s=o?a*(l-i.length+e-t):a;for(let e=0;e<a-1;e++){const i=t*a+e;(0===t||o||0===e||e===a-2?(u.emplaceBack(i+1,i,i+s),u):(n.emplaceBack(i+1,i,i+s),n)).emplaceBack(i+s,i+s+1,i+1)}}var t=ma.simpleSegment(0,s,r.length,n.length-s);for(let e=0;e<u.uint16.length;e+=3)n.emplaceBack(u.uint16[e],u.uint16[e+1],u.uint16[e+2]);var h=ma.simpleSegment(0,s,r.length,n.length-s);o.push({withoutSkirts:t,withSkirts:h})}return{vertices:r,indices:n,segments:o}}_createGrid(e){var t=this._fillGridMeshWithLods(64,Qa);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,eh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){var t=new Go;for(let e=0;e<=64;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);var i=new Zo,r=new Zo,n=new Zo,o=new Zo;this._poleSegments=[];for(let e=0,t=0;e<Ya;e++){var a=360/(1<<e);i.emplaceBack(0,-Xa,0,.5,0),r.emplaceBack(0,-Xa,0,.5,1),n.emplaceBack(0,-Xa,0,.5,.5),o.emplaceBack(0,-Xa,0,.5,.5);for(let e=0;e<=64;e++){var s=A(0,a,u=e/64),[l,c,h]=is(Sh,Ah,s,Xa),s=(i.emplaceBack(l,c,h,u,0),r.emplaceBack(l,c,h,u,1),_(s)),u=.5+.5*Math.sin(s),s=.5+.5*Math.cos(s);n.emplaceBack(l,c,h,u,s),o.emplaceBack(l,c,h,u,1-s)}this._poleSegments.push(ma.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Jc,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,Jc,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(n,Jc,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,Jc,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},Te.cZ=function(e){return wt.has(e)},Te.c_=Q,Te.ca=La,Te.cb=class extends Aa{constructor(e){super(e),this.current=za}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},Te.cc=J,Te.cd=function(e,t,i){var i=xh(i.zoom),r=e.style.map._antialias,t=t.options.extStandardDerivativesForceOff||e.terrain&&0<e.terrain.exaggeration();return 0===i&&!r&&!t},Te.ce=function(e){var t=e.pixelsPerMeter,i=t/vs(1,e.center.lat),r=Te.a6.identity(new Float64Array(16));return Te.a6.translate(r,r,[e.point.x,e.point.y,0]),Te.a6.scale(r,r,[i,i,t]),Float32Array.from(r)},Te.cf=hh,Te.cg=function(e){var t=y-5,t=(e=S(e,-t,t)/t*90,Math.pow(Math.abs(Math.sin(_(e))),3));return Math.round(t*(Qa.length-1))},Te.ch=function(e,t,i,r){var n=t.getNorth(),o=t.getSouth(),a=t.getWest(),t=t.getEast(),s=1<<e.z,t=t-a,o=n-o,l=t/64,i=-o/Qa[i],n=[0,l,0,i,0,0,n,a,0];if(0<e.z){const e=180/r;Te.co.multiply(n,n,[e/t+1,0,0,0,e/o+1,0,-.5*e/l,.5*e/i,1])}return n[2]=s,n[5]=e.x,n[8]=e.y,n},Te.ci=ah,Te.cj=function(e,t,i){var r=Te.a6.identity(new Float64Array(16)),t=(t/(1<<e)-.5)*Math.PI*2;return Te.a6.rotateY(r,i.globeMatrix,t),Float32Array.from(r)},Te.ck=class{isDataAvailableAtPoint(e){var t,i,r,n=this._source();return!(this.isUsingMockSource()||!n||e.y<0||1<e.y||(r=1<<(n=n.getSource().maxzoom),t=Math.floor(e.x),i=Math.floor((e.x-t)*r),e=Math.floor(e.y*r),!(r=this.findDEMTileFor(new ds(n,t,n,i,e))))||!r.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);var r,n,o,a=this._source();return a&&!(e.y<0||1<e.y)&&(r=1<<(a=a.getSource().maxzoom),o=Math.floor(e.x),n=e.x-o,o=new ds(a,o,a,Math.floor(n*r),Math.floor(e.y*r)),a=this.findDEMTileFor(o))&&a.dem?(r=a.dem,n=(n*(o=1<<a.tileID.canonical.z)-a.tileID.canonical.x)*r.dim,e=(e.y*o-a.tileID.canonical.y)*r.dim,o=Math.floor(n),a=Math.floor(e),(i?this.exaggeration():1)*A(A(r.get(o,a),r.get(o,a+1),e-a),A(r.get(o+1,a),r.get(o+1,a+1),e-a),n-o)):t}getAtTileOffset(e,t,i){var r=1<<e.canonical.z;return this.getAtPointOrZero(new Cs(e.wrap+(e.canonical.x+t/ue)/r,(e.canonical.y+i/ue)/r))}getAtTileOffsetFunc(r,n,o,a){return e=>{var t=this.getAtTileOffset(r,e.x,e.y),e=a.upVector(r.canonical,e.x,e.y),i=a.upVectorScale(r.canonical,n,o).metersToTile;return Te.N.scale(e,e,t*i),e}}getForTilePoints(e,t,i,r){if(this.isUsingMockSource())return!1;const n=Zu.create(this,e,r);return!!n&&(t.forEach(e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;var e=this.findDEMTileFor(t);if(!e||!e.dem)return null;var i=e.dem.tree,r=e.tileID,e=1<<t.canonical.z-r.canonical.z;let n=t.canonical.x/e-r.canonical.x,o=t.canonical.y/e-r.canonical.y,a=0;for(let e=0;e<t.canonical.z-r.canonical.z&&!i.leaves[a];e++){n*=2,o*=2;const t=2*Math.floor(o)+Math.floor(n);a=i.childOffsets[a]+t,n%=1,o%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const n of e){const e=this.getMinMaxForTile(n.tileID);e&&(i=Math.min(i,e.min),r=Math.max(r,e.max),t=!0)}return t?{min:i,max:r}:null}},Te.cl=th,Te.cm=Bh,Te.cn=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},Te.cp=yh,Te.cq=256,Te.cr=function(e,t){var i=[0,0,0],t=mh(ah(t.canonical));return Te.N.transformMat4(i,i,t),Te.N.transformMat4(i,i,e),i},Te.cs=e=>({u_camera_to_center_distance:new Ca(e),u_extrude_scale:new Oa(e),u_device_pixel_ratio:new Ca(e),u_matrix:new ka(e),u_inv_rot_matrix:new ka(e),u_merc_center:new Ma(e),u_tile_id:new Ia(e),u_zoom_transition:new Ca(e),u_up_dir:new Ia(e),u_emissive_strength:new Ca(e)}),Te.ct=e=>({u_matrix:new ka(e),u_pixels_to_tile_units:new Oa(e),u_device_pixel_ratio:new Ca(e),u_units_to_pixels:new Ma(e),u_dash_image:new Ea(e),u_gradient_image:new Ea(e),u_image_height:new Ca(e),u_texsize:new Ma(e),u_tile_units_to_pixels:new Ca(e),u_alpha_discard_threshold:new Ca(e),u_trim_offset:new Ma(e),u_emissive_strength:new Ca(e)}),Te.cu=e=>({u_matrix:new ka(e),u_texsize:new Ma(e),u_pixels_to_tile_units:new Oa(e),u_device_pixel_ratio:new Ca(e),u_image:new Ea(e),u_units_to_pixels:new Ma(e),u_tile_units_to_pixels:new Ca(e),u_alpha_discard_threshold:new Ca(e),u_trim_offset:new Ma(e)}),Te.cv=jo,Te.cw=$d,Te.cx=t,Te.cy=Ch,Te.cz=(e,t,i,r,n,o)=>{var a=e.transform,s="globe"===a.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(s){const e=yh(a.zoom,t.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);o={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(a.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Re.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Eh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(s){o.u_inv_rot_matrix=r,o.u_merc_center=n,o.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],o.u_zoom_transition=xh(a.zoom);const e=n[0]*ue,i=n[1]*ue;o.u_up_dir=a.projection.upVector(new hs(0,0,0),e,i)}return o},Te.d=at,Te.d0=ee,Te.d1=As,Te.d2=rs,Te.d3=function([e,t,i]){var r=Math.hypot(e,t,i),e=Math.atan2(e,i),i=.5*Math.PI-Math.acos(-t/r);return new E(Y(e),Y(i))},Te.d4=ns,Te.d5=o,Te.d6=wh,Te.d7=bh,Te.d8=function(e){var t=[0,0,0],i=Te.a6.identity(new Float64Array(16));return Te.a6.multiply(i,e.pixelMatrix,e.globeMatrix),Te.N.transformMat4(t,t,i),new U(t[0],t[1])},Te.d9=function(e){var t,i=e.navigator?e.navigator.userAgent:null;return e=e,null==Ie&&(t=e.navigator?e.navigator.userAgent:null,Ie=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))),!!Ie&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},Te.dA=Kp,Te.dB=Tg,Te.dC=Eg,Te.dD=Md,Te.dE=pe,Te.dF=Zp,Te.dG=function(r,n,o,a,s,l,c,h,u,d,p){r.createArrays(),r.tilePixelRatio=ue/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const f=r.layers[0].layout,m=r.layers[0]._unevaluatedLayout._values,g={};if("composite"===r.textSizeData.kind){const{minZoom:n,maxZoom:o}=r.textSizeData;g.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Kn(n),h),m["text-size"].possiblyEvaluate(new Kn(o),h)]}if("composite"===r.iconSizeData.kind){const{minZoom:n,maxZoom:o}=r.iconSizeData;g.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Kn(n),h),m["icon-size"].possiblyEvaluate(new Kn(o),h)]}g.layoutTextSize=m["text-size"].possiblyEvaluate(new Kn(u+1),h),g.layoutIconSize=m["icon-size"].possiblyEvaluate(new Kn(u+1),h),g.textMaxSize=m["text-size"].possiblyEvaluate(new Kn(18),h);const _="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),y=f.get("text-size");let v=!1;for(const n of r.features)if(n.icon&&n.icon.nameSecondary){v=!0;break}for(const l of r.features){const u=f.get("text-font").evaluate(l,{},h).join(","),m=y.evaluate(l,{},h),b=g.layoutTextSize.evaluate(l,{},h),w=(g.layoutIconSize.evaluate(l,{},h),{horizontal:{},vertical:void 0}),T=l.text;let e,i=[0,0];if(T){const a=T.toString(),c=f.get("text-letter-spacing").evaluate(l,{},h)*Xd,d=f.get("text-line-height").evaluate(l,{},h)*Xd,p=Rn(a)?c:0,g=f.get("text-anchor").evaluate(l,{},h),y=f.get("text-variable-anchor");if(!y){const r=f.get("text-radial-offset").evaluate(l,{},h);i=r?cf(g,[r*Xd,sf]):f.get("text-offset").evaluate(l,{},h).map(e=>e*Xd)}let e=_?"center":f.get("text-justify").evaluate(l,{},h);const S="point"===f.get("symbol-placement"),A=S?f.get("text-max-width").evaluate(l,{},h)*Xd:1/0,E=e=>{r.allowVerticalPlacement&&zn(a)&&(w.vertical=Ip(T,n,o,s,u,A,d,g,e,p,i,Ep.vertical,!0,b,m))};if(!_&&y){const r="auto"===e?y.map(e=>hf(e)):[e];let t=!1;for(let e=0;e<r.length;e++){const c=r[e];if(!w.horizontal[c])if(t)w.horizontal[c]=w.horizontal[0];else{const r=Ip(T,n,o,s,u,A,d,"center",c,p,i,Ep.horizontal,!1,b,m);r&&(w.horizontal[c]=r,t=1===r.positionedLines.length)}}E("left")}else{if("auto"===e&&(e=hf(g)),S||0<=f.get("text-writing-mode").indexOf("horizontal")||!zn(a)){const r=Ip(T,n,o,s,u,A,d,g,e,p,i,Ep.horizontal,!1,b,m);r&&(w.horizontal[e]=r)}E(S?"left":e)}}let t=!1;if(l.icon&&l.icon.namePrimary){const n=a[l.icon.namePrimary];n&&(e=function(e,t,i,r){var{horizontalAlign:r,verticalAlign:n}=Rp(r),r=i[0]-e.displaySize[0]*r,i=i[1]-e.displaySize[1]*n;return{imagePrimary:e,imageSecondary:t,top:i,bottom:i+e.displaySize[1],left:r,right:r+e.displaySize[0]}}(s[l.icon.namePrimary],l.icon.nameSecondary?s[l.icon.nameSecondary]:void 0,f.get("icon-offset").evaluate(l,{},h),f.get("icon-anchor").evaluate(l,{},h)),t=n.sdf,void 0===r.sdfIcons?r.sdfIcons=n.sdf:r.sdfIcons!==n.sdf&&_e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),n.pixelRatio!==r.pixelRatio||0!==f.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0)}var x=mf(w.horizontal)||w.vertical;r.iconsInText||(r.iconsInText=!!x&&x.iconsInText),(x||e)&&uf(r,l,w,e,a,g,b,0,i,t,c,h,d,p,v)}l&&r.generateCollisionDebugBuffers(u,r.collisionBoxArray)},Te.dH=Mu,Te.dI=xp,Te.dJ=Hu,Te.dK=G,Te.dL=g,Te.dM=w,Te.dN=q,Te.dO=v,Te.dP=function(e){let t=0;var i,r,n,o,a;return 1179937895!==new Uint32Array(e,0,1)[0]&&([,,r,n,o,a]=i=new Uint32Array(e,0,7),t=i.byteLength+n+o+a+o,r!==e.byteLength||t>=e.byteLength)&&_e("Invalid b3dm header information."),_g(e,t)},Te.dQ=function(e,t){var i=wg(e);for(const e of i){for(const t of e.meshes){r=void 0;n=void 0;o=void 0;a=void 0;s=void 0;l=void 0;c=void 0;h=void 0;u=void 0;var r=t;r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);var n=r.vertexArray.float32,o=r.aabb.min[0]-1,a=r.aabb.min[1]-1,s=64/(r.aabb.max[0]-o+2),l=64/(r.aabb.max[1]-a+2);for(let e=0;e<n.length;e+=3){var c=n[e+2],h=(n[e+0]-o)*s|0,u=(n[e+1]-a)*l|0;c>r.heightmap[64*u+h]&&(r.heightmap[64*u+h]=c)}}e.lights&&(e.lightMeshIndex=e.meshes.length,e.meshes.push(function(e,t){var i={};i.indexArray=new Go,i.indexArray.reserve(4*e.length),i.vertexArray=new Ko,i.vertexArray.reserve(10*e.length),i.colorArray=new Lo,i.vertexArray.reserve(10*e.length);let r=0;for(const o of e){const e=Math.min(10,Math.max(4,1.3*o.height))*t,a=[-o.normal[1],o.normal[0],0],s=Math.min(.29,.1*o.width/o.depth),l=o.width-2*o.depth*t*(s+.01),c=Te.N.scaleAndAdd([],o.pos,a,l/2),h=Te.N.scaleAndAdd([],o.pos,a,-l/2),u=[c[0],c[1],c[2]+o.height],d=[h[0],h[1],h[2]+o.height],p=Te.N.scaleAndAdd([],o.normal,a,s);Te.N.scale(p,p,e);var n=Te.N.scaleAndAdd([],o.normal,a,-s),n=(Te.N.scale(n,n,e),Te.N.add(p,c,p),Te.N.add(n,h,n),c[2]+=.1,h[2]+=.1,i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(n[0],n[1],n[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(n[0],n[1],n[2]),l/e/2);i.colorArray.emplaceBack(-n-s,-1,n,.8),i.colorArray.emplaceBack(n+s,-1,n,.8),i.colorArray.emplaceBack(-n,0,n,1.3),i.colorArray.emplaceBack(n,0,n,1.3),i.colorArray.emplaceBack(n+s,-.8,n,.7),i.colorArray.emplaceBack(n+s,-.8,n,.7),i.colorArray.emplaceBack(0,0,n,1.3),i.colorArray.emplaceBack(0,0,n,1.3),i.colorArray.emplaceBack(n+s,-1.2,n,.8),i.colorArray.emplaceBack(n+s,-1.2,n,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const o={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=zt.white,o.pbrMetallicRoughness=a,i.material=o,i.aabb=new M([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}(e.lights,t)))}return i},Te.dR=kg,Te.dS=Hm,Te.dT=Yn,Te.dU=function(r){Ve(),Ne&&Ne.then(i=>{i.keys().then(t=>{for(let e=0;e<t.length-r;e++)i.delete(t[e])})})},Te.da=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){var e=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1","01",t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){var i;return R(e)?((i=ct(e)).params.push("sdk=js-3.3.0"),i.path="/styles/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||t)):e}normalizeGlyphsURL(e,t){var i;return R(e)?((i=ct(e)).path="/fonts/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||t)):e}normalizeModelURL(e,t){var i;return R(e)?((i=ct(e)).path="/models/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||t)):e}normalizeSourceURL(e,t,i,r){var n;return R(e)?((n=ct(e)).path=`/v4/${n.authority}.json`,n.params.push("secure"),i&&n.params.push("language="+i),r&&n.params.push("worldview="+r),this._makeAPIURL(n,this._customAccessToken||t)):e}normalizeSpriteURL(e,t,i,r){var n=ct(e);return R(e)?(n.path=`/styles/v1${n.path}/sprite`+t+i,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=""+t+i,ht(n))}normalizeTileURL(e,t,i){return this._isSkuTokenExpired()&&this._createSkuToken(),e&&!R(e)?e:((e=ct(e)).path=e.path.replace(/(\.(png|jpg)\d*)(?=$)/,(t||i&&"raster"!==e.authority&&512===i?"@2x":"")+(He.supported?".webp":"$1")),"raster"===e.authority?e.path="/"+o.RASTER_URL_PREFIX+e.path:"rasterarrays"===e.authority?e.path="/"+o.RASTERARRAYS_URL_PREFIX+e.path:(e.path=e.path.replace(/^.+\/v4\//,"/"),e.path="/"+o.TILE_URL_VERSION+e.path),t=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(e.params)||o.ACCESS_TOKEN,o.REQUIRE_ACCESS_TOKEN&&t&&this._skuToken&&e.params.push("sku="+this._skuToken),this._makeAPIURL(e,t))}canonicalizeTileURL(e,t){var i=ct(e);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let r="mapbox://",n=(i.path.match(/^\/raster\/v1\//)?r+="raster/"+i.path.replace(`/${o.RASTER_URL_PREFIX}/`,""):i.path.match(/^\/rasterarrays\/v1\//)?r+="rasterarrays/"+i.path.replace(`/${o.RASTERARRAYS_URL_PREFIX}/`,""):r+="tiles/"+i.path.replace(`/${o.TILE_URL_VERSION}/`,""),i.params);return(n=t?n.filter(e=>!e.match(/^access_token=/)):n).length&&(r+="?"+n.join("&")),r}canonicalizeTileset(e,t){var i=!!t&&R(t),r=[];for(const t of e.tiles||[])z(t)?r.push(this.canonicalizeTileURL(t,i)):r.push(t);return r}_makeAPIURL(e,t){var i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=ct(o.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");0<=t&&e.params.splice(t,1)}if("/"!==r.path&&(e.path=""+r.path+e.path),o.REQUIRE_ACCESS_TOKEN){if(t=t||o.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. "+i);if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+i)}e.params=e.params.filter(e=>-1===e.indexOf("access_token")),e.params.push("access_token="+(t||""))}return ht(e)}},Te.db=function(e,t){t?wt.add(e):wt.delete(e)},Te.dc=He,Te.dd=vt,Te.de=bt,Te.df=st,Te.dg=_t,Te.dh=function(e){wt.delete(e)},Te.di=xt,Te.dj=gt,Te.dk=L,Te.dl=function(e,t){Be=e,Fe=t},Te.dm=function(e,t,i=!1){if(Gn===Nn||Gn===Un||Gn===jn)throw new Error("setRTLTextPlugin cannot be called multiple times.");qn=Re.resolveURL(e),Gn=Nn,Vn=t,Hn(),i||$n()},Te.dn=Zn,Te.dp=function(){Qm().acquire(Ym)},Te.dq=function(){var e=Jm;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Ym),Jm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Te.dr=Km,Te.ds=function(e){var t=je();t&&(t=t.delete(Oe),e)&&t.catch(e).then(()=>e())},Te.dt=$m,Te.du=ag,Te.dv=function(e){tg=Re.resolveURL(e),(og=og||new Zm(Qm(),new Ct)).broadcast("setDracoUrl",tg)},Te.dw=sg,Te.dx=function(e){rg=Re.resolveURL(e),(og=og||new Zm(Qm(),new Ct)).broadcast("setMeshoptUrl",rg)},Te.dy=n,Te.dz=Rh,Te.e=ne,Te.f=Re,Te.g=function(e,t){return et(ne(e,{type:"json"}),t)},Te.h=Oh,Te.i=pi,Te.j=Bt,Te.k=ln,Te.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>_g(e,0,t))},Te.m=hn,Te.n=xn,Te.o=lo,Te.p=qp,Te.q=Sn,Te.r=bn,Te.s=un,Te.t=wr,Te.u=so,Te.v=Sr,Te.w=_e,Te.x=br,Te.z=co}),e(0,function(y){function d(e){e=e?e.url.toString():void 0;return e?performance.getEntriesByName(e):[]}function a(e){let t="";for(const i of y.b2)t+="/"+function t(i){if("number"==typeof i||"boolean"==typeof i||"string"==typeof i||null==i)return JSON.stringify(i);if(Array.isArray(i)){let e="[";for(const r of i)e+=t(r)+",";return e+"]"}let e="{";for(const n of Object.keys(i).sort())e+=`${n}:${t(i[n])},`;return e+"}"}(e[i]);return t}class O{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(i,r,e){this._options=e;for(const r of i)this._layerConfigs[r.id]=r,(this._layers[r.id]=y.c2(r,this.scope,this._options)).compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const y of r)delete this.keyCache[y],delete this._layerConfigs[y],delete this._layers[y];this.familiesBySource={};const n=function(i,r){var n={};for(let t=0;t<i.length;t++){var o=r&&r[i[t].id]||a(i[t]);r&&(r[i[t].id]=o);let e=n[o];(e=e||(n[o]=[])).push(i[t])}var e=[];for(const i in n)e.push(n[i]);return e}(y.a$(this._layerConfigs),this.keyCache);for(const y of n){const i=y.map(e=>this._layers[e.id]),r=i[0];if("none"!==r.visibility){const a=r.source||"";let e=this.familiesBySource[a];e=e||(this.familiesBySource[a]={});const n=r.sourceLayer||"_geojsonTileLayer";let t=e[n];(t=t||(e[n]=[])).push(i)}}}}const l=+y.dA;class v{constructor(e){const t={},i=[];for(const y in e){const r=e[y],n=t[y]={};for(const y in r.glyphs){const e=r.glyphs[+y];if(e&&0!==e.bitmap.width&&0!==e.bitmap.height){const t=e.metrics.localGlyph?l:1,o={x:0,y:0,w:e.bitmap.width+2*t,h:e.bitmap.height+2*t};i.push(o),n[y]=o}}}const{w:r,h:n}=y.p(i),o=new y.dz({width:r||1,height:n||1});for(const i in e){const r=e[i];for(const e in r.glyphs){const n=r.glyphs[+e];var a,s;n&&0!==n.bitmap.width&&0!==n.bitmap.height&&(a=t[i][e],s=n.metrics.localGlyph?l:1,y.dz.copy(n.bitmap,o,{x:0,y:0},{x:a.x+s,y:a.y+s},n.bitmap))}}this.image=o,this.positions=t}}y.dy(v,"GlyphAtlas");class B{constructor(e){this.tileID=new y.am(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=y.as(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(r,n,o,a,s){this.status="parsing",this.data=r,this.collisionBoxArray=new y.aD;const l=new y.dB(Object.keys(r.layers).sort()),c=new y.dC(this.tileID,this.promoteId),h=(c.bucketLayerIDs=[],{}),u=new y.dD(256,256),d={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:u,availableImages:o,brightness:this.brightness},p=n.familiesBySource[this.source];for(const n in p){const a=r.layers[n];if(a){let e=!1,t=!1,i=!1;for(const y of p[n])"symbol"===y[0].type?e=!0:t=!0,y[0].is3D()&&"model"!==y[0].type&&(i=!0);if((!this.extraShadowCaster||i)&&(!0!==this.isSymbolTile||e)&&(!1!==this.isSymbolTile||t)){1===a.version&&y.w(`Vector tile source "${this.source}" layer "${n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=l.encode(n),m=[];for(let e=0;e<a.length;e++){const r=a.feature(e),o=c.getId(r,n);m.push({feature:r,id:o,index:e,sourceLayerIndex:f})}for(const y of p[n]){const r=y[0];this.extraShadowCaster&&(!r.is3D()||"model"===r.type)||void 0!==this.isSymbolTile&&"symbol"===r.type!==this.isSymbolTile||r.minzoom&&this.zoom<Math.floor(r.minzoom)||r.maxzoom&&this.zoom>=r.maxzoom||"none"!==r.visibility&&(x(y,this.zoom,d.brightness,o),(h[r.id]=r.createBucket({index:c.bucketLayerIDs.length,layers:y,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec})).populate(m,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(y.map(e=>e.id)))}}}}let f,m,g,_;u.trim();const e={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},i=()=>{if(f)return this.status="done",s(f);if(this.extraShadowCaster)this.status="done",s(null,{buckets:y.a$(h).filter(e=>!e.isEmpty()),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&g&&_){var e=new v(m),t=new y.dF(g,_);for(const i in h){const s=h[i];s instanceof y.aE?(x(s.layers,this.zoom,d.brightness,o),y.dG(s,m,e.positions,g,t.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):s.hasPattern&&(s instanceof y.aK||s instanceof y.aL||s instanceof y.cH)&&(x(s.layers,this.zoom,d.brightness,o),s.addFeatures(d,this.tileID.canonical,t.patternPositions,o,this.tileTransform,this.brightness))}this.status="done",s(null,{buckets:y.a$(h).filter(e=>!e.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:u,imageAtlas:t,brightness:d.brightness})}};if(!this.extraShadowCaster){const r=y.dE(d.glyphDependencies,e=>Object.keys(e).map(Number)),n=(Object.keys(r).length?a.send("getGlyphs",{uid:this.uid,stacks:r,scope:this.scope},(e,t)=>{f||(f=e,m=t,i())},void 0,!1,e):m={},Object.keys(d.iconDependencies)),o=(n.length?a.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{f||(f=e,g=t,i())},void 0,!1,e):g={},Object.keys(d.patternDependencies));o.length?a.send("getImages",{icons:o,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{f||(f=e,_=t,i())},void 0,!1,e):_={}}i()}}function x(e,t,i,r){var n=new y.K(t,{brightness:i});for(const y of e)y.recalculate(n,r)}class o extends y.E{constructor(e,t,i,r,n,o){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=n||y.ah,this.loading={},this.loaded={},this.deduped=new y.af(e.scheduler),this.isSpriteLoaded=r,this.scheduler=e.scheduler,this.brightness=o}loadTile(a,s){const l=a.uid,c=a&&a.request,h=c&&c.collectResourceTiming,u=this.loading[l]=new B(a);u.abort=this.loadVectorData(a,(e,t)=>{var i=!this.loading[l];if(delete this.loading[l],i||e||!t)return u.status="done",i||(this.loaded[l]=u),s(e);const r=t.rawData,n={},o=(t.expires&&(n.expires=t.expires),t.cacheControl&&(n.cacheControl=t.cacheControl),u.vectorTile=t.vectorTile||new y.dH(new y.dI(r)),()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(e,t)=>{if(e||!t)return s(e);e={};if(h){const y=d(c);0<y.length&&(e.resourceTiming=JSON.parse(JSON.stringify(y)))}s(null,y.e({rawTileData:r.slice(0)},t,n,e))})});this.isSpriteLoaded?o():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(o,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):o()}),this.loaded=this.loaded||{},this.loaded[l]=u})}reloadTile(e,r){const t=this.loaded,i=e.uid,n=this;if(t&&t[i]){const o=t[i];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=y.as(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster;e=(e,t)=>{var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,this.availableImages,n.actor,i)),r(e,t)};"parsing"===o.status?o.reloadCallback=e:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,e):e())}else r(null,void 0)}abortTile(e,t){var e=e.uid,i=this.loading[e];i&&(i.abort&&i.abort(),delete this.loading[e]),t()}removeTile(e,t){var i=this.loaded,e=e.uid;i&&i[e]&&delete i[e],t()}}class F{loadTile(e,t){var{uid:e,encoding:i,rawImageData:r,padding:n}=e,r=ImageBitmap&&r instanceof ImageBitmap?this.getImageData(r,n):r;t(null,new y.dJ(e,r,i,n<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);e=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),e}}class N{decodeRasterArray({task:e,buffer:t},i){y.aZ.performDecoding(t,e).then(e=>{i(null,e)},e=>{i(e)})}}function s(e,t){if(0!==e.length){r(e[0],t);for(var i=1;i<e.length;i++)r(e[i],!t)}}function r(e,t){for(var i=0,r=0,n=0,o=e.length,a=o-1;n<o;a=n++){var s=(e[n][0]-e[a][0])*(e[a][1]+e[n][1]),l=i+s;r+=Math.abs(i)>=Math.abs(s)?i-l+s:s-l+i,i=l}0<=i+r!=!!t&&e.reverse()}var U=y.dK(function e(t,i){var r,n=t&&t.type;if("FeatureCollection"===n)for(r=0;r<t.features.length;r++)e(t.features[r],i);else if("GeometryCollection"===n)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],i);else if("Feature"===n)e(t.geometry,i);else if("Polygon"===n)s(t.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<t.coordinates.length;r++)s(t.coordinates[r],i);return t});const j=y.dL.prototype.toGeoJSON;let V=class{constructor(e){this._feature=e,this.extent=y.V,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){var e=[];for(const r of this._feature.geometry)e.push([new y.P(r[0],r[1])]);return e}var t=[];for(const n of this._feature.geometry){var i=[];for(const o of n)i.push(new y.P(o[0],o[1]));t.push(i)}return t}toGeoJSON(e,t,i){return j.call(this,e,t,i)}},G=class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.V,this.length=e.length,this._features=e}feature(e){return new V(this._features[e])}};var e={exports:{}},q=y.dN,t=y.dM.VectorTileFeature,W=i;function i(e,t){this.options=t||{},this.features=e,this.length=e.length}function n(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}i.prototype.feature=function(e){return new n(this.features[e],this.options.extent)},n.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var i=e[t],r=[],n=0;n<i.length;n++)r.push(new q(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},n.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++)var l=a[s],t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y);return[t,r,i,n]},n.prototype.toGeoJSON=t.prototype.toGeoJSON;var H=y.dO,c=W;function h(e){var t,i=new H,r=e,n=i;for(t in r.layers)n.writeMessage(3,Z,r.layers[t]);return i.finish()}function Z(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);for(var i={keys:[],values:[],keycache:{},valuecache:{}},r=0;r<e.length;r++)i.feature=e.feature(r),t.writeMessage(2,$,i);var n=i.keys;for(r=0;r<n.length;r++)t.writeStringField(3,n[r]);var o=i.values;for(r=0;r<o.length;r++)t.writeMessage(4,K,o[r])}function $(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,X,e),t.writeVarintField(3,i.type),t.writeMessage(4,Y,i)}function X(e,t){var i,r=e.feature,n=e.keys,o=e.values,a=e.keycache,s=e.valuecache;for(i in r.properties){var l,c=r.properties[i],h=a[i];null!==c&&(void 0===h&&(n.push(i),a[i]=h=n.length-1),t.writeVarint(h),void 0===(l=s[h=(h=typeof c)+":"+(c="string"!=h&&"boolean"!=h&&"number"!=h?JSON.stringify(c):c)])&&(o.push(c),s[h]=l=o.length-1),t.writeVarint(l))}}function f(e,t){return(t<<3)+(7&e)}function m(e){return e<<1^e>>31}function Y(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,o=0,a=i.length,s=0;s<a;s++){var l=i[s],c=1;1===r&&(c=l.length),t.writeVarint(f(1,c));for(var h=3===r?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==r&&t.writeVarint(f(2,h-1));var d=l[u].x-n,p=l[u].y-o;t.writeVarint(m(d)),t.writeVarint(m(p)),n+=d,o+=p}3===r&&t.writeVarint(15)}}function K(e,t){var i=typeof e;"string"==i?t.writeStringField(1,e):"boolean"==i?t.writeBooleanField(7,e):"number"==i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}e.exports=h,e.exports.fromVectorTileJs=h,e.exports.fromGeojsonVt=function(e,t){t=t||{};var i,r={};for(i in e)r[i]=new c(e[i].features,t),r[i].name=i,r[i].version=t.version,r[i].extent=t.extent;return h({layers:r})},e.exports.GeoJSONWrapper=c;var u,J=y.dK(e.exports);const Q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},p=Math.fround||(u=new Float32Array(1),e=>(u[0]=+e,u[0])),g=3,_=5,ee=6;class te{constructor(e){this.options=Object.assign(Object.create(Q),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:i,minZoom:r,maxZoom:n}=this.options,o=(i&&console.time("total time"),`prepare ${t.length} points`);i&&console.time(o),this.points=t;var a=[];for(let e=0;e<t.length;e++){const r=t[e];if(r.geometry){const[n,o]=r.geometry.coordinates,s=p(b(n)),l=p(w(o));a.push(s,l,1/0,e,-1,1),this.options.reduce&&a.push(0)}}let s=this.trees[n+1]=this._createTree(a);i&&console.timeEnd(o);for(let e=n;e>=r;e--){const r=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),i&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-r)}return i&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;var r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;var o=Math.max(-90,Math.min(90,e[3]));if(360<=e[2]-e[0])i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,o],t),a=this.getClusters([-180,r,n,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(b(i),w(o),b(n),w(r)),l=a.data,c=[];for(const e of s){const t=this.stride*e;c.push(1<l[t+_]?ie(l,t,this.clusterProps):this.points[l[t+g]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);var o=n.data;if(t*this.stride>=o.length)throw new Error(r);var a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[t*this.stride],o[t*this.stride+1],a),s=[];for(const t of a){const i=t*this.stride;o[4+i]===e&&s.push(1<o[i+_]?ie(o,i,this.clusterProps):this.points[o[i+g]])}if(0===s.length)throw new Error(r);return s}getLeaves(e,t,i){var r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){var r=this.trees[this._limitZoom(e)],e=Math.pow(2,e),{extent:n,radius:o}=this.options,o=o/n,n=(i-o)/e,a=(i+1+o)/e,s={features:[]};return this._addTileFeatures(r.range((t-o)/e,n,(t+1+o)/e,a),r.data,t,i,e,s),0===t&&this._addTileFeatures(r.range(1-o/e,n,1,a),r.data,e,i,e,s),t===e-1&&this._addTileFeatures(r.range(0,n,o/e,a),r.data,-1,i,e,s),s.features.length?s:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){var i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(e,o.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_createTree(t){var i=new y.bg(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(r,n,o,a,s,l){for(const u of r){const r=u*this.stride,d=1<n[r+_];let e,t,i;if(d)e=re(n,r,this.clusterProps),t=n[r],i=n[1+r];else{const o=this.points[n[r+g]],[a,s]=(e=o.properties,o.geometry.coordinates);t=b(a),i=w(s)}var c={type:1,geometry:[[Math.round(this.options.extent*(t*s-o)),Math.round(this.options.extent*(i*s-a))]],tags:e},h=d||this.options.generateId?n[r+g]:this.points[n[r+g]].id;void 0!==h&&(c.id=h),l.features.push(c)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,a){const{radius:t,extent:s,reduce:l,minPoints:i}=this.options,r=t/(s*Math.pow(2,a)),c=e.data,h=[],u=this.stride;for(let o=0;o<c.length;o+=u)if(!(c[o+2]<=a)){c[o+2]=a;const s=c[o],f=c[o+1],m=e.within(c[o],c[o+1],r),g=c[o+_];let n=g;for(const e of m){const t=e*u;c[2+t]>a&&(n+=c[t+_])}if(n>g&&n>=i){let e,t=s*g,i=f*g,r=-1;var d,p=(o/u<<5)+(a+1)+this.points.length;for(const s of m){const h=s*u;c[2+h]<=a||(c[2+h]=a,d=c[h+_],t+=c[h]*d,i+=c[1+h]*d,c[4+h]=p,l&&(e||(e=this._map(c,o,!0),r=this.clusterProps.length,this.clusterProps.push(e)),l(e,this._map(c,h))))}c[o+4]=p,h.push(t/n,i/n,1/0,p,-1,n),l&&h.push(r)}else{for(let e=0;e<u;e++)h.push(c[o+e]);if(1<n)for(const e of m){const t=e*u;if(!(c[2+t]<=a)){c[2+t]=a;for(let e=0;e<u;e++)h.push(c[t+e])}}}}return h}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(1<e[t+_]){const r=this.clusterProps[e[t+ee]];return i?Object.assign({},r):r}const r=this.points[e[t+g]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function ie(e,t,i){return{type:"Feature",id:e[t+g],properties:re(e,t,i),geometry:{type:"Point",coordinates:[360*(e[t]-.5),function(e){e=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(e[t+1])]}}}function re(e,t,i){var r=e[t+_],n=1e4<=r?Math.round(r/1e3)+"k":1e3<=r?Math.round(r/100)/10+"k":r,o=e[t+ee],i=-1===o?{}:Object.assign({},i[o]);return Object.assign(i,{cluster:!0,cluster_id:e[t+g],point_count:r,point_count_abbreviated:n})}function b(e){return e/360+.5}function w(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}t={exports:{}};function T(e,t,i,r){for(var n,o=r,a=i-t>>1,s=i-t,l=e[t],c=e[t+1],h=e[i],u=e[i+1],d=t+3;d<i;d+=3){var p=function(e,t,i,r,n,o){var a=n-i,s=o-r;{var l;0==a&&0==s||(1<(l=((e-i)*a+(t-r)*s)/(a*a+s*s))?(i=n,r=o):0<l&&(i+=a*l,r+=s*l))}return(a=e-i)*a+(s=t-r)*s}(e[d],e[d+1],l,c,h,u);o<p?(n=d,o=p):p===o&&(p=Math.abs(d-a))<s&&(n=d,s=p)}r<o&&(3<n-t&&T(e,t,n,r),e[n+2]=o,3<i-n)&&T(e,n,i,r)}function A(e,t,i,r){var e={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},n=e,o=n.geometry,t=n.type;if("Point"===t||"MultiPoint"===t||"LineString"===t)S(n,o);else if("Polygon"===t||"MultiLineString"===t)for(var a=0;a<o.length;a++)S(n,o[a]);else if("MultiPolygon"===t)for(a=0;a<o.length;a++)for(var s=0;s<o[a].length;s++)S(n,o[a][s]);return e}function S(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function E(e,t,i,r){if(t.geometry){var n=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)ne(n,s);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)ne(n[c],s);else if("LineString"===o)C(n,s,a,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)C(n[c],s=[],a,!1),e.push(A(l,"LineString",s,t.properties));return}M(n,s,a,!1)}else if("Polygon"===o)M(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(c=0;c<t.geometry.geometries.length;c++)E(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,r);return}for(c=0;c<n.length;c++){var h=[];M(n[c],h,a,!0),s.push(h)}}e.push(A(l,o,s,t.properties))}}function ne(e,t){t.push(oe(e[0])),t.push(ae(e[1])),t.push(0)}function C(e,t,i,r){for(var n,o,a=0,s=0;s<e.length;s++){var l=oe(e[s][0]),c=ae(e[s][1]);t.push(l),t.push(c),t.push(0),0<s&&(a+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var h=t.length-3;t[2]=1,T(t,0,h,i),t[2+h]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function M(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];C(e[n],o,i,r),t.push(o)}}function oe(e){return e/360+.5}function ae(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function I(e,t,i,r,n,o,a,s){if(r/=t,o>=(i/=t)&&a<r)return e;if(a<i||r<=o)return null;for(var l=[],c=0;c<e.length;c++){var h=e[c],u=h.geometry,d=h.type,p=0===n?h.minX:h.minY,f=0===n?h.maxX:h.maxY;if(i<=p&&f<r)l.push(h);else if(!(f<i||r<=p)){var m=[];if("Point"===d||"MultiPoint"===d){g=void 0;_=void 0;y=void 0;v=void 0;x=void 0;b=void 0;w=void 0;var g=u;var _=m;var y=i;var v=r;var x=n;for(var b=0;b<g.length;b+=3){var w=g[b+x];y<=w&&w<=v&&(_.push(g[b]),_.push(g[b+1]),_.push(g[b+2]))}}else if("LineString"===d)se(u,m,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===d)P(u,m,i,r,n,!1);else if("Polygon"===d)P(u,m,i,r,n,!0);else if("MultiPolygon"===d)for(var T=0;T<u.length;T++){var S=[];P(u[T],S,i,r,n,!0),S.length&&m.push(S)}if(m.length)if(s.lineMetrics&&"LineString"===d)for(T=0;T<m.length;T++)l.push(A(h.id,d,m[T],h.tags));else"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(A(h.id,d,m,h.tags))}}return l.length?l:null}function se(e,t,i,r,n,o,a){for(var s,l,c=le(e),h=0===n?ce:he,u=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],_=e[d+4],y=0===n?p:f,v=0===n?g:_,x=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),y<i?i<v&&(l=h(c,p,f,g,_,i),a)&&(c.start=u+s*l):r<y?v<r&&(l=h(c,p,f,g,_,r),a)&&(c.start=u+s*l):L(c,p,f,m),v<i&&i<=y&&(l=h(c,p,f,g,_,i),x=!0),r<v&&y<=r&&(l=h(c,p,f,g,_,r),x=!0),!o&&x&&(a&&(c.end=u+s*l),t.push(c),c=le(e)),a&&(u+=s)}var b=e.length-3,p=e[b],f=e[1+b],m=e[2+b];(y=0===n?p:f)>=i&&y<=r&&L(c,p,f,m),b=c.length-3,o&&3<=b&&(c[b]!==c[0]||c[1+b]!==c[1])&&L(c,c[0],c[1],c[2]),c.length&&t.push(c)}function le(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function P(e,t,i,r,n,o){for(var a=0;a<e.length;a++)se(e[a],t,i,r,n,o,!1)}function L(e,t,i,r){e.push(t),e.push(i),e.push(r)}function ce(e,t,i,r,n,o){r=(o-t)/(r-t);return e.push(o),e.push(i+(n-i)*r),e.push(1),r}function he(e,t,i,r,n,o){n=(o-i)/(n-i);return e.push(t+(r-t)*n),e.push(o),e.push(1),n}function ue(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=D(n.geometry,t);else if("MultiLineString"===o||"Polygon"===o)for(var a=[],s=0;s<n.geometry.length;s++)a.push(D(n.geometry[s],t));else if("MultiPolygon"===o)for(a=[],s=0;s<n.geometry.length;s++){for(var l=[],c=0;c<n.geometry[s].length;c++)l.push(D(n.geometry[s][c],t));a.push(l)}i.push(A(n.id,o,a,n.tags))}return i}function D(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function de(e,t){if(!e.transformed){for(var i,r=1<<e.z,n=e.x,o=e.y,a=0;a<e.features.length;a++){var s=e.features[a],l=s.geometry,c=s.type;if(s.geometry=[],1===c)for(i=0;i<l.length;i+=2)s.geometry.push(pe(l[i],l[i+1],t,r,n,o));else for(i=0;i<l.length;i++){for(var h=[],u=0;u<l[i].length;u+=2)h.push(pe(l[i][u],l[i][u+1],t,r,n,o));s.geometry.push(h)}}e.transformed=!0}return e}function pe(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function fe(e,t,i,r,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,v=y=_=g=m=f=p=d=u=h=c=l=void 0;var l=a,c=e[s],h=o,u=n,d=c.geometry,p=c.type,f=[];if("Point"===p||"MultiPoint"===p)for(var m=0;m<d.length;m+=3)f.push(d[m]),f.push(d[m+1]),l.numPoints++,l.numSimplified++;else if("LineString"===p)k(f,d,l,h,!1,!1);else if("MultiLineString"===p||"Polygon"===p)for(m=0;m<d.length;m++)k(f,d[m],l,h,"Polygon"===p,0===m);else if("MultiPolygon"===p)for(var g=0;g<d.length;g++){var _=d[g];for(m=0;m<_.length;m++)k(f,_[m],l,h,!0,0===m)}if(f.length){var y=c.tags||null;if("LineString"===p&&u.lineMetrics){for(var v in y={},c.tags)y[v]=c.tags[v];y.mapbox_clip_start=d.start/d.size,y.mapbox_clip_end=d.end/d.size}u={geometry:f,type:"Polygon"===p||"MultiPolygon"===p?3:"LineString"===p||"MultiLineString"===p?2:1,tags:y};null!==c.id&&(u.id=c.id),l.features.push(u)}var u=e[s].minX,x=e[s].minY,b=e[s].maxX,w=e[s].maxY;u<a.minX&&(a.minX=u),x<a.minY&&(a.minY=x),a.maxX<b&&(a.maxX=b),a.maxY<w&&(a.maxY=w)}return a}function k(e,t,i,r,n,o){var a=r*r;if(0<r&&t.size<(n?a:r))i.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>a)&&(i.numSimplified++,s.push(t[l]),s.push(t[l+1])),i.numPoints++;if(n){var c=s;n=o;for(var h=0,u=0,d=c.length,p=d-2;u<d;p=u,u+=2)h+=(c[u]-c[p])*(c[u+1]+c[p+1]);if(0<h===n)for(u=0,d=c.length;u<d/2;u+=2){var f=c[u],m=c[u+1];c[u]=c[d-2-u],c[u+1]=c[d-1-u],c[d-2-u]=f,c[d-1-u]=m}}e.push(s)}}function z(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r,n,o,a,s,e=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)E(i,e.features[r],t,r);else E(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=e,n=(t=t).buffer/t.extent,a=I(o=r,1,-1-n,n,0,-1,2,t),s=I(r,1,1-n,2+n,0,-1,2,t),(e=o=(a||s)&&(o=I(r,1,-n,1+n,0,-1,2,t)||[],a&&(o=ue(a,1).concat(o)),s)?o.concat(ue(s,-1)):o).length&&this.splitTile(e,0,0,0),i&&(e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function R(e,t,i){return 32*((1<<e)*i+t)+e}t.exports=(z.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},z.prototype.splitTile=function(e,t,i,r,n,o,a){for(var s=[e,t,i,r],l=this.options,c=l.debug;s.length;){r=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();var h,u,d,p,f,m,g,_,y,v=1<<t,x=R(t,i,r),b=this.tiles[x];if(!b&&(1<c&&console.time("creation"),b=this.tiles[x]=fe(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)&&(1<c&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,b.numFeatures,b.numPoints,b.numSimplified),console.timeEnd("creation")),this.stats[x="z"+t]=(this.stats[x]||0)+1,this.total++),b.source=e,n){if(t===l.maxZoom||t===n)continue;var x=1<<n-t;if(i!==Math.floor(o/x)||r!==Math.floor(a/x))continue}else if(t===l.indexMaxZoom||b.numPoints<=l.indexMaxPoints)continue;b.source=null,0!==e.length&&(1<c&&console.time("clipping"),p=.5-(x=.5*l.buffer/l.extent),m=1+x,g=h=u=d=null,_=I(e,v,i-x,i+(f=.5+x),0,b.minX,b.maxX,l),y=I(e,v,i+p,i+m,0,b.minX,b.maxX,l),e=null,_&&(g=I(_,v,r-x,r+f,1,b.minY,b.maxY,l),h=I(_,v,r+p,r+m,1,b.minY,b.maxY,l),_=null),y&&(u=I(y,v,r-x,r+f,1,b.minY,b.maxY,l),d=I(y,v,r+p,r+m,1,b.minY,b.maxY,l),y=null),1<c&&console.timeEnd("clipping"),s.push(g||[],t+1,2*i,2*r),s.push(h||[],t+1,2*i,2*r+1),s.push(u||[],t+1,2*i+1,2*r),s.push(d||[],t+1,2*i+1,2*r+1))}},z.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,r=r.debug;if(e<0||24<e)return null;var o=1<<e,o=R(e,t=(t%o+o)%o,i);if(this.tiles[o])return de(this.tiles[o],n);1<r&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var a,s=e,l=t,c=i;!a&&0<s;)s--,l=Math.floor(l/2),c=Math.floor(c/2),a=this.tiles[R(s,l,c)];return a&&a.source&&(1<r&&console.log("found parent tile z%d-%d-%d",s,l,c),1<r&&console.time("drilling down"),this.splitTile(a.source,s,l,c,e,t,i),1<r&&console.timeEnd("drilling down"),this.tiles[o])?de(this.tiles[o],n):null},function(e,t){return new z(e,t)});var me=y.dK(t.exports);function ge(e,t){e=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);e=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!e)return t(null,null);e=new G(e.features);let i=J(e);t(null,{vectorTile:e,rawData:(i=0===i.byteOffset&&i.byteLength===i.buffer.byteLength?i:new Uint8Array(i)).buffer})}class _e extends o{constructor(e,t,i,r,n,o){super(e,t,i,r,ge,o),n&&(this.loadGeoJSON=n)}loadData(i,r){const n=i&&i.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(i,(e,t)=>{if(e||!t)return r(e);if("object"!=typeof t)return r(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));U(t,!0);try{if(i.filter){const d=y.r(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===d.result)throw new Error(d.value.map(e=>e.key+": "+e.message).join(", "));const r=t.features.filter(e=>d.value.evaluate({zoom:0},e));t={type:"FeatureCollection",features:r}}this._geoJSONIndex=i.cluster?new te(function({superclusterOptions:e,clusterProperties:t}){if(t&&e){const i={},r={},n={accumulated:null,zoom:0},o={properties:null},a=Object.keys(t);for(const e of a){const[n,o]=t[e],a=y.r(o),s=y.r("string"==typeof n?[n,["accumulated"],["get",e]]:n);i[e]=a.value,r[e]=s.value}e.map=e=>{o.properties=e;var t={};for(const e of a)t[e]=i[e].evaluate(n,o);return t},e.reduce=(e,t)=>{o.properties=t;for(const t of a)n.accumulated=e[t],e[t]=r[t].evaluate(n,o)}}return e}(i)).load(t.features):me(t,i.geojsonVtOptions)}catch(e){return r(e)}this.loaded={};t={};if(o){const y=d(n);y&&(t.resourceTiming={},t.resourceTiming[i.source]=JSON.parse(JSON.stringify(y)))}r(null,t)})}reloadTile(e,t){var i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)y.g(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class ye{constructor(e,t){this.tileID=new y.am(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=t}parse(e,t,o,a){this.status="parsing";const s=new y.am(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),l={},c=t.familiesBySource[o.source],h=new y.dC(s,o.promoteId);return h.bucketLayerIDs=[],h.is3DTile=!0,y.dP(e).then(e=>{if(!e)return a(new Error("Could not parse tile"));var t=y.dQ(e,1/y.bR(o.tileID.canonical)),i=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features")||e.json.asset.extras&&e.json.asset.extras.MAPBOX_mesh_features,r=e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression"),n=new y.K(this.zoom,{brightness:this.brightness});for(const e in c)for(const o of c[e]){const e=o[0],a=(h.bucketLayerIDs.push(o.map(e=>e.id)),e.recalculate(n,[]),new y.dR(t,s,i,r,this.brightness,h));i||(a.needsUpload=!0),(l[e.fqid]=a).evaluate(e)}this.status="done",a(null,{buckets:l,featureIndex:h})}).catch(e=>a(new Error(e.message)))}}class ve{constructor(e,t,i,r,n,o){this.actor=e,this.layerIndex=t,this.brightness=o,this.loading={},this.loaded={}}loadTile(r,n){const o=r.uid,a=this.loading[o]=new ye(r,this.brightness);y.a_(r.request,(e,t)=>{var i=!this.loading[o];return delete this.loading[o],i||e?(a.status="done",i||(this.loaded[o]=a),n(e)):t&&0!==t.byteLength?void a.parse(t,this.layerIndex,r,(e,t)=>{a.status="done",this.loaded=this.loaded||{},this.loaded[o]=a,e||!t?n(e):n(null,t)}):(a.status="done",this.loaded[o]=a,n())})}reloadTile(i,r){var e=this.loaded,t=i.uid;if(e&&e[t]){const n=e[t];n.projection=i.projection,n.brightness=i.brightness;"parsing"===n.status?n.reloadCallback=(e,t)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(i,r)),r(e,t)}:"done"===n.status&&this.loadTile(i,r)}}abortTile(e,t){e=e.uid;this.loading[e]&&delete this.loading[e],t()}removeTile(e,t){var i=this.loaded,e=e.uid;i&&i[e]&&delete i[e],t()}}class xe{constructor(e){this.self=e,this.actor=new y.dS(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=y.bo({name:"mercator"}),this.workerSourceTypes={vector:o,geojson:_e,"batched-model":ve},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=e=>{if(y.dT.isParsed())throw new Error("RTL text plugin already registered.");y.dT.applyArabicShaping=e.applyArabicShaping,y.dT.processBidirectionalText=e.processBidirectionalText,y.dT.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],delete this.rasterArrayWorkerSource,i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,{scope:t,isLoaded:i}){if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][t]=i,this.workerSources[e]&&this.workerSources[e][t])for(const n in this.workerSources[e][t]){var r=this.workerSources[e][t][n];for(const e in r)r[e]instanceof o&&(r[e].isSpriteLoaded=i,r[e].fire(new y.b("isSpriteLoaded")))}}setImages(e,{scope:t,images:i},r){if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][t]=i,this.workerSources[e]&&this.workerSources[e][t])for(const r in this.workerSources[e][t]){var n=this.workerSources[e][t][r];for(const e in n)n[e].availableImages=i}r()}setProjection(e,t){this.projections[e]=y.bo(t)}setBrightness(e,t,i){this.brightness=t,i()}setLayers(e,t,i){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),i()}updateLayers(e,t,i){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),i()}loadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,i)}loadDEMTile(e,t,i){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,i)}decodeRasterArray(e,t,i){this.getRasterArrayWorkerSource().decodeRasterArray(t,i)}reloadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,i)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,i)}removeSource(e,t,i){var r;this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]&&(r=this.workerSources[e][t.scope][t.type][t.source],delete this.workerSources[e][t.scope][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i())}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(e,t,i){try{y.dT.setState(t);const e=y.dT.getPluginURL();if(y.dT.isLoaded()&&!y.dT.isParsed()&&null!=e){this.self.importScripts(e);const t=y.dT.isParsed();i(t?void 0:new Error("RTL Text Plugin failed to import scripts from "+e),t)}}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let i=this.availableImages[e][t];return i=i||[]}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let i=this.layerIndexes[e][t];return i||((i=this.layerIndexes[e][t]=new O).scope=t),i}getWorkerSource(a,e,t,i){var r;return this.workerSources[a]||(this.workerSources[a]={}),this.workerSources[a][i]||(this.workerSources[a][i]={}),this.workerSources[a][i][e]||(this.workerSources[a][i][e]={}),this.isSpriteLoaded[a]||(this.isSpriteLoaded[a]={}),this.workerSources[a][i][e][t]||(r={send:(e,t,i,r,n,o)=>{this.actor.send(e,t,i,a,n,o)},scheduler:this.actor.scheduler},this.workerSources[a][i][e][t]=new this.workerSourceTypes[e](r,this.getLayerIndex(a,i),this.getAvailableImages(a,i),this.isSpriteLoaded[a][i],void 0,this.brightness)),this.workerSources[a][i][e][t]}getDEMWorkerSource(e,t,i){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][i]||(this.demWorkerSources[e][i]={}),this.demWorkerSources[e][i][t]||(this.demWorkerSources[e][i][t]=new F),this.demWorkerSources[e][i][t]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new N),this.rasterArrayWorkerSource}enforceCacheSizeLimit(e,t){y.dU(t)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xe(self)),xe}),e(0,function(Re){function L(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return;for(let e=0;e<t.length;e++)if(!L(t[e],i[e]))return;return 1}if("object"!=typeof t||null===t||null===i)return t===i;if("object"==typeof i&&Object.keys(t).length===Object.keys(i).length){for(const e in t)if(!L(t[e],i[e]))return;return 1}}var E=C;function C(e){return e=e,!("undefined"==typeof window||"undefined"==typeof document||!(function(){if("Worker"in window&&"Blob"in window&&"URL"in window){var e,t,i=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(i);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}}()&&function(){var e=document.createElement("canvas"),t=(e.width=e.height=1,e.getContext("2d"));if(t)return(t=t.getImageData(0,0,1,1))&&t.width===e.width}()&&(void 0===I[n=e&&e.failIfMajorPerformanceCaveat]&&(I[n]=function(){r=n,t=document.createElement("canvas"),(i=Object.create(C.webGLContextAttributes)).failIfMajorPerformanceCaveat=r;var e,t,i,r=t.getContext("webgl2",i);if(!r)return!1;try{e=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!e||r.isContextLost())&&(r.shaderSource(e,"void main() {}"),r.compileShader(e),!0===r.getShaderParameter(e,r.COMPILE_STATUS))}()),I[n])&&!document.documentMode));var n}var I={};function l(e,t,i){e=document.createElement(e);return null!=t&&(e.className=t),i&&i.appendChild(e),e}function o(e,t,i){var r=document.createElementNS("http://www.w3.org/2000/svg",e);for(const e of Object.keys(t))r.setAttributeNS(null,e,String(t[e]));return i&&i.appendChild(r),r}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const e="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,c=e&&void 0!==e.userSelect?"userSelect":"WebkitUserSelect";let P;function k(){e&&c&&(P=e[c],e[c]="none")}function z(){e&&c&&(e[c]=P)}function B(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",B,!0)}function F(){window.addEventListener("click",B,!0),window.setTimeout(()=>{window.removeEventListener("click",B,!0)},0)}function N(e,t){var i=e.getBoundingClientRect();return V(e,i,t)}function U(t,i){var r=t.getBoundingClientRect(),n=[];for(let e=0;e<i.length;e++)n.push(V(t,r,i[e]));return n}function j(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&0<=window.navigator.platform.toUpperCase().indexOf("MAC")?0:e.button}function V(e,t,i){e=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new Re.P((i.clientX-t.left)*e,(i.clientY-t.top)*e)}class G{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){var t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){var t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){var e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const i in this._removedLayers)e[i]=e[i]||{},e[i].removedIds=Object.keys(this._removedLayers[i]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class q extends Re.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return Re.l(this.requestManager.transformRequest(i,Re.R.Model).url).then(e=>{if(e)return e=Re.c(e),(e=new Re.M(t,void 0,void 0,e)).computeBoundsAndApplyParent(),e}).catch(e=>{this.fire(new Re.a(new Error(`Could not load model ${t} from ${i}: `+e.message)))})}load(e,n){this.models[n]||(this.models[n]={});const o=Object.keys(e);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+o.length;var t=[];for(const Re of o)t.push(this.loadModel(Re,e[Re]));Promise.allSettled(t).then(t=>{for(let e=0;e<t.length;e++){var{status:i,value:r}=t[e];"fulfilled"===i&&r&&(this.models[n][o[e]]=r)}this.numModelsLoading[n]-=o.length,this.fire(new Re.b("data",{dataType:"style"}))}).catch(e=>{this.fire(new Re.a(new Error("Could not load models: "+e.message)))})}isLoaded(){for(const e in this.numModelsLoading)if(0<this.numModelsLoading[e])return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.removeModel(e,i),this.load({[e]:this.requestManager.normalizeModelURL(t)},i)}addModels(e,t){var i={};for(const t in e)i[t]=this.requestManager.normalizeModelURL(e[t]);this.load(i,t)}removeModel(e,t){this.models[t]||(this.models[t]={});var i=this.models[t][e];delete this.models[t][e],i.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const i in this.models[t])this.models[t][i].upload(e.context)}}class W{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){var r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},Re.e(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const Re in this.state[e])Re!==r&&(this.deletedStates[e][Re]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const Re in this.state[e][r])i[Re]||(this.deletedStates[e][r][Re]=null)}else for(const Re in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][Re]&&delete this.deletedStates[e][r][Re]}removeFeatureState(e,t,i){if(null!==this.deletedStates[e]){var r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}}getState(e,t){var i=String(t),r=Re.e({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const Re=this.deletedStates[e][t];if(null===Re)return{};for(const e in Re)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),Re.e(this.state[e][i],this.stateChanges[e][i]),t[i]=this.state[e][i];i[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const Re in this.state[e])t[Re]={},this.state[e][Re]={};else for(const Re in this.deletedStates[e]){if(null===this.deletedStates[e][Re])this.state[e][Re]={};else if(this.state[e][Re])for(const t of Object.keys(this.deletedStates[e][Re]))delete this.state[e][Re][t];t[Re]=this.state[e][Re]}i[e]=i[e]||{},Re.e(i[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const Re in e)e[Re].setFeatureState(i,t)}}class H extends Re.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Re.h({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e)){for(const{ids:e,callback:i}of this.requestors)this._notify(e,t,i);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,i){this._validate(e,i)&&(this.images[t][e]=i)}_validate(e,t){let i=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new Re.a(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new Re.a(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(t.content,t)||(this.fire(new Re.a(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(t,i){if(t){let e=0;for(const r of t){if(r[0]<e||r[1]<r[0]||i<r[1])return!1;e=r[1]}}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,i){i.version=this.images[t][e].version+1,this.images[t][e]=i,this.updatedImages[t][e]=!0}removeImage(e,t){var i=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,i){let r=!0;var n=!!this.loaded[t];if(!n)for(const i of e)this.images[t][i]||(r=!1);n||r?this._notify(e,t,i):this.requestors.push({ids:e,scope:t,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,t,i){var r={};for(const i of e){this.images[t][i]||this.fire(new Re.b("styleimagemissing",{id:i}));const e=this.images[t][i];e?r[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:Re.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(e){var{width:e,height:t}=this.atlasImage[e];return{width:e,height:t}}getPattern(e,t){const i=this.patterns[t][e],r=this.getImage(e,t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new Re.I(i,r);this.patterns[t][e]={bin:i,position:n}}return this._updatePatternAtlas(t),this.patterns[t][e].position}bind(e,t){var i=e.gl;let r=this.atlasTexture[t];r?this.dirty&&(r.update(this.atlasImage[t]),this.dirty=!1):(r=new Re.T(e,this.atlasImage[t],i.RGBA),this.atlasTexture[t]=r),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const t=[];for(const Re in this.patterns[e])t.push(this.patterns[e][Re].bin);const{w:i,h:r}=Re.p(t),n=this.atlasImage[e];n.resize({width:i||1,height:r||1});for(const t in this.patterns[e]){const i=this.patterns[e][t]["bin"],r=i.x+1,o=i.y+1,a=this.images[e][t].data,s=a.width,l=a.height;Re.h.copy(a,n,{x:0,y:0},{x:r,y:o},{width:s,height:l}),Re.h.copy(a,n,{x:0,y:l-1},{x:r,y:o-1},{width:s,height:1}),Re.h.copy(a,n,{x:0,y:0},{x:r,y:o+l},{width:s,height:1}),Re.h.copy(a,n,{x:s-1,y:0},{x:r-1,y:o},{width:1,height:l}),Re.h.copy(a,n,{x:0,y:0},{x:r+s,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const n of e)if(!this.callbackDispatchedThisFrame[t][n]){this.callbackDispatchedThisFrame[t][n]=!0;const e=this.images[t][n];i=e,r=void 0,(r=i.userImage)&&r.render&&r.render()&&(i.data.replace(new Uint8Array(r.data.buffer)),1)&&this.updateImage(n,t,e)}var i,r}}class p{constructor(e,t,i,r){this.message=(e?e+": ":"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}class u extends p{}function f(t){var i=t.key,r=t.value,n=t.valueSpec||{},o=t.objectElementValidators||{},a=t.style,s=t.styleSpec;let l=[];t=Re.i(r);if("object"!==t)return[new p(i,r,`object expected, ${t} found`)];for(const Re in r){const t=Re.split(".")[0];let e;o[t]?e=o[t]:n[t]?e=m:o["*"]?e=o["*"]:n["*"]&&(e=m),e?l=l.concat(e({key:(i&&i+".")+Re,value:r[Re],valueSpec:n[t]||n["*"],style:a,styleSpec:s,object:r,objectKey:Re},r)):l.push(new u(i,r[Re],`unknown property "${Re}"`))}for(const Re in n)o[Re]||n[Re].required&&void 0===n[Re].default&&void 0===r[Re]&&l.push(new p(i,r,`missing required property "${Re}"`));return l}function Z(e){var t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,o=e.key,a=e.arrayElementValidator||m;if("array"!==Re.i(t))return[new p(o,t,`array expected, ${Re.i(t)} found`)];if(i.length&&t.length!==i.length)return[new p(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new p(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let s={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0},l=(n.$version<7&&(s.function=i.function),"object"===Re.i(i.value)&&(s=i.value),[]);for(let e=0;e<t.length;e++)l=l.concat(a({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:r,styleSpec:n,key:`${o}[${e}]`},!0));return l}function $(t){var i=t.key,r=t.value,n=t.valueSpec;let e=Re.i(r);if("number"!==(e="number"===e&&r!=r?"NaN":e))return[new p(i,r,`number expected, ${e} found`)];if("minimum"in n){let e=n.minimum;if(r<(e="array"===Re.i(n.minimum)?n.minimum[t.arrayIndex]:e))return[new p(i,r,r+" is less than the minimum value "+e)]}if("maximum"in n){let e=n.maximum;if(r>(e="array"===Re.i(n.maximum)?n.maximum[t.arrayIndex]:e))return[new p(i,r,r+" is greater than the maximum value "+e)]}return[]}function X(e){const n=e.valueSpec,o=Re.u(e.value.type);let a,s,l,c={};const t="categorical"!==o&&void 0===e.value.property,i=!t,h="array"===Re.i(e.value.stops)&&"array"===Re.i(e.value.stops[0])&&"object"===Re.i(e.value.stops[0][0]),r=f({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===o)return[new p(e.key,e.value,'identity function may not have a "stops" property')];let t=[];var i=e.value;return t=t.concat(Z({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:u})),"array"===Re.i(i)&&0===i.length&&t.push(new p(e.key,i,"array must have at least one stop")),t},default:function(e){return m({key:e.key,value:e.value,valueSpec:n,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===o&&t&&r.push(new p(e.key,e.value,'missing required property "property"')),"identity"===o||e.value.stops||r.push(new p(e.key,e.value,'missing required property "stops"')),"exponential"===o&&e.valueSpec.expression&&!Re.s(e.valueSpec)&&r.push(new p(e.key,e.value,"exponential functions not supported")),8<=e.styleSpec.$version&&(i&&!Re.k(e.valueSpec)?r.push(new p(e.key,e.value,"property functions not supported")):t&&!Re.m(e.valueSpec)&&r.push(new p(e.key,e.value,"zoom functions not supported"))),"categorical"!==o&&!h||void 0!==e.value.property||r.push(new p(e.key,e.value,'"property" property is required')),r;function u(e){let t=[];var i=e.value,r=e.key;if("array"!==Re.i(i))return[new p(r,i,`array expected, ${Re.i(i)} found`)];if(2!==i.length)return[new p(r,i,`array length 2 expected, length ${i.length} found`)];if(h){if("object"!==Re.i(i[0]))return[new p(r,i,`object expected, ${Re.i(i[0])} found`)];if(void 0===i[0].zoom)return[new p(r,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new p(r,i,"object stop key must have value")];const n=Re.u(i[0].zoom);if("number"!=typeof n)return[new p(r,i[0].zoom,"stop zoom values must be numbers")];if(l&&l>n)return[new p(r,i[0].zoom,"stop zoom values must appear in ascending order")];n!==l&&(l=n,s=void 0,c={}),t=t.concat(f({key:r+"[0]",value:i[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:$,value:d}}))}else t=t.concat(d({key:r+"[0]",value:i[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},i));return Re.n(Re.o(i[1]))?t.concat([new p(r+"[1]",i[1],"expressions are not allowed in function stops.")]):t.concat(m({key:r+"[1]",value:i[1],valueSpec:n,style:e.style,styleSpec:e.styleSpec}))}function d(t,i){var r=Re.i(t.value),e=Re.u(t.value),i=null!==t.value?t.value:i;if(a){if(r!==a)return[new p(t.key,i,r+" stop domain type must match previous stop domain type "+a)]}else a=r;if("number"!==r&&"string"!==r&&"boolean"!==r&&"number"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e)return[new p(t.key,i,"stop domain value must be a number, string, or boolean")];if("number"===r||"categorical"===o)return"categorical"!==o||"number"!==r||"number"==typeof e&&isFinite(e)&&Math.floor(e)===e?"categorical"!==o&&"number"===r&&"number"==typeof e&&"number"==typeof s&&void 0!==s&&e<s?[new p(t.key,i,"stop domain values must appear in ascending order")]:(s=e,"categorical"===o&&e in c?[new p(t.key,i,"stop domain values must be unique")]:(c[e]=!0,[])):[new p(t.key,i,"integer expected, found "+String(e))];{let e=`number expected, ${r} found`;return Re.k(n)&&void 0===o&&(e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new p(t.key,i,e)]}}}function h(t){var e=("property"===t.expressionContext?Re.q:Re.r)(Re.o(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new p(""+t.key+e.key,t.value,e.message));e=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!e.outputDefined())return[new p(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Re.t(e))return[new p(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return function t(e,i){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const Re of i.valueSpec.expression.parameters)r.delete(Re);if(0===r.size)return[];const n=[];return e instanceof Re.C&&r.has(e.name)?[new p(i.key,i.value,`["${e.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: `+i.object.id)]:(e.eachChild(e=>{n.push(...t(e,i))}),n)}(e,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Re.v(e,["zoom","feature-state"]))return[new p(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Re.x(e))return[new p(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Y(e){var t=e.key,i=e.value,e=e.valueSpec,r=[];return Array.isArray(e.values)?-1===e.values.indexOf(Re.u(i))&&r.push(new p(t,i,`expected one of [${e.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(e.values).indexOf(Re.u(i))&&r.push(new p(t,i,`expected one of [${Object.keys(e.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function K(e){return Re.z(Re.o(e.value))?h(Re.j({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_"+(e.layerType||"fill")]})):function t(i){const r=i.value,n=i.key;if("array"!==Re.i(r))return[new p(n,r,`array expected, ${Re.i(r)} found`)];const o=i.styleSpec;let a,s=[];if(r.length<1)return[new p(n,r,"filter array must have at least 1 element")];switch(s=s.concat(Y({key:n+"[0]",value:r[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Re.u(r[0])){case"<":case"<=":case">":case">=":2<=r.length&&"$type"===Re.u(r[1])&&s.push(new p(n,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&s.push(new p(n,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":2<=r.length&&"string"!==(a=Re.i(r[1]))&&s.push(new p(n+"[1]",r[1],`string expected, ${a} found`));for(let e=2;e<r.length;e++)a=Re.i(r[e]),"$type"===Re.u(r[1])?s=s.concat(Y({key:`${n}[${e}]`,value:r[e],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&s.push(new p(`${n}[${e}]`,r[e],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let e=1;e<r.length;e++)s=s.concat(t({key:`${n}[${e}]`,value:r[e],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":a=Re.i(r[1]),2!==r.length?s.push(new p(n,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==a&&s.push(new p(n+"[1]",r[1],`string expected, ${a} found`))}return s}(e)}function J(e,t){var i=e.key,r=e.style,n=e.layer,o=e.styleSpec,a=e.value,s=e.objectKey,l=o[t+"_"+e.layerType];if(!l)return[];var c=s.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return m({key:i,value:a,valueSpec:o.transition,style:r,styleSpec:o});c=e.valueSpec||l[s];if(!c)return[new u(i,a,`unknown property "${s}"`)];let h;if("string"===Re.i(a)&&Re.k(c)&&!c.tokens&&(h=/^{([^}]+)}$/.exec(a))){const Re=`\`{ "type": "identity", "property": ${h?JSON.stringify(h[1]):'"_"'} }\``;return[new p(i,a,`"${s}" does not support interpolation syntax
Use an identity property function instead: ${Re}.`)]}l=[];if("symbol"===e.layerType)"text-field"!==s||!r||r.glyphs||r.imports||l.push(new p(i,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Re.A(Re.o(a))&&"identity"===Re.u(a.type)&&l.push(new p(i,a,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&n&&n.layout&&n.layout.hasOwnProperty("model-id")&&Re.k(c)&&(Re.B(c)||Re.m(c))){const e=Re.q(Re.o(a),c),t=e.value.expression||e.value._styleExpression.expression;!t||Re.v(t,["measure-light"])||"model-emissive-strength"===s&&Re.x(t)&&Re.t(t)||l.push(new p(i,a,s+" does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))}return l.concat(m({key:e.key,value:a,valueSpec:c,style:r,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:s}))}function Q(e){return J(e,"paint")}function ee(e){return J(e,"layout")}function te(t){let i=[];const r=t.value,n=t.key,o=t.style,a=t.styleSpec;r.type||r.ref||i.push(new p(n,r,'either "type" or "ref" is required'));let s=Re.u(r.type);const l=Re.u(r.ref);if(r.id){const a=Re.u(r.id);for(let e=0;e<t.arrayIndex;e++){const t=o.layers[e];Re.u(t.id)===a&&i.push(new p(n,r.id,`duplicate layer id "${r.id}", previously used at line `+t.id.__line__))}}if("ref"in r){let t;["type","source","source-layer","filter","layout"].forEach(e=>{e in r&&i.push(new p(n,r[e],`"${e}" is prohibited for ref layers`))}),o.layers.forEach(e=>{Re.u(e.id)===l&&(t=e)}),t?t.ref?i.push(new p(n,r.ref,"ref cannot reference another ref layer")):s=Re.u(t.type):"string"==typeof l&&i.push(new p(n,r.ref,`ref layer "${l}" not found`))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(r.source){const t=o.sources&&o.sources[r.source],a=t&&Re.u(t.type);t?"vector"===a&&"raster"===s?i.push(new p(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===a&&"raster"!==s?i.push(new p(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==a||r["source-layer"]?"raster-dem"===a&&"hillshade"!==s?i.push(new p(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==a||["raster","raster-particle"].includes(s)?"line"!==s||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===a&&t.lineMetrics?"raster-particle"===s&&"raster-array"!==a&&i.push(new p(n,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):i.push(new p(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new p(n,r.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new p(n,r,`layer "${r.id}" must specify a "source-layer"`)):i.push(new p(n,r.source,`source "${r.source}" not found`))}else i.push(new p(n,r,'missing required property "source"'));return i=i.concat(f({key:n,value:r,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>m({key:n+".type",value:r.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:e=>K(Re.j({layerType:s},e)),layout:e=>f({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ee(Re.j({layerType:s},e))}}),paint:e=>f({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Q(Re.j({layerType:s,layer:r},e))}})}}))}function r(e){var t=e.value,e=e.key,i=Re.i(t);return"string"!==i?[new p(e,t,`string expected, ${i} found`)]:[]}const ie={promoteId:function({key:e,value:t}){if("string"===Re.i(t))return r({key:e,value:t});{const Re=[];for(const i in t)Re.push(...r({key:e+"."+i,value:t[i]}));return Re}}};function re(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style;if(!t.type)return[new p(i,t,'"type" is required')];var o,a=Re.u(t.type);let s=[];switch(!["vector","raster","raster-dem","raster-array"].includes(a)||t.url||t.tiles||s.push(new u(i,t,'Either "url" or "tiles" is required.')),a){case"vector":case"raster":case"raster-dem":case"raster-array":return s=s.concat(f({key:i,value:t,valueSpec:r["source_"+a.replace("-","_")],style:e.style,styleSpec:r,objectElementValidators:ie}));case"geojson":if(s=f({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:ie}),t.cluster)for(const Re in t.clusterProperties){const[e,r]=t.clusterProperties[Re],n="string"==typeof e?[e,["accumulated"],["get",Re]]:e;s.push(...h({key:`${i}.${Re}.map`,value:r,expressionContext:"cluster-map"})),s.push(...h({key:`${i}.${Re}.reduce`,value:n,expressionContext:"cluster-reduce"}))}return s;case"video":return f({key:i,value:t,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return f({key:i,value:t,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new p(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Y({key:i+".type",value:t.type,valueSpec:{values:(o=r).source.reduce((e,t)=>{t=o[t];return e="enum"===t.type.type?e.concat(Object.keys(t.type.values)):e},[])},style:n,styleSpec:r})}}function ne(e){var t,i=e.value;let r=[];return i&&("string"!==(t=Re.i(i))?r=r.concat([new p(e.key,i,`string expected, "${t}" found`)]):function(e){var t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),1}catch(e){}}(i)||(r=r.concat([new p(e.key,i,`invalid url "${i}"`)]))),r}function oe(e){var t=e.value,i=e.styleSpec,r=i.light,n=e.style;let o=[];e=Re.i(t);if(void 0!==t)if("object"!==e)o=o.concat([new p("light",t,`object expected, ${e} found`)]);else for(const Re in t){const e=Re.match(/^(.*)-transition$/);o=o.concat(e&&r[e[1]]&&r[e[1]].transition?m({key:Re,value:t[Re],valueSpec:i.transition,style:n,styleSpec:i}):r[Re]?m({key:Re,value:t[Re],valueSpec:r[Re],style:n,styleSpec:i}):[new p(Re,t[Re],`unknown property "${Re}"`)])}return o}function ae(t){var i=t.value;let r=[];if(i){const o=Re.i(i);if("object"!==o)r=r.concat([new p("light-3d",i,`object expected, ${o} found`)]);else{const a=t.styleSpec,s=a["light-3d"],l=t.key,c=t.style,h=t.style.lights;for(const Re of["type","id"])if(!(Re in i))return r=r.concat([new p("light-3d",i,`missing property ${Re} on light`)]),r;if(i.type&&h)for(let e=0;e<t.arrayIndex;e++){const t=Re.u(i.type),a=h[e];Re.u(a.type)===t&&r.push(new p(l,i.id,`duplicate light type "${i.type}", previously defined at line `+a.id.__line__))}var e="properties_light_"+i.type;if(e in a){var n=a[e];for(const o in i)if("properties"===o){const s=i[o],l=Re.i(s);if("object"!==l)return r=r.concat([new p("properties",s,`object expected, ${l} found`)]);for(const Re in s)r=r.concat(n[Re]?m({key:Re,value:s[Re],valueSpec:n[Re],style:c,styleSpec:a}):[new u(t.key,s[Re],`unknown property "${Re}"`)])}else{const Re=o.match(/^(.*)-transition$/);r=r.concat(Re&&s[Re[1]]&&s[Re[1]].transition?m({key:o,value:i[o],valueSpec:a.transition,style:c,styleSpec:a}):s[o]?m({key:o,value:i[o],valueSpec:s[o],style:c,styleSpec:a}):[new u(o,i[o],`unknown property "${o}"`)])}}else r=r.concat([new p("light-3d",i,"Invalid light type "+i.type)])}}return r}function se(e){const t=e.value,i=e.key,r=e.style,n=e.styleSpec,o=n.terrain;let a=[];e=Re.i(t);if(void 0!==t&&"null"!==e)if("object"!==e)a=a.concat([new p("terrain",t,`object expected, ${e} found`)]);else{for(const Re in t){const e=Re.match(/^(.*)-transition$/);a=a.concat(e&&o[e[1]]&&o[e[1]].transition?m({key:Re,value:t[Re],valueSpec:n.transition,style:r,styleSpec:n}):o[Re]?m({key:Re,value:t[Re],valueSpec:o[Re],style:r,styleSpec:n}):[new u(Re,t[Re],`unknown property "${Re}"`)])}if(t.source){const e=r.sources&&r.sources[t.source],n=e&&Re.u(e.type);e?"raster-dem"!==n&&a.push(new p(i,t.source,`terrain cannot be used with a source of type ${String(n)}, it only be used with a "raster-dem" source type`)):a.push(new p(i,t.source,`source "${t.source}" not found`))}else a.push(new p(i,t,'terrain is missing required property "source"'))}return a}function le(e){var t=e.value,i=e.style,r=e.styleSpec,n=r.fog;let o=[];e=Re.i(t);if(void 0!==t)if("object"!==e)o=o.concat([new p("fog",t,`object expected, ${e} found`)]);else for(const Re in t){const e=Re.match(/^(.*)-transition$/);o=o.concat(e&&n[e[1]]&&n[e[1]].transition?m({key:Re,value:t[Re],valueSpec:r.transition,style:i,styleSpec:r}):n[Re]?m({key:Re,value:t[Re],valueSpec:n[Re],style:i,styleSpec:r}):[new u(Re,t[Re],`unknown property "${Re}"`)])}return o}const ce={"*":()=>[],array:Z,boolean:function(e){var t=e.value,e=e.key,i=Re.i(t);return"boolean"!==i?[new p(e,t,`boolean expected, ${i} found`)]:[]},number:$,color:function(e){var t=e.key,e=e.value,i=Re.i(e);return"string"!==i?[new p(t,e,`color expected, ${i} found`)]:null===Re.y(e)?[new p(t,e,`color expected, "${e}" found`)]:[]},enum:Y,filter:K,function:X,layer:te,object:f,source:re,model:ne,light:oe,"light-3d":ae,terrain:se,fog:le,string:r,formatted:function(e){return 0===r(e).length?[]:h(e)},resolvedImage:function(e){return 0===r(e).length?[]:h(e)},projection:function(e){var t=e.value,i=e.styleSpec,r=i.projection,n=e.style;let o=[];e=Re.i(t);if("object"===e)for(const Re in t)o=o.concat(m({key:Re,value:t[Re],valueSpec:r[Re],style:n,styleSpec:i}));else"string"!==e&&(o=o.concat([new p("projection",t,`object or string expected, ${e} found`)]));return o},import:function(e){const{value:t,styleSpec:i}=e,{data:r,...n}=t;Object.defineProperty(n,"__line__",{value:t.__line__,enumerable:!1});let o=f(Re.j({},e,{value:n,valueSpec:i.import}));return""===Re.u(n.id)&&o.push(new p(e.key+".id",n,"import id can't be an empty string")),o=r?o.concat(ue(r,i,{key:e.key+".data"})):o}};function m(e,t=!1){const i=e.value,r=e.valueSpec,n=e.styleSpec;if(r.expression&&Re.A(Re.u(i)))return X(e);if(r.expression&&Re.n(Re.o(i)))return h(e);if(r.type&&ce[r.type]){const i=ce[r.type](e);return!0===t&&0<i.length&&"array"===Re.i(e.value)?h(e):i}return f(Re.j({},e,{valueSpec:r.type?n[r.type]:r}))}function he(e){var t=e.value,i=e.key,e=r(e);return e.length||(-1===t.indexOf("{fontstack}")&&e.push(new p(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&e.push(new p(i,t,'"glyphs" url must include a "{range}" token'))),e}function ue(e,t=Re.D,i={}){return m({key:i.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:he,"*":()=>[]}})}function a(e,t=Re.D){return s(ue(e,t))}const de=e=>s(re(e)),pe=e=>s(oe(e)),fe=e=>s(ae(e)),me=e=>s(se(e)),ge=e=>s(le(e)),_e=e=>s(te(e)),ye=e=>s(K(e)),ve=e=>s(ne(e));function s(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function xe(e,t){let i=!1;if(t&&t.length)for(const r of t)r instanceof u?Re.w(r.message):(e.fire(new Re.a(new Error(r.message))),i=!0);return i}const be=new Re.F({anchor:new Re.G(Re.D.light.anchor),position:new Re.H(Re.D.light.position),color:new Re.G(Re.D.light.color),intensity:new Re.G(Re.D.light.intensity)});class we extends Re.E{constructor(e,t="flat"){super(),this._transitionable=new Re.J(be),this.setLight(e,t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t,i={}){this._validate(pe,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,i){return(!i||!1!==i.validate)&&xe(this,e.call(a,Re.e({value:t,style:{glyphs:!0,sprite:!0},styleSpec:Re.D})))}}const Te=new Re.F({source:new Re.G(Re.D.terrain.source),exaggeration:new Re.G(Re.D.terrain.exaggeration)});let Se=class extends Re.E{constructor(e,t,i,r){super(),this.scope=i,this._transitionable=new Re.J(Te,i,r),this._transitionable.setTransitionOrValue(e,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new Re.K(e)).get("exaggeration")}isZoomDependent(){var e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Re.Z}};const Ae=45,Ee=65;function Ce(e,t,i,r){var i=Re.O(Ae,Ee,i),[r,n]=Me(e,r),t=1-Math.min(1,Math.exp((t-r)/(n-r)*-6));return t*=t*t,Math.min(1,1.00747*t)*i*e.alpha}function Me(e,t){t=.5/Math.tan(.5*t);return[e.range[0]+t,e.range[1]+t]}function Ie(e,t,i,r,n){t=Re.N.transformMat4([],[t,i,r],n.mercatorFogMatrix);return Ce(e,Re.N.length(t),n.pitch,n._fov)}function Pe(e,t,i,r,n,o,a){let s=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(const e of[[i,r,0],[n,r,0],[n,o,0],[i,o,0]]){const i=Re.N.transformMat4([],e,t),r=Re.N.length(i);s=Math.min(s,r),l=Math.max(l,r)}return[Ce(e,s,a.pitch,a._fov),Ce(e,l,a.pitch,a._fov)]}const Le=new Re.F({range:new Re.G(Re.D.fog.range),color:new Re.G(Re.D.fog.color),"high-color":new Re.G(Re.D.fog["high-color"]),"space-color":new Re.G(Re.D.fog["space-color"]),"horizon-blend":new Re.G(Re.D.fog["horizon-blend"]),"star-intensity":new Re.G(Re.D.fog["star-intensity"]),"vertical-range":new Re.G(Re.D.fog["vertical-range"])});class De extends Re.E{constructor(e,t,i,r){super(),this._transitionable=new Re.J(Le,i,new Map(r)),this.set(e,r),this._transitioning=this._transitionable.untransitioned(),this._transform=t,this.properties=new Re.Q(Le)}get state(){var e=this._transform,t="globe"===e.projection.name,e=Re.S(e.zoom),i=this.properties.get("range"),r=[.5,3];return{range:t?[Re.U(r[0],i[0],e),Re.U(r[1],i[1],e)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t,i={}){if(!this._validate(ge,e,i)){var r=Re.e({},e);for(const e of Object.keys(Re.D.fog))void 0===r[e]&&(r[e]=Re.D.fog[e].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,t)}}getOpacity(e){var t;return this._transform.projection.supportsFog?(t=this.properties&&this.properties.get("color")||1,("globe"===this._transform.projection.name?1:Re.O(Ae,Ee,e))*t.a):0}getOpacityAtLatLng(e,t){return this._transform.projection.supportsFog?(i=this.state,t=t,e=Re.L.fromLngLat(e),r=t.elevation?t.elevation.getAtPointOrZero(e):0,Ie(i,e.x,e.y,r,t)):0;var i,r}getOpacityForTile(e){return this._transform.projection.supportsFog?(e=this._transform.calculateFogTileMatrix(e.toUnwrapped()),Pe(this.state,e,0,0,Re.V,Re.V,this._transform)):[1,1]}getOpacityForBounds(e,t,i,r,n){return this._transform.projection.supportsFog?Pe(this.state,e,t,i,r,n,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Me(this.state,e):[0,1]}isVisibleOnFrustum(t){if(this._transform.projection.supportsFog){const r=[4,5,6,7];for(const n of r){const r=t.points[n];let e;var i;if(e=0<=r[2]?r:(i=t.points[n-4],Re.W(i,r,i[2]/(i[2]-r[2]))),.05<=Ie(this.state,e[0],e[1],0,this._transform))return!0}}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,i){return(!i||!1!==i.validate)&&xe(this,e.call(a,Re.e({value:t,style:{glyphs:!0,sprite:!0},styleSpec:Re.D})))}}class ke extends Re.E{constructor(e,t,i,r){super(),this.scope=i,this._options=e,this.properties=new Re.Q(t),this._transitionable=new Re.J(t,i,new Map(r)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const ze=new Re.F({color:new Re.G(Re.D.properties_light_ambient.color),intensity:new Re.G(Re.D.properties_light_ambient.intensity)}),Ue=new Re.F({direction:new Re.X(Re.D.properties_light_directional.direction),color:new Re.G(Re.D.properties_light_directional.color),intensity:new Re.G(Re.D.properties_light_directional.intensity),"cast-shadows":new Re.G(Re.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new Re.G(Re.D.properties_light_directional["shadow-intensity"])});class je{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(e,t){let i,r;var n;return r=e instanceof Re.P||"number"==typeof e[0]?(n=Re.P.convert(e),i=[n],t.isPointAboveHorizon(n)):(n=Re.P.convert(e[0]),e=Re.P.convert(e[1]),i=[n,e],Re.Y(n,e).every(e=>t.isPointAboveHorizon(e))),new je(i,t.getCameraPoint(),r,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return Re.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){var t=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new Re.P(1,1)):this.screenBounds[1],r=Re.Y(t,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(r[3]=this.cameraPoint)),Re._(r,e)}bufferedCameraGeometryGlobe(e){var t=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new Re.P(1,1)):this.screenBounds[1],r=Re.Y(t,i,e),n=this.cameraPoint.clone();switch(3*((n.y>t.y)+(n.y>i.y))+((n.x>t.x)+(n.x>i.x))){case 0:r[0]=n,r[4]=n.clone();break;case 1:r.splice(1,0,n);break;case 2:r[1]=n;break;case 3:r.splice(4,0,n);break;case 5:r.splice(2,0,n);break;case 6:r[3]=n;break;case 7:r.splice(3,0,n);break;case 8:r[2]=n}return r}containsTile(t,e,i,r=0){var n=t.queryPadding/e._pixelsPerMercatorPixel+1,i=i?this._bufferedCameraMercator(n,e):this._bufferedScreenMercator(n,e);let o=t.tileID.wrap+(i.unwrapped?r:0);n=i.polygon.map(e=>Re.$(t.tileTransform,e,o));if(Re.a0(n,0,0,Re.V,Re.V)){o=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const a=this.screenGeometryMercator.polygon.map(e=>Re.a1(t.tileTransform,e,o)),s=a.map(e=>new Re.P(e[0],e[1])),l=e.getFreeCameraOptions().position||new Re.L(0,0,0),c=Re.a1(t.tileTransform,l,o),h=a.map(e=>{e=Re.N.sub(e,e,c);return Re.N.normalize(e,e),new Re.a2(c,e)}),u=Re.a3(t,1,e.zoom)*e._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:s,tilespaceRays:h,bufferedTilespaceGeometry:n,bufferedTilespaceBounds:((i=Re.a4(n)).min.x=Re.aa(i.min.x,0,Re.V),i.min.y=Re.aa(i.min.y,0,Re.V),i.max.x=Re.aa(i.max.x,0,Re.V),i.max.y=Re.aa(i.max.y,0,Re.V),i),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:u}}}_bufferedScreenMercator(e,t){var i=qe(e);return this._screenRaycastCache[i]||(e="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[i]=e)}_bufferedCameraMercator(e,t){var i=qe(e);return this._cameraRaycastCache[i]||(e="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[i]=e)}_projectAndResample(e,t){var i=function(e,t){var i=Re.a6.multiply([],t.pixelMatrix,t.globeMatrix),r=[0,-Re.ab,0,1],n=[0,Re.ab,0,1],o=[0,0,0,1],i=(Re.a7.transformMat4(r,r,i),Re.a7.transformMat4(n,n,i),Re.a7.transformMat4(o,o,i),new Re.P(r[0]/r[3],r[1]/r[3])),a=new Re.P(n[0]/n[3],n[1]/n[3]),i=Re.a8(e,i)&&r[3]<o[3],r=Re.a8(e,a)&&n[3]<o[3];if(!i&&!r)return null;a=function(t,i,r){for(let e=1;e<t.length;e++){var n=Ge(i.pointCoordinate3D(t[e-1]).x),o=Ge(i.pointCoordinate3D(t[e]).x);if(r<0){if(n<o)return{idx:e,t:-n/(o-1-n)}}else if(o<n)return{idx:e,t:(1-n)/(o+1-n)}}return null}(e,t,i?-1:1);if(!a)return null;var{idx:n,t:o}=a;let s=1<n?Ve(e.slice(0,n),t):[],l=n<e.length?Ve(e.slice(n),t):[];s=s.map(e=>new Re.P(Ge(e.x),e.y)),l=l.map(e=>new Re.P(Ge(e.x),e.y));r=[...s],0===r.length&&r.push(l[l.length-1]),a=Re.U(r[r.length-1].y,(0===l.length?s:l)[0].y,o),e=i?[new Re.P(0,a),new Re.P(0,0),new Re.P(1,0),new Re.P(1,a)]:[new Re.P(1,a),new Re.P(1,1),new Re.P(0,1),new Re.P(0,a)];return r.push(...e),0===l.length?r.push(s[0]):r.push(...l),{polygon:r.map(e=>new Re.L(e.x,e.y)),unwrapped:!1}}(e,t);return i||{polygon:(i=function(t,i){let r=!1,n=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),n=t[i],a=t[1+i];.5<Math.abs(n.x-a.x)&&(n.x<a.x?(n.x+=1,0==i&&(t[t.length-1].x+=1)):(a.x+=1,1+i==t.length-1&&(t[0].x+=1)),r=!0)}const a=Re.a5(i.center.lng);return r&&a<Math.abs(a-1)&&t.forEach(e=>{--e.x}),{polygon:t,unwrapped:r}}(Ve(e,t).map(e=>new Re.P(Ge(e.x),e.y)),t)).polygon.map(e=>new Re.L(e.x,e.y)),unwrapped:i.unwrapped}}}function Ve(e,i){return Re.a9(e,e=>{var t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function Ge(e){return e<0?1+e%1:e%1}function qe(e){return 100*e|0}function We(i,r,e,t,n){function o(e,t){if(e)return n(e);if(t){i.url&&t.tiles&&i.tiles&&delete i.tiles;const e=Re.ac(Re.e(t,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);t.vector_layers&&(e.vectorLayers=t.vector_layers,e.vectorLayerIds=e.vectorLayers.map(e=>e.id)),t.raster_layers&&(e.rasterLayers=t.raster_layers,e.rasterLayerIds=e.rasterLayers.map(e=>e.id)),e.tiles=r.canonicalizeTileset(e,i.url),n(null,e)}}return i.url?Re.g(r.transformRequest(r.normalizeSourceURL(i.url,null,e,t),Re.R.Source),o):Re.f.frame(()=>o(null,i))}class He{constructor(e,t,i){this.bounds=Re.ad.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){var t=Math.pow(2,e.z),i=Math.floor(Re.a5(this.bounds.getWest())*t),r=Math.floor(Re.ae(this.bounds.getNorth())*t),n=Math.ceil(Re.a5(this.bounds.getEast())*t),t=Math.ceil(Re.ae(this.bounds.getSouth())*t);return e.x>=i&&e.x<n&&e.y>=r&&e.y<t}}class Ze extends Re.E{constructor(e,t,i,r){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Re.e(this,Re.ac(t,["url","scheme","tileSize","promoteId"])),this._options=Re.e({type:"vector"},t),this._collectResourceTiming=!!t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new Re.af}load(i){this._loaded=!1,this.fire(new Re.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=We(this._options,this.map._requestManager,r,n,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?(r&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: "+r),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: "+n),this.fire(new Re.a(e))):t&&(Re.e(this,t),t.bounds&&(this.tileBounds=new He(t.bounds,this.minzoom,this.maxzoom)),Re.aj(t.tiles,this.map._requestManager._customAccessToken),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(e)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Re.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Re.e({},this._options)}loadTile(i,r){const e=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(e,Re.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Re.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,i.actor&&"expired"!==i.state)"loading"===i.state?i.reloadCallback=r:i.request=i.actor.send("reloadTile",n,o.bind(this));else if(i.actor=this._tileWorkers[e]=this._tileWorkers[e]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",n,o.bind(this),void 0,!0);else{const r=Re.ah.call({deduped:this._deduped},n,(e,t)=>{e||!t?o.call(this,e):(n.data={cacheControl:t.cacheControl,expires:t.expires,rawData:t.rawData.slice(0)},i.actor&&i.actor.send("loadTile",n,o.bind(this),void 0,!0))},!0);i.request={cancel:r}}function o(e,t){return delete i.request,i.aborted?r(null):e&&404!==e.status?r(e):(t&&t.resourceTiming&&(i.resourceTiming=t.resourceTiming),this.map._refreshExpiredTiles&&t&&i.setExpiryData(t),i.loadVectorData(t,this.map.painter),Re.ai(this.dispatcher),r(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $e extends Re.E{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Re.e({type:"raster"},t),Re.e(this,Re.ac(t,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new Re.b("dataloading",{dataType:"source"})),this._tileJSONRequest=We(this._options,this.map._requestManager,null,null,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new Re.a(e)):t&&(Re.e(this,t),t.bounds&&(this.tileBounds=new He(t.bounds,this.minzoom,this.maxzoom)),Re.aj(t.tiles),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(e)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Re.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Re.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(n,o){var e=2<=Re.f.devicePixelRatio,e=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),e,this.tileSize);n.request=Re.d(this.map._requestManager.transformRequest(e,Re.R.Tile),(e,t,i,r)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):e?(n.state="errored",o(e)):t?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:i,expires:r}),n.setTexture(t,this.map.painter),n.state="loaded",Re.ai(this.dispatcher),void o(null)):o(null)))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&e.texture instanceof Re.T?(e.destroy(!0),e.texture&&e.texture instanceof Re.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xe extends $e{constructor(e,t,i,r){super(e,t,i,r),this.type="raster-array",this.maxzoom=22,this._options=Re.e({type:"raster-array"},t)}triggerRepaint(e){var t=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);t&&t.enabled&&i&&t._clearRenderCacheForTile(i.id,e.tileID),this.map.triggerRepaint()}loadTile(n,o){var e=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),e=this.map._requestManager.transformRequest(e,Re.R.Tile);n.requestParams=e,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(e,t,i,r)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):e?20===e.code?void 0:(n.state="errored",o(e)):(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:i,expires:r}),n.state="empty",void o(null))))}unloadTile(e){var t=e.texture;t&&t instanceof Re.T?(e.destroy(!0),this.map.painter.saveTileTexture(t)):(e.destroy(),e.flushQueues(),e._isHeaderLoaded=!1,delete e._mrt,delete e.textureDescriptor),e.fbo&&(e.fbo.destroy(),delete e.fbo),delete e.request,delete e.requestParams,delete e.neighboringTiles,e.state="unloaded"}prepareTile(i,e,t){i._isHeaderLoaded&&("empty"!==i.state&&(i.state="reloading"),i.fetchBand(e,t,(e,t)=>{e?(i.state="errored",this.fire(new Re.a(e)),this.triggerRepaint(i)):t&&(i.setTexture(t,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(t){var e;return this.rasterLayers&&(e=(e=(e=this.rasterLayers.find(({id:e})=>e===t))&&e.fields)&&e.bands&&e.bands)?e[0]:0}getTextureDescriptor(t,i,r){if(t){var n=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(n){let e=null;i instanceof Re.an?e=i.paint.get("raster-array-band"):i instanceof Re.ao&&(e=i.paint.get("raster-particle-array-band"));i=e||this.getInitialBand(n);if(null!=i)if(t.textureDescriptor){if(!t.updateNeeded(n,i)||r)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,n,i)}}}}const g=new Uint16Array(8184);for(let s=0;s<2046;s++){let e=s+2,t=0,i=0,r=0,n=0,o=0,a=0;for(1&e?r=n=o=32:t=i=a=32;1<(e>>=1);){const Re=t+r>>1,c=i+n>>1;1&e?(r=t,n=i,t=o,i=a):(t=r,i=n,r=o,n=a),o=Re,a=c}const c=4*s;g[0+c]=t,g[1+c]=i,g[2+c]=r,g[3+c]=n}const _=new Uint16Array(2178),y=new Uint8Array(1089),Ye=new Uint16Array(1089);function Ke(e){return 0===e?-.03125:32===e?.03125:0}class d{constructor(e,t,i,r){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++;var n=(this.context=e).gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++;var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}d.uniqueIdxCounter=0;const Je={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qe{constructor(e,t,i,r,n,o){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.instanceCount=o;i=(this.context=e).gl;this.buffer=i.createBuffer(),e.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(t,i){for(let e=0;e<this.attributes.length;e++){var r=i.attributes[this.attributes[e].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,i,r){for(let e=0;e<this.attributes.length;e++){var n=this.attributes[e],o=i.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[Je[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(t,i,r){for(let e=0;e<this.attributes.length;e++){var n=i.attributes[this.attributes[e].name];void 0!==n&&this.instanceCount&&0<this.instanceCount&&t.vertexAttribDivisor(n,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class t{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class et extends t{getDefault(){return Re.ax.transparent}set(e){var t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!this.dirty||(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class tt extends t{getDefault(){return 1}set(e){e===this.current&&!this.dirty||(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class it extends t{getDefault(){return 0}set(e){e===this.current&&!this.dirty||(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class rt extends t{getDefault(){return[!0,!0,!0,!0]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class nt extends t{getDefault(){return!0}set(e){e===this.current&&!this.dirty||(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ot extends t{getDefault(){return 255}set(e){e===this.current&&!this.dirty||(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class at extends t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){var t=this.current;e.func===t.func&&e.ref===t.ref&&e.mask===t.mask&&!this.dirty||(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class st extends t{getDefault(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&!this.dirty||(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class lt extends t{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1)}}class ct extends t{getDefault(){return[0,1]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&!this.dirty||(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ht extends t{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1)}}class ut extends t{getDefault(){return this.gl.LESS}set(e){e===this.current&&!this.dirty||(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class dt extends t{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1)}}class pt extends t{getDefault(){var e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ft extends t{getDefault(){return Re.ax.transparent}set(e){var t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!this.dirty||(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class mt extends t{getDefault(){return this.gl.FUNC_ADD}set(e){e===this.current&&!this.dirty||(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class gt extends t{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1)}}class _t extends t{getDefault(){return this.gl.BACK}set(e){e===this.current&&!this.dirty||(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class yt extends t{getDefault(){return this.gl.CCW}set(e){e===this.current&&!this.dirty||(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let vt=class extends t{getDefault(){return null}set(e){e===this.current&&!this.dirty||(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class xt extends t{getDefault(){return this.gl.TEXTURE0}set(e){e===this.current&&!this.dirty||(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class bt extends t{getDefault(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wt extends t{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1)}}class Tt extends t{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1)}}class St extends t{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1)}}class At extends t{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1)}}class Et extends t{getDefault(){return null}set(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ct extends t{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Mt extends t{getDefault(){return 4}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1)}}class It extends t{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1)}}class Pt extends t{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1)}}class Lt extends t{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Dt extends Lt{setDirty(){this.dirty=!0}set(e){var t;e===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(t=this.gl).framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1)}}class kt extends Lt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){var t;e===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(t=this.gl).framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1)}}class zt extends Lt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){var t;e===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(t=this.gl).framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1)}}class Rt extends kt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ot{constructor(e,t,i,r,n){this.context=e,this.width=t,this.height=i;t=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new Dt(e,t)),n&&(this.depthAttachmentType=n,this.depthAttachment=new("renderbuffer"===n?kt:zt)(e,t))}destroy(){var e,t=this.context.gl;this.colorAttachment&&(e=this.colorAttachment.get())&&t.deleteTexture(e),this.depthAttachment&&this.depthAttachmentType&&("renderbuffer"===this.depthAttachmentType?(e=this.depthAttachment.get())&&t.deleteRenderbuffer(e):(e=this.depthAttachment.get())&&t.deleteTexture(e)),t.deleteFramebuffer(this.framebuffer)}}class Oe{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Oe.ReadOnly=!1,Oe.ReadWrite=!0,Oe.disabled=new Oe(519,Oe.ReadOnly,[0,1]);class Be{constructor(e,t,i,r,n,o){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Be.disabled=new Be({func:519,mask:0},0,0,7680,7680,7680);class Fe{constructor(e,t,i,r){this.blendFunction=e,this.blendColor=t,this.mask=i,this.blendEquation=r}}Fe.Replace=[1,0,1,0],Fe.disabled=new Fe(Fe.Replace,Re.ax.transparent,[!1,!1,!1,!1]),Fe.unblended=new Fe(Fe.Replace,Re.ax.transparent,[!0,!0,!0,!0]),Fe.alphaBlended=new Fe([1,771,1,771],Re.ax.transparent,[!0,!0,!0,!0]),Fe.multiply=new Fe([774,0,774,0],Re.ax.transparent,[!0,!0,!0,!0]);class Ne{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Ne.disabled=new Ne(!1,1029,2305),Ne.backCCW=new Ne(!0,1029,2305),Ne.backCW=new Ne(!0,1029,2304),Ne.frontCW=new Ne(!0,1028,2304),Ne.frontCCW=new Ne(!0,1028,2305);class Bt{constructor(e,t){this.gl=e,this.clearColor=new et(this),this.clearDepth=new tt(this),this.clearStencil=new it(this),this.colorMask=new rt(this),this.depthMask=new nt(this),this.stencilMask=new ot(this),this.stencilFunc=new at(this),this.stencilOp=new st(this),this.stencilTest=new lt(this),this.depthRange=new ct(this),this.depthTest=new ht(this),this.depthFunc=new ut(this),this.blend=new dt(this),this.blendFunc=new pt(this),this.blendColor=new ft(this),this.blendEquation=new mt(this),this.cullFace=new gt(this),this.cullFaceSide=new _t(this),this.frontFace=new yt(this),this.program=new vt(this),this.activeTexture=new xt(this),this.viewport=new bt(this),this.bindFramebuffer=new wt(this),this.bindRenderbuffer=new Tt(this),this.bindTexture=new St(this),this.bindVertexBuffer=new At(this),this.bindElementBuffer=new Et(this),this.bindVertexArrayOES=new Ct(this),this.pixelStoreUnpack=new Mt(this),this.pixelStoreUnpackPremultiplyAlpha=new It(this),this.pixelStoreUnpackFlipY=new Pt(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,i){return new d(this,e,t,i)}createVertexBuffer(e,t,i,r,n){return new Qe(this,e,t,i,r,n)}createRenderbuffer(e,t,i){var r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i,r){return new Ot(this,e,t,i,r)}clear({color:e,depth:t,stencil:i,colorMask:r}){var n=this.gl;let o=0;e&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==t&&(o|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(o|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){L(e.blendFunction,Fe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Ft=Re.ay([{name:"a_pos",type:"Float32",components:3}]);class Nt{constructor(e,t,i,r){var i={width:i[0],height:i[1],data:null},n=e.gl;this.targetColorTexture=new Re.T(e,i,n.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new Re.T(e,i,n.RGBA,{useMipmap:!1}),this.context=e,this.setNumParticles(t,r),this.lastInvalidatedAt=0}setNumParticles(e,t){if(this.numParticles!==t){(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());var i=new Re.az,r=(i.reserve(Math.round(t)),Re.aA(e.key));for(let e=0;e<t;e++)i.emplaceBack(r(),r(),r());this.particleVertices0=this.context.createVertexBuffer(i,Ft.members,!0),this.particleVertices1=this.context.createVertexBuffer(i,Ft.members,!0),this.particleSegment=Re.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=t}}update(e){return!(this.lastInvalidatedAt<e&&(this.lastInvalidatedAt=Re.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ut={type:2,extent:Re.V,loadGeometry:()=>[[new Re.P(0,0),new Re.P(Re.V+1,0),new Re.P(Re.V+1,Re.V+1),new Re.P(0,Re.V+1),new Re.P(0,0)]]};class M{constructor(e,t,i,r,n){this.tileID=e,this.uid=Re.aC(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(e){e+=this.timeAdded;e<Re.f.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Re.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var i={};if(t)for(const r of e){const e=r.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)i[t.fqid]=r}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Re.aE){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Re.aE&&t.hasRTLText){this.hasRTLText=!0,Re.aF();break}}this.queryPadding=0;for(const Re in this.buckets){const e=this.buckets[Re],i=t.style.getOwnLayer(Re);var r;i&&(r=i.queryRadius(e),this.queryPadding=Math.max(this.queryPadding,r))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Re.aD}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const Re in this.buckets){const t=this.buckets[Re];t.uploadPending()&&t.upload(e)}const t=e.gl,i=this.imageAtlas;var r;i&&!i.uploaded&&(r=!!Object.keys(i.patternPositions).length,this.imageAtlasTexture=new Re.T(e,i.image,t.RGBA,{useMipmap:r}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Re.T(e,this.glyphAtlasImage,t.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Re.T(e,this.lineAtlas.image,t.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,i){this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),t&&this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&(e=t.style.getBrightness(),!this._lastUpdatedBrightness&&!e||this._lastUpdatedBrightness&&e&&Math.abs(this._lastUpdatedBrightness-e)<.001||(this._lastUpdatedBrightness=e,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,i,r,n,o,a,s){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:a,transform:o,params:n,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(t,e){var i=this.latestFeatureIndex;if(i&&i.rawTileData){const c=i.loadVTLayers(),h=e?e.sourceLayer:"",u=c._geojsonTileLayer||c[h];if(u){var r=Re.aG(e&&e.filter),{z:n,x:o,y:a}=this.tileID.canonical,s={z:n,x:o,y:a};for(let e=0;e<u.length;e++){const c=u.feature(e);if(r.needGeometry){const t=Re.aH(c,!0);if(!r.filter(new Re.K(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!r.filter(new Re.K(this.tileID.overscaledZ),c))continue;var l=i.getId(c,h),l=new Re.aI(c,n,o,a,l);l.tile=s,t.push(l)}}}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=Re.aJ(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const Re=Date.now();let e=!1;this.expirationTime>Re?e=!1:i&&!(this.expirationTime<i)&&(t=this.expirationTime-i)?this.expirationTime=Re+Math.max(t,3e4):e=!0,e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(t,i){if(this.latestFeatureIndex){var r=this.latestFeatureIndex.loadVTLayers(),n=i.style.listImages(),o=i.style.getBrightness();for(const c in this.buckets)if(i.style.hasLayer(c)){var a=this.buckets[c],s=a.layers[0].sourceLayer||"_geojsonTileLayer",l=r[s];let e={};if(!t||(e=t[s],l&&e&&0!==Object.keys(e).length)){if(a.update(e,l,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},o),a instanceof Re.aK||a instanceof Re.aL){const Re=i.style.getOwnSourceCache(a.layers[0].source);i._terrain&&i._terrain.enabled&&Re&&a.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(Re.id,this.tileID)}s=i&&i.style&&i.style.getOwnLayer(c);s&&(this.queryPadding=Math.max(this.queryPadding,s.queryRadius(a)))}}}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Re.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Re.f.now()+e}setTexture(e,t){var i=t.context,r=i.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture&&this.texture instanceof Re.T?this.texture.update(e,{useMipmap:!0}):(this.texture=new Re.T(i,e,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,t){var i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(i&&"mercator"!==i.name&&!this._tileDebugBuffer){var r=Re.aM(Ut,this.tileID.canonical,this.tileTransform)[0],n=new Re.aN,o=new Re.aO;for(let e=0;e<r.length;e++){const{x:t,y:i}=r[e];n.emplaceBack(t,i),o.emplaceBack(e)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(n,Re.aP.members),this._tileDebugSegments=Re.aB.simpleSegment(0,0,n.length,o.length)}}_makeTileBoundsBuffers(i,r){if(!this._tileBoundsBuffer&&r&&"mercator"!==r.name){var n=Re.aM(Ut,this.tileID.canonical,this.tileTransform)[0];let e,t;if(this.isRaster){const i=function(i,r){const n=Re.as(i,r),o=Math.pow(2,i.z);for(let t=0;t<33;t++)for(let e=0;e<33;e++){const s=Re.at((i.x+(e+Ke(e))/32)/o),c=Re.au((i.y+(t+Ke(t))/32)/o),h=r.project(s,c),u=33*t+e;_[2*u+0]=Math.round((h.x*n.scale-n.x)*Re.V),_[2*u+1]=Math.round((h.y*n.scale-n.y)*Re.V)}y.fill(0),Ye.fill(0);for(let e=2045;0<=e;e--){const i=4*e,r=g[0+i],n=g[1+i],o=g[2+i],a=g[3+i],l=r+o>>1,s=n+a>>1,c=l+s-n,h=s+r-l,t=33*n+r,d=33*a+o,p=33*s+l,f=16<=Math.hypot((_[2*t+0]+_[2*d+0])/2-_[2*p+0],(_[2*t+1]+_[2*d+1])/2-_[2*p+1]);y[p]=y[p]||(f?1:0),e<1022&&(y[p]=y[p]||y[33*(n+h>>1)+(r+c>>1)]||y[33*(a+h>>1)+(o+c>>1)])}const a=new Re.av,l=new Re.aw;let s=0;function c(e,t){var i=33*t+e;return 0===Ye[i]&&(a.emplaceBack(_[2*i+0],_[2*i+1],e*Re.V/32,t*Re.V/32),Ye[i]=++s),Ye[i]-1}function h(e,t,i,r,n,o){const a=e+i>>1,s=t+r>>1;if(1<Math.abs(e-n)+Math.abs(t-o)&&y[33*s+a])h(n,o,e,t,a,s),h(i,r,n,o,a,s);else{const a=c(e,t),h=c(i,r),s=c(n,o);l.emplaceBack(a,h,s)}}return h(0,0,32,32,32,0),h(32,32,0,0,0,32),{vertices:a,indices:l}}(this.tileID.canonical,r);e=i.vertices,t=i.indices}else{e=new Re.av,t=new Re.aw;for(const{x:Re,y:i}of n)e.emplaceBack(Re,i,0,0);const i=Re.aQ(e.int16,void 0,4);for(let e=0;e<i.length;e+=3)t.emplaceBack(i[e],i[e+1],i[e+2])}this._tileBoundsBuffer=i.createVertexBuffer(e,Re.aR.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(t),this._tileBoundsSegments=Re.aB.simpleSegment(0,0,e.length,t.length)}}_makeGlobeTileDebugBuffers(t,i){var r=i.projection;if(r&&"globe"===r.name&&!i.freezeTileCoverage){var r=this.tileID.canonical,n=Re.aS(r,i),n=Re.aT(n),o=Re.S(i.zoom);let e;0<o&&(e=Re.a6.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,i,n,e,o),this._makeGlobeTileDebugTextBuffer(t,r,i,n,e,o)}}_globePoint(t,i,r,n,o,a,s){let l=Re.aU(t,i,r);if(a){const o=1<<r.z,c=Re.a5(n.center.lng),h=Re.ae(n.center.lat),u=(r.x+.5)/o-c;let e=0;.5<u?e=-1:u<-.5&&(e=1);t=(t/Re.V+r.x)/o+e,i=(i/Re.V+r.y)/o,t=(t-c)*n._pixelsPerMercatorPixel+c,i=(i-h)*n._pixelsPerMercatorPixel+h,r=[t*n.worldSize,i*n.worldSize,0];Re.N.transformMat4(r,r,a),l=Re.aV(l,r,s)}return Re.N.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(e,c,h,u,d,p){const f=new Re.aN,m=new Re.aO,g=new Re.aW,t=(t,i,e,r,n)=>{var o=(e-t)/(n-1),a=(r-i)/(n-1),s=f.length;for(let e=0;e<n;e++){const r=t+e*o,n=i+e*a;f.emplaceBack(r,n);var l=this._globePoint(r,n,c,h,u,d,p);g.emplaceBack(l[0],l[1],l[2]),m.emplaceBack(s+e)}},i=Re.V;t(0,0,i,0,16),t(i,0,i,i,16),t(i,i,0,i,16),t(0,i,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(f,Re.aP.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(g,Re.aX.members),this._tileDebugSegments=Re.aB.simpleSegment(0,0,f.length,m.length)}_makeGlobeTileDebugTextBuffer(t,i,r,n,o,a){const s=Re.V/4,l=new Re.aN,c=new Re.aw,h=new Re.aW,u=25;c.reserve(32),l.reserve(u),h.reserve(u);var d=(e,t)=>u*e+t;for(let e=0;e<u;e++){const t=e*s;for(let e=0;e<u;e++){const c=e*s,u=(l.emplaceBack(c,t),this._globePoint(c,t,i,r,n,o,a));h.emplaceBack(u[0],u[1],u[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=d(t,e),r=d(t,e+1),n=d(t+1,e),o=d(t+1,e+1);c.emplaceBack(i,r,n),c.emplaceBack(n,r,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,Re.aP.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(h,Re.aX.members),this._tileDebugTextSegments=Re.aB.simpleSegment(0,0,u,32)}destroy(e=!1){for(const Re in this.buckets)this.buckets[Re].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Re.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function jt(e,t,i,r){if((t=new Vt[t.type](e,t,i,r)).id!==e)throw new Error(`Expected Source id to be ${e} instead of `+t.id);return Re.aY(["load","abort","unload","serialize","prepare"],t),t}const Vt={vector:Ze,raster:$e,"raster-dem":class extends $e{constructor(e,t,i,r){super(e,t,i,r),this.type="raster-dem",this.maxzoom=22,this._options=Re.e({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(n,o){var e=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function a(e,t){e&&(n.state="errored",o(e)),t&&(n.dem=t,n.dem.onDeserialize(),n.needsHillshadePrepare=!0,n.needsDEMTextureUpload=!0,n.state="loaded",o(null))}n.request=Re.d(this.map._requestManager.transformRequest(e,Re.R.Tile),function(e,t,i,r){if(delete n.request,n.aborted)n.state="unloaded",o(null);else if(e)n.state="errored",o(e);else if(t){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:i,expires:r});const o=ImageBitmap&&t instanceof ImageBitmap&&Re.ak(),e=1-(t.width-Re.al(t.width))/2;e<1||n.neighboringTiles||(n.neighboringTiles=this._getNeighboringTiles(n.tileID));i=o?t:Re.f.getImageData(t,e),r={uid:n.uid,coord:n.tileID,source:this.id,scope:this.scope,rawImageData:i,encoding:this.encoding,padding:e};n.actor&&"expired"!==n.state||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",r,a.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){var t=e.canonical,i=Math.pow(2,t.z),r=(t.x-1+i)%i,n=0===t.x?e.wrap-1:e.wrap,o=(t.x+1+i)%i,a=t.x+1===i?e.wrap+1:e.wrap,s={};return s[new Re.am(e.overscaledZ,n,t.z,r,t.y).key]={backfilled:!1},s[new Re.am(e.overscaledZ,a,t.z,o,t.y).key]={backfilled:!1},0<t.y&&(s[new Re.am(e.overscaledZ,n,t.z,r,t.y-1).key]={backfilled:!1},s[new Re.am(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},s[new Re.am(e.overscaledZ,a,t.z,o,t.y-1).key]={backfilled:!1}),t.y+1<i&&(s[new Re.am(e.overscaledZ,n,t.z,r,t.y+1).key]={backfilled:!1},s[new Re.am(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},s[new Re.am(e.overscaledZ,a,t.z,o,t.y+1).key]={backfilled:!1}),s}},"raster-array":Xe,geojson:class extends Re.E{constructor(e,t,i,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=t.data,this._options=Re.e({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;e=Re.V/this.tileSize;this.workerOptions=Re.e({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*e,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*e,extent:Re.V,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:Re.V,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*e,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(){var e,t;this._pendingLoad?this._coalesce=!0:(this.fire(new Re.b("dataloading",{dataType:"source"})),this._loaded=!1,(e=Re.e({},this.workerOptions)).scope=this.scope,"string"==typeof(t=this._data)?(e.request=this.map._requestManager.transformRequest(Re.f.resolveURL(t),Re.R.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(this.type+".loadData",e,(e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new Re.a(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new Re.b("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(i,r){const n=i.actor?"reloadTile":"loadTile";i.actor=this.actor;var e={type:this.type,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Re.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};i.request=this.actor.send(n,e,(e,t)=>(delete i.request,i.destroy(),i.aborted?r(null):e?r(e):(i.loadVectorData(t,this.map.painter,"reloadTile"==n),r(null))),void 0,"loadTile"==n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Re.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Re.ap{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;var e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,Re.R.Source).url);Re.aq(this.urls,(e,t)=>{this._loaded=!0,e?this.fire(new Re.a(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){var t;this.video&&(e<(t=this.video.seekable).start(0)||e>t.end(0)?this.fire(new Re.a(new p("sources."+this.id,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e)}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){var e,t;0===Object.keys(this.tiles).length||this.video.readyState<2||(t=(e=this.map.painter.context).gl,this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new Re.T(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Re.ap,model:class extends Re.E{constructor(e,t,i,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){var e=[];for(const t in this._options.models){const i=this._options.models[t],r=Re.l(this.map._requestManager.transformRequest(i.uri,Re.R.Model).url).then(e=>{e&&(e=Re.c(e),(e=new Re.M(t,i.position,i.orientation,e)).computeBoundsAndApplyParent(),this.models.push(e))}).catch(e=>{this.fire(new Re.a(new Error(`Could not load model ${t} from ${i.uri}: `+e.message)))});e.push(r)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Re.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new Re.a(new Error("Could not load models: "+e.message)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Re.E{constructor(e,t,i,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}load(i){this._loaded=!1,this.fire(new Re.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=We(this._options,this.map._requestManager,r,n,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?(r&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: "+r),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: "+n),this.fire(new Re.a(e))):t&&(Re.e(this,t),t.bounds&&(this.tileBounds=new He(t.bounds,this.minzoom,this.maxzoom)),Re.aj(t.tiles,this.map._requestManager._customAccessToken),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(e)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(i,r){var e=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),e={request:this.map._requestManager.transformRequest(e,Re.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(i.actor&&"expired"!==i.state)if("loading"===i.state)i.reloadCallback=r;else if(i.buckets){const Re=Object.values(i.buckets);for(const i of Re)i.dirty=!0;void(i.state="loaded")}else i.request=i.actor.send("reloadTile",e,t.bind(this));else i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",e,t.bind(this),void 0,!0);function t(e,t){return i.aborted?r(null):e&&404!==e.status?r(e):(t&&(t.resourceTiming&&(i.resourceTiming=t.resourceTiming),this.map._refreshExpiredTiles&&i.setExpiryData(t),i.buckets={...i.buckets,...t.buckets},t.featureIndex)&&(i.latestFeatureIndex=t.featureIndex),i.state="loaded",void r(null))}}serialize(){return Re.e({},this._options)}},canvas:class extends Re.ap{constructor(e,t,i,r){super(e,t,i,r),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new Re.a(new p("sources."+e,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Re.a(new p("sources."+e,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new Re.a(new p("sources."+e,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof HTMLCanvasElement||this.fire(new Re.a(new p("sources."+e,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Re.a(new p("sources."+e,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Re.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;var t;this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||0!==Object.keys(this.tiles).length&&(t=this.map.painter.context,this.texture?!e&&!this._playing||this.texture instanceof Re.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Re.T(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Re.E{constructor(e,t,i,r){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Re.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Re.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new He(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Re.e(this,Re.ac(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Re.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Re.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Re.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Re.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){var t,i,r;return this._implementation.hasTile?({x:t,y:i,z:r}=e.canonical,this._implementation.hasTile({x:t,y:i,z:r})):!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(i,r){const{x:e,y:t,z:n}=i.tileID.canonical,o=new AbortController;i.request=Promise.resolve(this._implementation.loadTile({x:e,y:t,z:n},{signal:o.signal})).then(function(e){return delete i.request,i.aborted?(i.state="unloaded",r(null)):void 0===e?(i.state="errored",r(null)):null===e?(this.loadTileData(i,{width:this.tileSize,height:this.tileSize,data:null}),i.state="loaded",r(null)):(t=e)instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof ImageBitmap||t instanceof HTMLImageElement?(this.loadTileData(i,e),i.state="loaded",void r(null)):(i.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var t}.bind(this)).catch(e=>{20!==e.code&&(i.state="errored",r(e))}),i.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof Re.T?(e.destroy(!0),e.texture&&e.texture instanceof Re.T&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:Re,y:t,z:i}=e.tileID.canonical;this._implementation.unloadTile({x:Re,y:t,z:i})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){var e=Re.ag(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Re.b("data",{dataType:"source",sourceDataType:"content"}))}}};function Gt(i,e,t,r,n,o,a,s=!1){var l,c,h,a=i.tilesIn(r,a,s),u=(a.sort(qt),[]);for(const r of a)u.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,t,i._state,r,n,o,(l=i.transform,c=r.tile.tileID,h=void 0,h=Re.a6.identity([]),Re.a6.scale(h,h,[.5*l.width,.5*-l.height,1]),Re.a6.translate(h,h,[1,-1,0]),Re.a6.multiply(h,h,l.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)),s)});var d=function(e){const t={},i={};for(const a of e){const e=a.queryResults,s=a.wrappedTileID,l=i[s]=i[s]||{};for(const i in e){var r=e[i],n=l[i]=l[i]||{},o=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,o.push(e))}}return t}(u);for(const e in d)d[e].forEach(e=>{var e=e.feature,t=e.layer;t&&"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(e.source=t.source,t["source-layer"]&&(e.sourceLayer=t["source-layer"]),e.state=void 0!==e.id?i.getFeatureState(t["source-layer"],e.id):{})});return d}function qt(e,t){e=e.tileID,t=t.tileID;return e.overscaledZ-t.overscaledZ||e.canonical.y-t.canonical.y||e.wrap-t.wrap||e.canonical.x-t.canonical.x}class Wt extends M{constructor(e,t,i,r,n){super(e,t,i,r,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,t){var i=t.context,r=i.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture&&this.texture instanceof Re.T?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Re.T(i,e,r.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,o){const a=this._mrt=new Re.aZ(30),t=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Re.a_(t,(t,i,r,n)=>{if(t)o(t);else try{const t=a.getHeaderLength(i);if(t>e)this.request=this.fetchHeader(t,o);else{a.parseHeader(i),this._isHeaderLoaded=!0;let e=0;for(const t of Object.values(a.layers))e=Math.max(e,t.dataIndex[t.dataIndex.length-1].last_byte);i.byteLength>=e&&(this.entireBuffer=i),o(null,this.entireBuffer||i,r,n)}}catch(t){o(t)}}),this.request}fetchBand(i,n,o){var e=this._mrt;if(this._isHeaderLoaded&&e){const a=this.actor;if(a){let r;const s=(e,t)=>{r.complete(e,t),e?o(e):(this.updateTextureDescriptor(i,n),o(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(e,t)=>{if(e)return o(e);const i=a.send("decodeRasterArray",{buffer:t,task:r},s,void 0,!0);this._workQueue.push(()=>{i&&i.cancel(),r.cancel()})},c=e.getLayer(i);if(c)if(c.hasDataForBand(n))this.updateTextureDescriptor(i,n),o(null,this.textureDescriptor?this.textureDescriptor.img:null);else{var t=c.getDataRange([n]);if(!(r=e.createDecodingTask(t))||r.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(t.firstByte,t.lastByte+1));else{const i=Object.assign({},this.requestParams,{headers:{Range:`bytes=${t.firstByte}-`+t.lastByte}}),n=Re.a_(i,l);this._fetchQueue.push(()=>{n.cancel(),r.cancel()})}else o(null)}else o(new Error(`Unknown sourceLayer "${i}"`))}else o(new Error("Can't fetch tile band without an actor"))}else o(new Error("Tile header is not ready"))}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(e,t){var i,r,n,o,a,s,l;this._mrt&&(i=this._mrt.getLayer(e))&&i.hasBand(t)&&i.hasDataForBand(t)&&({bytes:s,tileSize:r,buffer:n,offset:o,scale:a}=i.getBandView(t),s={data:s,width:s=r+2*n,height:s},(l=this.texture)&&l instanceof Re.T&&l.update(s,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:t,img:s,buffer:n,offset:o,tileSize:r,format:i.pixelFormat,mix:[a,256*a,65536*a,16777216*a]})}}class Ht{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){var r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout(()=>{this.remove(e,n)},i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){e=this.data[e];return e?e[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){var i;return this.has(e)&&(e=e.wrapped().key,t=void 0===t?0:this.data[e].indexOf(t),i=this.data[e][t],this.data[e].splice(t,1),i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.onRemove(i.value),this.order.splice(this.order.indexOf(e),1)),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){var t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class v extends Re.E{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform)&&this.update(this.transform)}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Ht(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new W,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=(void 0===this._minTileCacheSize&&e?e:this)._minTileCacheSize,this._maxTileCacheSize=(void 0===this._maxTileCacheSize&&e?e:this)._maxTileCacheSize}loaded(){if(!this._sourceErrored){if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){var e=this._tiles[t];if("errored"!==e.state&&("loaded"!==e.state||!e.bucketsLoaded()))return!1}}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){var e;this._paused&&(e=this._shouldReloadOnResume,this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform)&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){var t=this._tiles[i];t.upload(e),t.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Re.a$(this._tiles).map(e=>e.tileID).sort(Zt).map(e=>e.key)}getRenderableIds(e,t){var i=[];for(const Re in this._tiles)this._isIdRenderable(+Re,e,t)&&i.push(this._tiles[Re]);return e?i.sort((e,t)=>{var e=e.tileID,t=t.tileID,i=new Re.P(e.canonical.x,e.canonical.y)._rotate(this.transform.angle),r=new Re.P(t.canonical.x,t.canonical.y)._rotate(this.transform.angle);return e.overscaledZ-t.overscaledZ||r.y-i.y||r.x-i.x}).map(e=>e.tileID.key):i.map(e=>e.tileID).sort(Zt).map(e=>e.key)}hasRenderableParent(e){e=this.findLoadedParent(e,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(e,t,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){var i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,r){if(r)if(e.state="errored",404!==r.status)this._source.fire(new Re.a(r,{tile:e}));else if(e.tileID.key in this._loadedParentTiles)if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const Re=this.map.painter.terrain;this.update(this.transform,Re.getScaledDemTileSize(),!0),Re.resetTileLookupCache(this.id)}else this.update(this.transform);else this._source.fire(new Re.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));else e.timeAdded=Re.f.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Re.b("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let e=0;e<i.length;e++){var r=i[e];if(t.neighboringTiles&&t.neighboringTiles[r]){const i=this.getTileByID(r);n(t,i),n(i,t)}}function n(t,i){if(t.dem&&!t.dem.borderReady){t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let e=i.tileID.canonical.x-t.tileID.canonical.x;var r=i.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=i.tileID.key;0===e&&0==r||1<Math.abs(r)||(1<Math.abs(e)&&(1===Math.abs(e+n)?e+=n:1===Math.abs(e-n)&&(e-=n)),i.dem&&t.dem&&(t.dem.backfillBorder(i.dem,e,r),t.neighboringTiles)&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0))}}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(r,n,e,o){for(const t in this._tiles){let i=this._tiles[t];if(!(o[t]||!i.hasData()||i.tileID.overscaledZ<=n||i.tileID.overscaledZ>e)){let e=i.tileID;for(;i&&i.tileID.overscaledZ>n+1;){const r=i.tileID.scaledTo(i.tileID.overscaledZ-1);(i=this._tiles[r.key])&&i.hasData()&&(e=r)}let t=e;for(;t.overscaledZ>n;)if(r[(t=t.scaledTo(t.overscaledZ-1)).key]){o[e.key]=e;break}}}}findLoadedParent(t,i){var e;if(t.key in this._loadedParentTiles)return(e=this._loadedParentTiles[t.key])&&e.tileID.overscaledZ>=i?e:null;for(let e=t.overscaledZ-1;e>=i;e--){const i=t.scaledTo(e),r=this._getLoadedTile(i);if(r)return r}}_getLoadedTile(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey((this._source.reparseOverscaled?e.wrapped():e.canonical).key)}updateCacheSize(e,t){t=t||this._source.tileSize;var i=Math.ceil(e.width/t)+1,e=Math.ceil(e.height/t)+1,t=Math.floor(i*e*5),i="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,t):t,e="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(e)}handleWrapJump(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,i,r,n){if(this.transform=t,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||r)){let e;if(this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)e=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(e=>new Re.am(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y));else if(0!==this.tileCoverLift){const n=t.clone();n.tileCoverLift=this.tileCoverLift,e=n.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===t.projection.name&&(e.push(new Re.am(1,0,1,0,0)),e.push(new Re.am(1,0,1,1,0)),e.push(new Re.am(1,0,1,0,1)),e.push(new Re.am(1,0,1,1,1)))}else e=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(e=e.filter(e=>this._source.hasTile(e)));else e=[];if(0<e.length&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!$t(this._source.type)){const Re=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),o=Math.min(Re,this._source.maxzoom),a=t.extendTileCoverForShadows(e,n,o);for(const Re of a)this._shadowCasterTiles[Re.key]=!0,e.push(Re)}const o=this._updateRetainedTiles(e);if($t(this._source.type)&&0!==e.length){const t={},i={},r=Object.keys(o);for(const n of r){const r=o[n],e=this._tiles[n];if(e&&!(e.fadeEndTime&&e.fadeEndTime<=Re.f.now())){const a=this.findLoadedParent(r,Math.max(r.overscaledZ-v.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),i[n]=r}}const n=e[e.length-1].overscaledZ;for(const Re in this._tiles){const t=this._tiles[Re];if(!o[Re]&&t.hasData()){let e=t.tileID;for(;e.overscaledZ>n;){e=e.scaledTo(e.overscaledZ-1);const n=this._tiles[e.key];if(n&&n.hasData()&&i[e.key]){o[Re]=t.tileID;break}}}}for(const Re in t)o[Re]||(this._coveredTiles[Re]=!0,o[Re]=t[Re])}for(const Re in o)this._tiles[Re].clearFadeHold();const a=Re.b0(this._tiles,o);for(const Re of a){const t=this._tiles[Re];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+Re)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){var r={};if(0!==e.length){const n={},o=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),t=e[0].overscaledZ,a=Math.max(t-v.maxOverzooming,this._source.minzoom),i=Math.max(t+v.maxUnderzooming,this._source.minzoom),s={};for(const n of e){const e=this._addTile(n);r[n.key]=n,e.hasData()||o<this._source.maxzoom&&(s[n.key]=n)}this._retainLoadedChildren(s,o,i,r);for(const o of e){let i=this._tiles[o.key];if(!i.hasData()){if(o.canonical.z>=this._source.maxzoom){const e=o.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){r[e.key]=e;continue}}else{const e=o.children(this._source.maxzoom);if(r[e[0].key]&&r[e[1].key]&&r[e[2].key]&&r[e[3].key])continue}let t=i.wasRequested();for(let e=o.overscaledZ-1;e>=a;--e){const a=o.scaledTo(e);if(n[a.key])break;if(n[a.key]=!0,(i=!(i=this.getTile(a))&&t?this._addTile(a):i)&&(r[a.key]=a,t=i.wasRequested(),i.hasData()))break}}}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){var i=[];let e,t=this._tiles[n].tileID;for(;0<t.overscaledZ;){if(t.key in this._loadedParentTiles){e=this._loadedParentTiles[t.key];break}i.push(t.key);var r=t.scaledTo(t.overscaledZ-1);if(e=this._getLoadedTile(r))break;t=r}for(const o of i)this._loadedParentTiles[o]=e}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;(t=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key])&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t));const i=Boolean(t);if(!i){const Re=this.map?this.map.painter:null,i=this._source.tileSize*e.overscaleFactor();t=new("raster-array"===this._source.type?Wt:M)(e,i,this.transform.tileZoom,Re,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Re.b("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);t=t.getExpiryTimeout();t&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},t))}_removeTile(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),0<t.uses||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,r){var n=[],o=this.transform;if(o){var a="globe"===o.projection.name,s=Re.a5(o.center.lng);for(const e in this._tiles){var l=this._tiles[e];if(r&&l.clearQueryDebugViz(),!l.holdingForFade()){let e;if(a){const t=l.tileID.canonical;if(0===t.z){const i=[Math.abs(Re.aa(s,...Xt(t,-1))-s),Math.abs(Re.aa(s,...Xt(t,1))-s)];e=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(Re.aa(s,...Xt(t,-1))-s),Math.abs(Re.aa(s,...Xt(t,0))-s),Math.abs(Re.aa(s,...Xt(t,1))-s)];e=[i.indexOf(Math.min(...i))-1]}}else e=[0];for(const Re of e){const r=t.containsTile(l,o,i,Re);r&&n.push(r)}}}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){var t=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),i="globe"===this.transform.projection.name;for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped()),e.expandedProjMatrix=i?this.transform.calculateProjMatrix(e.toUnwrapped(),!1,!0):e.projMatrix;return t}sortCoordinatesByDistance(e){const t=e.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),n={};for(const e of t){const t=1/(1<<e.canonical.z);n[e.key]=((e.canonical.x+.5)*t+e.wrap-i[0])*r[0]+((e.canonical.y+.5)*t-i[1])*r[1]-i[2]*r[2]}return t.sort((e,t)=>n[e.key]-n[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if($t(this._source.type))for(const t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=Re.f.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){e=this._tiles[e];e&&e.setDependencies(t,i)}reloadTilesForDependencies(t,i){for(const e in this._tiles)this._tiles[e].hasDependency(t,i)&&this._reloadTile(+e,"reloading");this._cache.filter(e=>!e.hasDependency(t,i))}_preloadTiles(e,t){if(this._sourceLoaded){var i=new Map,r=Array.isArray(e)?e:[e],n=this.map.painter.terrain,o=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const Re of r){const e=Re.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Re of e)i.set(Re.key,Re);this.usedForTerrain&&Re.updateElevation(!1)}n=Array.from(i.values());Re.b1(n,(e,t)=>{const i=new M(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)})},t)}else{const Re=()=>{this._sourceLoaded&&(this._source.off("data",Re),this._preloadTiles(e,t))};void this._source.on("data",Re)}}}function Zt(e,t){var i=Math.abs(2*e.wrap)-(e.wrap<0),r=Math.abs(2*t.wrap)-(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function $t(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Xt(e,t){var i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}v.maxOverzooming=10,v.maxUnderzooming=3;class Yt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const i in this.style._mergedLayers){var e,t=this.style._mergedLayers[i];("fill-extrusion"===t.type||"model"===t.type&&(e=this.style.getLayerSource(t))&&"batched-model"===e.type)&&this.layers.push({layer:t,visible:!1,visibilityChanged:!1})}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){var i=r.layer;let e=!1;"fill-extrusion"===i.type?e=!i.isHidden(t)&&0<i.paint.get("fill-extrusion-opacity"):"model"===i.type&&(e=!i.isHidden(t)&&0<i.paint.get("model-opacity")),this.layersGotHidden=this.layersGotHidden||!e&&r.visible,r.visible=e}}updateZOffset(i,r){this.currentBuildingBuckets=[];for(const i of this.layers){const n=i.layer,s=this.style.getLayerSourceCache(n);let e=1,t=("fill-extrusion"===n.type&&(e=i.visible?n.paint.get("fill-extrusion-vertical-scale"):0),s?s.getTile(r):null);if(!t&&s&&r.canonical.z>s.getSource().minzoom){let e=r.scaledTo(Math.min(s.getSource().maxzoom,r.overscaledZ-1));for(;e.overscaledZ>=s.getSource().minzoom&&!(t=s.getTile(e))&&0!==e.overscaledZ;)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:t?t.getBucket(n):null,tileID:t?t.tileID:r,verticalScale:e})}let n=i.hasAnyZOffset=!1;for(let e=0;e<i.symbolInstances.length;e++){var t=i.symbolInstances.get(e),o=t.zOffset,a=this._getHeightAtTileOffset(r,t.tileAnchorX,t.tileAnchorY);t.zOffset=a!==Number.NEGATIVE_INFINITY?a:o,n||o===t.zOffset||(n=!0),i.hasAnyZOffset||0===t.zOffset||(i.hasAnyZOffset=!0)}n&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,t,i,r){let n=t,o=i;var a;return e.canonical.z!==r.canonical.z&&(r=r.canonical,a=1/(1<<e.canonical.z-r.z),n=(t+e.canonical.x*Re.V)*a-r.x*Re.V|0,o=(i+e.canonical.y*Re.V)*a-r.y*Re.V|0),{tileX:n,tileY:o}}_getHeightAtTileOffset(t,i,r){let n,o;for(let e=0;e<this.layers.length;++e){var a,s,l,c;"fill-extrusion"===this.layers[e].layer.type&&({bucket:a,tileID:l,verticalScale:s}=this.currentBuildingBuckets[e],a&&({tileX:l,tileY:c}=this._mapCoordToOverlappingTile(t,i,r,l),c=a.getHeightAtTileCoord(l,c))&&void 0!==c.height)&&(c.hidden?n=c.height:o=Math.max(c.height*s,o||0))}if(void 0!==o)return o;for(let e=0;e<this.layers.length;++e){var h=this.layers[e];if("model"===h.layer.type&&h.visible){var{bucket:h,tileID:u}=this.currentBuildingBuckets[e];if(h){var{tileX:u,tileY:d}=this._mapCoordToOverlappingTile(t,i,r,u),h=h.getHeightAtTileCoord(u,d);if(h&&!h.hidden)return void 0===h.height&&void 0!==n?Math.min(h.maxHeight,n)*h.verticalScale:(h.height||0)*h.verticalScale}}}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Kt(t){t=t.slice();var i=Object.create(null);for(let e=0;e<t.length;e++)i[t[e].id]=t[e];for(let e=0;e<t.length;e++)"ref"in t[e]&&(t[e]=function(e,t){const i={};for(const Re in e)"ref"!==Re&&(i[Re]=e[Re]);return Re.b2.forEach(e=>{e in t&&(i[e]=t[e])}),i}(t[e],i[t[e].ref]));return t}const D={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Jt(e,t,i){i.push({command:D.addSource,args:[e,t[e]]})}function Qt(e,t,i){t.push({command:D.removeSource,args:[e]}),i[e]=!0}function ei(e,t,i,r,n,o){let a;for(a in t=t||{},e=e||{})!e.hasOwnProperty(a)||L(e[a],t[a])||i.push({command:o,args:[r,a,t[a],n]});for(a in t)!t.hasOwnProperty(a)||e.hasOwnProperty(a)||L(e[a],t[a])||i.push({command:o,args:[r,a,t[a],n]})}function ti(e){return e.id}function ii(e,t){return e[t.id]=t,e}class ri{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=Re.aa(e,0,1);let t=1,i=this._distances[t];for(var r=e*this.paddedLength+this.padding;i<r&&t<this._distances.length;)i=this._distances[++t];var e=t-1,n=this._distances[e],o=i-n,n=0<o?(r-n)/o:0;return this.points[e].mult(1-n).add(this.points[t].mult(n))}}class ni{constructor(e,t,i){var r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,i,r,n,o){this.circleCells[n].push(o)}_query(e,t,i,r,n,o){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];var a=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return o?a.filter(o):a}return this._forEachCell(e,t,i,r,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?0<a.length:a}_queryCircle(e,t,i,r,n){var o=e-i,a=e+i,s=t-i,l=t+i;return a<0||o>this.width||l<0||s>this.height?!r&&[]:(this._forEachCell(o,s,a,l,this._queryCellCircle,o=[],{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?0<o.length:o)}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,o,a,s){const l=a.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=n[2+c]&&t<=n[3+c]&&i>=n[0+c]&&r>=n[1+c]&&(!s||s(this.boxKeys[h]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[h],x1:n[c],y1:n[1+c],x2:n[2+c],y2:n[3+c]})}}}const h=this.circleCells[n];if(null!==h){const n=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(n[h],n[1+h],n[2+h],e,t,i,r)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return o.push(!0),!0;{const e=n[h],t=n[1+h],i=n[2+h];o.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,o,a,s){var l=a.circle,c=a.seenUids,a=this.boxCells[n];if(null!==a){const e=this.bboxes;for(const t of a)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[0+i],e[1+i],e[2+i],e[3+i])&&(!s||s(this.boxKeys[t])))return o.push(!0),!0}}a=this.circleCells[n];if(null!==a){const e=this.circles;for(const t of a)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[1+i],e[2+i],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(i,r,n,o,a,s,l,c){var e=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r),u=this._convertToXCellCoord(n),d=this._convertToYCellCoord(o);for(let t=e;t<=u;t++)for(let e=h;e<=d;e++)if(a.call(this,i,r,n,o,this.xCellCount*e+t,s,l,c))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,o){r-=e,e=n-t,n=i+o;return r*r+e*e<n*n}_circleAndRectCollide(e,t,i,r,n,o,a){o=(o-r)/2,e=Math.abs(e-(r+o));return!(o+i<e||(r=(a-n)/2)+i<(a=Math.abs(t-(n+r)))||!(e<=o||a<=r||(t=e-o)*t+(n=a-r)*n<=i*i))}}const R={unknown:0,flipRequired:1,flipNotRequired:2},oi=Math.tan(85*Math.PI/180);function ai(e,t,i,r,n,o,a){var s=Re.a6.create();if(i)if("globe"===o.name){const e=Re.b3(n,t);Re.a6.multiply(s,s,e)}else{const e=Re.b4.invert([],a);s[0]=e[0],s[1]=e[1],s[4]=e[2],s[5]=e[3],r||Re.a6.rotateZ(s,s,n.angle)}else Re.a6.multiply(s,n.labelPlaneMatrix,e);return s}function si(e,t,i,r,n,o,a){e=ai(e,t,i,r,n,o,a);return"globe"===o.name&&i||(e[2]=e[6]=e[10]=e[14]=0),e}function li(e,t,i,r,n,o,a){if(i){if("globe"===o.name)return t=ai(e,t,i,r,n,o,a),Re.a6.invert(t,t),Re.a6.multiply(t,e,t),t;{const t=Re.a6.clone(e),i=Re.a6.identity([]);return i[0]=a[0],i[1]=a[1],i[4]=a[2],i[5]=a[3],Re.a6.multiply(t,t,i),r||Re.a6.rotateZ(t,t,-n.angle),t}}return n.glCoordMatrix}function O(e,t,i,r){e=[e,t,i,1],i?Re.a7.transformMat4(e,e,r):yi(e,e,r),t=e[3];return e[0]/=t,e[1]/=t,e[2]/=t,e}function ci(e,t){return Math.min(.5+e/t*.5,1.5)}function hi(r,n,o,e,a,s,l,c,h,u){const d=o.transform,p=e?r.textSizeData:r.iconSizeData,f=Re.b5(p,o.transform.zoom),m="globe"===d.projection.name,g=[256/o.width*2+1,256/o.height*2+1],_=(e?r.text:r.icon).dynamicLayoutVertexArray;_.clear();let y=null;m&&(y=(e?r.text:r.icon).globeExtVertexArray);var v=r.lineVertexArray,t=(e?r.text:r.icon).placedSymbolArray,x=o.transform.width/o.transform.height;let i,b=!1;for(let e=0;e<t.length;e++){const m=t.get(e),{numGlyphs:C,writingMode:M}=m;if(M!==Re.b6.vertical||b||i===Re.b6.horizontal||(b=!0),i=M,!m.hidden&&M!==Re.b6.vertical||b){b=!1;var w=new Re.P(m.tileAnchorX,m.tileAnchorY);let{x:e,y:t,z:i}=d.projection.projectTilePoint(w.x,w.y,u.canonical);if(h){const[Re,r,n]=h(w);e+=Re,t+=r,i+=n}var T=[e,t,i,1];if(Re.a7.transformMat4(T,T,n),E=g,S=void 0,S=(A=T)[0]/A[3],A=A[1]/A[3],S>=-E[0]&&S<=E[0]&&A>=-E[1]&&A<=E[1]){var S=T[3],A=ci(o.transform.getCameraToCenterDistance(d.projection),S),E=Re.b7(p,f,m),T=l?E/A:E*A,S=O(e,t,i,a);if(S[3]<=0)_i(C,_);else{let e={};var E=l?null:h,A=pi(m,T,!1,c,n,a,s,r.glyphOffsetArray,v,_,y,S,w,e,x,E,d.projection,u,l);b=A.useVertical,E&&A.needsFlipping&&(e={}),(A.notEnoughRoom||b||A.needsFlipping&&pi(m,T,!0,c,n,a,s,r.glyphOffsetArray,v,_,y,S,w,e,x,E,d.projection,u,l).notEnoughRoom)&&_i(C,_)}}else _i(C,_)}else _i(C,_)}e?(r.text.dynamicLayoutVertexBuffer.updateData(_),y&&r.text.globeExtVertexBuffer&&r.text.globeExtVertexBuffer.updateData(y)):(r.icon.dynamicLayoutVertexBuffer.updateData(_),y&&r.icon.globeExtVertexBuffer&&r.icon.globeExtVertexBuffer.updateData(y))}function ui(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m){var{lineStartIndex:g,glyphStartIndex:_,segment:y}=s,v=_+s.numGlyphs,s=g+s.lineLength,_=t.getoffsetX(_),t=t.getoffsetX(v-1),v=gi(e*_,i,r,n,o,a,y,g,s,l,c,h,u,d,!0,p,f,m);return v&&(_=gi(e*t,i,r,n,o,a,y,g,s,l,c,h,u,d,!0,p,f,m))?{first:v,last:_}:null}function di(e,t,i,r){return e===Re.b6.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:e===Re.b6.vertical?0<r?{needsFlipping:!0}:null:t!==R.unknown&&(0===i||Math.abs(r/i)>oi)?t===R.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function pi(t,e,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y){var v=e/24,x=t.lineOffsetX*v,b=t.lineOffsetY*v,{lineStartIndex:w,glyphStartIndex:T,numGlyphs:S,segment:A,writingMode:E,flipState:C}=t,M=w+t.lineLength,I=e=>{if(h){const[t,i,r]=e.up,n=c.length;Re.b8(h,n+0,t,i,r),Re.b8(h,n+1,t,i,r),Re.b8(h,n+2,t,i,r),Re.b8(h,n+3,t,i,r)}const[t,i,r]=e.point;Re.b9(c,t,i,r,e.angle)};if(1<S){const Re=ui(v,s,x,b,i,u,d,t,l,o,p,m,!1,g,_,y);if(!Re)return{notEnoughRoom:!0};if(r&&!i){var[e,P,L]=Re.first.point,[D,k,z]=Re.last.point;[e,P]=O(e,P,L,a),[D,k]=O(D,k,z,a);const l=di(E,C,(D-e)*f,k-P);if(t.flipState=l&&l.needsFlipping?R.flipRequired:R.flipNotRequired,l)return l}I(Re.first);for(let e=T+1;e<T+S-1;e++){const t=gi(v*s.getoffsetX(e),x,b,i,u,d,A,w,M,l,o,p,m,!1,!1,g,_,y);if(!t)return c.length-=4*(e-T),{notEnoughRoom:!0};I(t)}I(Re.last)}else{if(r&&!i){const e=O(d.x,d.y,0,n),i=w+A+1,r=new Re.P(l.getx(i),l.gety(i)),o=O(r.x,r.y,0,n),a=0<o[3]?o:mi(d,r,e,1,n,void 0,g,_.canonical),s=di(E,C,(a[0]-e[0])*f,a[1]-e[1]);if(t.flipState=s&&s.needsFlipping?R.flipRequired:R.flipNotRequired,s)return s}const e=gi(v*s.getoffsetX(T),x,b,i,u,d,A,w,M,l,o,p,m,!1,!1,g,_,y);if(!e)return{notEnoughRoom:!0};I(e)}return{}}function fi(e,t,i,r,n){var o,{x:r,y:t,z:a}=r.projectTilePoint(e.x,e.y,t);return n?([n,e,o]=n(e),O(r+n,t+e,a+o,i)):O(r,t,a,i)}function mi(e,t,i,r,n,o,a,s){t=fi(e.sub(t)._unit()._add(e),s,n,a,o);return Re.N.sub(t,i,t),Re.N.normalize(t,t),Re.N.scaleAndAdd(t,i,t,r)}function gi(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_){e=r?e-t:e+t;let y=0<e?1:-1,v=0,x=(r&&(y*=-1,v=Math.PI),y<0&&(v+=Math.PI),s+a+(0<y?0:1)|0),b=n,w=n,T=0,S=0;const A=Math.abs(e),E=[],C=[];let M=o,I=M;for(var P=()=>mi(I,M,w,A-T+1,h,d,m,g.canonical);T+S<=A;){if((x+=y)<s||x>=l)return null;if(w=b,I=M,E.push(w),p&&C.push(I),M=new Re.P(c.getx(x),c.gety(x)),!(b=u[x])){const Re=fi(M,g.canonical,h,m,d);b=0<Re[3]?u[x]=Re:P()}T+=S,S=Re.N.distance(w,b)}f&&d&&(u[x]&&(b=P(),S=Re.N.distance(w,b)),u[x]=b);t=(A-T)/S,r=M.sub(I)._mult(t)._add(I),a=Re.N.sub([],b,w),n=Re.N.scaleAndAdd([],w,a,t);let L=[0,0,1],D=a[0],k=a[1];if(_&&(0!==(L=m.upVector(g.canonical,r.x,r.y))[0]||0!==L[1]||1!==L[2])){const e=[L[2],0,-L[0]],t=Re.N.cross([],L,e);Re.N.normalize(e,e),Re.N.normalize(t,t),D=Re.N.dot(a,e),k=Re.N.dot(a,t)}if(i){const e=Re.N.cross([],L,a);Re.N.normalize(e,e),Re.N.scaleAndAdd(n,n,e,i*y)}e=v+Math.atan2(k,D);return E.push(n),p&&C.push(r),{point:n,angle:e,path:E,tilePath:C,up:L}}function _i(e,t){var i=t.length,e=i+4*e;t.resize(e),t.float32.fill(-1/0,4*i,4*e)}function yi(e,t,i){var r=t[0],t=t[1];e[0]=i[0]*r+i[4]*t+i[12],e[1]=i[1]*r+i[5]*t+i[13],e[3]=i[3]*r+i[7]*t+i[15]}class vi{constructor(e,t,i=new ni(e.width+200,e.height+200,25),r=new ni(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,r,n,o,a,s){let l=i.projectedAnchorX,c=i.projectedAnchorY,h=i.projectedAnchorZ;var u=i.elevation,d=i.tileID,p=e.getProjection();if(u&&d){const[e,t,r]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*u*n,c+=t*u*n,h+=r*u*n}e=this.projectAndGetPerspectiveRatio(a,l,c,h,i.tileID,"globe"===p.name||!!u||0<this.transform.pitch,p),d=o*e.perspectiveRatio,a=(i.x1*t+r.x-i.padding)*d+e.point.x,u=(i.y1*t+r.y-i.padding)*d+e.point.y,p=(i.x2*t+r.x+i.padding)*d+e.point.x,o=(i.y2*t+r.y+i.padding)*d+e.point.y,t=e.perspectiveRatio<=.55||e.occluded;return!this.isInsideGrid(a,u,p,o)||!n&&this.grid.hitTest(a,u,p,o,s)||t?{box:[],offscreen:!1,occluded:e.occluded}:{box:[a,u,p,o],offscreen:this.isOffscreen(a,u,p,o),occluded:!1}}placeCollisionCircles(t,i,a,s,r,l,c,h,u,d,p,f,m,g,e){const _=[],n=this.transform.elevation,o=t.getProjection(),y=n?n.getAtTileOffsetFunc(e,this.transform.center.lat,this.transform.worldSize,o):null,v=new Re.P(a.tileAnchorX,a.tileAnchorY);let{x,y:b,z:w}=o.projectTilePoint(v.x,v.y,e.canonical);if(y){const[Re,t,i]=y(v);x+=Re,b+=t,w+=i}const T="globe"===o.name,S=this.projectAndGetPerspectiveRatio(c,x,b,w,e,T||!!n||0<this.transform.pitch,o),A=S["perspectiveRatio"],E=(p?l/A:l*A)/Re.bc,C=O(x,b,w,h),M=0<S.signedDistanceFromCamera?ui(E,r,a.lineOffsetX*E,a.lineOffsetY*E,!1,C,v,a,s,h,{},n&&!p?y:null,p&&!!n,o,e,p):null;let I=!1,P=!1,L=!0;if(M&&!S.occluded){const t=.5*m*A+g,a=new Re.P(-100,-100),s=new Re.P(this.screenRightBoundary,this.screenBottomBoundary),r=new ri,{first:l,last:c}=M,h=l.path.length;let n=[];for(let e=h-1;1<=e;e--)n.push(l.path[e]);for(let e=1;e<c.path.length;e++)n.push(c.path[e]);const e=2.5*t;let o=[];if(0<(n=u&&(n=n.map(([e,t,i],r)=>O(e,t,i=y&&!T?y(r<h-1?l.tilePath[h-1-r]:c.tilePath[r-h+2])[2]:i,u))).some(e=>e[3]<=0)?[]:n).length){let e=1/0,t=-1/0,i=1/0,r=-1/0;for(const Re of n)e=Math.min(e,Re[0]),i=Math.min(i,Re[1]),t=Math.max(t,Re[0]),r=Math.max(r,Re[1]);t>=a.x&&e<=s.x&&r>=a.y&&i<=s.y&&(o=[n.map(e=>new Re.P(e[0],e[1]))],e<a.x||t>s.x||i<a.y||r>s.y)&&(o=Re.ba(o,a.x,a.y,s.x,s.y))}for(const Re of o){r.reset(Re,.25*t);var D=r.length<=.5*t?1:Math.ceil(r.paddedLength/e)+1;for(let e=0;e<D;e++){const s=e/Math.max(D-1,1),l=r.lerp(s),c=l.x+100,h=l.y+100,u=(_.push(c,h,t,0),c-t),p=h-t,m=c+t,g=h+t;if(L=L&&this.isOffscreen(u,p,m,g),P=P||this.isInsideGrid(u,p,m,g),!i&&this.grid.hitTestCircle(c,h,t,f)&&(I=!0,!d))return{circles:[],offscreen:!1,collisionDetected:I,occluded:!1}}}}return{circles:!d&&I||!P?[]:_,offscreen:L,collisionDetected:I,occluded:S.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};var t=[];let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const a of e){const e=new Re.P(a.x+100,a.y+100);i=Math.min(i,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),o=Math.max(o,e.y),t.push(e)}const a=this.grid.query(i,r,n,o).concat(this.ignoredGrid.query(i,r,n,o)),s={},l={};for(const e of a){const i=e.key;if(void 0===s[i.bucketInstanceId]&&(s[i.bucketInstanceId]={}),!s[i.bucketInstanceId][i.featureIndex]){const r=[new Re.P(e.x1,e.y1),new Re.P(e.x2,e.y1),new Re.P(e.x2,e.y2),new Re.P(e.x1,e.y2)];Re.bb(t,r)&&(s[i.bucketInstanceId][i.featureIndex]=!0,void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]=[]),l[i.bucketInstanceId].push(i.featureIndex))}}return l}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(t,e,i,r,n){var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let e=0;e<t.length;e+=4)o.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,t,i,r,n,o,a){var s=[t,i,r,1];let l=!1;if(r||0<this.transform.pitch){if(Re.a7.transformMat4(s,s,e),this.fogState&&n&&"globe"!==a.name){const e=function(e,t,i,r,n,o){n=o.calculateFogTileMatrix(n),t=[t,i,r];return Re.N.transformMat4(t,t,n),Ce(e,Re.N.length(t),o.pitch,o._fov)}(this.fogState,t,i,r,n.toUnwrapped(),this.transform);l=.9<e}}else yi(s,s,e);t=s[3];return{point:new Re.P((s[0]/t+1)/2*this.transform.width+100,(-s[1]/t+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/t*.5,1.5),signedDistanceFromCamera:t,occluded:o&&t<s[2]||l}}isOffscreen(e,t,i,r){return i<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return 0<=i&&e<this.gridRightBoundary&&0<=r&&t<this.gridBottomBoundary}getViewportMatrix(){var e=Re.a6.identity([]);return Re.a6.translate(e,e,[-100,-100,0]),e}}function xi(e,t,i){t=t.createTileMatrix(e,e.worldSize,i.toUnwrapped());return Re.a6.multiply(new Float32Array(16),e.projMatrix,t)}function bi(e,t,i){return t.name===i.projection.name?e.projMatrix:xi(i,t,e)}class wi{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Ti{constructor(e,t,i,r,n,o=!1){this.text=new wi(e?e.text:null,t,i,n),this.icon=new wi(e?e.icon:null,t,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Si{constructor(e,t,i,r=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=r}}class Ai{constructor(){this.invProjMatrix=Re.a6.create(),this.viewportMatrix=Re.a6.create(),this.circles=[]}}class Ei{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Ci{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Mi(e,t,i,r,n){var{horizontalAlign:o,verticalAlign:a}=Re.bf(e),o=-(o-.5)*t,t=-(a-.5)*i,a=Re.bd(e,r);return new Re.P(o+a[0]*n,t+a[1]*n)}function Ii(e,t,i,r,n){e=new Re.P(e,t);return i&&e._rotate(r?n:-n),e}class Pi{constructor(e,t,i,r,n,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new vi(this.transform,n),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ci(i),this.collisionCircleArrays={},(this.prevPlacement=r)&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,r,n,o){var a=n.getBucket(r),s=n.latestFeatureIndex;if(a&&s&&r.fqid===a.layerIds[0]){var l=a.layers[0].layout,c=n.collisionBoxArray,h=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/Re.V,d=n.tileID.toUnwrapped(),p=(this.transform.setProjection(a.projection),m=n.tileID,f=a.getProjection(),p=this.transform,f.name===this.projection?p.calculateProjMatrix(m.toUnwrapped()):xi(p,f,m)),f="map"===l.get("text-pitch-alignment"),m="map"===l.get("text-rotation-alignment"),g=(r.compileFilter(),r.dynamicFilter()),r=r.dynamicFilterNeedsFeature(),_=this.transform.calculatePixelsToTileUnitsMatrix(n),y=si(p,n.tileID.canonical,f,m,this.transform,a.getProjection(),_);let e=null;if(f){const i=li(p,n.tileID.canonical,f,m,this.transform,a.getProjection(),_);e=Re.a6.multiply([],this.transform.labelPlaneMatrix,i)}let t=null;g&&n.latestFeatureIndex&&(t={unwrappedTileID:d,dynamicFilter:g,dynamicFilterNeedsFeature:r,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[a.bucketInstanceId]=new Ei(a.bucketInstanceId,s,a.sourceLayerIndex,a.index,n.tileID);var v={bucket:a,layout:l,posMatrix:p,textLabelPlaneMatrix:y,labelToScreenMatrix:e,clippingData:t,scale:h,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:c,partiallyEvaluatedTextSize:Re.b5(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Re.b5(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(o)for(const Re of a.sortKeyRanges){const{sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:o}=Re;i.push({sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:o,parameters:v})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:v})}}attemptAnchorPlacement(t,i,r,n,o,e,a,s,l,c,h,u,d,p,f,m,g,_){var{textOffset0:y,textOffset1:v,crossTileID:x}=u,y=[y,v],v=Mi(t,r,n,y,o),i=this.collisionIndex.placeCollisionBox(p,o,i,Ii(v.x,v.y,e,a,this.transform.angle),h,s,l,c.predicate);if(m){const t=p.getSymbolInstanceIconSize(_,this.transform.zoom,u.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,t,m,Ii(v.x,v.y,e,a,this.transform.angle),h,s,l,c.predicate).box.length)return}if(0<i.box.length){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(e=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:y,width:r,height:n,anchor:t,textScale:o,prevAnchor:e},this.markUsedJustification(p,t,u,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,u),this.placedOrientations[x]=f),{shift:v,placedGlyphBoxes:i}}}placeLayerBucketPart(t,T,S,e){const{bucket:A,layout:E,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:I,clippingData:P,textPixelRatio:L,holdingForFade:i,collisionBoxArray:r,partiallyEvaluatedTextSize:D,partiallyEvaluatedIconSize:k,collisionGroup:z}=t.parameters,R=E.get("text-optional"),O=E.get("icon-optional"),B=E.get("text-allow-overlap"),F=E.get("icon-allow-overlap"),N="map"===E.get("text-rotation-alignment"),U="map"===E.get("text-pitch-alignment"),n="viewport-y"===E.get("symbol-z-order"),o=E.get("symbol-z-elevate");this.transform.setProjection(A.projection);let j=B&&(F||!A.hasIconData()||O),V=F&&(B||!A.hasTextData()||R);!A.collisionArrays&&r&&A.deserializeCollisionBoxes(r),S&&e&&A.updateCollisionDebugBuffers(this.transform.zoom,r);var a=(f,m,g)=>{const{crossTileID:_,numVerticalGlyphVertices:y}=f;if(P){const S={zoom:this.transform.zoom,pitch:this.transform.pitch};let e=null;if(P.dynamicFilterNeedsFeature){const Re=this.retainedQueryData[A.bucketInstanceId];e=P.featureIndex.loadFeature({featureIndex:f.featureIndex,bucketIndex:Re.bucketIndex,sourceLayerIndex:Re.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(S,e,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new Re.P(f.tileAnchorX,f.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[_]=new Si(!1,!1,!1,!0),void T.add(_)}if(!T.has(_))if(i)this.placements[_]=new Si(!1,!1,!1);else{let h=!1,e=!1,t=!0,i=!1,r=!1,u=null,n={box:null,offscreen:null,occluded:null},o={box:null,offscreen:null,occluded:null},a,s=null,l=null,c=0,d=0,p=0;g.textFeatureIndex?c=g.textFeatureIndex:f.useRuntimeCollisionCircles&&(c=f.featureIndex),g.verticalTextFeatureIndex&&(d=g.verticalTextFeatureIndex);const b=e=>{e.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;var t=this.transform.elevation;e.elevation=f.zOffset+(t?t.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},w=g.textBox;if(w){b(w);const T=e=>{let t=Re.b6.horizontal;if(A.allowVerticalPlacement&&!e&&this.prevPlacement){const Re=this.prevPlacement.placedOrientations[_];Re&&(this.placedOrientations[_]=Re,t=Re,this.markUsedOrientation(A,t,f))}return t},S=(e,t)=>{if(A.allowVerticalPlacement&&0<y&&g.verticalTextBox){for(const i of A.writingModes)if(i===Re.b6.vertical?(n=t(),o=n):n=e(),n&&n.box&&n.box.length)break}else n=e()};if(E.get("text-variable-anchor")){let c=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_]){const Re=this.prevPlacement.variableOffsets[_];0<c.indexOf(Re.anchor)&&(c=c.filter(e=>e!==Re.anchor)).unshift(Re.anchor)}const I=(t,e,i)=>{var r=A.getSymbolInstanceTextSize(D,f,this.transform.zoom,m),n=(t.x2-t.x1)*r+2*t.padding,o=(t.y2-t.y1)*r+2*t.padding,a=f.hasIconTextFit&&!F?e:null;a&&b(a);let s={box:[],offscreen:!1,occluded:!1};const l=B?2*c.length:c.length;for(let e=0;e<l;++e){const l=this.attemptAnchorPlacement(c[e%c.length],t,n,o,r,N,U,L,C,z,e>=c.length,f,m,A,i,a,D,k);if(l&&(s=l.placedGlyphBoxes)&&s.box&&s.box.length){h=!0,u=l.shift;break}}return s},P=(S(()=>I(w,g.iconBox,Re.b6.horizontal),()=>{var e=g.verticalTextBox;return e&&b(e),A.allowVerticalPlacement&&!(n&&n.box&&n.box.length)&&0<y&&e?I(e,g.verticalIconBox,Re.b6.vertical):{box:null,offscreen:null,occluded:null}}),n&&(h=n.box,t=n.offscreen,i=n.occluded),T(!(!n||!n.box)));if(!h&&this.prevPlacement){const Re=this.prevPlacement.variableOffsets[_];Re&&(this.variableOffsets[_]=Re,this.markUsedJustification(A,Re.anchor,f,P))}}else{const E=(e,t)=>{var i=A.getSymbolInstanceTextSize(D,f,this.transform.zoom,m),i=this.collisionIndex.placeCollisionBox(A,i,e,new Re.P(0,0),B,L,C,z.predicate);return i&&i.box&&i.box.length&&(this.markUsedOrientation(A,t,f),this.placedOrientations[_]=t),i};S(()=>E(w,Re.b6.horizontal),()=>{var e=g.verticalTextBox;return A.allowVerticalPlacement&&0<y&&e?(b(e),E(e,Re.b6.vertical)):{box:null,offscreen:null,occluded:null}}),T(!!(n&&n.box&&n.box.length))}}if(a=n,h=a&&a.box&&0<a.box.length,t=a&&a.offscreen,i=a&&a.occluded,f.useRuntimeCollisionCircles){const T=A.text.placedSymbolArray.get(0<=f.centerJustifiedTextSymbolIndex?f.centerJustifiedTextSymbolIndex:f.verticalPlacedTextSymbolIndex),m=Re.b7(A.textSizeData,D,T),P=E.get("text-padding");s=this.collisionIndex.placeCollisionCircles(A,B,T,A.lineVertexArray,A.glyphOffsetArray,m,C,M,I,S,U,z.predicate,f.collisionCircleDiameter*m/Re.bc,P,this.retainedQueryData[A.bucketInstanceId].tileID),h=B||0<s.circles.length&&!s.collisionDetected,t=t&&s.offscreen,i=s.occluded}if(g.iconFeatureIndex&&(p=g.iconFeatureIndex),g.iconBox){const T=e=>{b(e);var t=f.hasIconTextFit&&u?Ii(u.x,u.y,N,U,this.transform.angle):new Re.P(0,0),i=A.getSymbolInstanceIconSize(k,this.transform.zoom,f.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,i,e,t,F,L,C,z.predicate)};e=0<(l=o&&o.box&&o.box.length&&g.verticalIconBox?T(g.verticalIconBox):T(g.iconBox)).box.length,t=t&&l.offscreen,r=l.occluded}var v=R||0===f.numHorizontalGlyphVertices&&0===y,x=O||0===f.numIconVertices;if(v||x?x?v||(e=e&&h):h=e&&h:e=h=e&&h,h&&a&&a.box&&this.collisionIndex.insertCollisionBox(a.box,E.get("text-ignore-placement"),A.bucketInstanceId,o&&o.box&&d?d:c,z.ID),e&&l&&this.collisionIndex.insertCollisionBox(l.box,E.get("icon-ignore-placement"),A.bucketInstanceId,p,z.ID),s&&(h&&this.collisionIndex.insertCollisionCircles(s.circles,E.get("text-ignore-placement"),A.bucketInstanceId,c,z.ID),S)){const Re=A.bucketInstanceId;let t=this.collisionCircleArrays[Re];void 0===t&&(t=this.collisionCircleArrays[Re]=new Ai);for(let e=0;e<s.circles.length;e+=4)t.circles.push(s.circles[e+0]),t.circles.push(s.circles[e+1]),t.circles.push(s.circles[e+2]),t.circles.push(s.collisionDetected?1:0)}x="globe"!==A.projection.name;j=j&&(x||!i),V=V&&(x||!r),this.placements[_]=new Si(h||j,e||V,t||A.justReloaded),T.add(_)}};if(o&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,this.retainedQueryData[A.bucketInstanceId].tileID),A.updateZOffset()),n){const t=A.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;0<=e;--e){const T=t[e];a(A.symbolInstances.get(T),T,A.collisionArrays[T])}A.hasAnyZOffset&&Re.w(A.layerIds[0]+" layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y")}else if(A.hasAnyZOffset){const Re=A.getSortedIndexesByZOffset();for(let e=0;e<Re.length;++e){const T=Re[e];a(A.symbolInstances.get(T),T,A.collisionArrays[T])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)a(A.symbolInstances.get(e),e,A.collisionArrays[e]);if(S&&A.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[A.bucketInstanceId];Re.a6.invert(t.invProjMatrix,C),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(e,t,i,r){var{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a,crossTileID:s}=i,t=Re.be(t),r=r===Re.b6.vertical?a:"left"===t?i:"center"===t?n:"right"===t?o:-1;0<=i&&(e.text.placedSymbolArray.get(i).crossTileID=0<=r&&i!==r?0:s),0<=n&&(e.text.placedSymbolArray.get(n).crossTileID=0<=r&&n!==r?0:s),0<=o&&(e.text.placedSymbolArray.get(o).crossTileID=0<=r&&o!==r?0:s),0<=a&&(e.text.placedSymbolArray.get(a).crossTileID=0<=r&&a!==r?0:s)}markUsedOrientation(e,t,i){var r=t===Re.b6.horizontal||t===Re.b6.horizontalOnly?t:0,t=t===Re.b6.vertical?t:0,{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a}=i,e=e.text.placedSymbolArray;0<=i&&(e.get(i).placedOrientation=r),0<=n&&(e.get(n).placedOrientation=r),0<=o&&(e.get(o).placedOrientation=r),0<=a&&(e.get(a).placedOrientation=t)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=n[e];i=o?(this.opacities[e]=new Ti(o,r,t.text,t.icon,null,t.clipped),i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new Ti(null,r,t.text,t.icon,t.skipFade,t.clipped),i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new Ti(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in a)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=a[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){var i=new Set;for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,i,r.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate"))&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,r.tileID),t.updateZOffset())}}updateBucketOpacities(r,n,t){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const o=r.layers[0].layout,a=!!r.layers[0].dynamicFilter(),s=new Ti(null,0,!1,!1,!0),l=o.get("text-allow-overlap"),c=o.get("icon-allow-overlap"),h=o.get("text-variable-anchor"),u="map"===o.get("text-rotation-alignment"),d="map"===o.get("text-pitch-alignment"),p=new Ti(null,0,l&&(c||!r.hasIconData()||o.get("icon-optional")),c&&(l||!r.hasTextData()||o.get("text-optional")),!0);!r.collisionArrays&&t&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(t);var f=(t,i,r)=>{for(let e=0;e<i/4;e++)t.opacityVertexArray.emplaceBack(r)};let m=0;for(let e=0;e<r.symbolInstances.length;e++){const o=r.symbolInstances.get(e),{numHorizontalGlyphVertices:l,numVerticalGlyphVertices:c,crossTileID:b,numIconVertices:w}=o,T=n.has(b);let i=this.opacities[b];T?i=s:i||(i=p,this.opacities[b]=i),n.add(b);var g=0<l||0<c,_=0<w,y=this.placedOrientations[b],v=y===Re.b6.vertical,x=y===Re.b6.horizontal||y===Re.b6.horizontalOnly;if(!g&&!_||i.isHidden()||m++,g){const Re=Ni(i.text),n=(f(r.text,l,v?Ui:Re),f(r.text,c,x?Ui:Re),i.text.isHidden()),{leftJustifiedTextSymbolIndex:t,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:h}=o,u=r.text.placedSymbolArray,d=n||v?1:0,p=(0<=t&&(u.get(t).hidden=d),0<=a&&(u.get(a).hidden=d),0<=s&&(u.get(s).hidden=d),0<=h&&(u.get(h).hidden=n||x?1:0),this.variableOffsets[b]),m=(p&&this.markUsedJustification(r,p.anchor,o,y),this.placedOrientations[b]);m&&(this.markUsedJustification(r,"left",o,m),this.markUsedOrientation(r,m,o))}if(_){const Re=Ni(i.icon),{placedIconSymbolIndex:n,verticalPlacedIconSymbolIndex:t}=o,a=r.icon.placedSymbolArray,s=i.icon.isHidden()?1:0;0<=n&&(f(r.icon,w,v?Ui:Re),a.get(n).hidden=s),0<=t&&(f(r.icon,o.numVerticalIconVertices,x?Ui:Re),a.get(t).hidden=s)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const n=r.collisionArrays[e];if(n){let e=new Re.P(0,0),t=!0;if(n.textBox||n.verticalTextBox){if(h){const Re=this.variableOffsets[b];Re?(e=Mi(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textScale),u&&e._rotate(d?this.transform.angle:-this.transform.angle)):t=!1}a&&(t=!i.clipped),n.textBox&&Li(r.textCollisionBox.collisionVertexArray,i.text.placed,!t||v,e.x,e.y),n.verticalTextBox&&Li(r.textCollisionBox.collisionVertexArray,i.text.placed,!t||x,e.x,e.y)}const l=t&&Boolean(!x&&n.verticalIconBox);n.iconBox&&Li(r.iconCollisionBox.collisionVertexArray,i.icon.placed,l,o.hasIconTextFit?e.x:0,o.hasIconTextFit?e.y:0),n.verticalIconBox&&Li(r.iconCollisionBox.collisionVertexArray,i.icon.placed,!l,o.hasIconTextFit?e.x:0,o.hasIconTextFit?e.y:0)}}}if(r.fullyClipped=0===m,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Re.invProjMatrix,r.placementViewportMatrix=Re.viewportMatrix,r.collisionCircleArray=Re.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){var i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Li(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}const Di=Math.pow(2,25),ki=Math.pow(2,24),zi=Math.pow(2,17),Ri=Math.pow(2,16),Oi=Math.pow(2,9),Bi=Math.pow(2,8),Fi=Math.pow(2,1);function Ni(e){var t;return 0!==e.opacity||e.placed?1===e.opacity&&e.placed?4294967295:(t=e.placed?1:0,(e=Math.floor(127*e.opacity))*Di+t*ki+e*zi+t*Ri+e*Oi+t*Bi+e*Fi+t):0}const Ui=0;class ji{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,i,r,n){for(var o=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class Vi{constructor(e,t,i,r,n,o,a,s,l){this.placement=new Pi(e,n,o,a,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,t,i,r){const n=Re.f.now(),o=()=>{var e=Re.f.now()-n;return!this._forceFullPlacement&&2<e};for(;0<=this._currentPlacementIndex;){const n=t[e[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===n.type&&(!n.minzoom||n.minzoom<=a)&&(!n.maxzoom||n.maxzoom>a)){const e=n,t=e.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new ji(e),l=Re.ag(n.source,n.scope);if(s.continuePlacement((t?r:i)[l],this.placement,this._showCollisionBoxes,n,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Gi=512/Re.V/2;class qi{constructor(t,i,r){this.tileID=t,this.bucketInstanceId=r,this.index=new Re.bg(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];var n=t.canonical.x*Re.V,o=t.canonical.y*Re.V;for(let e=0;e<i.length;e++){const{key:t,crossTileID:r,tileAnchorX:a,tileAnchorY:s}=i.get(e),l=Math.floor((n+a)*Gi),c=Math.floor((o+s)*Gi);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(r)}this.index.finish()}findMatches(t,i,r){var n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),o=Gi/Math.pow(2,i.canonical.z-this.tileID.canonical.z),a=i.canonical.x*Re.V,s=i.canonical.y*Re.V;for(let e=0;e<t.length;e++){const i=t.get(e);if(!i.crossTileID){var{key:l,tileAnchorX:c,tileAnchorY:h}=i,c=Math.floor((a+c)*o),h=Math.floor((s+h)*o);for(const Re of this.index.range(c-n,h-n,c+n,h+n)){const t=this.crossTileIDs[Re];if(this.keys[Re]===l&&!r.has(t)){r.add(t),i.crossTileID=t;break}}}}}}class Wi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){var i=this.indexes[e],r={};for(const e in i){var n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);var r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){var n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){var o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{var a=n[e.scaledTo(Number(i)).key];a&&a.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){var s=t.symbolInstances.get(e);s.crossTileID||(s.crossTileID=i.generate(),r.add(s.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new qi(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){var i=this.indexes[r];for(const n in i)e[i[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[n]),delete i[n],t=!0)}return t}}class Zi{constructor(){this.layerIndexes={},this.crossTileIDs=new Wi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,r){let n=this.layerIndexes[e.fqid],o=(void 0===n&&(n=this.layerIndexes[e.fqid]=new Hi),!1);var a={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),a[t.bucketInstanceId]=!0)}return o=n.removeStaleBuckets(a)?!0:o}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}class $i{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(e,t,i){return null!=t.top&&null!=e.top&&(this.top=Re.U(e.top,t.top,i)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Re.U(e.bottom,t.bottom,i)),null!=t.left&&null!=e.left&&(this.left=Re.U(e.left,t.left,i)),null!=t.right&&null!=e.right&&(this.right=Re.U(e.right,t.right,i)),this}getCenter(e,t){e=Re.aa((this.left+e-this.right)/2,0,e),t=Re.aa((this.top+t-this.bottom)/2,0,t);return new Re.P(e,t)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new $i(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Xi(e,t){var i=Re.bk(e,3);Re.a6.fromQuat(e,t),Re.bm(e,3,i)}function Yi(e,t){var i=Re.bi.identity([]);return Re.bi.rotateZ(i,i,-t),Re.bi.rotateX(i,i,-e),i}function Ki(e,t){var i=[e[0],e[1],0],r=[t[0],t[1],0];if(1e-15<=Re.N.length(i)){const e=Re.N.normalize([],i);Re.N.scale(r,e,Re.N.dot(r,e)),t[0]=r[0],t[1]=r[1]}i=Re.N.cross([],t,e);return Re.N.len(i)<1e-15?null:(r=Math.atan2(-i[1],i[0]),Yi(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),r))}class Ji{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){e?(e=e instanceof Re.L?e:new Re.L(e[0],e[1],e[2]),this._renderWorldCopies&&(e.x=Re.bh(e.x,0,1)),this._position=e):this._position=null}lookAtPoint(e,t){var i,r;this.orientation=null,this.position&&(i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(Re.L.fromLngLat(e)):0,r=[(e=Re.L.fromLngLat(e,r)).x-i.x,e.y-i.y,e.z-i.z],(t=t||[0,0,1])[2]=Math.abs(t[2]),this.orientation=Ki(r,t))}setPitchBearing(e,t){this.orientation=Yi(Re.bj(e),Re.bj(-t))}}class Qi{constructor(e,t){this._transform=Re.a6.identity([]),this.orientation=t,this.position=e}get mercatorPosition(){var e=this.position;return new Re.L(e[0],e[1],e[2])}get position(){var e=Re.bk(this._transform,3);return[e[0],e[1],e[2]]}set position(e){e&&Re.bm(this._transform,3,[e[0],e[1],e[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||Re.bi.identity([]),e&&Xi(this._transform,this._orientation)}getPitchBearing(){var e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Yi(e,t),Xi(this._transform,this._orientation)}forward(){var e=Re.bk(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){var e=Re.bk(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){var e=Re.bk(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){var i=new Float64Array(16);return Re.a6.invert(i,this.getWorldToCamera(e,t)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,t,i){var r=this.position,e=(Re.N.scale(r,r,-e),new Float64Array(16));return Re.a6.fromScaling(e,[i,i,i]),Re.a6.translate(e,e,r),e[10]*=t,e}getWorldToCamera(e,t){var i=new Float64Array(16),r=new Float64Array(4),n=this.position;return Re.bi.conjugate(r,this._orientation),Re.N.scale(n,n,-e),Re.a6.fromQuat(i,r),Re.a6.translate(i,i,n),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=t,i[9]*=t,i[10]*=t,i[11]*=t,i}getCameraToClipPerspective(e,t,i,r){var n=new Float64Array(16);return Re.a6.perspective(n,e,t,i,r),n}getCameraToClipOrthographic(e,t,i,r,n,o){var a=new Float64Array(16);return Re.a6.ortho(a,e,t,i,r,n,o),a}getDistanceToElevation(e,t=!1){e=0===e?0:Re.bl(e,t?Re.au(this.position[1]):this.position[1]),t=this.forward();return(e-this.position[2])/t[2]}clone(){return new Qi([...this.position],[...this.orientation])}}const er=(e,t,i)=>(1-i)*e+i*t,tr=e=>e*e*e*e*e;class ir{constructor(e,t,i,r,n,o,a){this.tileSize=512,this._renderWorldCopies=void 0===n||n,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setProjection(o),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new Re.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new $i,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){var e=new ir(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){var i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;null!=this._seaLevelZoom&&!i||this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return Re.ac(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};e=this.projection?this.getProjection():void 0,this.projection=Re.bo(this.projectionOptions),e=!L(e,this.getProjection());return e&&this._calcMatrices(),this.mercatorFromTransition=!1,e}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){var e=this.projection.name,e=(this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Re.bo({name:"mercator"}),e!==this.projection.name);return e&&this._calcMatrices(),e}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Re.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new Re.P(this.width,this.height)}get bearing(){return Re.bh(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){e=-e*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=Re.b4.create(),Re.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){e=Re.aa(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){var e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=Re.bj(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){e=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){var e,t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&0<this.elevation.visibleDemTiles.length&&0<this.elevation.exaggeration()&&this._centerAltitudeValidForExaggeration;this._elevation&&(t!==Number.NEGATIVE_INFINITY||i&&this._centerAltitude)?(e=this._elevation,i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&e.exaggeration()&&this._centerAltitudeValidForExaggeration!==e.exaggeration()?this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*e.exaggeration():this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()):(this._centerAltitude=0,this._seaLevelZoom=null,this._centerAltitudeValidForExaggeration=void 0)}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;var t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,o=0;for(let e=0;e<i.length;e++){var a,s=new Re.P(i[e][0]*this.width,r+i[e][1]*(this.height-r)),s=t.pointCoordinate(s);s&&(a=1/Math.hypot(s[0]-this._camera.position[0],s[1]-this._camera.position[1]),n+=s[3]*a,o+=a)}return 0===o?NaN:n/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){var e,t,i;null!=this._seaLevelZoom&&this._elevation&&(i=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),e=this.pixelsPerMeter/this.worldSize*e,i=this._mercatorZfromZoom(i),t=this._mercatorZfromZoom(this._maxZoom),i=Math.max(i-e,t),this._setZoom(this._zoomFromMercatorZ(i)))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){var t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude())),t=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z],e=Re.N.length(Re.N.sub([],this._camera.position,t));return Re.aa(this._zoomFromMercatorZ(e),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(this.height&&(t.position||t.orientation)){this._updateCameraState();let e=!1;t.orientation&&!Re.bi.exactEquals(t.orientation,this._camera.orientation)&&(e=this._setCameraOrientation(t.orientation)),t.position&&(t=[t.position.x,t.position.y,t.position.z],Re.N.exactEquals(t,this._camera.position)||(this._setCameraPosition(t),e=!0)),e&&(this._updateStateFromCamera(),this.recenterOnTerrain())}}getFreeCameraOptions(){this._updateCameraState();var e=this._camera.position,t=new Ji;return t.position=new Re.L(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!Re.bi.length(e))return!1;Re.bi.normalize(e,e);var t=Re.N.transformQuat([],[0,0,-1],e),e=Re.N.transformQuat([],[0,-1,0],e);return!(e[2]<0||!(t=Ki(t,e))||(this._camera.orientation=t,0))}_setCameraPosition(e){var t=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=Re.aa(e[2],r/i,r/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){e=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(t){var i=[new Re.bp(0,t)];if(this.renderWorldCopies){var e=this.pointCoordinate(new Re.P(0,0)),r=this.pointCoordinate(new Re.P(this.width,0)),n=this.pointCoordinate(new Re.P(this.width,this.height)),o=this.pointCoordinate(new Re.P(0,this.height)),a=Math.floor(Math.min(e.x,r.x,n.x,o.x)),s=Math.floor(Math.max(e.x,r.x,n.x,o.x));for(let e=a-1;e<=s+1;e++)0!==e&&i.push(new Re.bp(e,t))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,t,i){let r=[];if(0!==t[0]||0!==t[1]){for(const i of e){const e=i.canonical,n=i.overscaledZ,o=i.wrap,a=1<<e.z,s=e.x+1<a,l=0<e.x,c=e.y+1<a,h=0<e.y,u=i.wrap-(l?0:1),d=i.wrap+(s?0:1),p=l?e.x-1:a-1,f=s?e.x+1:0;t[0]<0?(r.push(new Re.am(n,d,e.z,f,e.y)),t[1]<0&&c&&(r.push(new Re.am(n,o,e.z,e.x,e.y+1)),r.push(new Re.am(n,d,e.z,f,e.y+1))),0<t[1]&&h&&(r.push(new Re.am(n,o,e.z,e.x,e.y-1)),r.push(new Re.am(n,d,e.z,f,e.y-1)))):0<t[0]?(r.push(new Re.am(n,u,e.z,p,e.y)),t[1]<0&&c&&(r.push(new Re.am(n,o,e.z,e.x,e.y+1)),r.push(new Re.am(n,u,e.z,p,e.y+1))),0<t[1]&&h&&(r.push(new Re.am(n,o,e.z,e.x,e.y-1)),r.push(new Re.am(n,u,e.z,p,e.y-1)))):t[1]<0&&c?r.push(new Re.am(n,o,e.z,e.x,e.y+1)):h&&r.push(new Re.am(n,o,e.z,e.x,e.y-1))}if(1<r.length){r.sort((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y);let e=0,t=0;for(;t<r.length;)r[t].equals(r[e])?++t:r[++e]=r[t++];r.length=e+1}const n=[];for(const Re of r)r.some(e=>Re.isChildOf(e))||n.push(Re);r=n.filter(t=>!e.some(e=>!!(t.overscaledZ<i&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e)))}return r}coveringTiles(s){let l=this.coveringZoomLevel(s);const c=l,i=this.elevation&&this.elevation.exaggeration(),h=i&&!s.isTerrainDEM,r="mercator"===this.projection.name;if(void 0!==s.minzoom&&l<s.minzoom)return[];void 0!==s.maxzoom&&l>s.maxzoom&&(l=s.maxzoom);const n=this.locationCoordinate(this.center),u=this.center.lat,o=1<<l,a=[o*n.x,o*n.y,0],d="globe"===this.projection.name,p=!d,f=Re.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,p),e=d?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=o*Re.bl(1,this.center.lat),t=this._camera.position[2]/Re.bl(1,this.center.lat),g=[o*e.x,o*e.y,t*(p?1:m)],_=d||i,y=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),v=this.isLODDisabled(!0)?l:0;let x;if(this._elevation&&s.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();x=Re?Re.max:this._centerAltitude}else x=this._centerAltitude;const b=s.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?Re.br(this):1,T=e=>{var t=new Re.L(e.x+25e-6,e.y,e.z),i=new Re.L(e.x,e.y+25e-6,e.z),e=e.toLngLat(),t=t.toLngLat(),i=i.toLngLat(),e=this.locationCoordinate(e),t=this.locationCoordinate(t),i=this.locationCoordinate(i),t=Math.hypot(t.x-e.x,t.y-e.y),i=Math.hypot(i.x-e.x,i.y-e.y);return Math.sqrt(t*i)*w/25e-6},S=e=>{var t=x,i=b;return{aabb:Re.bu(this,o,0,0,0,e,i,t,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:t,wrap:e,fullyVisible:!1}},A=[];let E=[];const C=l,M=s.reparseOverscaled?c:l,I=e=>e*e,P=I((t-this._centerAltitude)*m),L=e=>{var t,i;this._elevation&&e.tileID&&r&&(t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb,t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=D(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude)))},D=e=>{if(e.zoom<v)return!0;if(e.zoom===C)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(g),i=e.aabb.distanceY(g);let r=P,n=1;if(d){r=I(e.aabb.distanceZ(g));const t=Math.pow(2,e.zoom),c=Re.au((e.y+1)/t),i=Re.au(e.y/t),h=Math.min(Math.max(u,c),i),o=Re.bJ(h)/Re.bJ(u);if(n=h===u?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,o/this._mercatorScaleRatio),this.zoom<=Re.bG&&e.zoom===C-1&&.9<=o)return!0}else if(h&&(r=I(e.aabb.distanceZ(g)*m)),this.projection.isReprojectedInTileSpace&&c<=5){const t=Math.pow(2,e.zoom),c=T(new Re.L((e.x+.5)/t,(e.y+.5)/t));n=.85<c?1:c}const o=t*t+i*i+r,a=I((1<<C-e.zoom)*y*n*(e=Math.max(r,P),(s=o)*I(.707)<e?1:(s=Math.sqrt(s/e))/(1.4144271570014144+(Math.pow(1.1,s-1.4144271570014144+1)-1)/(1.1-1)-1)));var s;return o<a};if(this.renderWorldCopies)for(let e=1;e<=3;e++)A.push(S(-e)),A.push(S(e));for(A.push(S(0));0<A.length;){const c=A.pop(),i=c.x,n=c.y;let t=c.fullyVisible;const p=()=>"globe"===this.projection.name&&(0===c.y||c.y===(1<<c.zoom)-1);if(!t){let e=_?c.aabb.intersects(f):c.aabb.intersectsFlat(f);if(0===e&&p()){const l=new Re.bs(c.zoom,i,n);e=Re.bt(this,o,l,!0).intersects(f)}if(0===e)continue;t=2===e}if(c.zoom!==C&&D(c))for(let e=0;e<4;e++){const l=(i<<1)+e%2,a=(n<<1)+(e>>1),p={aabb:r?c.aabb.quadrant(e):Re.bu(this,o,c.zoom+1,l,a,c.wrap,c.minZ,c.maxZ,this.projection),zoom:c.zoom+1,x:l,y:a,wrap:c.wrap,fullyVisible:t,tileID:void 0,shouldSplit:void 0,minZ:c.minZ,maxZ:c.maxZ};h&&!d&&(p.tileID=new Re.am(c.zoom+1===C?M:c.zoom+1,c.wrap,c.zoom+1,l,a),L(p)),A.push(p)}else{const h=c.zoom===C?M:c.zoom;if(!(s.minzoom&&s.minzoom>h)){if(!t){let e=_?c.aabb.intersectsPrecise(f):c.aabb.intersectsPreciseFlat(f);if(0===e&&p()){const l=new Re.bs(c.zoom,i,n);e=Re.bt(this,o,l,!0).intersectsPrecise(f)}if(0===e)continue}const r=a[0]-(.5+i+(c.wrap<<c.zoom))*(1<<l-c.zoom),d=a[1]-.5-n,e=c.tileID||new Re.am(h,c.wrap,c.zoom,i,n);E.push({tileID:e,distanceSq:r*r+d*d})}}}if(this.fogCullDistSq){const l=this.fogCullDistSq,c=this.horizonLineFromTop();E=E.filter(t=>{const e=[0,0,0,1],i=[Re.V,Re.V,0,1],r=this.calculateFogTileMatrix(t.tileID.toUnwrapped());Re.a7.transformMat4(e,e,r),Re.a7.transformMat4(i,i,r);var n=Re.a7.min([],e,i),o=Re.a7.max([],e,i),n=Re.bv(n,o);if(0===n)return!0;let a=!1;o=this._elevation;if(o&&n>l&&0!==c){const l=this.calculateProjMatrix(t.tileID.toUnwrapped());let e;e=(e=s.isTerrainDEM?e:o.getMinMaxForTile(t.tileID))||{min:b,max:x};const i=Re.bH(this.rotation),r=[i[0]*Re.V,i[1]*Re.V,e.max];Re.N.transformMat4(r,r,l),a=(1-r[1])*this.height*.5<c}return n<l||a})}return E.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){var t=Re.aa(e.lat,-Re.bw,Re.bw),e=this.projection.project(e.lng,t);return new Re.P(e.x*this.worldSize,e.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Re.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,t){let i,r;var n=this.centerPoint;if("globe"===this.projection.name){const Re=this.worldSize;i=(t.x-n.x)/Re,r=(t.y-n.y)/Re}else{const Re=this.pointCoordinate(t),e=this.pointCoordinate(n);i=Re.x-e.x,r=Re.y-e.y}t=this.locationCoordinate(e);this.setLocation(new Re.L(t.x-i,t.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){t=t?Re.bl(t,e.lat):void 0,e=this.projection.project(e.lng,e.lat);return new Re.L(e.x,e.y,t)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){var t=null!=t?t:this._centerAltitude,i=[e.x,e.y,0,1],e=[e.x,e.y,1,1],r=(Re.a7.transformMat4(i,i,this.pixelMatrixInverse),Re.a7.transformMat4(e,e,this.pixelMatrixInverse),e[3]),r=(Re.a7.scale(i,i,1/i[3]),Re.a7.scale(e,e,1/r),i[2]),n=e[2];return{p0:i,p1:e,t:r===n?0:(t-r)/(n-r)}}screenPointToMercatorRay(e){var t=[e.x,e.y,0,1],e=[e.x,e.y,1,1];return Re.a7.transformMat4(t,t,this.pixelMatrixInverse),Re.a7.transformMat4(e,e,this.pixelMatrixInverse),Re.a7.scale(t,t,1/t[3]),Re.a7.scale(e,e,1/e[3]),t[2]=Re.bl(t[2],this._center.lat)*this.worldSize,e[2]=Re.bl(e[2],this._center.lat)*this.worldSize,Re.a7.scale(t,t,1/this.worldSize),Re.a7.scale(e,e,1/this.worldSize),new Re.a2([t[0],t[1],t[2]],Re.N.normalize([],Re.N.sub([],e,t)))}rayIntersectionCoordinate(e){var{p0:e,p1:t,t:i}=e,r=Re.bl(e[2],this._center.lat),n=Re.bl(t[2],this._center.lat);return new Re.L(Re.U(e[0],t[0],i)/this.worldSize,Re.U(e[1],t[1],i)/this.worldSize,Re.U(r,n,i))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new Re.L(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);var o=.02*n,a=t.clone();for(let e=0;e<10&&n-r>o;e++){a.y=Re.U(r,n,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(n=a.y,i=t):r=a.y}return i?new Re.L(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){return!(e.y<0||e.y>this.height||e.x<0||e.x>this.width)&&(this.elevation||this.zoom>=Re.bx?!this.isPointAboveHorizon(e):0<=(e=this.pointCoordinate(e)).y&&e.y<=1)}_coordinatePoint(e,t){t=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,t=[e.x*this.worldSize,e.y*this.worldSize,t+e.toAltitude(),1];return Re.a7.transformMat4(t,t,this.pixelMatrix),0<t[3]?new Re.P(t[0]/t[3],t[1]/t[3]):new Re.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:t}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,n=this.pointLocation3D(new Re.P(t,e)),o=this.pointLocation3D(new Re.P(r,e)),a=this.pointLocation3D(new Re.P(r,i)),s=this.pointLocation3D(new Re.P(t,i));let h=Math.min(n.lng,o.lng,a.lng,s.lng),u=Math.max(n.lng,o.lng,a.lng,s.lng),d=Math.min(n.lat,o.lat,a.lat,s.lat),p=Math.max(n.lat,o.lat,a.lat,s.lat);const f=Math.pow(2,-this.zoom)/16*270,m="globe"===this.projection.name?1:4,g=(e,t,i,r,n)=>{var o=(e+i)/2,a=(t+r)/2,s=new Re.P(o,a),{lng:s,lat:l}=this.pointLocation3D(s),c=Math.max(0,h-s,d-l,s-u,l-p);h=Math.min(h,s),u=Math.max(u,s),d=Math.min(d,l),p=Math.max(p,l),(n<m||c>f)&&(g(e,t,o,a,n+1),g(o,a,i,r,n+1))};if(g(t,e,r,e,1),g(r,e,r,i,1),g(r,i,t,i,1),g(t,i,t,e,1),"globe"===this.projection.name){const[e,t]=Re.by(this);e?(p=90,u=180,h=-180):t&&(d=-90,u=180,h=-180)}return new Re.ad(new Re.bn(h,d),new Re.bn(u,p))}_getBoundsRectangular(e,t){var{top:i,left:r}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,a=new Re.P(r,i),i=new Re.P(o,i),o=new Re.P(o,n),r=new Re.P(r,n);let s=this.pointCoordinate(a,e),l=this.pointCoordinate(i,e);n=this.pointCoordinate(o,t),a=this.pointCoordinate(r,t),i=(e,t)=>(t.y-e.y)/(t.x-e.x);return 1<s.y&&0<=l.y?s=new Re.L((1-a.y)/i(a,s)+a.x,1):s.y<0&&l.y<=1&&(s=new Re.L(-a.y/i(a,s)+a.x,0)),1<l.y&&0<=s.y?l=new Re.L((1-n.y)/i(n,l)+n.x,1):l.y<0&&s.y<=1&&(l=new Re.L(-n.y/i(n,l)+n.x,0)),(new Re.ad).extend(this.coordinateLocation(s)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(n))}_getBoundsRectangularTerrain(){var e,t=this.elevation;return!t.visibleDemTiles.length||t.isUsingMockSource()?this._getBoundsRectangular(0,0):(e=t.visibleDemTiles.reduce((e,t)=>{return t.dem&&(t=t.dem.tree,e.min=Math.min(e.min,t.minimums[0]),e.max=Math.max(e.max,t.maximums[0])),e},{min:Number.MAX_VALUE,max:0}),this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration()))}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){var t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,t=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,t):t}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Re.bw,this.maxLat=Re.bw,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng)&&(this.maxLng+=360),this.worldMinX=Re.a5(this.minLng)*this.tileSize,this.worldMaxX=Re.a5(this.maxLng)*this.tileSize,this.worldMinY=Re.ae(this.maxLat)*this.tileSize,this.worldMaxY=Re.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(e){var t,i,r,n,o,a,s=e.key,l=this._distanceTileDataCache;return l[s]||(r=e.canonical,t=1/this.height,i=(a=this.cameraWorldSize)/this.zoomScale(r.z),e=(r.x+Math.pow(2,r.z)*e.wrap)*i,r=r.y*i,(n=this.point).x*=a/this.worldSize,n.y*=a/this.worldSize,a=this.angle,o=Math.sin(-a),a=-Math.cos(-a),l[s]={bearing:[o,a],center:[(n.x-e)*t,(n.y-r)*t],scale:i/Re.V*t}),l[s]}calculateFogTileMatrix(e){var t=e.key,i=this._fogTileMatrixCache;return i[t]||(e=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e),Re.a6.multiply(e,this.worldToFogMatrix,e),i[t]=new Float32Array(e)),i[t]}calculateProjMatrix(e,t=!1,i=!1){var r,n=e.key;return(r=i?this._expandedProjMatrixCache:t?this._alignedProjMatrixCache:this._projMatrixCache)[n]||(e=this.calculatePosMatrix(e,this.worldSize),i=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:t?this.alignedProjMatrix:this.projMatrix,Re.a6.multiply(e,i,e),r[n]=new Float32Array(e)),r[n]}calculatePixelsToTileUnitsMatrix(e){var t=e.tileID.key,i=this._pixelsToTileUnitsCache;return i[t]||(e=Re.bz(e,this),i[t]=e),i[t]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){var e;if("globe"===this.projection.name)return e=1/this.worldSize,e=Re.a6.fromScaling([],[e,e,e]),Re.a6.multiply(e,e,this.globeMatrix),e}recenterOnTerrain(){if(this._elevation&&"globe"!==this.projection.name){const t=this._elevation,i=(this._updateCameraState(),Re.bl(1,this._center.lat)*this.worldSize),r=this._computeCameraPosition(i),n=this._camera.forward(),o=Re.bl(1,this._center.lat);r[2]/=o,n[2]/=o,Re.N.normalize(n,n);var e=t.raycast(r,n,t.exaggeration());if(e){const t=Re.N.scaleAndAdd([],r,n,e),i=new Re.L(t[0],t[1],Re.bl(t[2],Re.au(t[1]))),a=(i.z+Re.N.length([i.x-r[0],i.y-r[1],i.z-r[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}}_constrainCamera(e=!1){if(this._elevation){const t=this._elevation,i=Re.bl(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=t.getAtPointOrZero(new Re.L(...r)),o=this.pixelsPerMeter/this.worldSize*n,a=this._minimumHeightOverTerrain(),s=r[2]-o;if(s<=a)if(s<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),t=[r[0],r[1],e.z-r[2]],i=Re.N.length(t),n=(t[2]-=(a-s)/this._pixelsPerMercatorPixel,Re.N.length(t));0!==n&&(Re.N.scale(t,t,i/n*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],e.z*this._pixelsPerMercatorPixel-t[2]],this._updateStateFromCamera())}else this._isCameraConstrained=!0}}_constrain(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const l=this.center;l.lat=Re.aa(l.lat,this.minLat,this.maxLat),!this.maxBounds&&(this.renderWorldCopies||s)||(l.lng=Re.aa(l.lng,this.minLng,this.maxLng)),this.center=l,void(this._constraining=!1)}else{const l=this._unmodified,{x:c,y:h}=this.point;let e=0,t=c,i=h;var r=this.width/2,n=this.height/2,o=this.worldMinY*this.scale,a=this.worldMaxY*this.scale;if(h-n<o&&(i=o+n),a<h+n&&(i=a-n),a-o<this.height&&(e=Math.max(e,this.height/(a-o)),i=(a+o)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Re=this.worldMinX*this.scale,s=this.worldMaxX*this.scale,l=this.worldSize/2-(Re+s)/2;(t=(t=(c+l+this.worldSize)%this.worldSize-l)-r<Re?Re+r:t)+r>s&&(t=s-r),s-Re<this.width&&(e=Math.max(e,this.width/(s-Re)),t=(s+Re)/2)}t===c&&i===h||(this.center=this.unproject(new Re.P(t,i))),e&&(this.zoom+=this.scaleZoom(e)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}}}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return e=this.maxBounds?Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX))):e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(this.height){const f=this.centerOffset,m="globe"===this.projection.name,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Re.bl(1,this.center.lat)/Re.bl(1,Re.bI));var t=Re.bA(this.projection,this.zoom,this.width,this.height,1024),t=(this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,t),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50,"meters"===this.projection.zAxisUnit?g:1),i=this._camera.getWorldToCamera(this.worldSize,t);let e;var r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(r[8]=2*-f.x/this.width,r[9]=2*f.y/this.height,this.isOrthographic){var n=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),o=n*this.aspect,a=-o,s=-n,l=(o-=f.x,a-=f.x,n+=f.y,s+=f.y,e=this._camera.getCameraToClipOrthographic(a,o,s,n,this._nearZ,this._farZ)),c=e,h=r,u=tr(15<=this.pitch?1:this.pitch/15);for(let e=0;e<16;e++)l[e]=er(c[e],h[e],u)}else e=r;a=Re.a6.mul([],r,i),o=Re.a6.mul([],e,i);if(this.projection.isReprojectedInTileSpace){const f=this.locationCoordinate(this.center),m=Re.a6.identity([]);Re.a6.translate(m,m,[f.x*this.worldSize,f.y*this.worldSize,0]),Re.a6.multiply(m,m,Re.bB(this)),Re.a6.translate(m,m,[-f.x*this.worldSize,-f.y*this.worldSize,0]),Re.a6.multiply(o,o,m),Re.a6.multiply(a,a,m),this.inverseAdjustmentMatrix=Re.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=Re.a6.scale([],o,[this.worldSize,this.worldSize,this.worldSize/t,1]),this.projMatrix=o,this.invProjMatrix=Re.a6.invert(new Float64Array(16),this.projMatrix),m){const m=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);m[8]=2*-f.x/this.width,m[9]=2*f.y/this.height,this.expandedFarZProjMatrix=Re.a6.mul([],m,i)}else this.expandedFarZProjMatrix=this.projMatrix;var s=Re.a6.invert([],e),n=(this.frustumCorners=Re.bD.fromInvProjectionMatrix(s,this.horizonLineFromTop(),this.height),this.cameraFrustum=Re.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!m),new Float32Array(16)),r=(Re.a6.identity(n),Re.a6.scale(n,n,[1,-1,1]),Re.a6.rotateX(n,n,this._pitch),Re.a6.rotateZ(n,n,this.angle),Re.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ)),t=(this.starsProjMatrix=Re.a6.clone(r),(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift),s=(r[8]=2*-f.x/this.width,r[9]=2*(f.y+t)/this.height,this.skyboxMatrix=Re.a6.multiply(n,r,n),this.point),t=s.x,r=s.y,n=this.width%2/2,s=this.height%2/2,d=Math.cos(this.angle),p=Math.sin(this.angle),t=t-Math.round(t)+d*n+p*s,r=r-Math.round(r)+d*s+p*n,d=new Float64Array(o);if(Re.a6.translate(d,d,[.5<t?t-1:t,.5<r?r-1:r,0]),this.alignedProjMatrix=d,o=Re.a6.create(),Re.a6.scale(o,o,[this.width/2,-this.height/2,1]),Re.a6.translate(o,o,[1,-1,0]),this.labelPlaneMatrix=o,o=Re.a6.create(),Re.a6.scale(o,o,[1,-1,1]),Re.a6.translate(o,o,[-1,-1,0]),Re.a6.scale(o,o,[2/this.width,2/this.height,1]),this.glCoordMatrix=o,this.pixelMatrix=Re.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,a),this._calcFogMatrices(),this._distanceTileDataCache={},!(o=Re.a6.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=o,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=Re.bE(this);const f=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Re.N.transformMat4(f,f,i),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=o;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}}_calcFogMatrices(){this._fogTileMatrixCache={};var e=this.cameraWorldSizeForFog,t=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,n=[e,e,t],o=(Re.N.scale(n,n,r),Re.N.scale(i,i,-1),Re.N.multiply(i,i,n),Re.a6.create());Re.a6.translate(o,o,i),Re.a6.scale(o,o,n),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,r)}_computeCameraPosition(e){var t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,t=this._mercatorZfromZoom(this._seaLevelZoom||this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*t,r.y/this.worldSize-i[1]*t,e/this.worldSize*this._centerAltitude-i[2]*t]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){var t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=e[2];let n=1;this.projection.wrap&&(this.center=this.center.wrap()),0<r&&(n=Math.min((t-i)/r,1)),this._camera.position=Re.N.scaleAndAdd([],this._camera.position,e,n),this._updateStateFromCamera()}_updateStateFromCamera(){var e=this._camera.position,t=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),n=Re.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Re.bj(this._maxPitch)),n=Math.max((e[2]-n)/Math.cos(i),o),o=this._zoomFromMercatorZ(n);Re.N.scaleAndAdd(e,e,t,n),this._pitch=Re.aa(i,Re.bj(this.minPitch),Re.bj(this.maxPitch)),this.angle=Re.bh(r,-Math.PI,Math.PI),this._setZoom(Re.aa(o,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Re.L(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){var e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let t=0,i=Re.bx,r=0,n=1/0;for(;1e-6<i-t&&i>t;){const Re=t+.5*(i-t),o=this.tileSize*Math.pow(2,Re),a=this.getCameraToCenterDistance(this.projection,Re,o),s=this.scaleZoom(a/(e*this.tileSize)),l=Math.abs(Re-s);l<n&&(n=l,r=Re),Re<s?t=Re:i=Re}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Re.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,t){var i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),n=Math.min(e.y,t.y),e=Math.max(e.y,t.y);if(n<this.horizonLineFromTop(!1))return!0;if("mercator"===this.projection.name){var t=[new Re.P(i,n),new Re.P(r,e),new Re.P(i,e),new Re.P(r,n)],o=this.renderWorldCopies?-3:0,a=this.renderWorldCopies?4:1;for(const Re of t){const e=this.pointRayIntersection(Re);if(e.t<0)return!0;const t=this.rayIntersectionCoordinate(e);if(t.x<o||t.y<0||t.x>a||1<t.y)return!0}}return!1}isHorizonVisible(){return 88<this.pitch+Re.bF(this.fovAboveCenter)||this.anyCornerOffEdge(new Re.P(0,0),new Re.P(this.width,this.height))}zoomDeltaToMovement(e,t){e=Re.N.length(Re.N.sub([],this._camera.position,e)),t=this._zoomFromMercatorZ(e)+t;return e-this._mercatorZfromZoom(t)}getCameraPoint(){var e;return"globe"===this.projection.name?(e=function([e,t,i],r){e=[e,t,i,1],Re.a7.transformMat4(e,e,r),t=e[3]=Math.max(e[3],1e-6);return e[0]/=t,e[1]/=t,e[2]/=t,e}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix),new Re.P(e[0],e[1])):(e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1),this.centerPoint.add(new Re.P(0,e)))}getCameraToCenterDistance(e,t=this.zoom,i=this.worldSize){t=Re.bA(e,t,this.width,this.height,1024),e=e.pixelSpaceConversion(this.center.lat,i,t);let r=.5/Math.tan(.5*this._fov)*this.height*e;return r=this.isOrthographic?er(1,r,tr(15<=this.pitch?1:this.pitch/15)):r}getWorldToCameraMatrix(){var e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&Re.a6.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Re.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}const x={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},rr=(e,t)=>{var i,r,n;return 0<t&&e.terrain&&Re.w("Cutoff is currently disabled on terrain"),t<=0||e.terrain?{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}}:(i=e.transform,e=Math.max(Math.abs(i._zoom-(e.minCutoffZoom-1)),1),r=i.isLODDisabled(!1)?Re.O(60,45,i.pitch):Re.O(30,15,i.pitch),n=i._farZ-i._nearZ,t=t*i.height,e=((1-r)*i.cameraToCenterDistance+r*(i._farZ+t))*e,{shouldRenderCutoff:r<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(e-i._nearZ)/n,(e-t-i._nearZ)/n]}})},b={cascadeCount:2,shadowMapResolution:2048};class nr{constructor(e,t){this.aabb=e,this.lastCascade=t}}class or{add(e,t){var i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],t.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],t.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],t.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],t.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],t.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],t.max[2])):this.receivers[e.key]=new nr(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,i,r){var t=Re.bS.fromPoints(e.points);let n=0;for(const e in this.receivers){var o=this.receivers[e];if(o&&t.intersectsAabb(o.aabb)){o.aabb.min=t.closestPoint(o.aabb.min),o.aabb.max=t.closestPoint(o.aabb.max);var a=o.aabb.getCorners();for(let t=0;t<r.length;t++){let e=!0;for(const n of a){var s=[n[0]*i,n[1]*i,n[2]];if(Re.N.transformMat4(s,s,r[t].matrix),s[0]<-1||1<s[0]||s[1]<-1||1<s[1]){e=!1;break}}if(o.lastCascade=t,n=Math.max(n,t),e)break}}}return n+1}}class ar{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new or,this._depthMode=new Oe(e.context.gl.LEQUAL,Oe.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,e.tp.registerParameter(b,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(b,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,t){const o=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),t&&t.properties){const c=t.properties.get("shadow-intensity");if(t.shadowsEnabled()&&!(c<=0)&&(this._shadowLayerCount=o.style.order.reduce((e,t)=>{t=o.style._mergedLayers[t];return e+(t.hasShadowPass()&&!t.isHidden(n.zoom)?1:0)},0),this._enabled=0<this._shadowLayerCount,this._enabled)){const h=o.context,u=b.shadowMapResolution,d=b.shadowMapResolution;if(0===this._cascades.length||b.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let e=0;e<b.cascadeCount;++e){const n=o._shadowMapDebug,t=h.gl,c=h.createFramebuffer(u,d,n,"texture"),e=new Re.T(h,{width:u,height:d,data:null},t.DEPTH_COMPONENT);if(c.depthAttachment.set(e.texture),n){const n=new Re.T(h,{width:u,height:d,data:null},t.RGBA);c.colorAttachment.set(n.texture)}this._cascades.push({framebuffer:c,texture:e,matrix:[],far:0,boundingSphereRadius:0,frustum:new Re.bq,scale:0})}}this.shadowDirection=lr(t);let r=0;if(n.elevation){const Re=n.elevation,t=[1e4,-1e4];Re.visibleDemTiles.filter(e=>e.dem).forEach(e=>{e=e.dem.tree;t[0]=Math.min(t[0],e.minimums[0]),t[1]=Math.max(t[1],e.maximums[0])}),1e4!==t[0]&&(r=(t[1]-t[0])*Re.exaggeration())}var a=1.5*n.cameraToCenterDistance,s=3*a,l=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const o=this._cascades[i];let e=n.height/50,t=1;t=1===b.cascadeCount?s:0===i?a:(e=a,s);const[u,d]=function(e,t,i,r,n,o){const a=e.zoom,s=e.scale,l=e.worldSize,c=1/l,h=e.aspect,u=Math.sqrt(1+h*h)*Math.tan(.5*e.fovX),d=u*u,p=r-i,f=r+i;let m,g;g=p/f<d?(m=r,r*u):(m=.5*f*(1+d),.5*Math.sqrt(p*p+2*(r*r+i*i)*d+f*f*d*d));var _=e.projection.pixelsPerMeter(e.center.lat,l),y=e._camera.getCameraToWorldMercator(),v=[0,0,-m*c];Re.N.transformMat4(v,v,y);let x=g*c;y=e._edgeInsets;if(!(0===y.left&&0===y.top&&0===y.right&&0===y.bottom||y.left===y.right&&y.top===y.bottom)){const t=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?_:1),n=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,i,r),o=(n[8]=2*-e.centerOffset.x/e.width,n[9]=2*e.centerOffset.y/e.height,new Float64Array(16)),c=(Re.a6.mul(o,n,t),new Float64Array(16)),h=(Re.a6.invert(c,o),Re.bq.fromInvProjectionMatrix(c,l,a,!0));for(const t of h.points){(b=t)[0]/=s,b[1]/=s,b[2]=Re.bl(b[2],e._center.lat);const i=b;x=Math.max(x,Re.N.len(Re.N.subtract([],v,i)))}}var b;x*=n/(n-1);var y=Math.acos(t[2]),i=Math.atan2(-t[0],-t[1]),r=new Qi,y=(r.position=v,r.setPitchBearing(y,i),r.getWorldToCamera(l,_)),i=x*l,w=Math.min(e._mercatorZfromZoom(17)*l*-2,-2*i),r=r.getCameraToClipOrthographic(-i,i,-i,i,w,(i+o*_)/t[2]),w=new Float64Array(16),o=(Re.a6.multiply(w,r,y),Re.N.fromValues(Math.floor(1e6*v[0])/1e6*l,Math.floor(1e6*v[1])/1e6*l,0)),_=.5*n,t=[0,0,0],r=(Re.N.transformMat4(t,o,w),Re.N.scale(t,t,_),[Math.floor(t[0]),Math.floor(t[1]),Math.floor(t[2])]),y=[0,0,0],n=(Re.N.sub(y,t,r),Re.N.scale(y,y,-1/_),new Float64Array(16));return Re.a6.identity(n),Re.a6.translate(n,n,y),Re.a6.multiply(w,n,w),[w,i]}(n,this.shadowDirection,e,t,b.shadowMapResolution,r);o.scale=n.scale,o.matrix=u,o.boundingSphereRadius=d,Re.a6.invert(l,o.matrix),o.frustum=Re.bq.fromInvProjectionMatrix(l,1,0,!0),o.far=t}var t=this._cascades.length-1,i=(this._uniformValues.u_fade_range=[.75*this._cascades[t].far,this._cascades[t].far],this._uniformValues.u_shadow_intensity=c,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/b.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=b.shadowMapResolution,this._uniformValues.u_shadowmap_0=x.ShadowMap0,this._uniformValues.u_shadowmap_1=x.ShadowMap0+1,this._groundShadowTiles=o.transform.coveringTiles({tileSize:512,renderWorldCopies:!0}),o.transform.elevation);for(const Re of this._groundShadowTiles){let e={min:0,max:0};if(i){const t=i.getMinMaxForTile(Re);t&&(e=t)}this.addShadowReceiver(Re.toUnwrapped(),e.min,e.max)}}}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(t,i){if(this._enabled){const o=this.painter,a=o.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(o.transform.getFrustum(0),o.transform.worldSize,this._cascades),a.viewport.set([0,0,b.shadowMapResolution,b.shadowMapResolution]);for(let e=0;e<this._numCascadesToRender;++e){o.currentShadowCascade=e,a.bindFramebuffer.set(this._cascades[e].framebuffer.framebuffer),a.clear({color:Re.ax.white,depth:1});for(const Re of t.order){const a=t._mergedLayers[Re];var r,n;a.hasShadowPass()&&!a.isHidden(o.transform.zoom)&&(n=(r=t.getLayerSourceCache(a))?i[r.id]:void 0,"model"===a.type||n&&n.length)&&o.renderLayer(o,r,a,n)}}o.currentShadowCascade=0}}drawGroundShadows(){if(this._enabled){const o=this.painter,a=o.style,s=o.context,l=a.directionalLight,c=a.ambientLight;if(l&&c){var e=[],t=rr(o,o.longestCutoffRange),i=(t.shouldRenderCutoff&&e.push("RENDER_CUTOFF"),cr(l,c)),r=new Oe(s.gl.LEQUAL,Oe.ReadOnly,o.depthRangeFor3D);for(const a of this._groundShadowTiles){const l=a.toUnwrapped(),c=o.isTileAffectedByFog(a),h=o.getOrCreateProgram("groundShadow",{defines:e,overrideFog:c});this.setupShadows(l,h),o.uploadCommonUniforms(s,h,l,null,t);var n={u_matrix:o.transform.calculateProjMatrix(l),u_ground_shadow_factor:i};h.draw(o,s.gl.TRIANGLES,r,Be.disabled,Fe.multiply,Ne.disabled,n,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Fe.unblended:Fe.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){var t=this.painter.transform,e=t.calculatePosMatrix(e,t.worldSize);return Re.a6.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}calculateShadowPassMatrixFromMatrix(e){return Re.a6.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,t,i,r=0){if(this._enabled){const n=this.painter.transform,o=this.painter.context,a=o.gl,s=this._uniformValues,l=new Float64Array(16),c=n.calculatePosMatrix(e,n.worldSize);for(let e=0;e<this._cascades.length;e++)Re.a6.multiply(l,this._cascades[e].matrix,c),s[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(a.TEXTURE0+x.ShadowMap0+e),this._cascades[e].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const t=Re.bR(e.canonical),o=2/n.tileSize*Re.V/b.shadowMapResolution,a=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===i?1:3)/Math.pow(2,r-e.canonical.z-(1-n.zoom+Math.floor(n.zoom)));s.u_shadow_normal_offset=[t,a*c,l*c],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(o,s)}}setupShadowsFromMatrix(t,e,i=!1){if(this._enabled){var r=this.painter.context,n=r.gl,o=this._uniformValues,a=new Float64Array(16);for(let e=0;e<b.cascadeCount;e++)Re.a6.multiply(a,this._cascades[e].matrix,t),o[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),r.activeTexture.set(n.TEXTURE0+x.ShadowMap0+e),this._cascades[e].texture.bind(n.NEAREST,n.CLAMP_TO_EDGE);if(this.useNormalOffset=i){const Re=5;o.u_shadow_normal_offset=[1,5,5],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];e.setShadowUniformValues(r,o)}}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,t,i,r){var n;return 0<=r[2]?{}:(n=i/(1<<e.canonical.z),n=new Re.bS([e.canonical.x*n+e.wrap*i,e.canonical.y*n+e.wrap*i,0],[(e.canonical.x+1)*n+e.wrap*i,(e.canonical.y+1)*n+e.wrap*i,t]).getCorners(),e=t/-r[2],r[0]<0?(Re.N.add(n[0],n[0],[r[0]*e,0,0]),Re.N.add(n[3],n[3],[r[0]*e,0,0])):0<r[0]&&(Re.N.add(n[1],n[1],[r[0]*e,0,0]),Re.N.add(n[2],n[2],[r[0]*e,0,0])),r[1]<0?(Re.N.add(n[0],n[0],[0,r[1]*e,0]),Re.N.add(n[1],n[1],[0,r[1]*e,0])):0<r[1]&&(Re.N.add(n[2],n[2],[0,r[1]*e,0]),Re.N.add(n[3],n[3],[0,r[1]*e,0])),(i={}).vertices=n,i.planes=[sr(n[1],n[0],n[4]),sr(n[2],n[1],n[5]),sr(n[3],n[2],n[6]),sr(n[0],n[3],n[7])],i)}addShadowReceiver(e,t,i){this._receivers.add(e,Re.bS.fromTileIdAndHeight(e,t,i))}getMaxCascadeForTile(e){e=this._receivers.get(e);return e&&e.lastCascade?e.lastCascade:0}}function sr(e,t,i){i=Re.N.sub([],i,t),e=Re.N.sub([],e,t),i=Re.N.cross([],i,e),e=Re.N.length(i);return 0===e?[0,0,1,0]:(Re.N.scale(i,i,1/e),[i[0],i[1],i[2],-Re.N.dot(i,t)])}function lr(e){e=e.properties.get("direction"),e=Re.bQ(e.x,e.y,e.z),e[2]=Re.aa(e[2],0,75),e=Re.bT([e[0],e[1],e[2]]);return Re.N.fromValues(e.x,e.y,e.z)}function cr(e,t){var i=e.properties.get("color"),r=e.properties.get("intensity"),e=e.properties.get("direction"),e=[e.x,e.y,e.z],n=t.properties.get("color"),t=t.properties.get("intensity"),e=Math.max(Re.N.dot([0,0,1],e),0),o=[0,0,0],n=(Re.N.scale(o,n.toArray01Linear().slice(0,3),t),[0,0,0]);return Re.N.scale(n,i.toArray01Linear().slice(0,3),e*r),Re.bU([0<o[0]?o[0]/(o[0]+n[0]):0,0<o[1]?o[1]/(o[1]+n[1]):0,0<o[2]?o[2]/(o[2]+n[2]):0])}const w=(e,t)=>xe(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),hr=Re.ac(D,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),ur=Re.ac(D,["setCenter","setZoom","setBearing","setPitch"]),dr={version:8,layers:[],sources:{}},pr={duration:300,delay:0},fr=new Set(["fill","line","background","hillshade","raster"]);class n extends Re.E{constructor(e,t={}){super(),this.map=e,this.scope=t.scope||"",this.fragments=[],this.importDepth=t.importDepth||0,this.importsCache=t.importsCache||new Map,this.resolvedImports=t.resolvedImports||new Set,this.transition=Re.e({},pr),this._buildingIndex=new Yt(this),this.crossTileSymbolIndex=new Zi,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=t.styleChanges||new G,this.dispatcher=t.dispatcher||new Re.bW(Re.bX(),this),t.imageManager?this.imageManager=t.imageManager:(this.imageManager=new H,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=t.glyphManager||new Re.bY(e._requestManager,t.localFontFamily?Re.bZ.all:t.localIdeographFontFamily?Re.bZ.ideographs:Re.bZ.none,t.localFontFamily||t.localIdeographFontFamily),t.modelManager?this.modelManager=t.modelManager:(this.modelManager=new q(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=t.configOptions||new Map,this._configDependentLayers=t.configDependentLayers||new Set,this._config=t.config,this.dispatcher.broadcast("setReferrer",Re.b_());const i=this;this._rtlTextPluginCallback=n.registerForPluginStateChange(e=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,t)=>{if(Re.b$(e),t&&t.every(e=>e))for(const Re in i._sourceCaches){const e=i._sourceCaches[Re],t=e.getSource().type;"vector"!==t&&"geojson"!==t||e.reload()}})}),this.on("data",e=>{if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){var i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}})}loadURL(i,e={}){this.fire(new Re.b("dataloading",{dataType:"style"}));const r="boolean"==typeof e.validate?e.validate:!Re.c0(i);i=this.map._requestManager.normalizeStyleURL(i,e.accessToken),this.resolvedImports.add(i);e=this.importsCache.get(i);if(e)return this._load(e,r);e=this.map._requestManager.transformRequest(i,Re.R.Style);this._request=Re.g(e,(e,t)=>{if(this._request=null,e)this.fire(new Re.a(e));else if(t)return this.importsCache.set(i,t),this._load(t,r)})}loadJSON(e,t={}){this.fire(new Re.b("dataloading",{dataType:"style"})),this._request=Re.f.frame(()=>{this._request=null,this._load(e,!1!==t.validate)})}loadEmpty(){this.fire(new Re.b("dataloading",{dataType:"style"})),this._load(dr,!1)}_loadImports(t,e,i){if(4<=this.importDepth)return Re.w("Style doesn't support nesting deeper than 5"),Promise.resolve();var r=[];for(const Re of t){const t=this._createFragmentStyle(Re),o=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(r.push(o),this.resolvedImports.has(Re.url))t.loadEmpty();else{var n=Re.data||this.importsCache.get(Re.url),n=(n?t.loadJSON(n,{validate:e}):Re.url?t.loadURL(Re.url,{validate:e}):t.loadEmpty(),{style:t,id:Re.id,config:Re.config});if(i){const Re=this.fragments.findIndex(({id:e})=>e===i);this.fragments=this.fragments.slice(0,Re).concat(n).concat(this.fragments.slice(Re))}else this.fragments.push(n)}}return Promise.allSettled(r)}_createFragmentStyle(e){var t=this.scope?Re.ag(e.id,this.scope):e.id,t=new n(this.map,{scope:t,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return t.setEventedParent(this.map,{style:t}),t}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});var e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Re.b(e?"style.load":"style.import.load"))}_load(e,t){const i=e.schema;if(this.isRootStyle()&&(e.fragment||i&&!1!==e.fragment)){const i=Re.e({},dr,{imports:[{id:"basemap",data:e,url:""}]});void this._load(i,t)}else if(this.setConfig(this._config,i),!t||!w(this,a(e))){this._loaded=!0,this.stylesheet=Re.c1(e);for(const Re in e.sources)this.addSource(Re,e.sources[Re],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=Kt(this.stylesheet.layers);if(this._order=n.map(e=>e.id),this.stylesheet.light&&Re.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const Re=this.stylesheet.lights[0];this.light=new we(Re.properties,Re.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new we(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of n){const t=Re.c2(e,this.scope,this.options),i=(t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),this.getOwnLayerSourceCache(t)),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();i&&t.canCastShadows()&&n&&(i.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);var r=this.stylesheet.terrain;r&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=Re.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?Re.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(r,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Re.b("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,t).then(()=>this._reloadImports()):this._reloadImports()}}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,i,r,n,o,a,s,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(i=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(r=e.directionalLight);n=this._prioritizeTerrain(n,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(o=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(a=e.stylesheet.projection),null!=e.stylesheet.transition&&(s=e.stylesheet.transition)}}),this.light=t,this.ambientLight=i,this.directionalLight=r,this.fog=o,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=Re.e({},pr,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const i=e=>{for(const t of e.fragments)i(t.style);t(e)};i(this)}_prioritizeTerrain(e,t,i){var r=e&&0===e.drapeRenderMode;return null===i?t&&0===t.drapeRenderMode?t:r?e:null:null!=t&&(!e||r||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)}),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},i={},r={};this.forEachFragmentStyle(e=>{for(const i in e._sourceCaches){const r=Re.ag(i,e.scope);t[r]=e._sourceCaches[i]}for(const t in e._otherSourceCaches){const r=Re.ag(t,e.scope);i[r]=e._otherSourceCaches[t]}for(const t in e._symbolSourceCaches){const i=Re.ag(t,e.scope);r[i]=e._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){const r={},n=[],i={},o=(this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(e=>{for(const i of e._order){var t=e._layers[i];if("slot"===t.type){const n=Re.c3(i);if(r[n])continue;r[n]=[]}(t.slot&&r[t.slot]?r[t.slot]:n).push(t)}}),this._mergedOrder=[],(e=[])=>{for(const t of e)if("slot"===t.type){const e=Re.c3(t.id);r[e]&&o(r[e])}else{const r=Re.ag(t.id,t.scope);this._mergedOrder.push(r),(i[r]=t).is3D()&&(this._has3DLayers=!0),"circle"===t.type&&(this._hasCircleLayers=!0),"symbol"===t.type&&(this._hasSymbolLayers=!0)}});o(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Re.e({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,t,h){let u,d,p;var i=1<Re.f.devicePixelRatio?"@2x":"";let r=Re.g(t.transformRequest(t.normalizeSpriteURL(e,i,".json"),Re.R.SpriteJSON),(e,t)=>{r=null,p||(p=e,u=t,o())}),n=Re.d(t.transformRequest(t.normalizeSpriteURL(e,i,".png"),Re.R.SpriteImage),(e,t)=>{n=null,p||(p=e,d=t,o())});function o(){if(p)h(p);else if(u&&d){var e=Re.f.getImageData(d),t={};for(const h in u){const{width:d,height:p,x:i,y:r,sdf:n,pixelRatio:o,stretchX:a,stretchY:s,content:l}=u[h],c=new Re.h({width:d,height:p});Re.h.copy(e,c,{x:i,y:r},{x:0,y:0},{width:d,height:p}),t[h]={data:c,pixelRatio:o,sdf:n,stretchX:a,stretchY:s,content:l}}h(null,t)}}return{cancel(){r&&(r.cancel(),r=null),n&&(n.cancel(),n=null)}}}(e,this.map._requestManager,(e,t)=>{if(this._spriteRequest=null,e)this.fire(new Re.a(e));else if(t)for(const Re in t)this.imageManager.addImage(Re,this.scope,t[Re]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Re.b("data",{dataType:"style"}))})}_validateLayer(e){var t,i=this.getOwnSource(e.source);i&&(t=e.sourceLayer)&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(t))&&this.fire(new Re.a(new Error(`Source layer "${t}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(var{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{t=this.fragments[t];return t&&t.style&&(e.data=t.style.serialize()),e})}_serializeSources(){var e={};for(const i in this._sourceCaches){var t=this._sourceCaches[i].getSource();e[t.id]||(e[t.id]=t.serialize())}return e}_serializeLayers(e){var t=[];for(const i of e){const e=this._layers[i];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):fr.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){var t=this.getOwnLayer(e);if(t)return t;this.fire(new Re.a(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){var t=this.getOwnSource(e);if(t)return t;this.fire(new Re.a(new Error(`The source '${e}' does not exist in the map's style.`)))}update(t){if(this._loaded){this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness(),r=(t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i)),this._changes.isDirty());if(this._changes.isDirty()){const Re=this._changes.getLayerUpdatesByScope();for(const t in Re){const{updatedIds:i,removedIds:r}=Re[t];(i||r)&&this._updateWorkerLayers(t,i,r)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const n={};for(const Re in this._mergedSourceCaches){const t=this._mergedSourceCaches[Re];n[Re]=t.used,t.used=!1,t.tileCoverLift=0}for(const Re of this._mergedOrder){const i=this._mergedLayers[Re];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const Re=this.getLayerSourceCache(i);Re&&(Re.used=!0,Re.tileCoverLift=Math.max(Re.tileCoverLift,i.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let e=i.minzoom||0;e<(i.maxzoom||25.5);e++){const Re=this.map.painter;if(Re){const r=i.getProgramIds();if(r)for(const n of r){const r=i.getDefaultProgramParams(n,t.zoom);r&&((Re.style=this).fog&&(Re._fogVisible=!0,r.overrideFog=!0,Re.getOrCreateProgram(n,r)),Re._fogVisible=!1,r.overrideFog=!1,Re.getOrCreateProgram(n,r),this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,Re.getOrCreateProgram(n,r))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const t in n){const i=this._mergedSourceCaches[t];n[t]!==i.used&&i.getSource().fire(new Re.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new Re.b("data",{dataType:"style"}))}}_updateTilesForChangedImages(){var e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,i){var r=this.getFragmentStyle(e);r&&this.dispatcher.broadcast("updateLayers",{layers:t?r._serializeLayers(t):[],scope:e,removedIds:i||[],options:r.options})}setState(e){if(this._checkLoaded(),w(this,a(e)))return!1;(e=Re.c1(e)).layers=Kt(e.layers);var t=function(n,s){if(!n)return[{command:D.setStyle,args:[s]}];let l=[];try{if(!L(n.version,s.version))return[{command:D.setStyle,args:[s]}];if(L(n.center,s.center)||l.push({command:D.setCenter,args:[s.center]}),L(n.zoom,s.zoom)||l.push({command:D.setZoom,args:[s.zoom]}),L(n.bearing,s.bearing)||l.push({command:D.setBearing,args:[s.bearing]}),L(n.pitch,s.pitch)||l.push({command:D.setPitch,args:[s.pitch]}),L(n.sprite,s.sprite)||l.push({command:D.setSprite,args:[s.sprite]}),L(n.glyphs,s.glyphs)||l.push({command:D.setGlyphs,args:[s.glyphs]}),!L(n.imports,s.imports)){var[o=[],a=[],c]=[n.imports,s.imports,l];a=a||[];var h=(o=o||[]).map(ti),u=a.map(ti),d=o.reduce(ii,{}),p=a.reduce(ii,{}),f=h.slice();let e,t,i,r;for(e=0,t=0;e<h.length;e++)i=h[e],p.hasOwnProperty(i)?t++:(c.push({command:D.removeImport,args:[i]}),f.splice(f.indexOf(i,t),1));for(e=0,t=0;e<u.length;e++)i=u[u.length-1-e],f[f.length-1-e]!==i&&(d.hasOwnProperty(i)?(c.push({command:D.removeImport,args:[i]}),f.splice(f.lastIndexOf(i,f.length-t),1)):t++,r=f[f.length-e],c.push({command:D.addImport,args:[p[i],r]}),f.splice(f.length-e,0,i));for(const o of a){const a=d[o.id];a&&!L(a,o)&&c.push({command:D.updateImport,args:[o.id,o]})}}L(n.transition,s.transition)||l.push({command:D.setTransition,args:[s.transition]}),L(n.light,s.light)||l.push({command:D.setLight,args:[s.light]}),L(n.fog,s.fog)||l.push({command:D.setFog,args:[s.fog]}),L(n.projection,s.projection)||l.push({command:D.setProjection,args:[s.projection]}),L(n.lights,s.lights)||l.push({command:D.setLights,args:[s.lights]}),L(n.camera,s.camera)||l.push({command:D.setCamera,args:[s.camera]});const M={},I=[];{var t=n.sources;var i=s.sources;var r=I;var m=M;let e;for(e in i=i||{},t=t||{})!t.hasOwnProperty(e)||i.hasOwnProperty(e)||Qt(e,r,m);for(e in i)i.hasOwnProperty(e)&&(g=i[e],t.hasOwnProperty(e)?L(t[e],g)||("geojson"===t[e].type&&"geojson"===g.type&&function(e,t,i){let r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!L(e[i][r],t[i][r]))return;for(r in t[i])if(t[i].hasOwnProperty(r)&&"data"!==r&&!L(e[i][r],t[i][r]))return;return 1}(t,i,e)?r.push({command:D.setGeoJSONSourceData,args:[e,g.data]}):(g=e,_=i,Qt(g,y=r,m),Jt(g,_,y))):Jt(e,i,r));var g,_,y}const P=[];n.layers&&n.layers.forEach(e=>{e.source&&M[e.source]?l.push({command:D.removeLayer,args:[e.id]}):P.push(e)});let e=n.terrain;e&&M[e.source]&&(l.push({command:D.setTerrain,args:[void 0]}),e=void 0),l=l.concat(I),L(e,s.terrain)||l.push({command:D.setTerrain,args:[s.terrain]});{var v=P;var x=s.layers;var b=l;x=x||[];var w=(v=v||[]).map(ti),T=x.map(ti),S=v.reduce(ii,{}),A=x.reduce(ii,{}),E=w.slice(),C=Object.create(null);let e,t,i,r,n,o,a;for(e=0,t=0;e<w.length;e++)i=w[e],A.hasOwnProperty(i)?t++:(b.push({command:D.removeLayer,args:[i]}),E.splice(E.indexOf(i,t),1));for(e=0,t=0;e<T.length;e++)i=T[T.length-1-e],E[E.length-1-e]!==i&&(S.hasOwnProperty(i)?(b.push({command:D.removeLayer,args:[i]}),E.splice(E.lastIndexOf(i,E.length-t),1)):t++,o=E[E.length-e],b.push({command:D.addLayer,args:[A[i],o]}),E.splice(E.length-e,0,i),C[i]=!0);for(e=0;e<T.length;e++)if(i=T[e],r=S[i],n=A[i],!C[i]&&!L(r,n))if(L(r.source,n.source)&&L(r["source-layer"],n["source-layer"])&&L(r.type,n.type)){for(a in ei(r.layout,n.layout,b,i,null,D.setLayoutProperty),ei(r.paint,n.paint,b,i,null,D.setPaintProperty),L(r.slot,n.slot)||b.push({command:D.setSlot,args:[i,n.slot]}),L(r.filter,n.filter)||b.push({command:D.setFilter,args:[i,n.filter]}),L(r.minzoom,n.minzoom)&&L(r.maxzoom,n.maxzoom)||b.push({command:D.setLayerZoomRange,args:[i,n.minzoom,n.maxzoom]}),r)r.hasOwnProperty(a)&&"layout"!==a&&"paint"!==a&&"filter"!==a&&"metadata"!==a&&"minzoom"!==a&&"maxzoom"!==a&&"slot"!==a&&(0===a.indexOf("paint.")?ei(r[a],n[a],b,i,a.slice(6),D.setPaintProperty):L(r[a],n[a])||b.push({command:D.setLayerProperty,args:[i,a,n[a]]}));for(a in n)n.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&"layout"!==a&&"paint"!==a&&"filter"!==a&&"metadata"!==a&&"minzoom"!==a&&"maxzoom"!==a&&"slot"!==a&&(0===a.indexOf("paint.")?ei(r[a],n[a],b,i,a.slice(6),D.setPaintProperty):L(r[a],n[a])||b.push({command:D.setLayerProperty,args:[i,a,n[a]]}))}else b.push({command:D.removeLayer,args:[i]}),o=E[E.lastIndexOf(i)+1],b.push({command:D.addLayer,args:[n,o]})}}catch(n){console.warn("Unable to compute style diff:",n),l=[{command:D.setStyle,args:[s]}]}return l}(this.serialize(),e).filter(e=>!(e.command in ur));if(0===t.length)return!1;var i=t.filter(e=>!(e.command in hr));if(0<i.length)throw new Error(`Unimplemented: ${i.map(e=>e.command).join(", ")}.`);return t.forEach(e=>{this[e.command].apply(this,e.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,t){return this.getImage(e)?this.fire(new Re.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,t),this._afterImageUpdated(e),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new Re.a(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Re.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t,i={}){return this._checkLoaded(),this._validate(ve,"models."+e,t,null,i)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new Re.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,t,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!t.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(t).join(", ")}.`);if(!(0<=["vector","raster","geojson","video","image"].indexOf(t.type)&&this._validate(de,"sources."+e,t,null,i))){this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const r=jt(e,t,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id}));e=e=>{var t=(e?"symbol:":"other:")+r.id,i=Re.ag(t,this.scope),t=this._sourceCaches[t]=new v(i,r,e);((e?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=t).onAdd(this.map)};e(!1),"vector"!==t.type&&"geojson"!==t.type||e(!0),r.onAdd&&r.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}}removeSource(e){this._checkLoaded();const t=this.getOwnSource(e);if(!t)throw new Error("There is no source with this ID");for(const t in this._layers)if(this._layers[t].source===e)return this.fire(new Re.a(new Error(`Source "${e}" cannot be removed while layer "${t}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new Re.a(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));var i=this.getOwnSourceCaches(e);for(const e of i){const t=Re.c3(e.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(e.id),e.fire(new Re.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){e=this.getOwnSourceCache(e);return e&&e.getSource()}getOwnSources(){var e=[];for(const i in this._otherSourceCaches){var t=this.getOwnSourceCache(i);t&&e.push(t.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const r in e){var t=e[r]._tiles;for(const e in t){var i=t[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0}setLights(e){if(this._checkLoaded(),e){var t=this._getTransitionParameters();for(const Re of e){if(this._validate(fe,"lights",Re))return;switch(Re.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(Re),e.updateTransitions(t)}else this.ambientLight=new ke(Re,ze,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(Re),e.updateTransitions(t)}else this.directionalLight=new ke(Re,Ue,this.scope,this.options)}}e=new Re.K(this.z||0,t);this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}else delete this.ambientLight,delete this.directionalLight}calculateLightsBrightness(){var e,t,i,r=this.directionalLight,n=this.ambientLight;if(r&&n)return e=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),t=r.properties.get("color").toArray01(),i=r.properties.get("intensity"),r=r.properties.get("direction"),r=1-Re.bQ(r.x,r.y,r.z)[2]/90,t=e(t)*i*r,i=n.properties.get("color").toArray01(),r=n.properties.get("intensity"),(t+e(i)*r)/2}getBrightness(){return this._brightness}getLights(){var e;return this.enable3dLights()?(e=[],this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e):null}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(Re.c4(t)){const i=Re.c5(t),r=this.fragments.find(({id:e})=>e===i);var e;if(r)return e=Re.c3(t),r.style.getFragmentStyle(e);throw new Error("Style import not found: "+t)}{const Re=this.fragments.find(({id:e})=>e===t);if(Re)return Re.style;throw new Error("Style import not found: "+t)}}getConfigProperty(e,t){var e=this.getFragmentStyle(e);return e&&(t=Re.ag(t,e.scope),t=(e=e.options.get(t))?e.value||e.default:null)?t.serialize():null}setConfigProperty(e,t,i){var i=Re.r(i);"success"!==i.result?w(this,i.value):(i=i.value.expression,(e=this.getFragmentStyle(e))&&(t=Re.ag(t,e.scope),e=e.options.get(t))&&(this.options.set(t,{...e,value:i}),this.updateConfigDependencies()))}setConfig(i,r){if((this._config=i)||r)if(r)for(const c in r){let e,t;var n=Re.r(r[c].default);if("success"===n.result&&(e=n.value.expression),i&&void 0!==i[c]){const r=Re.r(i[c]);"success"===r.result&&(t=r.value.expression)}var{minValue:n,maxValue:o,stepValue:a,type:s,values:l}=r[c];if(e){const i=Re.ag(c,this.scope);this.options.set(i,{default:e,value:t,minValue:n,maxValue:o,stepValue:a,type:s,values:l})}else this.fire(new Re.a(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new Re.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){var e=this.getLayer(t);e&&(e.possiblyEvaluateVisibility(),this._updateLayer(e))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(i,r,n={}){this._checkLoaded();var o=i.id;if(this._layers[o])this.fire(new Re.a(new Error(`Layer with id "${o}" already exists on this map`)));else{let e;if("custom"===i.type){if(w(this,Re.c6(i)))return;e=Re.c2(i,this.scope,this.options)}else{if("object"==typeof i.source&&(this.addSource(o,i.source),i=Re.c1(i),i=Re.e(i,{source:o})),this._validate(_e,"layers."+o,i,{arrayIndex:-1},n))return;e=Re.c2(i,this.scope,this.options),this._validateLayer(e),e.setEventedParent(this,{layer:{id:o}}),this._serializedLayers[e.id]=e.serialize()}e.isConfigDependent&&this._configDependentLayers.add(e.fqid);let t=this._order.length;if(r){const i=this._order.indexOf(r);if(-1===i)return void this.fire(new Re.a(new Error(`Layer with id "${r}" does not exist on this map.`)));e.slot===this._layers[r].slot?t=i:Re.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(t,0,o),this._layerOrderChanged=!0,this._layers[o]=e;n=this.getOwnLayerSourceCache(e),i=!!this.directionalLight&&this.directionalLight.shadowsEnabled(),r=(n&&e.canCastShadows()&&i&&(n.castsShadows=!0),this._changes.getRemovedLayer(e));if(r&&e.source&&n&&"custom"!==e.type){this._changes.discardLayerRemoval(e);const i=Re.ag(e.source,e.scope);r.type!==e.type?this._changes.updateSourceCache(i,"clear"):(this._changes.updateSourceCache(i,"reload"),n.pause())}this._updateLayer(e),e.onAdd&&e.onAdd(this.map),e.scope=this.scope,this.mergeLayers()}}moveLayer(t,i){this._checkLoaded();var r=this._checkLayer(t);if(r&&t!==i){var n=this._order.indexOf(t);this._order.splice(n,1);let e=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new Re.a(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?e=t:Re.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(e,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}}removeLayer(t){this._checkLoaded();var i=this._checkLayer(t);if(i){i.setEventedParent(null);const r=this._order.indexOf(t);this._order.splice(r,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);t=this.getOwnLayerSourceCache(i);if(t&&t.castsShadows){let e=!1;for(const r in this._layers)if(this._layers[r].source===i.source&&this._layers[r].canCastShadows()){e=!0;break}t.castsShadows=e}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,i){this._checkLoaded();e=this._checkLayer(e);!e||e.minzoom===t&&e.maxzoom===i||(null!=t&&(e.minzoom=t),null!=i&&(e.maxzoom=i),this._updateLayer(e))}setSlot(e,t){this._checkLoaded();e=this._checkLayer(e);e&&e.slot!==t&&(e.slot=t,this._updateLayer(e))}setFilter(e,t,i={}){this._checkLoaded();e=this._checkLayer(e);if(e&&!L(e.filter,t))return null==t?(e.filter=void 0,void this._updateLayer(e)):void(this._validate(ye,`layers.${e.id}.filter`,t,{layerType:e.type},i)||(e.filter=Re.c1(t),this._updateLayer(e)))}getFilter(e){e=this._checkLayer(e);if(e)return Re.c1(e.filter)}setLayoutProperty(e,t,i,r={}){this._checkLoaded();var n=this._checkLayer(e);n&&!L(n.getLayoutProperty(t),i)&&(null==i||r&&!1===r.validate||!w(n,(e=>s(ee(e))).call(a,{key:`layers.${e}.layout.`+t,layerType:n.type,objectKey:t,value:i,styleSpec:Re.D,style:{glyphs:!0,sprite:!0}})))&&(n.setLayoutProperty(t,i),n.isConfigDependent&&this._configDependentLayers.add(n.fqid),this._updateLayer(n))}getLayoutProperty(e,t){e=this._checkLayer(e);if(e)return e.getLayoutProperty(t)}setPaintProperty(e,t,i,r={}){this._checkLoaded();var n=this._checkLayer(e);n&&!L(n.getPaintProperty(t),i)&&(null==i||r&&!1===r.validate||!w(n,(e=>s(Q(e))).call(a,{key:`layers.${e}.paint.`+t,layerType:n.type,objectKey:t,value:i,styleSpec:Re.D})))&&(r=n.setPaintProperty(t,i),n.isConfigDependent&&this._configDependentLayers.add(n.fqid),r&&this._updateLayer(n),this._changes.updatePaintProperties(n))}getPaintProperty(e,t){e=this._checkLayer(e);if(e)return e.getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();var i=e.source,r=e.sourceLayer,n=this._checkSource(i);if(n){n=n.type;if("geojson"===n&&r)this.fire(new Re.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));else if("vector"!==n||r){void 0===e.id&&this.fire(new Re.a(new Error("The feature id parameter must be provided.")));for(const Re of this.getOwnSourceCaches(i))Re.setFeatureState(r,e.id,t)}else this.fire(new Re.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}removeFeatureState(e,t){this._checkLoaded();var i=e.source,r=this._checkSource(i);if(r){var r=r.type,n="vector"===r?e.sourceLayer:void 0;if("vector"!==r||n)if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)this.fire(new Re.a(new Error("A feature id is required to remove its specific state property.")));else for(const Re of this.getOwnSourceCaches(i))Re.removeFeatureState(n,e.id,t);else this.fire(new Re.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}getFeatureState(e){this._checkLoaded();var t=e.source,i=e.sourceLayer,r=this._checkSource(t);if(r){if("vector"!==r.type||i)return void 0===e.id&&this.fire(new Re.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(t)[0].getFeatureState(i,e.id);this.fire(new Re.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Re.e({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Re.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();var e=this.getTerrain(),e=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return Re.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:e,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateLayer(e){this._changes.updateLayer(e);var t=this.getLayerSourceCache(e),i=Re.ag(e.source,e.scope),r=this._changes.getUpdatedSourceCaches();e.source&&!r[i]&&t&&"raster"!==t.getSource().type&&(this._changes.updateSourceCache(i,"reload"),t.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const r=e=>"fill-extrusion"===this._mergedLayers[e].type||"model"===this._mergedLayers[e].type,n=this.order,o={},a=[];for(let e=n.length-1;0<=e;e--){var t=n[e];if(r(t)){o[t]=e;for(const r of i){const i=r[t];if(i)for(const r of i)a.push(r)}}}a.sort((e,t)=>t.intersectionZ-e.intersectionZ);var s=[];for(let t=n.length-1;0<=t;t--){var e=n[t];if(r(e))for(let e=a.length-1;0<=e;e--){const r=a[e].feature;if(o[r.layer.id]<t)break;s.push(r),a.pop()}else for(const r of i){const i=r[e];if(i)for(const r of i)s.push(r.feature)}}return s}queryRenderedFeatures(e,t,i){t&&t.filter&&this._validate(ye,"queryRenderedFeatures.filter",t.filter,null,t),t.scope=this.scope,t.availableImages=this._availableImages,t.serializedLayers=this._serializedLayers;var r={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new Re.a(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._mergedLayers[e];if(!t)return this.fire(new Re.a(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[t.source]=!0}}var n,o=[],a=t.serializedLayers||{},s=t&&t.layers?t.layers.some(e=>{e=this.getLayer(e);return e&&e.is3D()}):this.has3DLayers(),l=je.createFromScreenPoints(e,i);for(const Re in this._mergedSourceCaches){const e=this._mergedSourceCaches[Re].getSource();e&&e.scope===t.scope&&(n=this._mergedSourceCaches[Re].getSource().id,t.layers&&!r[n]||o.push(Gt(this._mergedSourceCaches[Re],this._mergedLayers,a,l,t,i,s,!!this.map._showQueryGeometry)))}return this.placement&&o.push(function(i,r,n,e,t,o,a){var s={},l=o.queryRenderedSymbols(e),c=[];for(const i of Object.keys(l).map(Number))c.push(a[i]);c.sort(qt);for(const n of c){const e=n.featureIndex.lookupSymbolFeatures(l[n.bucketInstanceId],r,n.bucketIndex,n.sourceLayerIndex,t.filter,t.layers,t.availableImages,i);for(const i in e){const r=s[i]=s[i]||[],t=e[i];t.sort((e,t)=>{var i=n.featureSortOrder;if(i){const n=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex});for(const i of t)r.push(i)}}for(const r in s)s[r].forEach(e=>{var e=e.feature,t=n(i[r]);t&&(t=t.getFeatureState(e.layer["source-layer"],e.id),e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=t)});return s}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),l.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,t){t&&t.filter&&this._validate(ye,"querySourceFeatures.filter",t.filter,null,t);var i=this.getOwnSourceCaches(e);let r=[];for(const e of i)r=r.concat(function(t,i){var r=t.getRenderableIds().map(e=>t.getTileByID(e)),n=[],o={};for(let e=0;e<r.length;e++){var a=r[e],s=a.tileID.canonical.key;o[s]||(o[s]=!0,a.querySourceFeatures(n,i))}return n}(e,t));return r}addSourceType(e,t,i){return n.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(n.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,t,i={}){this._checkLoaded();var r,n=this.light.getLight();let o=!1;for(const t in e)if(!L(e[t],n[t])){o=!0;break}o&&(r=this._getTransitionParameters(),this.light.setLight(e,t,i),this.light.updateTransitions(r))}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,i=1){if(this._checkLoaded(),t){let e=t;const r=null==t.source;if(1===i){if("object"==typeof e.source){const L="terrain-dem-src";this.addSource(L,e.source),e=Re.c1(e),e=Re.e(e,{source:L})}const L=Re.e({},e),t={};if(this.terrain&&r){L.source=this.terrain.get().source;const Re=this.terrain?this.getFragmentStyle(this.terrain.scope):null;Re&&(t.style=Re.serialize())}if(this._validate(me,"terrain",L,t))return}if(!this.terrain||this.terrain.scope!==this.scope&&!r||this.terrain&&i!==this.terrain.drapeRenderMode){if(!e)return;this._createTerrain(e,i),this.fire(new Re.b("data",{dataType:"style"}))}else{const i=this.terrain,r=i.get();for(const L of Object.keys(Re.D.terrain))!e.hasOwnProperty(L)&&Re.D.terrain[L].default&&(e[L]=Re.D.terrain[L].default);for(const e in t)if(!L(t[e],r[e])){i.set(t,this.options),this.stylesheet.terrain=t;const L=this._getTransitionParameters({duration:0});i.updateTransitions(L),this.fire(new Re.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers()}else this.terrainSetForDrapingOnly()&&0!==i||delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate();this._markersNeedUpdate=!0}_createFog(e){var e=this.fog=new De(e,this.map.transform,this.scope,this.options),t=(this.stylesheet.fog=e.get(),this._getTransitionParameters({duration:0}));e.updateTransitions(t)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),e)if(this.fog){var t=this.fog;if(!L(t.get(),e)){t.set(e,this.options),this.stylesheet.fog=t.get();const L=this._getTransitionParameters({duration:0});t.updateTransitions(L)}}else this._createFog(e);else delete this.fog,delete this.stylesheet.fog;this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:Re.f.now(),transition:Re.e(this.transition,e)}}updateDrapeFirstLayers(){if(this.terrain){var e=[],t=[];for(const i in this._mergedLayers)(this.isLayerDraped(this._mergedLayers[i])?e:t).push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}}_createTerrain(e,t){var i=this.terrain=new Se(e,t,this.scope,this.options),t=(1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate(),this._getTransitionParameters({duration:0}));i.updateTransitions(t)}_force3DLayerUpdate(){for(const t in this._layers){var e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){var e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,t,i,r,n={}){return(!n||!1!==n.validate)&&(n=Re.e({},this.serialize()),w(this,e.call(a,Re.e({key:t,style:n,value:i,styleSpec:Re.D},r))))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Re.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const Re in this._mergedLayers)this._mergedLayers[Re].setEventedParent(null);for(const Re in this._mergedSourceCaches)this._mergedSourceCaches[Re].clearTiles(),this._mergedSourceCaches[Re].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){var t=this.getSourceCaches(e);for(const e of t)e.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){var t=this.getSourceCaches(e);for(const e of t)e.resume(),e.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=lr(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){var e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(t,e,i,r,n=!1){let o=!1,a=!1;var s={},l={};for(const e of this._mergedOrder){const i=this._mergedLayers[e];if("symbol"===i.type){const r=Re.ag(i.source,i.scope);let e=s[r];if(!e){const Re=this.getLayerSourceCache(i);if(!Re)continue;const t=Re.getRenderableIds(!0).map(e=>Re.getTileByID(e));l[r]=t.slice(),e=s[r]=t.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const a=this.crossTileSymbolIndex.addLayer(i,e,t.center.lng,t.projection);o=o||a}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),n=n||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new Re.b("neworder")),(n||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Re.f.now(),t.zoom))&&(this.pauseablePlacement=new Vi(t,this._mergedOrder,n,e,i,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,s,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Re.f.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o){this._buildingIndex.onNewFrame(t.zoom);for(const t of this._mergedOrder){const e=this._mergedLayers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,s[Re.ag(e.source,e.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Re.f.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();var e,r=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==r.findIndex(({id:e})=>e===t.id)?this.fire(new Re.a(new Error(`Import with id '${t.id}' already exists in the map's style.`))):i?-1===(e=r.findIndex(({id:e})=>e===i))?this.fire(new Re.a(new Error(`Import with id "${i}" does not exist on this map.`))):(this.stylesheet.imports=r.slice(0,e).concat(t).concat(r.slice(e)),this._loadImports([t],!0,i),this):(r.push(t),this._loadImports([t],!0),this)}updateImport(e,t){this._checkLoaded();var i=this.stylesheet.imports||[],r=this.getImportIndex(e);return-1===r||("string"==typeof t?this.setImportUrl(e,t):(t.url&&t.url!==i[r].url&&this.setImportUrl(e,t.url),L(t.config,i[r].config)||this.setImportConfig(e,t.config),L(t.data,i[r].data)||this.setImportData(e,t.data))),this}moveImport(t,e){this._checkLoaded();let i=this.stylesheet.imports||[];var r,n=this.getImportIndex(t);return-1!==n&&-1!==(e=this.getImportIndex(e))&&(r=i[n],n=this.fragments[n],i=i.filter(({id:e})=>e!==t),this.fragments=this.fragments.filter(({id:e})=>e!==t),this.stylesheet.imports=i.slice(0,e).concat(r).concat(i.slice(e)),this.fragments=this.fragments.slice(0,e).concat(n).concat(this.fragments.slice(e)),this.mergeLayers()),this}setImportUrl(e,t){this._checkLoaded();var i,r=this.stylesheet.imports||[],e=this.getImportIndex(e);return-1!==e&&(r[e].url=t,(i=this.fragments[e]).style=this._createFragmentStyle(r[e]),i.style.on("style.import.load",()=>this.mergeAll()),i.style.loadURL(t)),this}setImportData(e,t){this._checkLoaded();var i=this.getImportIndex(e),r=this.stylesheet.imports||[];return-1===i?this:t?(this.fragments[i].style.setState(t),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(e,r[i].url))}setImportConfig(e,t){this._checkLoaded();var e=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1!==e&&(t?i[e].config=t:delete i[e].config,e=(i=this.fragments[e]).style.stylesheet&&i.style.stylesheet.schema,i.config=t,i.style.setConfig(t,e),this.updateConfigDependencies()),this}removeImport(e){this._checkLoaded();var t=this.stylesheet.imports||[],e=this.getImportIndex(e);return-1!==e&&(t.splice(e,1),this.fragments[e].style._remove(),this.fragments.splice(e,1),this._reloadImports()),this}getImportIndex(t){var e=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===e&&this.fire(new Re.a(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),e}getLayer(e){return this._mergedLayers[e]}getSources(){var e=[];for(const i in this._mergedOtherSourceCaches){var t=this._mergedOtherSourceCaches[i];t&&e.push(t.getSource())}return e}getSource(e,t){e=this.getSourceCache(e,t);return e&&e.getSource()}getLayerSource(e){e=this.getLayerSourceCache(e);return e&&e.getSource()}getSourceCache(e,t){e=Re.ag(e,t);return this._mergedOtherSourceCaches[e]}getLayerSourceCache(e){var t=Re.ag(e.source,e.scope);return("symbol"===e.type?this._mergedSymbolSourceCaches:this._mergedOtherSourceCaches)[t]}getSourceCaches(e){var t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){var e=this._changes.getUpdatedSourceCaches();for(const i in e){var t=e[i];"reload"===t?this.reloadSource(i):"clear"===t&&this.clearSource(i)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const i of t){const t=this.getLayer(i);t&&t.updateTransitions(e)}}getImages(e,t,i){this.imageManager.getImages(t.icons,t.scope,i),this._updateTilesForChangedImages();i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,t.scope,i)}getResource(e,t,i){return Re.c9(t,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return("symbol"===e.type?this._symbolSourceCaches:this._otherSourceCaches)[e.source]}getOwnSourceCaches(e){var t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(e){var t=this.getOwnSourceCaches(e);return 0===t.length?(this.fire(new Re.a(new Error(`There is no source with ID '${e}'`))),!1):t.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}n.getSourceType=function(e){return Vt[e]},n.setSourceType=function(e,t){Vt[e]=t},n.registerForPluginStateChange=Re.bV;var mr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",gr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",_r="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",yr="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",vr="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",xr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",br="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",wr="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Tr="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",Sr="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Ar="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Er=[],Cr=(Dr(mr,Er),Dr(_r,Er),Dr(gr,Er),{"_prelude_fog.vertex.glsl":xr,"_prelude_terrain.vertex.glsl":vr,"_prelude_shadow.vertex.glsl":Sr,"_prelude_fog.fragment.glsl":br,"_prelude_shadow.fragment.glsl":Ar,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":wr,"_prelude_raster_particle.glsl":Tr}),Mr={},Ir=(i("",vr),i(br,xr),i(Ar,Sr),i(wr,""),i(Tr,""),i(gr,_r)),Pr=mr;var Lr={background:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:i("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:i('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:i("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:i("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:i("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:i("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:i("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:i('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:i("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:i("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:i("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:i("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:i("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:i('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:i('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:i('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:i("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:i('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',yr),skyboxGradient:i('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',yr),skyboxCapture:i("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:i('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:i('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:i("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:i("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Dr(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(var r of i)if(r=r.trim(),"#"===r[0]&&r.includes("if")&&!r.includes("endif")){const i=(r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim()).split(" ");for(const e of i)t.includes(e)||t.push(e)}}function i(t,i){var e=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map(e=>{e=e.split(" ");return e[e.length-1]}),n=[...new Set(n)]);const s={},o=[],a=[];if(t=t.replace(e,(e,t)=>(a.push(t),"")),!(i=i.replace(e,(e,t)=>(o.push(t),""))).includes("flat out")){let e=[...Er];Dr(t,e),Dr(i,e);for(const t of[...o,...a])Cr[t]||console.error("Undefined include: "+t),Mr[t]||(Mr[t]=[],Dr(Cr[t],Mr[t])),e=[...e,...Mr[t]];return{fragmentSource:t=t.replace(r,(e,t,i,r,n)=>(s[n]=!0,"define"===t?`
#ifndef HAS_UNIFORM_u_${n}
in ${i} ${r} ${n};
#else
uniform ${i} ${r} u_${n};
#endif
`:"initialize"===t?`
#ifdef HAS_UNIFORM_u_${n}
    ${i} ${r} ${n} = u_${n};
#endif
`:"define-attribute"===t?`
#ifdef HAS_ATTRIBUTE_a_${n}
    in ${i} ${r} ${n};
#endif
`:"initialize-attribute"===t?"":void 0)),vertexSource:i=i.replace(r,(e,t,i,r,n)=>{var o="float"===r?"vec2":r,a=n.match(/color/)?"color":o;return"define-attribute-vertex-shader-only"===t?`
#ifdef HAS_ATTRIBUTE_a_${n}
in ${i} ${r} a_${n};
#endif
`:s[n]?"define"===t?`
#ifndef HAS_UNIFORM_u_${n}
uniform lowp float u_${n}_t;
in ${i} ${o} a_${n};
out ${i} ${r} ${n};
#else
uniform ${i} ${r} u_${n};
#endif
`:"initialize"===t?"vec4"===a?`
#ifndef HAS_UNIFORM_u_${n}
    ${n} = a_${n};
#else
    ${i} ${r} ${n} = u_${n};
#endif
`:`
#ifndef HAS_UNIFORM_u_${n}
    ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);
#else
    ${i} ${r} ${n} = u_${n};
#endif
`:"define-attribute"===t?`
#ifdef HAS_ATTRIBUTE_a_${n}
    in ${i} ${r} a_${n};
    out ${i} ${r} ${n};
#endif
`:"initialize-attribute"===t?`
#ifdef HAS_ATTRIBUTE_a_${n}
    ${n} = a_${n};
#endif
`:void 0:"define"===t?`
#ifndef HAS_UNIFORM_u_${n}
uniform lowp float u_${n}_t;
in ${i} ${o} a_${n};
#else
uniform ${i} ${r} u_${n};
#endif
`:"define-instanced"===t?"mat4"===a?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${n}0;
in vec4 a_${n}1;
in vec4 a_${n}2;
in vec4 a_${n}3;
#else
uniform ${i} ${r} u_${n};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${i} ${o} a_${n};
#else
uniform ${i} ${r} u_${n};
#endif
`:"initialize-attribute-custom"===t?`
#ifdef HAS_ATTRIBUTE_a_${n}
    ${i} ${r} ${n} = a_${n};
#endif
`:"vec4"===a?`
#ifndef HAS_UNIFORM_u_${n}
    ${i} ${r} ${n} = a_${n};
#else
    ${i} ${r} ${n} = u_${n};
#endif
`:`
#ifndef HAS_UNIFORM_u_${n}
    ${i} ${r} ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);
#else
    ${i} ${r} ${n} = u_${n};
#endif
`}),staticAttributes:n,usedDefines:e,vertexIncludes:o,fragmentIncludes:a}}console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071')}class kr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,r,n,o,a,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!l&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==a.length;for(let e=0;!c&&e<a.length;e++)this.boundDynamicVertexBuffers[e]!==a[e]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(t,i,r,n,o,a,s);else{e.bindVertexArrayOES.set(this.vao);for(const i of a)i&&(i.bind(),s)&&i.instanceCount&&i.setVertexAttribDivisor(e.gl,t,s);n&&n.dynamicDraw&&n.bind()}}freshBind(e,t,i,r,n,o,a){var s=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const t of i)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const t of o)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n),a)&&t.instanceCount&&t.setVertexAttribDivisor(c,e,a);r&&r.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function zr(e,t,i,r,n,o,a){var s,l=e.context,c=l.gl,h=i.hillshadeFBO;h&&(e.prepareDrawTile(),s=e.isTileAffectedByFog(t),s=e.getOrCreateProgram("hillshade",{overrideFog:s}),l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h.colorAttachment.get()),h=((e,t,i,r)=>{var n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),a=i.paint.get("hillshade-accent-color"),s=i.paint.get("hillshade-emissive-strength");let l=Re.bj(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))l-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const t=e.style.directionalLight.properties.get("direction"),i=Re.bQ(t.x,t.y,t.z);l=Re.bj(i[1])}var c=!e.options.moving;return{u_matrix:r||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),c),u_image:0,u_latrange:(r=t.tileID,e=Math.pow(2,r.canonical.z),r=r.canonical.y,[new Re.L(0,r/e).toLngLat().lat,new Re.L(0,(r+1)/e).toLngLat().lat]),u_light:[i.paint.get("hillshade-exaggeration"),l],u_shadow:n,u_highlight:o,u_emissive_strength:s,u_accent:a}})(e,i,r,e.terrain?t.projMatrix:null),{tileBoundsBuffer:l,tileBoundsIndexBuffer:t,tileBoundsSegments:i}=(e.uploadCommonUniforms(l,s,t.toUnwrapped()),e.getTileBoundsBuffers(i)),s.draw(e,c.TRIANGLES,n,o,a,Ne.disabled,h,r.id,l,t,i))}function Rr(e,t,i){var r,n;t.needsDEMTextureUpload&&(n=(r=e.context).gl,r.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(i.stride),e=i.getPixels(),t.demTexture?t.demTexture.update(e,{premultiply:!1}):t.demTexture=new Re.T(r,e,n.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1)}const Or=e=>({u_matrix:new Re.bK(e),u_image0:new Re.bO(e),u_skirt_height:new Re.bN(e),u_ground_shadow_factor:new Re.bM(e)}),Br=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Fr=(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:h,u_globe_radius:u,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});function Nr(e,t){return null!=e&&null!=t&&e.hasData()&&t.hasData()&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Ur=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){return e in this.operations?{from:(e=this.operations[e]).from,to:e.to,phase:e.phase}:null}update(e){for(const i in this.operations){var t=this.operations[i];for(t.phase=(e-t.startTime)/t.duration;1<=t.phase||!this._validOp(t);)if(!this._nextOp(t,e)){delete this.operations[i];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},jr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Vr(e,t,i){return 0===t?0:(i=t<1&&514===i?.25/t:1,6*Math.pow(1.5,22-e)*Math.max(t,1)*i)}const Gr=e=>({u_matrix:e});function qr(e,t,i,r,n){var o,a;return 0<n?(o=((a=Re.f.now())-e.timeAdded)/n,a=t?(a-t.timeAdded)/n:-1,n=i.getSource(),i=r.coveringZoomLevel({tileSize:n.tileSize,roundZoom:n.roundZoom}),n=(r=!t||Math.abs(t.tileID.overscaledZ-i)>Math.abs(e.tileID.overscaledZ-i))&&e.refreshedUponExpiration?1:Re.aa(r?o:1-a,0,1),e.refreshedUponExpiration&&1<=o&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-n}:{opacity:n,mix:0}):{opacity:1,mix:0}}class Wr extends v{constructor(e){var t={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new Re.bW(Re.bX(),null),t=jt("mock-dem",t,i,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Hr extends v{constructor(e){var t=jt("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new Re.bW(Re.bX(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,e,t){if(!i.freezeTileCoverage){var r=(this.transform=i).coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((e,t)=>{if(e[t.key]="",!this._tiles[t.key]){const e=new M(t,this._source.tileSize*t.overscaleFactor(),i.tileZoom);e.state="loaded",this._tiles[t.key]=e}return e},{});for(const i in this._tiles)i in r||(this.freeFBO(i),this._tiles[i].unloadVectorData(),delete this._tiles[i])}}freeFBO(e){var t=this.proxyCachedFBO[e];void 0!==t&&(t=Object.values(t),this.renderCachePool.push(...t),delete this.proxyCachedFBO[e])}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zr extends Re.am{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class $r extends Re.ck{constructor(e,t){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},e.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),e.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),e.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};var[i,r,n]=function(){const i=new Re.aN,r=new Re.aw,n=131,o=(i.reserve(17161),r.reserve(33800),Re.V/128),a=Re.V+o/2,s=a+o;for(let t=-o;t<s;t+=o)for(let e=-o;e<s;e+=o){const n=e<0||e>a||t<0||t>a?24575:0,o=Re.aa(Math.round(e),0,Re.V),s=Re.aa(Math.round(t),0,Re.V);i.emplaceBack(o+n,s)}const l=(e,t)=>{t=t*n+e;r.emplaceBack(t+1,t,t+n),r.emplaceBack(t+n,t+n+1,t+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)}),[i,r,32768]}(),o=e.context,r=(this.gridBuffer=o.createVertexBuffer(i,Re.aP.members),this.gridIndexBuffer=o.createIndexBuffer(r),this.gridSegments=Re.aB.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=Re.aB.simpleSegment(0,0,i.length,n),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Hr(t.map),this.orthoMatrix=Re.a6.create(),Re.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,Re.V,0,Re.V,0,1),o.gl);this._overlapStencilMode=new Be({func:r.GEQUAL,mask:255},0,255,r.KEEP,r.KEEP,r.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Wr(t.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,t,i){var r,n,o,a,s;e&&e.terrain?(this._style!==e&&(this.style=e,this._evaluationZoom=void 0),r=e.terrain.properties,s=0===e.terrain.drapeRenderMode,n=e.terrain.isZoomDependent(),this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Re.f.now(),o=e.terrain&&e.terrain.scope,a=r.get("source"),(s=s?this._mockSourceCache:e.getSourceCache(a,o))?(this.sourceCache=s,this._exaggeration=n?this.calculateExaggeration(t):r.get("exaggeration"),!t.projection.requiresDraping&&n&&0===this._exaggeration?this._disable():(this.enabled=!0,e=()=>{this.sourceCache.used&&Re.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);var e=this.getScaledDemTileSize();this.sourceCache.update(t,e,!0),this.resetTileLookupCache(this.sourceCache.id)},this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,e(),this._initializing=!0),e(),t.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(t),this._emptyDEMTextureDirty=!0,this._previousZoom=t.zoom)):Re.w(`Couldn't find terrain source "${a}".`)):this._disable()}calculateExaggeration(e){var t=this._previousCameraAltitude,i=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize,i=(this._previousCameraAltitude=i,null!=t?i-t:Number.MAX_VALUE);if(Math.abs(i)<2)return this._exaggeration;t=e.zoom,e=this._style.terrain;if(!this._previousUpdateTimestamp)return e.getExaggeration(t);let r=t-this._previousZoom;var n=this._previousUpdateTimestamp;let o=t;null!=this._evaluationZoom&&(o=this._evaluationZoom,(r=.5<Math.abs(t-o)?.5*(t-o+r):r)*i<0)&&(o+=r),this._evaluationZoom=o;t=e.getExaggeration(o),i=t===e.getExaggeration(Math.max(0,o-.1));if(i&&Math.abs(t-this._exaggeration)<.01)return t;let a=Math.min(.1,.00375*(this._updateTimestamp-n));return(i||t<.1||Math.abs(r)<1e-4)&&(a=Math.min(.2,4*a)),Re.U(this._exaggeration,t,a)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){var e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(this.enabled){this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,l=this.painter.transform;this._initializing&&(this._initializing=0===l._centerAltitude&&-1===this.getAtPointOrZero(Re.L.fromLngLat(l.center),-1),this._emptyDEMTextureDirty=!this._initializing);var t=this.proxyCoords=s.getIds().map(e=>{e=s.getTileByID(e).tileID;return e.projMatrix=l.calculateProjMatrix(e.toUnwrapped()),e});{var i=t;var r=this.painter;const c=r.transform.pointCoordinate(r.transform.getCameraPoint()),h=new Re.P(c.x,c.y);i.sort((e,t)=>{var i;return t.overscaledZ-e.overscaledZ?t.overscaledZ-e.overscaledZ:(i=new Re.P(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),t=new Re.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),(e=h.mult(1<<e.canonical.z)).x-=.5,e.y-=.5,e.distSqr(i)-e.distSqr(t))})}var n=this.proxyToSource||{},o=(this.proxyToSource={},t.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={},this._style._mergedSourceCaches);for(const Re in o){const s=o[Re];if(s.used&&(s!==this.sourceCache&&this.resetTileLookupCache(s.id),this._setupProxiedCoordsForOrtho(s,e[Re],n),!s.usedForTerrain)){const l=e[Re];s.getSource().reparseOverscaled&&this._assignTerrainTiles(l)}}this.proxiedCoords[s.id]=t.map(e=>new Zr(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(t),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(n),this.renderingToTexture=!1;var a={};this._visibleDemTiles=[];for(const Re of this.proxyCoords){const e=this.terrainTileForTile[Re.key];if(e){const s=e.tileID.key;s in a||(this._visibleDemTiles.push(e),a[s]=s)}}}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{var t;this.terrainTileForTile[e.key]||(t=this._findTileCoveringTileID(e,this.sourceCache))&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){var e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){var i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Rr(this.painter,i,r))}}_prepareDemTileUniforms(e,t,i,r){return!(!t||null==t.demTexture||(e=e.tileID.canonical,t=Math.pow(2,t.tileID.canonical.z-e.z),i["u_dem_tl"+(r=r||"")]=[e.x*t%1,e.y*t%1],i["u_dem_scale"+r]=t,0))}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){var e,t=this.painter.context,i=t.gl;return this._emptyDepthBufferTexture||(e=new Re.h({width:1,height:1},Uint8Array.of(255,255,255,255)),this._emptyDepthBufferTexture=new Re.T(t,e,i.RGBA,{premultiply:!1})),this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;var e=this._visibleDemTiles.reduce((e,t)=>{return t.dem?(0<(t=t.dem.tree.minimums[0])&&i++,e+t):e},0);return i?e/i:0}_updateEmptyDEMTexture(){const e=this.painter.context,t=e.gl,i=(e.activeTexture.set(t.TEXTURE2),this._getLoadedAreaMinimum()),[r,n]=(o=new Re.cm({width:1,height:1},new Float32Array([i])),[t.R32F,o]);var o;this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(n,{premultiply:!1}):a=this._emptyDEMTexture=new Re.T(e,n,r,{premultiply:!1}),a}setupElevationDraw(e,t,i){const r=this.painter.context,n=r.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};o.u_exaggeration=this.exaggeration();let a=null,s=null,l=1;if(i&&i.morphing&&this._useVertexMorphing){const Re=i.morphing.srcDemTile,t=i.morphing.dstDemTile;l=i.morphing.phase,Re&&t&&(this._prepareDemTileUniforms(e,Re,o,"_prev")&&(s=Re),this._prepareDemTileUniforms(e,t,o))&&(a=t)}var c=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?n.LINEAR:n.NEAREST,h=e=>{o.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(s&&a)r.activeTexture.set(n.TEXTURE2),a.demTexture.bind(c(a),n.CLAMP_TO_EDGE),r.activeTexture.set(n.TEXTURE4),s.demTexture.bind(c(s),n.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),o.u_dem_lerp=l;else{a=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(n.TEXTURE2);const Re=this._prepareDemTileUniforms(e,a,o)?a.demTexture:this.emptyDEMTexture;Re.bind(c(a),n.CLAMP_TO_EDGE),h(Re)}if(r.activeTexture.set(n.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*Re.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}if(i&&i.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),t.setTerrainUniformValues(r,o),"globe"===this.painter.transform.projection.name){const Re=this.globeUniformValues(this.painter.transform,e.tileID.canonical,i&&i.useDenormalizedUpVectorScale);t.setGlobeUniformValues(r,Re)}}globeUniformValues(e,t,i){var r=e.projection;return{u_tile_tl_up:r.upVector(t,0,0),u_tile_tr_up:r.upVector(t,Re.V,0),u_tile_br_up:r.upVector(t,Re.V,Re.V),u_tile_bl_up:r.upVector(t,0,Re.V),u_tile_up_scale:i?Re.cl(1):r.upVectorScale(t,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){var n,o,t=this.painter,r=this.painter.context;if(0!==e.length){r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]),t.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1;var a=t,s=this,B=this.proxySourceCache,l=e,c=this._updateTimestamp;if("globe"===a.transform.projection.name){var h=a;var u=s;var d=B;var p=l;var f=c;const v=h.context,x=v.gl;let r,n;const b=h.transform,w=Re.cd(h,v,b),T=(e,t)=>{var i;n!==t&&(i=[jr[t],"PROJECTION_GLOBE_VIEW"],w&&i.push("CUSTOM_ANTIALIASING"),e=h.isTileAffectedByFog(e),r=h.getOrCreateProgram("globeRaster",{defines:i,overrideFog:e}),n=t)},S=h.colorModeForRenderPass(),A=new Oe(x.LEQUAL,Oe.ReadWrite,h.depthRangeFor3D),E=(Ur.update(f),Re.ce(b)),C=[Re.a5(b.center.lng),Re.ae(b.center.lat)],M=h.globeSharedBuffers,I=[b.width*Re.f.devicePixelRatio,b.height*Re.f.devicePixelRatio],P=Float32Array.from(b.globeMatrix),L={useDenormalizedUpVectorScale:!0};{const b=h.transform,w=Vr(b.zoom,u.exaggeration(),u.sourceCache._source.tileSize);n=-1;var F=x.TRIANGLES;for(const e of p){const p=d.getTile(e),Z=Be.disabled,D=u.prevTerrainTileForTile[e.key],k=u.terrainTileForTile[e.key];Nr(D,k)&&Ur.newMorphing(e.key,D,k,f,250),v.activeTexture.set(x.TEXTURE0),p.texture&&p.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE);var i=Ur.getMorphValuesForProxy(e.key),N=i?1:0,i=(i&&Re.j(L,{morphing:{srcDemTile:i.from,dstDemTile:i.to,phase:Re.cc(i.phase)}}),Re.cf(e.canonical)),U=Re.cg(i.getCenter().lat),i=Re.ch(e.canonical,i,U,b.worldSize/b._pixelsPerMercatorPixel),j=Re.aT(Re.ci(e.canonical)),j=Fr(b.expandedFarZProjMatrix,P,E,j,Re.S(b.zoom),C,b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.globeCenterInViewSpace,b.globeRadius,I,w,b._farZ,i);if(T(e,N),r&&(u.setupElevationDraw(p,r,L),h.uploadCommonUniforms(v,r,e.toUnwrapped()),M)){const[Re,u,d]=M.getGridBuffers(U,0!==w);r.draw(h,F,A,Z,S,Ne.backCCW,j,"globe_raster",Re,u,d)}}}if(M&&(h.renderDefaultNorthPole||h.renderDefaultSouthPole)){const f=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];w&&f.push("CUSTOM_ANTIALIASING"),r=h.getOrCreateProgram("globeRaster",{defines:f});for(const f of p){const{x:p,y:e,z:w}=f.canonical,T=0===e,E=e===(1<<w)-1,[P,$,X,z]=M.getPoleBuffers(w,!1);if(z&&(T||E)){const e=d.getTile(f);v.activeTexture.set(x.TEXTURE0),e.texture&&e.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE);let i=Re.cj(w,p,b);const Y=Re.aT(Re.ci(f.canonical)),K=(e,t)=>e.draw(h,x.TRIANGLES,A,Be.disabled,S,Ne.disabled,Fr(b.expandedFarZProjMatrix,i,i,Y,0,C,b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.globeCenterInViewSpace,b.globeRadius,I,0,b._farZ),"globe_pole_raster",t,X,z);u.setupElevationDraw(e,r,L),h.uploadCommonUniforms(v,r,f.toUnwrapped()),T&&h.renderDefaultNorthPole&&K(r,P),E&&h.renderDefaultSouthPole&&(i=Re.a6.scale(Re.a6.create(),i,[1,-1,1]),K(r,$))}}}}else{var m=a.context,g=m.gl;let t,i;const R=a.shadowRenderer,J=rr(a,a.longestCutoffRange),Q=a.colorModeForRenderPass(),ee=new Oe(g.LEQUAL,Oe.ReadWrite,a.depthRangeFor3D);Ur.update(c);var V=a.transform,G=Vr(V.zoom,s.exaggeration(),s.sourceCache._source.tileSize);let r=[0,0,0];if(R){const Re=a.style.directionalLight,s=a.style.ambientLight;Re&&s&&(r=cr(Re,s))}i=-1;var q=g.TRIANGLES,[W,H]=[s.gridIndexBuffer,s.gridSegments];for(const O of l){const l=B.getTile(O),te=Be.disabled,ie=s.prevTerrainTileForTile[O.key],re=s.terrainTileForTile[O.key];Nr(ie,re)&&Ur.newMorphing(O.key,ie,re,c,250),m.activeTexture.set(g.TEXTURE0),l.texture&&l.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE);var _=Ur.getMorphValuesForProxy(O.key),y=_?1:0;let e;_&&(e={morphing:{srcDemTile:_.from,dstDemTile:_.to,phase:Re.cc(_.phase)}});n=Br(O.projMatrix,(_=O.canonical,n=V.renderWorldCopies,o=void 0,o=1<<_.z,(n||0!==_.x&&_.x!==o-1)&&0!==_.y&&_.y!==o-1?G:G/10),r);_=y,o=void 0,i!==_&&((o=[]).push(jr[_]),J.shouldRenderCutoff&&o.push("RENDER_CUTOFF"),t=a.getOrCreateProgram("terrainRaster",{defines:o}),i=_),t&&(s.setupElevationDraw(l,t,e),y=O.toUnwrapped(),R&&R.setupShadows(y,t),a.uploadCommonUniforms(m,t,y,null,J),t.draw(a,q,ee,te,Q,Ne.backCCW,n,"terrain_raster",s.gridBuffer,W,H))}}this.renderingToTexture=!0,t.gpuTimingDeferredRenderEnd(),e.splice(0,e.length)}}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const r=this.painter,n=this.painter.context,o=this.proxySourceCache,a=this.proxiedCoords[o.id],s=this._drapedRenderBatches.shift(),l=r.style.order,e=[];let c=0;for(const h of a){const a=o.getTileByID(h.proxyTileKey),t=o.proxyCachedFBO[h.key]?o.proxyCachedFBO[h.key][i]:void 0,u=void 0!==t?o.renderCache[t]:this.pool[c++],d=void 0!==t;if(a.texture=u.tex,d&&!u.dirty)e.push(a.tileID);else{let t;n.bindFramebuffer.set(u.fb.framebuffer),this.renderedToTile=!1,u.dirty&&(n.clear({color:Re.ax.transparent,stencil:0}),u.dirty=!1);for(let e=s.start;e<=s.end;++e){const i=r.style._mergedLayers[l[e]];if(!i.isHidden(r.transform.zoom)){const o=r.style.getLayerSourceCache(i),a=o?this.proxyToSource[h.key][o.id]:[h];if(a){const s=a;n.viewport.set([0,0,u.fb.width,u.fb.height]),t!==(o?o.id:null)&&(this._setupStencil(u,a,i,o),t=o?o.id:null),r.renderLayer(r,o,i,s)}}}if(0===this._drapedRenderBatches.length)for(const Re of this._pendingGroundEffectLayers){const i=r.style._mergedLayers[l[Re]];if(!i.isHidden(r.transform.zoom)){const o=r.style.getLayerSourceCache(i),a=o?this.proxyToSource[h.key][o.id]:[h];if(a){const s=a;n.viewport.set([0,0,u.fb.width,u.fb.height]),t!==(o?o.id:null)&&(this._setupStencil(u,a,i,o),t=o?o.id:null),r.renderLayer(r,o,i,s)}}}this.renderedToTile?(u.dirty=!0,e.push(a.tileID)):d||--c,5===c&&(c=0,this.renderToBackBuffer(e))}}return this.renderToBackBuffer(e),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),s.end+1}postRender(){}isLayerOrderingCorrect(t){var i=t.order.length;let r=-1,n=i;for(let e=0;e<i;++e)this._style.isLayerDraped(t._mergedLayers[t.order[e]])?r=Math.max(r,e):n=Math.min(n,e);return n>r}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(a,s,l){if(this._visibleDemTiles){const e=this._visibleDemTiles.filter(e=>e.dem).map(e=>{var t=e.tileID,i=1<<t.overscaledZ,{x:t,y:r}=t.canonical,n=t/i,t=(t+1)/i,o=r/i,r=(r+1)/i;return{minx:n,miny:o,maxx:t,maxy:r,t:e.dem.tree.raycastRoot(n,o,t,r,a,s,l),tile:e}});e.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const t of e){if(null==t.t)return null;const e=t.tile.dem.tree.raycast(t.minx,t.miny,t.maxx,t.maxy,a,s,l);if(null!=e)return e}}return null}_createFBO(){var e=this.painter.context,t=e.gl,i=this.drapeBufferSize,r=(e.activeTexture.set(t.TEXTURE0),new Re.T(e,{width:i[0],height:i[1],data:null},t.RGBA)),n=(r.bind(t.LINEAR,t.CLAMP_TO_EDGE),e.createFramebuffer(i[0],i[1],!0,null));return n.colorAttachment.set(r.texture),n.depthAttachment=new Rt(e,n.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,n.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):n.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:n,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{var e=this._style._mergedLayers[e],t=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!t&&e.shouldRedrape():!t&&e.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const Re of this._style.getSources())if(Re instanceof Ze){t=!0;break}if(t){var i={};for(let e=0;e<this._style.order.length;++e){var r=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(r);if(n&&!i[n.id]&&!r.isHidden(this.painter.transform.zoom)&&"line"===r.type&&r.widthExpression()instanceof Re.Z){i[n.id]=!0;for(const Re of this.proxyCoords){const t=this.proxyToSource[Re.key][n.id];if(t)for(const Re of t)this._clearRenderCacheForTile(n.id,Re)}}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o]._source instanceof $e){t=!0;break}if(t){const o={};for(let e=0;e<this._style.order.length;++e){var i=this._style._mergedLayers[this._style.order[e]],r=this._style.getLayerSourceCache(i);if(r&&!o[r.id]&&(!i.isHidden(this.painter.transform.zoom)&&"raster"===i.type)){var n=i.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const o=this.proxyToSource[t.key][r.id];if(o)for(const t of o){const o=qr(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,n);1===o.opacity&&0===o.mix||this._clearRenderCacheForTile(r.id,t)}}}}}}_setupDrapedRenderBatches(){const r=this._style.order,n=r.length;if(0!==n){var o=[];this._pendingGroundEffectLayers=[];let e,t=0,i=this._style._mergedLayers[r[t]];for(;!this._style.isLayerDraped(i)&&i.isHidden(this.painter.transform.zoom)&&++t<n;)i=this._style._mergedLayers[r[t]];for(;t<n;++t){const Re=this._style._mergedLayers[r[t]];Re.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Re)?void 0===e&&(e=t):("fill-extrusion"===Re.type&&this._pendingGroundEffectLayers.push(t),void 0!==e&&(o.push({start:e,end:t-1}),e=void 0)))}if(void 0!==e&&o.push({start:e,end:t-1}),0!==o.length){const r=o[o.length-1];this._pendingGroundEffectLayers.every(e=>e>r.end)||Re.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=o}}_setupRenderCache(i){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const i=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let e=0;e<i.length;++e){const n=Object.values(i[e]);t.renderCachePool.push(...n)}}}else{this._clearRasterLayersFromRenderCache();const o=this.proxyCoords,n=this._tilesDirty;for(let e=o.length-1;0<=e;e--){var r=o[e];if(t.getTileByID(r.key),void 0!==t.proxyCachedFBO[r.key]){const o=i[r.key],a=this.proxyToSource[r.key];let e=0;for(const i in a){const t=a[i],s=o[i];if(!s||s.length!==t.length||t.some((e,t)=>e!==s[t]||n[i]&&n[i].hasOwnProperty(e.key))){e=-1;break}++e}for(const i in t.proxyCachedFBO[r.key])t.renderCache[t.proxyCachedFBO[r.key][i]].dirty=e<0||e!==Object.values(o).length}}const a=[...this._drapedRenderBatches];a.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const i of a)for(const n of o)if(!t.proxyCachedFBO[n.key]){let e=t.renderCachePool.pop();void 0===e&&t.renderCache.length<50&&(e=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==e&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][i.start]=e,t.renderCache[e].dirty=!0)}this._tilesDirty={}}}_setupStencil(e,t,i,r){if(r&&this._sourceTilesOverlap[r.id]){var r=this.painter.context,n=r.gl;if(t.length<=1)this._overlapStencilType=!1;else{let e;if(i.isTileClipped())e=t.length,this._overlapStencilMode.test={func:n.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);e=1,this._overlapStencilMode.test={func:n.GREATER,mask:255},this._overlapStencilType="Mask"}255<this._stencilRef+e&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=e,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}}else this._overlapStencilType&&(this._overlapStencilType=!1)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Be.disabled}_renderTileClippingMasks(e,t){const i=this.painter,r=this.painter.context,n=r.gl;i._tileClippingMaskIDs={},r.setColorMode(Fe.disabled),r.setDepthMode(Oe.disabled);var o=i.getOrCreateProgram("clippingMask");for(const r of e){const e=i._tileClippingMaskIDs[r.key]=--t;o.draw(i,n.TRIANGLES,Oe.disabled,new Be({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),Fe.disabled,Ne.disabled,Gr(r.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){var t,i,r=this.painter.transform;return!(e.x<0||e.x>r.width||e.y<0||e.y>r.height)&&(e=[e.x,e.y,1,1],Re.a7.transformMat4(e,e,r.pixelMatrixInverse),Re.a7.scale(e,e,1/e[3]),e[0]/=r.worldSize,e[1]/=r.worldSize,t=r._camera.position,r=Re.bl(1,r.center.lat),t=[t[0],t[1],t[2]/r,0],e=Re.N.subtract([],e.slice(0,3),t),Re.N.normalize(e,e),null!==(i=this.raycast(t,e,this._exaggeration)))&&i?(Re.N.scaleAndAdd(t,t,e,i),t[3]=t[2],t[2]*=r,t):null}drawDepth(){const e=this.painter,t=e.context,i=this.proxySourceCache,r=Math.ceil(e.width),n=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===n||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=t.gl,i=t.createFramebuffer(r,n,!0,"renderbuffer");t.activeTexture.set(e.TEXTURE0);var o=new Re.T(t,{width:r,height:n,data:null},e.RGBA),a=(o.bind(e.NEAREST,e.CLAMP_TO_EDGE),i.colorAttachment.set(o.texture),t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,r,n));i.depthAttachment.set(a),this._depthFBO=i,this._depthTexture=o}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,r,n]);var s=e,l=this,c=i,h=this.proxyCoords;if("globe"!==s.transform.projection.name){const p=s.context,f=p.gl;p.clear({depth:1});var u=s.getOrCreateProgram("terrainDepth"),d=new Oe(f.LESS,Oe.ReadWrite,s.depthRangeFor3D);for(const p of h){const h=c.getTile(p),m=Br(p.projMatrix,0,[0,0,0]);l.setupElevationDraw(h,u),u.draw(s,f.TRIANGLES,d,Be.disabled,Fe.unblended,Ne.backCCW,m,"terrain_depth",l.gridBuffer,l.gridIndexBuffer,l.gridNoSkirtSegments)}}}_setupProxiedCoordsForOrtho(t,i,r){if(t.getSource()instanceof Re.ap)return this._setupProxiedCoordsForImageSource(t,i,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const i=o[e],a=this._findTileCoveringTileID(i,t);if(a){const Re=this._createProxiedId(i,a,r[i.key]&&r[i.key][t.id]);n.push(Re),this.proxyToSource[i.key][t.id]=[Re]}}let a=!1;var s=new Set;for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(o&&o.hasData()){var l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const Re=this.proxyToSource[l.tileID.key][t.id],i=this._createProxiedId(l.tileID,o,r[l.tileID.key]&&r[l.tileID.key][t.id]);Re?Re.splice(Re.length-1,0,i):this.proxyToSource[l.tileID.key][t.id]=[i];l=this.proxyToSource[l.tileID.key][t.id];s.has(l)||s.add(l),n.push(i),a=!0}}}if((this._sourceTilesOverlap[t.id]=a)&&this._debugParams.sortTilesHiZFirst)for(const Re of s)Re.sort((e,t)=>t.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(t,i,r){if(t.getSource().loaded()){const c=this.proxiedCoords[t.id]=[],h=this.proxyCoords,u=t.getSource(),d=u.tileID;if(d){const p=new Re.P(d.x,d.y)._div(1<<d.z),f=u.coordinates.map(Re.L.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-p.x),e.min.y=Math.min(e.min.y,t.y-p.y),e.max.x=Math.max(e.max.x,t.x-p.x),e.max.y=Math.max(e.max.y,t.y-p.y),e),{min:new Re.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new Re.P(-Number.MAX_VALUE,-Number.MAX_VALUE)});for(let e=0;e<h.length;e++){const u=h[e];for(let e=0;e<i.length;e++){const h=t.getTile(i[e]);if(h&&h.hasData()&&(n=u,o=h.tileID,l=s=a=void 0,a=n.wrap+n.canonical.x/(1<<n.canonical.z),s=n.canonical.y/(1<<n.canonical.z),n=Re.V/(1<<n.canonical.z),l=o.wrap+o.canonical.x/(1<<o.canonical.z),o=o.canonical.y/(1<<o.canonical.z),!(a+n<l+f.min.x||a>l+f.max.x||s+n<o+f.min.y||s>o+f.max.y))){const d=this._createProxiedId(u,h,r[u.key]&&r[u.key][t.id]),p=this.proxyToSource[u.key][t.id];p?p.push(d):this.proxyToSource[u.key][t.id]=[d],c.push(d)}}}var n,o,a,s,l}}}_createProxiedId(r,n,o){let a=this.orthoMatrix;if(o){const Re=o.find(e=>e.key===n.tileID.key);if(Re)return Re}if(n.tileID.key!==r.key){const o=r.canonical.z-n.tileID.canonical.z;let e,t,i;a=Re.a6.create();var s=n.tileID.wrap-r.wrap<<r.overscaledZ;i=0<o?(e=Re.V>>o,t=e*((n.tileID.canonical.x<<o)-r.canonical.x+s),e*((n.tileID.canonical.y<<o)-r.canonical.y)):(e=Re.V<<-o,t=Re.V*(n.tileID.canonical.x-(r.canonical.x+s<<-o)),Re.V*(n.tileID.canonical.y-(r.canonical.y<<-o))),Re.a6.ortho(a,0,e,0,e,0,1),Re.a6.translate(a,a,[t,i,0])}return new Zr(n.tileID,r.key,a)}_findTileCoveringTileID(e,t){let i=t.getTile(e);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[t.id],n=r[e.key];if((i=n?t.getTileByID(n):null)&&i.hasData()||null===n)return i;let o=i?i.tileID:e,a=o.overscaledZ;const s=t.getSource().minzoom,l=[];if(!n){const r=t.getSource().maxzoom;if(e.canonical.z>=r){const i=e.canonical.z-r;t.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,t.transform.tileZoom),o=new Re.am(a,e.wrap,r,e.canonical.x>>i,e.canonical.y>>i)):0!=i&&(a=r,o=new Re.am(a,e.wrap,r,e.canonical.x>>i,e.canonical.y>>i))}o.key!==e.key&&(l.push(o.key),i=t.getTile(o))}var c=t=>{l.forEach(e=>{r[e]=t}),l.length=0};for(--a;a>=s&&(!i||!i.hasData());a--){i&&c(i.tileID.key);const Re=o.calculateScaledKey(a);if((i=t.getTileByID(Re))&&i.hasData())break;const e=r[Re];if(null===e)break;void 0===e?l.push(Re):i=t.getTileByID(e)}return c(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];(i=i||(this._tilesDirty[e]={}))[t.key]=!0}}const Xr=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Yr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Kr{static cacheKey(e,t,i,r){let n=""+t+(r?r.cacheKey:"");for(const t of i)e.usedDefines.includes(t)&&(n+="/"+t);return n}constructor(t,e,i,r,n,o,a){var s=t.gl,e=(this.program=s.createProgram(),this.configuration=r,this.name=e,this.fixedDefines=[...o],r?r.getBinderAttributes():[]),l=(i.staticAttributes||[]).concat(e);let c=r?r.defines():[];e="#version 300 es\n";let h=e+(c=c.concat(o.map(e=>"#define "+e))).concat("precision mediump float;",Pr,Ir.fragmentSource).join("\n");for(const Re of i.fragmentIncludes)h+=`
`+Cr[Re];h+=`
`+i.fragmentSource;let u=e+c.concat("precision highp float;",Pr,Ir.vertexSource).join("\n");for(const Re of i.vertexIncludes)u+=`
`+Cr[Re];u+=`
`+i.vertexSource;e=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(e,h),s.compileShader(e),s.attachShader(this.program,e);var i=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(i,u),s.compileShader(i),s.attachShader(this.program,i),this.attributes={},this.numAttributes=l.length;for(let e=0;e<this.numAttributes;e++)if(l[e]){const t=l[e].startsWith("a_")?l[e]:"a_"+l[e];s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}a&&0<a.shaderVaryings.length&&s.transformFeedbackVaryings(this.program,a.shaderVaryings,a.bufferMode),s.linkProgram(this.program),s.deleteShader(i),s.deleteShader(e),this.fixedUniforms=n(t),this.binderUniforms=r?r.getUniforms(t):[],o.includes("TERRAIN")&&(this.terrainUniforms=(a=t,{u_dem:new Re.bO(a),u_dem_prev:new Re.bO(a),u_dem_tl:new Re.bL(a),u_dem_scale:new Re.bN(a),u_dem_tl_prev:new Re.bL(a),u_dem_scale_prev:new Re.bN(a),u_dem_size:new Re.bN(a),u_dem_lerp:new Re.bN(a),u_exaggeration:new Re.bN(a),u_depth:new Re.bO(a),u_depth_size_inv:new Re.bL(a),u_meter_to_dem:new Re.bN(a),u_label_plane_matrix_inv:new Re.bK(a)})),o.includes("GLOBE")&&(this.globeUniforms=(i=t,{u_tile_tl_up:new Re.bM(i),u_tile_tr_up:new Re.bM(i),u_tile_br_up:new Re.bM(i),u_tile_bl_up:new Re.bM(i),u_tile_up_scale:new Re.bN(i)})),o.includes("FOG")&&(this.fogUniforms=(e=t,{u_fog_matrix:new Re.bK(e),u_fog_range:new Re.bL(e),u_fog_color:new Re.bP(e),u_fog_horizon_blend:new Re.bN(e),u_fog_vertical_limit:new Re.bL(e),u_fog_temporal_offset:new Re.bN(e),u_frustum_tl:new Re.bM(e),u_frustum_tr:new Re.bM(e),u_frustum_br:new Re.bM(e),u_frustum_bl:new Re.bM(e),u_globe_pos:new Re.bM(e),u_globe_radius:new Re.bN(e),u_globe_transition:new Re.bN(e),u_is_globe:new Re.bO(e),u_viewport:new Re.bL(e)})),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms={u_cutoff_params:new Re.bP(t)}),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(n=t,{u_lighting_ambient_color:new Re.bM(n),u_lighting_directional_dir:new Re.bM(n),u_lighting_directional_color:new Re.bM(n),u_ground_radiance:new Re.bM(n)})),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(r=t,{u_light_matrix_0:new Re.bK(r),u_light_matrix_1:new Re.bK(r),u_fade_range:new Re.bL(r),u_shadow_normal_offset:new Re.bM(r),u_shadow_intensity:new Re.bN(r),u_shadow_texel_size:new Re.bN(r),u_shadow_map_resolution:new Re.bN(r),u_shadow_direction:new Re.bM(r),u_shadow_bias:new Re.bM(r),u_shadowmap_0:new Re.bO(r),u_shadowmap_1:new Re.bO(r)}))}}}setTerrainUniformValues(e,t){if(this.terrainUniforms){var i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}}setGlobeUniformValues(e,t){if(this.globeUniforms){var i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}}setFogUniformValues(e,t){if(this.fogUniforms){var i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}}setCutoffUniformValues(e,t){if(this.cutoffUniforms){var i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}}setLightsUniformValues(e,t){if(this.lightsUniforms){var i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}}setShadowUniformValues(e,t){if(!this.failedToCreate&&this.shadowUniforms){var i=this.shadowUniforms;e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}_drawDebugWireframe(e,t,i,r,n,o,a,s,l,c){const h=e.options.wireframe;var u,d,p,f;!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D||(u=e.context,(h.terrain&&("terrainRaster"===this.name||"globeRaster"===this.name)||!(!h.layers2D||e._terrain&&e._terrain.renderingToTexture)&&Xr.includes(this.name)||h.layers3D&&Yr.includes(this.name))&&(d=u.gl,p=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,n,u))&&((f=[...this.fixedDefines]).push("DEBUG_WIREFRAME"),e=e.getOrCreateProgram(this.name,{config:this.configuration,defines:f}),u.program.set(e.program),f=(e,t,i)=>{if(t[e]&&i[e])for(const r in t[e])i[e][r]&&i[e][r].set(i.program,r,t[e][r].current)},l&&l.setUniforms(e.program,u,e.binderUniforms,a,{zoom:s}),f("fixedUniforms",this,e),f("terrainUniforms",this,e),f("globeUniforms",this,e),f("fogUniforms",this,e),f("lightsUniforms",this,e),f("shadowUniforms",this,e),p.bind(),u.setColorMode(new Fe([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],Re.ax.transparent,[!0,!0,!0,!1])),u.setDepthMode(new Oe(t.func===d.LESS?d.LEQUAL:t.func,Oe.ReadOnly,t.range)),u.setStencilMode(Be.disabled),l=3*o.primitiveLength*2,a=3*o.primitiveOffset*2*2,c&&1<c?d.drawElementsInstanced(d.LINES,l,d.UNSIGNED_SHORT,a,c):d.drawElements(d.LINES,l,d.UNSIGNED_SHORT,a),n.bind(),u.program.set(this.program),u.setDepthMode(t),u.setStencilMode(i),u.setColorMode(r)))}draw(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g){var _=e.context,y=_.gl;if(!this.failedToCreate){_.program.set(this.program),_.setDepthMode(i),_.setStencilMode(r),_.setColorMode(n),_.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,a[e]);p&&p.setUniforms(this.program,_,this.binderUniforms,u,{zoom:d});var v={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t],o=g&&0<g.length;if(o){for(const e of g)y.bindBufferBase(y.TRANSFORM_FEEDBACK_BUFFER,e.targetIndex,e.buffer.buffer);y.beginTransformFeedback(t)}var x=m&&0<m?1:void 0;for(const o of h.get()){const a=o.vaos||(o.vaos={});(a[s]||(a[s]=new kr)).bind(_,this,l,p?p.getPaintVertexBuffers():[],c,o.vertexOffset,f||[],x),m&&1<m?y.drawElementsInstanced(t,o.primitiveLength*v,y.UNSIGNED_SHORT,o.primitiveOffset*v*2,m):c?y.drawElements(t,o.primitiveLength*v,y.UNSIGNED_SHORT,o.primitiveOffset*v*2):y.drawArrays(t,o.vertexOffset,o.vertexLength),t===y.TRIANGLES&&c&&this._drawDebugWireframe(e,i,r,n,c,o,u,d,p,m)}o&&y.endTransformFeedback()}}}function Jr(e,t){var i=Math.pow(2,t.tileID.overscaledZ),r=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,i=r*(t.tileID.canonical.x+t.tileID.wrap*i),r=r*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/Re.a3(t,1,e.transform.tileZoom),u_pixel_coord_upper:[i>>16,r>>16],u_pixel_coord_lower:[65535&i,65535&r]}}const Qr=Re.a6.create(),en=(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m)=>{var g=t.style.light,_=g.properties.get("position"),_=[_.x,_.y,_.z],y=Re.co.create(),y=("viewport"===g.properties.get("anchor")&&(Re.co.fromRotation(y,-t.transform.angle),Re.N.transformMat3(_,_,y)),g.properties.get("color")),t=t.transform,e={u_matrix:e,u_lightpos:_,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:n,u_edge_radius:o,u_flood_light_color:u,u_vertical_scale:d,u_flood_light_intensity:p,u_ground_shadow_factor:f,u_emissive_strength:m};return"globe"===t.projection.name&&(e.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],e.u_zoom_transition=l,e.u_inv_rot_matrix=h,e.u_merc_center=c,e.u_up_dir=t.projection.upVector(new Re.bs(0,0,0),c[0]*Re.V,c[1]*Re.V),e.u_height_lift=s),e},tn=(e,t,i,r,n,o,a,s,l,c,h,u,d,p)=>{e=en(e,t,i,r,n,o,a,l,c,h,u,d,p,1,[0,0,0],0),i={u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8};return Re.e(e,Jr(t,s),i)},rn=(e,t)=>({u_matrix:e,u_emissive_strength:t}),nn=(e,t,i,r)=>Re.e(rn(e,t),Jr(i,r)),on=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),an=Re.a6.create();function sn(e,[t,i,r,n],[o,a]){return o===a?[0,0,0,0]:[t*(t=255*(e-1)/(e*(a-o))),i*t,r*t,n*t]}function ln(e,t,[i,r]){return i===r?0:.5/e+(t-i)*(e-1)/(e*(r-i))}const cn=(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_,y,v,x)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:o,u_scale_parent:c,u_fade_t:h.mix,u_opacity:h.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:0<(e=u.paint.get("raster-saturation"))?1-1/(1.001-e):-e,u_contrast_factor:0<(t=u.paint.get("raster-contrast"))?1/(1-t):1+t,u_spin_weights:(i=u.paint.get("raster-hue-rotate"),i*=Math.PI/180,r=Math.sin(i),[(2*(i=Math.cos(i))+1)/3,(-Math.sqrt(3)*r-i+1)/3,(Math.sqrt(3)*r-i+1)/3]),u_perspective_transform:d,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:s,u_cutoff_params:l,u_colorization_mix:sn(Re.cq,m,_),u_colorization_offset:ln(Re.cq,g,_),u_color_ramp:f,u_texture_offset:[v/(y+2*v),y/(y+2*v)],u_texture_res:[y+2*v,y+2*v],u_emissive_strength:x}};const hn=Re.a6.create(),un=(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g,_)=>{var y=n.transform,e={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:y.getCameraToCenterDistance(m),u_rotate_symbol:+i,u_aspect_ratio:y.width/y.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hn,u_up_vector:[0,-1,0],u_icon_transition:_||0,u_icon_saturation:g};return"globe"===m.name&&(e.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],e.u_zoom_transition=u,e.u_inv_rot_matrix=p,e.u_merc_center=d,e.u_camera_forward=y._camera.forward(),e.u_ecef_origin=Re.cr(y.globeMatrix,h.toUnwrapped()),e.u_tile_matrix=Float32Array.from(y.globeMatrix),e.u_up_vector=f),e},dn=(e,t,i,r,n,o,a,s,l,c,h,u,d,p,f,m,g)=>Re.e(un(e,t,i,r,n,o,a,s,l,c,u,d,p,f,m,g,1),{u_gamma_scale:r?n.transform.getCameraToCenterDistance(g)*Math.cos(n.terrain?0:n.transform._pitch):1,u_device_pixel_ratio:Re.f.devicePixelRatio,u_is_halo:+h,undefined:void 0}),pn=(e,t,i,r,n,o,a,s,l,c,h,u,d=[0,0,0],p)=>{var f=r.style.light,m=f.properties.get("position"),m=[-m.x,-m.y,m.z],g=Re.co.create(),r=("viewport"===f.properties.get("anchor")&&(Re.co.fromRotation(g,-r.transform.angle),Re.N.transformMat3(m,m,g)),"MASK"===c.alphaMode),g=f.properties.get("color"),_=u.paint.get("model-ambient-occlusion-intensity"),y=u.paint.get("model-color").constantOr(Re.ax.white),u=u.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:i,u_lightpos:m,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_camera_pos:d,u_opacity:n,u_baseTextureIsAlpha:0,u_alphaMask:+r,u_alphaCutoff:c.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:s,u_roughnessFactor:l,u_baseColorTexture:x.BaseColor,u_metallicRoughnessTexture:x.MetallicRoughness,u_normalTexture:x.Normal,u_occlusionTexture:x.Occlusion,u_emissionTexture:x.Emission,u_color_mix:[y.r,y.g,y.b,u],u_aoIntensity:_,u_emissive_strength:h,u_occlusionTextureTransform:p||[0,0,0,0]}},fn=new Float32Array(16),mn=(e,t=fn,i=fn)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),gn={fillExtrusion:e=>({u_matrix:new Re.bK(e),u_lightpos:new Re.bM(e),u_lightintensity:new Re.bN(e),u_lightcolor:new Re.bM(e),u_vertical_gradient:new Re.bN(e),u_opacity:new Re.bN(e),u_edge_radius:new Re.bN(e),u_ao:new Re.bL(e),u_tile_id:new Re.bM(e),u_zoom_transition:new Re.bN(e),u_inv_rot_matrix:new Re.bK(e),u_merc_center:new Re.bL(e),u_up_dir:new Re.bM(e),u_height_lift:new Re.bN(e),u_flood_light_color:new Re.bM(e),u_vertical_scale:new Re.bN(e),u_flood_light_intensity:new Re.bN(e),u_ground_shadow_factor:new Re.bM(e),u_emissive_strength:new Re.bN(e)}),fillExtrusionDepth:e=>({u_matrix:new Re.bK(e),u_edge_radius:new Re.bN(e),u_vertical_scale:new Re.bN(e)}),fillExtrusionPattern:e=>({u_matrix:new Re.bK(e),u_lightpos:new Re.bM(e),u_lightintensity:new Re.bN(e),u_lightcolor:new Re.bM(e),u_vertical_gradient:new Re.bN(e),u_height_factor:new Re.bN(e),u_edge_radius:new Re.bN(e),u_ao:new Re.bL(e),u_tile_id:new Re.bM(e),u_zoom_transition:new Re.bN(e),u_inv_rot_matrix:new Re.bK(e),u_merc_center:new Re.bL(e),u_up_dir:new Re.bM(e),u_height_lift:new Re.bN(e),u_image:new Re.bO(e),u_texsize:new Re.bL(e),u_pixel_coord_upper:new Re.bL(e),u_pixel_coord_lower:new Re.bL(e),u_tile_units_to_pixels:new Re.bN(e),u_opacity:new Re.bN(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new Re.bK(e),u_opacity:new Re.bN(e),u_ao_pass:new Re.bN(e),u_meter_to_tile:new Re.bN(e),u_ao:new Re.bL(e),u_flood_light_intensity:new Re.bN(e),u_flood_light_color:new Re.bM(e),u_attenuation:new Re.bN(e),u_edge_radius:new Re.bN(e),u_fb:new Re.bO(e),u_fb_size:new Re.bN(e)}),fill:e=>({u_matrix:new Re.bK(e),u_emissive_strength:new Re.bN(e)}),fillPattern:e=>({u_matrix:new Re.bK(e),u_emissive_strength:new Re.bN(e),u_image:new Re.bO(e),u_texsize:new Re.bL(e),u_pixel_coord_upper:new Re.bL(e),u_pixel_coord_lower:new Re.bL(e),u_tile_units_to_pixels:new Re.bN(e)}),fillOutline:e=>({u_matrix:new Re.bK(e),u_emissive_strength:new Re.bN(e),u_world:new Re.bL(e)}),fillOutlinePattern:e=>({u_matrix:new Re.bK(e),u_emissive_strength:new Re.bN(e),u_world:new Re.bL(e),u_image:new Re.bO(e),u_texsize:new Re.bL(e),u_pixel_coord_upper:new Re.bL(e),u_pixel_coord_lower:new Re.bL(e),u_tile_units_to_pixels:new Re.bN(e)}),circle:Re.cs,collisionBox:e=>({u_matrix:new Re.bK(e),u_camera_to_center_distance:new Re.bN(e),u_extrude_scale:new Re.bL(e)}),collisionCircle:e=>({u_matrix:new Re.bK(e),u_inv_matrix:new Re.bK(e),u_camera_to_center_distance:new Re.bN(e),u_viewport_size:new Re.bL(e)}),debug:e=>({u_color:new Re.ca(e),u_matrix:new Re.bK(e),u_overlay:new Re.bO(e),u_overlay_scale:new Re.bN(e)}),clippingMask:e=>({u_matrix:new Re.bK(e)}),heatmap:e=>({u_extrude_scale:new Re.bN(e),u_intensity:new Re.bN(e),u_matrix:new Re.bK(e),u_inv_rot_matrix:new Re.bK(e),u_merc_center:new Re.bL(e),u_tile_id:new Re.bM(e),u_zoom_transition:new Re.bN(e),u_up_dir:new Re.bM(e)}),heatmapTexture:e=>({u_image:new Re.bO(e),u_color_ramp:new Re.bO(e),u_opacity:new Re.bN(e)}),hillshade:e=>({u_matrix:new Re.bK(e),u_image:new Re.bO(e),u_latrange:new Re.bL(e),u_light:new Re.bL(e),u_shadow:new Re.ca(e),u_highlight:new Re.ca(e),u_emissive_strength:new Re.bN(e),u_accent:new Re.ca(e)}),hillshadePrepare:e=>({u_matrix:new Re.bK(e),u_image:new Re.bO(e),u_dimension:new Re.bL(e),u_zoom:new Re.bN(e)}),line:Re.ct,linePattern:Re.cu,raster:e=>({u_matrix:new Re.bK(e),u_normalize_matrix:new Re.bK(e),u_globe_matrix:new Re.bK(e),u_merc_matrix:new Re.bK(e),u_grid_matrix:new Re.cb(e),u_tl_parent:new Re.bL(e),u_scale_parent:new Re.bN(e),u_fade_t:new Re.bN(e),u_opacity:new Re.bN(e),u_image0:new Re.bO(e),u_image1:new Re.bO(e),u_brightness_low:new Re.bN(e),u_brightness_high:new Re.bN(e),u_saturation_factor:new Re.bN(e),u_contrast_factor:new Re.bN(e),u_spin_weights:new Re.bM(e),u_perspective_transform:new Re.bL(e),u_raster_elevation:new Re.bN(e),u_zoom_transition:new Re.bN(e),u_merc_center:new Re.bL(e),u_cutoff_params:new Re.bP(e),u_colorization_mix:new Re.bP(e),u_colorization_offset:new Re.bN(e),u_color_ramp:new Re.bO(e),u_texture_offset:new Re.bL(e),u_texture_res:new Re.bL(e),u_emissive_strength:new Re.bN(e)}),rasterParticle:e=>({u_matrix:new Re.bK(e),u_normalize_matrix:new Re.bK(e),u_globe_matrix:new Re.bK(e),u_merc_matrix:new Re.bK(e),u_grid_matrix:new Re.cb(e),u_tl_parent:new Re.bL(e),u_scale_parent:new Re.bN(e),u_fade_t:new Re.bN(e),u_opacity:new Re.bN(e),u_image0:new Re.bO(e),u_image1:new Re.bO(e),u_raster_elevation:new Re.bN(e),u_zoom_transition:new Re.bN(e),u_merc_center:new Re.bL(e),u_cutoff_params:new Re.bP(e)}),rasterParticleTexture:e=>({u_texture:new Re.bO(e),u_opacity:new Re.bN(e)}),rasterParticleDraw:e=>({u_tile_offset:new Re.bL(e),u_velocity:new Re.bO(e),u_color_ramp:new Re.bO(e),u_velocity_res:new Re.bL(e),u_max_speed:new Re.bN(e),u_texture_offset:new Re.bL(e),u_data_scale:new Re.bP(e),u_data_offset:new Re.bN(e)}),rasterParticleUpdate:e=>({u_velocity:new Re.bO(e),u_velocity_res:new Re.bL(e),u_max_speed:new Re.bN(e),u_speed_factor:new Re.bN(e),u_lifetime_delta:new Re.bN(e),u_rand_seed:new Re.bN(e),u_texture_offset:new Re.bL(e),u_data_scale:new Re.bP(e),u_data_offset:new Re.bN(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Re.bO(e),u_is_size_feature_constant:new Re.bO(e),u_size_t:new Re.bN(e),u_size:new Re.bN(e),u_camera_to_center_distance:new Re.bN(e),u_rotate_symbol:new Re.bO(e),u_aspect_ratio:new Re.bN(e),u_fade_change:new Re.bN(e),u_matrix:new Re.bK(e),u_label_plane_matrix:new Re.bK(e),u_coord_matrix:new Re.bK(e),u_is_text:new Re.bO(e),u_pitch_with_map:new Re.bO(e),u_texsize:new Re.bL(e),u_tile_id:new Re.bM(e),u_zoom_transition:new Re.bN(e),u_inv_rot_matrix:new Re.bK(e),u_merc_center:new Re.bL(e),u_camera_forward:new Re.bM(e),u_tile_matrix:new Re.bK(e),u_up_vector:new Re.bM(e),u_ecef_origin:new Re.bM(e),u_texture:new Re.bO(e),u_icon_transition:new Re.bN(e),u_icon_saturation:new Re.bN(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Re.bO(e),u_is_size_feature_constant:new Re.bO(e),u_size_t:new Re.bN(e),u_size:new Re.bN(e),u_camera_to_center_distance:new Re.bN(e),u_rotate_symbol:new Re.bO(e),u_aspect_ratio:new Re.bN(e),u_fade_change:new Re.bN(e),u_matrix:new Re.bK(e),u_label_plane_matrix:new Re.bK(e),u_coord_matrix:new Re.bK(e),u_is_text:new Re.bO(e),u_pitch_with_map:new Re.bO(e),u_texsize:new Re.bL(e),u_texture:new Re.bO(e),u_gamma_scale:new Re.bN(e),u_device_pixel_ratio:new Re.bN(e),u_tile_id:new Re.bM(e),u_zoom_transition:new Re.bN(e),u_inv_rot_matrix:new Re.bK(e),u_merc_center:new Re.bL(e),u_camera_forward:new Re.bM(e),u_tile_matrix:new Re.bK(e),u_up_vector:new Re.bM(e),u_ecef_origin:new Re.bM(e),u_is_halo:new Re.bO(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Re.bO(e),u_is_size_feature_constant:new Re.bO(e),u_size_t:new Re.bN(e),u_size:new Re.bN(e),u_camera_to_center_distance:new Re.bN(e),u_rotate_symbol:new Re.bO(e),u_aspect_ratio:new Re.bN(e),u_fade_change:new Re.bN(e),u_matrix:new Re.bK(e),u_label_plane_matrix:new Re.bK(e),u_coord_matrix:new Re.bK(e),u_is_text:new Re.bO(e),u_pitch_with_map:new Re.bO(e),u_texsize:new Re.bL(e),u_texsize_icon:new Re.bL(e),u_texture:new Re.bO(e),u_texture_icon:new Re.bO(e),u_gamma_scale:new Re.bN(e),u_device_pixel_ratio:new Re.bN(e),u_is_halo:new Re.bO(e)}),background:e=>({u_matrix:new Re.bK(e),u_emissive_strength:new Re.bN(e),u_opacity:new Re.bN(e),u_color:new Re.ca(e)}),backgroundPattern:e=>({u_matrix:new Re.bK(e),u_emissive_strength:new Re.bN(e),u_opacity:new Re.bN(e),u_image:new Re.bO(e),u_pattern_tl:new Re.bL(e),u_pattern_br:new Re.bL(e),u_texsize:new Re.bL(e),u_pattern_size:new Re.bL(e),u_pixel_coord_upper:new Re.bL(e),u_pixel_coord_lower:new Re.bL(e),u_tile_units_to_pixels:new Re.bN(e)}),terrainRaster:Or,terrainDepth:Or,skybox:e=>({u_matrix:new Re.bK(e),u_sun_direction:new Re.bM(e),u_cubemap:new Re.bO(e),u_opacity:new Re.bN(e),u_temporal_offset:new Re.bN(e)}),skyboxGradient:e=>({u_matrix:new Re.bK(e),u_color_ramp:new Re.bO(e),u_center_direction:new Re.bM(e),u_radius:new Re.bN(e),u_opacity:new Re.bN(e),u_temporal_offset:new Re.bN(e)}),skyboxCapture:e=>({u_matrix_3f:new Re.cb(e),u_sun_direction:new Re.bM(e),u_sun_intensity:new Re.bN(e),u_color_tint_r:new Re.bP(e),u_color_tint_m:new Re.bP(e),u_luminance:new Re.bN(e)}),globeRaster:e=>({u_proj_matrix:new Re.bK(e),u_globe_matrix:new Re.bK(e),u_normalize_matrix:new Re.bK(e),u_merc_matrix:new Re.bK(e),u_zoom_transition:new Re.bN(e),u_merc_center:new Re.bL(e),u_image0:new Re.bO(e),u_grid_matrix:new Re.cb(e),u_skirt_height:new Re.bN(e),u_far_z_cutoff:new Re.bN(e),u_frustum_tl:new Re.bM(e),u_frustum_tr:new Re.bM(e),u_frustum_br:new Re.bM(e),u_frustum_bl:new Re.bM(e),u_globe_pos:new Re.bM(e),u_globe_radius:new Re.bN(e),u_viewport:new Re.bL(e)}),globeAtmosphere:e=>({u_frustum_tl:new Re.bM(e),u_frustum_tr:new Re.bM(e),u_frustum_br:new Re.bM(e),u_frustum_bl:new Re.bM(e),u_horizon:new Re.bN(e),u_transition:new Re.bN(e),u_fadeout_range:new Re.bN(e),u_color:new Re.bP(e),u_high_color:new Re.bP(e),u_space_color:new Re.bP(e),u_temporal_offset:new Re.bN(e),u_horizon_angle:new Re.bN(e)}),model:e=>({u_matrix:new Re.bK(e),u_lighting_matrix:new Re.bK(e),u_normal_matrix:new Re.bK(e),u_lightpos:new Re.bM(e),u_lightintensity:new Re.bN(e),u_lightcolor:new Re.bM(e),u_camera_pos:new Re.bM(e),u_opacity:new Re.bN(e),u_baseColorFactor:new Re.bP(e),u_emissiveFactor:new Re.bP(e),u_metallicFactor:new Re.bN(e),u_roughnessFactor:new Re.bN(e),u_baseTextureIsAlpha:new Re.bO(e),u_alphaMask:new Re.bO(e),u_alphaCutoff:new Re.bN(e),u_baseColorTexture:new Re.bO(e),u_metallicRoughnessTexture:new Re.bO(e),u_normalTexture:new Re.bO(e),u_occlusionTexture:new Re.bO(e),u_emissionTexture:new Re.bO(e),u_color_mix:new Re.bP(e),u_aoIntensity:new Re.bN(e),u_emissive_strength:new Re.bN(e),u_occlusionTextureTransform:new Re.bP(e)}),modelDepth:e=>({u_matrix:new Re.bK(e),u_instance:new Re.bK(e),u_node_matrix:new Re.bK(e)}),groundShadow:e=>({u_matrix:new Re.bK(e),u_ground_shadow_factor:new Re.bM(e)}),stars:e=>({u_matrix:new Re.bK(e),u_up:new Re.bM(e),u_right:new Re.bM(e),u_intensity_multiplier:new Re.bN(e)})};let _n;function yn(i,r,n,o,a,s,t){var l,c,h,u,e=i.context,d=e.gl,p=i.transform,f=i.getOrCreateProgram("collisionBox"),m=[];let g=0,_=0;for(let e=0;e<o.length;e++){const y=o[e],v=r.getTile(y),x=v.getBucket(n);if(x){l=y,c=x,h=p;const b=c.projection.name===h.projection.name?l.projMatrix:((h=h.clone()).setProjection(c.projection),xi(h,c.getProjection(),l));let e=b;0===a[0]&&0===a[1]||(e=i.translatePosMatrix(b,v,a,s));const u=t?x.textCollisionBox:x.iconCollisionBox,w=x.collisionCircleArray;if(0<w.length){const i=Re.a6.create(),r=e;Re.a6.mul(i,x.placementInvProjMatrix,p.glCoordMatrix),Re.a6.mul(i,i,x.placementViewportMatrix),m.push({circleArray:w,circleOffset:_,transform:r,invTransform:i,projection:x.getProjection()}),g+=w.length/4,_=g}u&&(i.terrain&&i.terrain.setupElevationDraw(v,f),f.draw(i,d.LINES,Oe.disabled,Be.disabled,i.colorModeForRenderPass(),Ne.disabled,((e,t,i,r)=>{i=Re.V/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(r),u_extrude_scale:[t.pixelsToGLUnits[0]/i,t.pixelsToGLUnits[1]/i]}})(e,p,v,x.getProjection()),n.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,null,p.zoom,null,[u.collisionVertexBuffer,u.collisionVertexBufferExt]))}}if(t&&m.length){const y=i.getOrCreateProgram("collisionCircle"),v=new Re.cv;v.resize(4*g),v._trim();let t=0;for(const Re of m)for(let e=0;e<Re.circleArray.length/4;e++){const r=4*e,n=Re.circleArray[0+r],o=Re.circleArray[1+r],a=Re.circleArray[2+r],s=Re.circleArray[3+r];v.emplace(t++,n,o,a,s,0),v.emplace(t++,n,o,a,s,1),v.emplace(t++,n,o,a,s,2),v.emplace(t++,n,o,a,s,3)}(!_n||_n.length<2*g)&&(_n=function(t){var i=2*t,r=new Re.aw;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[0+t]=4*e+0,r.uint16[1+t]=4*e+1,r.uint16[2+t]=4*e+2,r.uint16[3+t]=4*e+2,r.uint16[4+t]=4*e+3,r.uint16[5+t]=4*e+0}return r}(g));const b=e.createIndexBuffer(_n,!0),T=e.createVertexBuffer(v,Re.cw.members,!0);for(const r of m){const o={u_matrix:r.transform,u_inv_matrix:r.invTransform,u_camera_to_center_distance:(u=p).getCameraToCenterDistance(r.projection),u_viewport_size:[u.width,u.height]};y.draw(i,d.TRIANGLES,Oe.disabled,Be.disabled,i.colorModeForRenderPass(),Ne.disabled,o,n.id,T,b,Re.aB.simpleSegment(0,2*r.circleOffset,r.circleArray.length,r.circleArray.length/2),null,p.zoom)}T.destroy(),b.destroy()}}const vn=Re.a6.create();function xn(e){var t=e._camera.getWorldToCamera(e.worldSize,1),t=Re.a6.multiply([],t,e.globeMatrix),e=(Re.a6.invert(t,t),[0,0,0]),i=[0,1,0,0];return Re.a7.transformMat4(i,i,t),e[0]=i[0],e[1]=i[1],e[2]=i[2],Re.N.normalize(e,e),e}function bn(l,c,h,t,u,d,p,f,m,g,_){var i=l.text.placedSymbolArray,y=l.text.dynamicLayoutVertexArray,r=l.icon.dynamicLayoutVertexArray,v={},x=l.getProjection(),b=bi(f,x,d),w=d.elevation,T=x.upVectorScale(f.canonical,d.center.lat,d.worldSize).metersToTile;y.clear();for(let e=0;e<i.length;e++){var S=i.get(e),{tileAnchorX:A,tileAnchorY:E,numGlyphs:C}=S,M=S.hidden||!S.crossTileID||l.allowVerticalPlacement&&!S.placedOrientation?null:t[S.crossTileID];if(M){let e=0,t=0,i=0;if(w){const Re=w?w.getAtTileOffset(f,A,E):0,[l,c,h]=x.upVector(f.canonical,A,E);e=Re*l*T,t=Re*c*T,i=Re*h*T}let[r,n,o,a]=O(S.projectedAnchorX+e,S.projectedAnchorY+t,S.projectedAnchorZ+i,h?b:p);var I=ci(d.getCameraToCenterDistance(x),a);let s=u.evaluateSizeForFeature(l.textSizeData,g,S)*I/Re.bc;h&&(s*=l.tilePixelRatio/m);var I=function({width:e,height:t,anchor:i,textOffset:r,textScale:n},o){var{horizontalAlign:a,verticalAlign:s}=Re.bf(i),a=-(a-.5)*e,e=-(s-.5)*t,s=Re.bd(i,r);return new Re.P((a/n+s[0])*o,(e/n+s[1])*o)}(M,s),P=(h?({x:r,y:n,z:o}=x.projectTilePoint(A+I.x,E+I.y,f.canonical),[r,n,o]=O(r+e,n+t,o+i,p)):(c&&I._rotate(-d.angle),r+=I.x,n+=I.y,o=0),l.allowVerticalPlacement&&S.placedOrientation===Re.b6.vertical?Math.PI/2:0);for(let e=0;e<C;e++)Re.b9(y,r,n,o,P);_&&0<=S.associatedIconIndex&&(v[S.associatedIconIndex]={x:r,y:n,z:o,angle:P})}else _i(C,y)}if(_){r.clear();const c=l.icon.placedSymbolArray;for(let e=0;e<c.length;e++){const h=c.get(e),t=h["numGlyphs"],u=v[e];if(h.hidden||!u)_i(t,r);else{const{x:l,y:c,z:h,angle:d}=u;for(let e=0;e<t;e++)Re.b9(r,l,c,h,d)}}l.icon.dynamicLayoutVertexBuffer.updateData(r)}l.text.dynamicLayoutVertexBuffer.updateData(y)}function wn(z,e,R,O,B,F,t={}){const _=R.paint.get("icon-translate"),N=R.paint.get("text-translate"),y=R.paint.get("icon-translate-anchor"),U=R.paint.get("text-translate-anchor"),j=R.layout.get("icon-rotation-alignment"),V=R.layout.get("text-rotation-alignment"),G=R.layout.get("icon-pitch-alignment"),q=R.layout.get("text-pitch-alignment"),w=R.layout.get("icon-keep-upright"),te=R.layout.get("text-keep-upright"),v=R.paint.get("icon-color-saturation"),i=z.context,W=i.gl,H=z.transform,x="map"===j,Z="map"===V,b="map"===G,$="map"===q,h=void 0!==R.layout.get("symbol-sort-key").constantOr(1);let r=!1;const X=z.depthModeForSublayer(0,Oe.ReadOnly),Y=[Re.a5(H.center.lng),Re.ae(H.center.lat)],K=R.layout.get("text-variable-anchor"),J="globe"===H.projection.name,n=[],Q=[0,-1,0];for(const B of O){const O=e.getTile(B),F=O.getBucket(R);if(F&&!("mercator"===F.projection.name&&J||F.fullyClipped)){const j="globe"===F.projection.name,V=j?Re.S(H.zoom):0,G=bi(B,F.getProjection(),H),q=H.calculatePixelsToTileUnitsMatrix(O),i=K&&F.hasTextData(),X=F.hasIconTextFit()&&i&&F.hasIconData(),ee=F.getProjection().createInversionMatrix(H,B.canonical),o=()=>{const e=Z&&"point"!==R.layout.get("symbol-placement"),t=[],i=e||K||X;z.terrainRenderModeElevated()&&$&&t.push("PITCH_WITH_MAP_TERRAIN"),j&&(t.push("PROJECTION_GLOBE_VIEW"),i)&&t.push("PROJECTED_POS_ON_VIEWPORT"),F.text.zOffsetVertexBuffer&&t.push("Z_OFFSET");var r=F.text.programConfigurations.get(R.id),r=z.getOrCreateProgram(F.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:r,defines:t});let n,o=[0,0],a=null;var s=F.textSizeData,l=(F.iconsInText&&(o=O.imageAtlasTexture?O.imageAtlasTexture.size:[0,0],a=O.imageAtlasTexture||null,n=$||0!==H.pitch||z.options.rotating||z.options.zooming||"composite"===s.kind||"camera"===s.kind?W.LINEAR:W.NEAREST),O.glyphAtlasTexture?O.glyphAtlasTexture.size:[0,0]),c=Re.b5(s,H.zoom),h=ai(G,O.tileID.canonical,$,Z,H,F.getProjection(),q),u=li(G,O.tileID.canonical,$,Z,H,F.getProjection(),q),d=z.translatePosMatrix(u,O,N,U,!0),p=z.translatePosMatrix(G,O,N,U),f=i?vn:h,m=Z&&!$&&!e;let g=Q;!J&&!H.mercatorFromTransition||Z||(g=xn(H));var _,y,v,x,b,w,T,S,A,E,C,M=j?g:Q,I=F.iconsInText?(I=s.kind,P=c,L=m,D=$,k=z,_=p,y=f,v=d,x=l,b=o,w=B,T=V,S=Y,A=ee,E=M,C=F.getProjection(),Re.e(dn(I,P,L,D,k,_,y,v,!0,x,!0,w,T,S,A,E,C),{u_texsize_icon:b,u_texture_icon:1})):dn(s.kind,c,m,$,z,p,f,d,!0,l,!0,B,V,Y,ee,M,F.getProjection()),P=O.glyphAtlasTexture||null,L=W.LINEAR,D=0!==R.paint.get("text-halo-width").constantOr(1),k=z.terrain&&$&&e?Re.a6.invert(Re.a6.create(),h):vn;if(e&&F.text){const Re=H.elevation,e=Re?Re.getAtTileOffsetFunc(B,H.center.lat,H.worldSize,F.getProjection()):null,R=si(G,O.tileID.canonical,$,Z,H,F.getProjection(),q);hi(F,G,z,!0,R,u,$,te,e,B)}return{program:r,buffers:F.text,uniformValues:I,atlasTexture:P,atlasTextureIcon:a,atlasInterpolation:L,atlasInterpolationIcon:n,isSDF:!0,hasHalo:D,tile:O,labelPlaneMatrixInv:k}},u=F.icon.segments.get().length,d=F.text.segments.get().length,a=u&&!t.onlyText?(()=>{const e=x&&"point"!==R.layout.get("symbol-placement"),t=[],i=e||X,r=R.paint.get("icon-image-cross-fade").constantOr(0);z.terrainRenderModeElevated()&&b&&t.push("PITCH_WITH_MAP_TERRAIN"),j&&(t.push("PROJECTION_GLOBE_VIEW"),i)&&t.push("PROJECTED_POS_ON_VIEWPORT"),0<r&&t.push("ICON_TRANSITION"),F.icon.zOffsetVertexBuffer&&t.push("Z_OFFSET"),v<1&&t.push("SATURATION");var n=F.icon.programConfigurations.get(R.id),n=z.getOrCreateProgram(F.sdfIcons?"symbolSDF":"symbolIcon",{config:n,defines:t}),o=O.imageAtlasTexture?O.imageAtlasTexture.size:[0,0],a=F.iconSizeData,s=Re.b5(a,H.zoom),l=b||0!==H.pitch,c=ai(G,O.tileID.canonical,b,x,H,F.getProjection(),q),h=li(G,O.tileID.canonical,b,x,H,F.getProjection(),q),u=z.translatePosMatrix(h,O,_,y,!0),d=z.translatePosMatrix(G,O,_,y),p=i?vn:c,f=x&&!b&&!e;let m=Q;!J&&!H.mercatorFromTransition||x||(m=xn(H));var g=j?m:Q,a=F.sdfIcons&&!F.iconsInText?dn(a.kind,s,f,b,z,d,p,u,!1,o,!0,B,V,Y,ee,g,F.getProjection()):un(a.kind,s,f,b,z,d,p,u,!1,o,B,V,Y,ee,g,F.getProjection(),v,r),s=O.imageAtlasTexture||null,f=1!==R.layout.get("icon-size").constantOr(0)||F.iconsNeedLinear,d=F.sdfIcons||z.options.rotating||z.options.zooming||f||l?W.LINEAR:W.NEAREST,p=F.sdfIcons&&0!==R.paint.get("icon-halo-width").constantOr(1),u=z.terrain&&b&&e?Re.a6.invert(Re.a6.create(),c):vn;if(e&&F.icon){const Re=H.elevation,e=Re?Re.getAtTileOffsetFunc(B,H.center.lat,H.worldSize,F.getProjection()):null,R=si(G,O.tileID.canonical,b,x,H,F.getProjection(),q);hi(F,G,z,!1,R,h,b,w,e,B)}return{program:n,buffers:F.icon,uniformValues:a,atlasTexture:s,atlasTextureIcon:null,atlasInterpolation:d,atlasInterpolationIcon:null,isSDF:F.sdfIcons,hasHalo:p,tile:O,labelPlaneMatrixInv:u}})():null,s=d&&!t.onlyIcons?o():null,l=R.paint.get("icon-opacity").constantOr(1),c=R.paint.get("text-opacity").constantOr(1);if(h&&F.canOverlap){r=!0;const z=l&&!t.onlyText?F.icon.segments.get():[],e=c&&!t.onlyIcons?F.text.segments.get():[];for(const e of z)n.push({segments:new Re.aB([e]),sortKey:e.sortKey,state:a});for(const z of e)n.push({segments:new Re.aB([z]),sortKey:z.sortKey,state:s})}else t.onlyText||n.push({segments:l?F.icon.segments:new Re.aB([]),sortKey:0,state:a}),t.onlyIcons||n.push({segments:c?F.text.segments:new Re.aB([]),sortKey:0,state:s})}}r&&n.sort((e,t)=>e.sortKey-t.sortKey);for(const Re of n){const e=Re.state;if(e)if(z.terrain&&z.terrain.setupElevationDraw(e.tile,e.program,{useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:e.labelPlaneMatrixInv}),i.activeTexture.set(W.TEXTURE0),e.atlasTexture&&e.atlasTexture.bind(e.atlasInterpolation,W.CLAMP_TO_EDGE,!0),e.atlasTextureIcon&&(i.activeTexture.set(W.TEXTURE1),e.atlasTextureIcon)&&e.atlasTextureIcon.bind(e.atlasInterpolationIcon,W.CLAMP_TO_EDGE,!0),z.uploadCommonLightUniforms(z.context,e.program),e.hasHalo){const O=e.uniformValues;O.u_is_halo=1,Tn(e.buffers,Re.segments,R,z,e.program,X,B,F,O,2),O.u_is_halo=0}else{if(e.isSDF){const O=e.uniformValues;e.hasHalo&&(O.u_is_halo=1,Tn(e.buffers,Re.segments,R,z,e.program,X,B,F,O,1)),O.u_is_halo=0}Tn(e.buffers,Re.segments,R,z,e.program,X,B,F,e.uniformValues,1)}}}function Tn(e,t,i,r,n,o,a,s,l,c){var h=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,o,a,s,Ne.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),h,c)}function Sn(e,t,i,r,n,o,a){var s,l,c,h,u,d=e.context.gl,p=i.paint.get("fill-pattern"),f=p&&p.constantOr(1);let m,g,_,y,v;m=a?(g=f&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d.LINES):(g=f?"fillPattern":"fill",d.TRIANGLES);for(const A of r){const r=t.getTile(A);if(!f||r.patternsLoaded()){var x=r.getBucket(i);if(x){e.prepareDrawTile();var b=x.programConfigurations.get(i.id),w=e.isTileAffectedByFog(A),w=e.getOrCreateProgram(g,{config:b,overrideFog:w}),T=(f&&(e.context.activeTexture.set(d.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),b.updatePaintBuffers()),p.constantOr(null));if(T&&r.imageAtlas){const e=r.imageAtlas.patternPositions[T.toString()];e&&b.setConstantPatternPositions(e)}var T=e.translatePosMatrix(A.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),S=i.paint.get("fill-emissive-strength");if(a){y=x.indexBuffer2,v=x.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];_="fillOutlinePattern"===g&&f?(s=T,l=S,c=e,h=r,u=t,Re.e(nn(s,l,c,h),{u_world:u})):(s=t,{u_matrix:T,u_world:s,u_emissive_strength:S})}else y=x.indexBuffer,v=x.segments,_=f?nn(T,S,e,r):rn(T,S);e.uploadCommonUniforms(e.context,w,A.toUnwrapped()),w.draw(e,m,n,e.stencilModeForClipping(A),o,Ne.disabled,_,i.id,x.layoutVertexBuffer,y,v,i.paint,e.transform.zoom,b,void 0)}}}}function An(r,n,o,a,s,l,c,h){o.resetLayerRenderingStats(r);const u=r.context,d=u.gl,p=r.transform,f=o.paint.get("fill-extrusion-pattern"),m=f.constantOr(1),g=o.paint.get("fill-extrusion-opacity"),_=r.style.enable3dLights(),e=o.paint.get(_&&!m?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),y=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),e],v=o.layout.get("fill-extrusion-edge-radius"),x=0<v&&!o.paint.get("fill-extrusion-rounded-roof"),b=x?0:v,w="globe"===p.projection.name?Re.cF():0,T="globe"===p.projection.name,S=T?Re.S(p.zoom):0,A=[Re.a5(p.center.lng),Re.ae(p.center.lat)],E=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),C=o.paint.get("fill-extrusion-flood-light-intensity"),M=o.paint.get("fill-extrusion-vertical-scale"),I=rr(r,o.paint.get("fill-extrusion-cutoff-fade-range")),F=o.paint.get("fill-extrusion-emissive-strength"),P=[];let L;T&&P.push("PROJECTION_GLOBE_VIEW"),0<y[0]&&P.push("FAUX_AO"),x&&P.push("ZERO_ROOF_RADIUS"),h&&P.push("HAS_CENTROID"),0<C&&P.push("FLOOD_LIGHT"),I.shouldRenderCutoff&&P.push("RENDER_CUTOFF");const D="shadow"===r.renderPass,k=r.shadowRenderer,z=D&&!!k;r.shadowRenderer&&(r.shadowRenderer.useNormalOffset=!0);let R=[0,0,0];if(k){const Re=r.style.directionalLight,n=r.style.ambientLight;Re&&n&&(R=cr(Re,n)),L=P.concat(["SHADOWS_SINGLE_CASCADE"])}var N=z?"fillExtrusionDepth":m?"fillExtrusionPattern":"fillExtrusion",O=o.getLayerRenderingStats();for(const Re of a){const a=n.getTile(Re),_=a.getBucket(o);if(_&&_.projection.name===p.projection.name){let e=!1;k&&(e=0===k.getMaxCascadeForTile(Re.toUnwrapped()));const v=r.isTileAffectedByFog(Re),x=_.programConfigurations.get(o.id),z=r.getOrCreateProgram(N,{config:x,defines:e?L:P,overrideFog:v});if(r.terrain&&r.terrain.setupElevationDraw(a,z,{useMeterToDem:!0}),!_.centroidVertexBuffer){const Re=z.attributes.a_centroid_pos;void 0!==Re&&d.vertexAttrib2f(Re,0,0)}!D&&k&&k.setupShadows(a.tileID.toUnwrapped(),z,"vector-tile",a.tileID.overscaledZ),m&&(r.context.activeTexture.set(d.TEXTURE0),a.imageAtlasTexture&&a.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),x.updatePaintBuffers());var B=f.constantOr(null);if(B&&a.imageAtlas){const Re=a.imageAtlas.patternPositions[B.toString()];Re&&x.setConstantPatternPositions(Re)}B=o.paint.get("fill-extrusion-vertical-gradient");let t;if(D&&k){if(Ln(a.tileID,_,r))continue;const Re=k.calculateShadowPassMatrixFromTile(a.tileID.toUnwrapped());t={u_matrix:Re,u_edge_radius:b,u_vertical_scale:M}}else{const n=r.translatePosMatrix(Re.expandedProjMatrix,a,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),s=p.projection.createInversionMatrix(p,Re.canonical);t=m?tn(n,r,B,g,y,b,Re,a,w,S,A,s,E,M):en(n,r,B,g,y,b,Re,w,S,A,s,E,M,C,R,F)}r.uploadCommonUniforms(u,z,Re.toUnwrapped(),null,I);let i=_.segments;if("mercator"!==p.projection.name||D||(i=_.getVisibleSegments(a.tileID,r.terrain,r.transform.getFrustum(0))).get().length){if(O)if(D)for(const Re of i.get())O.numRenderedVerticesInShadowPass+=Re.primitiveLength;else for(const Re of i.get())O.numRenderedVerticesInTransparentPass+=Re.primitiveLength;B=[];(r.terrain||h)&&B.push(_.centroidVertexBuffer),T&&B.push(_.layoutVertexExtBuffer),z.draw(r,u.gl.TRIANGLES,s,l,c,Ne.backCCW,t,o.id,_.layoutVertexBuffer,_.indexBuffer,i,o.paint,r.transform.zoom,x,B)}}}r.shadowRenderer&&(r.shadowRenderer.useNormalOffset=!1)}function En(s,e,l,r,c,h,u,d,p,n,f,m,g,_,y,v,x,t,b){const w=s.context,i=w.gl,o=s.transform,T=s.transform.zoom,S=[],A=rr(s,l.paint.get("fill-extrusion-cutoff-fade-range")),E=("clear"===n?(S.push("CLEAR_SUBPASS"),b&&(S.push("CLEAR_FROM_TEXTURE"),w.activeTexture.set(i.TEXTURE0),b.bind(i.LINEAR,i.CLAMP_TO_EDGE))):"sdf"===n&&S.push("SDF_SUBPASS"),x&&S.push("HAS_CENTROID"),A.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),l.layout.get("fill-extrusion-edge-radius")),a=(e,t,i,r,n)=>{var o=t.programConfigurations.get(l.id),a=s.isTileAffectedByFog(e),a=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:o,defines:S,overrideFog:a}),r={u_matrix:r,u_opacity:f,u_ao_pass:p?1:0,u_meter_to_tile:n,u_ao:[m,g*n],u_flood_light_intensity:_,u_flood_light_color:y,u_attenuation:v,u_edge_radius:17<=T?0:E*n,u_fb:0,u_fb_size:b?b.size[0]:0},n=[];x&&n.push(t.hiddenByLandmarkVertexBuffer),s.uploadCommonUniforms(w,a,e.toUnwrapped(),null,A),a.draw(s,w.gl.TRIANGLES,c,h,u,d,r,l.id,t.vertexBuffer,t.indexBuffer,i,l.paint,T,o,n)};for(const c of r){const r=e.getTile(c),h=r.getBucket(l);if(h&&h.projection.name===o.projection.name&&h.groundEffect&&(!h.groundEffect||h.groundEffect.hasData())){const u=h.groundEffect,d=1/h.tileToMeter;{const Re=s.translatePosMatrix(c.projMatrix,r,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),e=u.getDefaultSegment();a(c,u,e,Re,d)}if(t)for(let i=0;i<4;i++){const u=Re.cG[i](c),p=e.getTile(u);if(p){const n=p.getBucket(l);if(n&&n.projection.name===o.projection.name&&n.groundEffect&&(!n.groundEffect||n.groundEffect.hasData())){const f=n.groundEffect;let e,t;t=0===i?(e=[-Re.V,0,0],1):1===i?(e=[Re.V,0,0],0):2===i?(e=[0,-Re.V,0],3):(e=[0,Re.V,0],2);const _=f.regionSegments[t];if(_){const y=new Float32Array(16);Re.a6.translate(y,c.projMatrix,e),a(c,f,_,s.translatePosMatrix(y,r,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),d)}}}}}}}function Cn(e,n,c,o,a,h,s){0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const u=h?h.findDEMTileFor(c):null;if(u&&u.dem||s){const f=e=>{const t=n.getSource().minzoom,i=e=>{e=n.getTileByID(e);if(e&&e.hasData())return e.getBucket(a)},r=[0,-1,1];for(const n of r)if(!(e.overscaledZ+n<t)){const r=i(e.calculateScaledKey(e.overscaledZ+n));if(r)return r}},m=[0,0,0],g=(e,t)=>(m[0]=Math.min(e.min.y,t.min.y),m[1]=Math.max(e.max.y,t.max.y),m[2]=Re.V-t.min.x>e.max.x?t.min.x-Re.V:e.max.x,m),_=(e,t)=>(m[0]=Math.min(e.min.x,t.min.x),m[1]=Math.max(e.max.x,t.max.x),m[2]=Re.V-t.min.y>e.max.y?t.min.y-Re.V:e.max.y,m),y=[(e,t)=>g(e,t),(e,t)=>g(t,e),(e,t)=>_(e,t),(e,t)=>_(t,e)],v=(e,t,i,r,n,o,a)=>{var s,l;return h?(s=[[o?i:e,o?e:i,0],[o?i:t,o?t:i,0]],l=a<0?Re.V+a:a,o=[o?l:(e+t)/2,o?(e+t)/2:l,0],0===i&&a<0||0!==i&&0<a?h.getForTilePoints(n,[o],!0,r):s.push(o),h.getForTilePoints(c,s,!0,u),Math.max(s[0][2],s[1][2],o[2])/h.exaggeration()):0};for(let r=0;r<4;r++){const n=o.borderFeatureIndices[r];if(0!==n.length){const a=Re.cG[r](c),u=f(a);if(u&&u instanceof Re.cH&&o.borderDoneWithNeighborZ[r]!==u.canonical.z){0===u.centroidVertexArray.length&&u.createCentroidsBuffer();const m=h?h.findDEMTileFor(a):null;if(m&&m.dem||s){const g=(r<2?1:5)-r,_=u.borderDoneWithNeighborZ[g]!==o.canonical.z,x=u.borderFeatureIndices[g];let i=0;if(o.canonical.z!==u.canonical.z){for(const Re of n)o.showCentroid(o.featuresOnBorder[Re]);if(_)for(const Re of x)u.showCentroid(u.featuresOnBorder[Re]);o.borderDoneWithNeighborZ[r]=u.canonical.z,u.borderDoneWithNeighborZ[g]=o.canonical.z}for(const c of n){const n=o.featuresOnBorder[c],h=o.centroidData[n.centroidDataIndex],f=n.borders[r];let t;for(;i<x.length;){const Re=(t=u.featuresOnBorder[x[i]]).borders[g];if(Re[1]>f[0]+3||Re[0]>f[0]-3)break;u.showCentroid(t),i++}if(t&&i<x.length){const c=i;let e=0;for(;!(t.borders[g][0]>f[1]-3)&&(e++,++i!==x.length);)t=u.featuresOnBorder[x[i]];if(t=u.featuresOnBorder[x[c]],1<e){const Re=t.borders[g];Math.abs(f[0]-Re[0])<3&&Math.abs(f[1]-Re[1])<3&&(e=1,i=c+1)}else if(0===e){o.showCentroid(n);continue}var l=u.centroidData[t.centroidDataIndex],d=(s&&1===e&&(((d=h).flags|(p=l).flags)&Re.cI?(d.flags|=Re.cI,p.flags|=Re.cI):(d.flags&=~Re.cI,p.flags&=~Re.cI)),1<n.intersectsCount()||1<t.intersectsCount());if(1<e)i=c,h.centroidXY=l.centroidXY=new Re.P(0,0);else if(m&&m.dem&&!d){const n=y[r](h,l),c=r%2?Re.V-1:0,o=v(n[0],Math.min(Re.V-1,n[1]),c,m,a,r<2,n[2]);h.centroidXY=l.centroidXY=(p=o,new Re.P(Math.ceil((p+Re.cJ)*Re.cK),0))}else d?h.centroidXY=l.centroidXY=new Re.P(0,0):(h.centroidXY=o.encodeBorderCentroid(n),l.centroidXY=u.encodeBorderCentroid(t));o.writeCentroidToBuffer(h),u.writeCentroidToBuffer(l)}else o.showCentroid(n)}o.borderDoneWithNeighborZ[r]=u.canonical.z,u.borderDoneWithNeighborZ[g]=o.canonical.z}}}}var d,p;(o.needsCentroidUpdate||!o.centroidVertexBuffer&&0!==o.centroidVertexArray.length)&&o.uploadCentroid(e)}}const Mn=[1,0,0],In=[0,1,0],Pn=[0,0,1];function Ln(e,t,i){var r=i.transform,n=i.shadowRenderer;if(!n)return 1;var o=e.toUnwrapped(),i=r.tileSize*n._cascades[i.currentShadowCascade].scale;let a=t.maxHeight;if(r.elevation){const Re=r.elevation.getMinMaxForTile(e);Re&&(a+=Re.max)}var t=[...n.shadowDirection],e=(t[2]=-t[2],n.computeSimplifiedTileShadowVolume(o,a,i,t));return e?(o=[Mn,In,Pn,t,[t[0],0,t[2]],[0,t[1],t[2]]],t="globe"===r.projection.name,i=r.scaleZoom(i),r=Re.bq.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,i,!t),i=n.getCurrentCascadeFrustum(),0===r.intersectsPrecise(e.vertices,e.planes,o)||0===i.intersectsPrecise(e.vertices,e.planes,o)):void 0}function Dn(e){return[e[0]*Re.cL,e[1]*Re.cL,e[2]*Re.cL,0]}function kn(r,n,o,a,s,l,c,h,u){var d=a.getSource(),p=o.globeSharedBuffers;if(p){let e,t,i;if(n&&(e=a.getTile(n)),d instanceof Re.ap?(t=d.texture,i=Re.cj(0,0,o.transform)):e&&n&&(t=e.texture,i=Re.cj(n.canonical.z,n.canonical.x,o.transform)),t&&i){r||(i=Re.a6.scale(Re.a6.create(),i,[1,-1,1]));var a=o.context,d=a.gl,f="nearest"===s.paint.get("raster-resampling")?d.NEAREST:d.LINEAR,m=o.colorModeForDrapableLayerRenderPass(l),g=c.defines,_=(g.push("GLOBE_POLES"),new Oe(d.LEQUAL,Oe.ReadWrite,o.depthRangeFor3D)),y=Float32Array.from(o.transform.expandedFarZProjMatrix),v=Float32Array.from(Re.aT(Re.ci(new Re.bs(0,0,0)))),[f,n,p,x]=(o.terrain&&o.terrain.prepareDrawTile(),a.activeTexture.set(d.TEXTURE0),t.bind(f,d.CLAMP_TO_EDGE),a.activeTexture.set(d.TEXTURE1),t.bind(f,d.CLAMP_TO_EDGE),t.useMipmap&&a.extTextureFilterAnisotropic&&20<o.transform.pitch&&d.texParameterf(d.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),n?p.getPoleBuffers(n.canonical.z,!1):p.getPoleBuffers(0,!0)),b=s.paint.get("raster-elevation");let e;r?(e=f,o.renderDefaultNorthPole=0!==b):(e=n,o.renderDefaultSouthPole=0!==b);var w,T,r=Dn(c.mix),f=(f=y,n=v,y=i,v=Re.S(o.transform.zoom),w=s,b=b,r=r,T=c.offset,c=c.range,l=l,cn(f,n,y,new Float32Array(16),new Float32Array(9),[0,0],v,[0,0],[0,0,0,0],1,{opacity:1,mix:0},w,[0,0],b,2,r,T,c,1,0,l)),n=o.getOrCreateProgram("raster",{defines:g});o.uploadCommonUniforms(a,n,null),n.draw(o,d.TRIANGLES,_,u,m,h,f,s.id,e,p,x)}}}function zn(e,t,i){if(!e)return null;t=t.getTextureDescriptor(e,i,!0);if(!t)return null;let{texture:r,mix:n,offset:o,tileSize:a,buffer:s,format:l}=t;if(!r||!l)return null;let c=!1;return"uint32"===l&&(c=!0,n[3]=0,n=sn(Re.cM,n,[0,i.paint.get("raster-particle-max-speed")]),o=ln(Re.cM,o,[0,i.paint.get("raster-particle-max-speed")])),{texture:r,textureOffset:[s/(a+2*s),a/(a+2*s)],tileSize:a,scalarData:c,scale:n,offset:o,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[l]]}}const Rn=new Re.ax(1,0,0,1),On=new Re.ax(0,1,0,1),Bn=new Re.ax(0,0,1,1),Fn=new Re.ax(1,0,1,1),Nn=new Re.ax(0,1,1,1);function Un(t,i,r,n,e,o,a){var s=t.context,l=t.transform,c=s.gl,h="globe"===l.projection.name,u=h?["PROJECTION_GLOBE_VIEW"]:[];let d=Re.a6.clone(r.projMatrix);if(h&&0<Re.S(l.zoom)){const t=Re.aS(r.canonical,l),i=Re.cN(t);d=Re.a6.multiply(new Float32Array(16),l.globeMatrix,i),Re.a6.multiply(d,l.projMatrix,d)}var p=Re.a6.create(),e=(p[12]+=2*e/(Re.f.devicePixelRatio*l.width),p[13]+=2*o/(Re.f.devicePixelRatio*l.height),Re.a6.multiply(d,p,d),t.getOrCreateProgram("debug",{defines:u})),o=i.getTileByID(r.key),p=(t.terrain&&t.terrain.setupElevationDraw(o,e),Oe.disabled),u=Be.disabled,f=t.colorModeForRenderPass(),s=(s.activeTexture.set(c.TEXTURE0),t.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),h?o._makeGlobeTileDebugBuffers(t.context,l):o._makeDebugTileBoundsBuffers(t.context,l.projection),o._tileDebugBuffer||t.debugBuffer),h=o._tileDebugIndexBuffer||t.debugIndexBuffer,m=o._tileDebugSegments||t.debugSegments;if(e.draw(t,c.LINE_STRIP,p,u,f,Ne.disabled,on(d,n),"$debug",s,h,m,null,null,null,[o._globeTileDebugBorderBuffer]),a){const Re=o.latestRawTileData,i=Math.floor((Re&&Re.byteLength||0)/1024);let e=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(e+=" => "+r.overscaledZ),e=e+(" "+o.state)+` ${i}kb`,f=t,n=e,f.initDebugOverlayCanvas(),s=f.debugOverlayCanvas,h=f.context.gl,(m=f.debugOverlayCanvas.getContext("2d")).clearRect(0,0,s.width,s.height),m.shadowColor="white",m.shadowBlur=2,m.lineWidth=1.5,m.strokeStyle="white",m.textBaseline="top",m.font="bold 36px Open Sans, sans-serif",m.fillText(n,5,5),m.strokeText(n,5,5),f.debugOverlayTexture.update(s),f.debugOverlayTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}a=i.getTile(r).tileSize,m=512/Math.min(a,512)*(r.overscaledZ/l.zoom)*.5,n=o._tileDebugTextBuffer||t.debugBuffer,s=o._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,f=o._tileDebugTextSegments||t.debugSegments;e.draw(t,c.TRIANGLES,p,u,Fe.alphaBlended,Ne.disabled,on(d,Re.ax.transparent,m),"$debug",n,s,f,null,null,null,[o._globeTileDebugTextBuffer])}function jn(e,t,i,r){Gn(e,0,t+i/2,e.transform.width,i,r)}function Vn(e,t,i,r){Gn(e,t-i/2,0,i,e.transform.height,r)}function Gn(e,t,i,r,n,o){var e=e.context,a=e.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*Re.f.devicePixelRatio,i*Re.f.devicePixelRatio,r*Re.f.devicePixelRatio,n*Re.f.devicePixelRatio),e.clear({color:o}),a.disable(a.SCISSOR_TEST)}const qn=Re.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),Wn=qn["members"];function T(e,t,i,r){e.emplaceBack(t,i,r)}class Hn{constructor(e){this.vertexArray=new Re.az,this.indices=new Re.aw,T(this.vertexArray,-1,-1,1),T(this.vertexArray,1,-1,1),T(this.vertexArray,-1,1,1),T(this.vertexArray,1,1,1),T(this.vertexArray,-1,-1,-1),T(this.vertexArray,1,-1,-1),T(this.vertexArray,-1,1,-1),T(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Wn),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=Re.aB.simpleSegment(0,0,36,12)}}function Zn(e,t,i,r,n,o){const a=e.context.gl,s=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),c=t.paint.get("sky-atmosphere-sun-intensity"),h={u_matrix_3f:Re.co.fromMat4(Re.co.create(),r),u_sun_direction:n,u_sun_intensity:c,u_color_tint_r:[s.r,s.g,s.b,s.a],u_color_tint_m:[l.r,l.g,l.b,l.a],u_luminance:5e-5};a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o,t.skyboxTexture,0),i.draw(e,a.TRIANGLES,Oe.disabled,Be.disabled,Fe.unblended,Ne.frontCW,h,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const $n=Re.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xn{constructor(e){var t=new Re.cO,i=(t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1),new Re.aw);i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(t,$n.members),this.indexBuffer=e.createIndexBuffer(i),this.segments=Re.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Yn=Re.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Kn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Jn{constructor(e){this.colorModeAlphaBlendedWriteRGB=new Fe([1,771,1,771],Re.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Fe([1,0,1,0],Re.ax.transparent,[!1,!1,!1,!0]),this.params=new Kn,this.updateNeeded=!0,e.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),e.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),e.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),e.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){var e=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Xn(e);const i=this.params.sizeRange,a=this.params.intensityRange,s=function(t){var i=Re.aA(30),r=[];for(let e=0;e<t;++e){const t=2*Math.PI*i(),n=Math.acos(1-2*i())-.5*Math.PI;r.push(Re.N.fromValues(Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)))}return r}(this.params.starsCount),l=Re.aA(300),c=new Re.cP,h=new Re.aw;let t=0;for(let e=0;e<s.length;++e){var r=Re.N.scale([],s[e],200),n=Math.max(0,1+.01*i*(+l()-.5)),o=Math.max(0,1+.01*a*(+l()-.5));c.emplaceBack(r[0],r[1],r[2],-1,-1,n,o),c.emplaceBack(r[0],r[1],r[2],1,-1,n,o),c.emplaceBack(r[0],r[1],r[2],1,1,n,o),c.emplaceBack(r[0],r[1],r[2],-1,1,n,o),h.emplaceBack(t+0,t+1,t+2),h.emplaceBack(t+0,t+2,t+3),t+=4}this.starsVx=e.createVertexBuffer(c,Yn.members),this.starsIdx=e.createIndexBuffer(h),this.starsSegments=Re.aB.simpleSegment(0,0,c.length,h.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,e){const o=n.context,a=o.gl,s=n.transform,l=new Oe(a.LEQUAL,Oe.ReadOnly,[0,1]),c=Re.S(s.zoom),h=e.properties.get("color").toArray01(),u=e.properties.get("high-color").toArray01(),d=e.properties.get("space-color").toArray01PremultipliedAlpha(),p=Re.cQ(e.properties.get("horizon-blend"),0,1,5e-4,.25),t=Re.cd(n,o,s)&&5e-4===p?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,f=n.frameCounter/1e3%1,i=Re.N.length(s.globeCenterInViewSpace),r=Math.sqrt(Math.pow(i,2)-Math.pow(t,2)),m=Math.acos(r/i),g=e=>{var t="globe"===s.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"],t=(e&&t.push("ALPHA_PASS"),n.getOrCreateProgram("globeAtmosphere",{defines:t})),i={u_frustum_tl:s.frustumCorners.TL,u_frustum_tr:s.frustumCorners.TR,u_frustum_br:s.frustumCorners.BR,u_frustum_bl:s.frustumCorners.BL,u_horizon:s.frustumCorners.horizon,u_transition:c,u_fadeout_range:p,u_color:h,u_high_color:u,u_space_color:d,u_temporal_offset:f,u_horizon_angle:m},r=(n.uploadCommonUniforms(o,t),this.atmosphereBuffer);r&&t.draw(n,a.TRIANGLES,l,Be.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ne.backCW,i,e?"atmosphere_glow_alpha":"atmosphere_glow",r.vertexBuffer,r.indexBuffer,r.segments)};g(!1),g(!0)}drawStars(e,t){var i,r,n,o,a,s,l,t=Re.aa(t.properties.get("star-intensity"),0,1);0!==t&&(r=(i=e.context).gl,o=e.transform,n=e.getOrCreateProgram("stars"),a=Re.bi.identity([]),Re.bi.rotateX(a,a,-o._pitch),Re.bi.rotateZ(a,a,-o.angle),Re.bi.rotateX(a,a,Re.bj(o._center.lat)),Re.bi.rotateY(a,a,-Re.bj(o._center.lng)),a=Re.a6.fromQuat(new Float32Array(16),a),o=Re.a6.multiply([],o.starsProjMatrix,a),a=Re.co.fromMat4([],a),a=Re.co.invert([],a),Re.N.transformMat3(s=[0,1,0],s,a),Re.N.scale(s,s,this.params.sizeMultiplier),Re.N.transformMat3(l=[1,0,0],l,a),Re.N.scale(l,l,this.params.sizeMultiplier),a=s,s=l,l=t,t={u_matrix:Float32Array.from(o),u_up:a,u_right:s,u_intensity_multiplier:l},e.uploadCommonUniforms(i,n),this.starsVx)&&this.starsIdx&&n.draw(e,r.TRIANGLES,Oe.disabled,Be.disabled,this.colorModeAlphaBlendedWriteRGB,Ne.disabled,t,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Qn(e,t){var e=[...e],i=t.cameraWorldSizeForFog/t.worldSize,r=Re.a6.identity([]);return Re.a6.scale(r,r,[i,i,1]),Re.a6.multiply(e,r,e),Re.a6.multiply(e,t.worldToFogMatrix,e),e}function eo(n,e,t,i){const r=t.material,o=i.context,{baseColorTexture:a,metallicRoughnessTexture:s}=r.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:h}=r;function u(e,t,i){if(e&&(n.push(t),o.activeTexture.set(o.gl.TEXTURE0+i),e.gfxTexture)){const{minFilter:n,magFilter:t,wrapS:i,wrapT:r}=e.sampler;e.gfxTexture.bindExtraParam(n,t,i,r)}}u(a,"HAS_TEXTURE_u_baseColorTexture",x.BaseColor),u(s,"HAS_TEXTURE_u_metallicRoughnessTexture",x.MetallicRoughness),u(l,"HAS_TEXTURE_u_normalTexture",x.Normal),u(c,"HAS_TEXTURE_u_occlusionTexture",x.Occlusion),u(h,"HAS_TEXTURE_u_emissionTexture",x.Emission),t.texcoordBuffer&&(n.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(t.texcoordBuffer)),t.colorBuffer&&(n.push(12===t.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(t.colorBuffer)),t.normalBuffer&&(n.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(t.normalBuffer)),t.pbrBuffer&&(n.push("HAS_ATTRIBUTE_a_pbr"),n.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(t.pbrBuffer)),"OPAQUE"!==r.alphaMode&&"MASK"!==r.alphaMode||n.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||n.push("DIFFUSE_SHADED"),n.push("USE_STANDARD_DERIVATIVES")}function to(e,t,i,r,n,o){var a=i.paint.get("model-opacity"),s=t.context,l=new Oe(t.context.gl.LEQUAL,Oe.ReadWrite,t.depthRangeFor3D),c=t.transform,h=e.mesh,u=h.material,d=u.pbrMetallicRoughness,p=t.style.fog,f="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:Re.a6.multiply([],r.zScaleMatrix,e.nodeModelMatrix),r=(Re.a6.multiply(f,r.negCameraPosMatrix,f),Re.a6.invert([],f)),m=(Re.a6.transpose(r,r),i.paint.get("model-emissive-strength").constantOr(0)),f=pn(new Float32Array(e.worldViewProjection),new Float32Array(f),new Float32Array(r),t,a,d.baseColorFactor,u.emissiveFactor,d.metallicFactor,d.roughnessFactor,u,m,i),a={defines:[]},r=[],d=(eo(a.defines,r,h,t),t.shadowRenderer);d&&(d.useNormalOffset=!1);let g=null;if(p){const Re=Qn(e.nodeModelMatrix,t.transform);if(g=new Float32Array(Re),"globe"!==c.projection.name){const e=h.aabb.min,t=h.aabb.max,[i,r]=p.getOpacityForBounds(Re,e[0],e[1],t[0],t[1]);a.overrideFog=.05<=i||.05<=r}}u=rr(t,i.paint.get("model-cutoff-fade-range")),u.shouldRenderCutoff&&a.defines.push("RENDER_CUTOFF"),m=t.getOrCreateProgram("model",a);t.uploadCommonUniforms(s,m,null,g,u),"shadow"!==t.renderPass&&d&&d.setupShadowsFromMatrix(e.nodeModelMatrix,m),m.draw(t,s.gl.TRIANGLES,l,n,o,h.material.doubleSided?Ne.disabled:Ne.backCCW,f,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,t.transform.zoom,void 0,r)}function io(e,t,i,r,n,o,a){var s="globe"===e.projection.name?Re.cS(i,e):[...i],l=(Re.a6.multiply(s,s,t.matrix),Re.a6.multiply([],r,s));if(t.meshes)for(const e of t.meshes)if("BLEND"!==e.material.alphaMode)a.push({mesh:e,depth:0,modelIndex:n,worldViewProjection:l,nodeModelMatrix:s});else{const t=Re.N.transformMat4([],e.centroid,l);0<t[2]&&o.push({mesh:e,depth:t[2],modelIndex:n,worldViewProjection:l,nodeModelMatrix:s})}if(t.children)for(const Re of t.children)io(e,Re,i,r,n,o,a)}function ro(e,t,i,r){var n,o,a=i.shadowRenderer;a&&(n=a.getShadowPassDepthMode(),o=a.getShadowPassColorMode(),a=a.calculateShadowPassMatrixFromMatrix(t),t=mn(a),i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,n,Be.disabled,o,Ne.backCCW,t,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,i.transform.zoom,void 0,void 0))}const S={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Re.bS([0,0,0],[Re.V,Re.V,0])};const no=[1,-1,1];class oo{}class ao{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,r){{const Re=this._storage.get(i.id);if(Re)return Re.lastUsedFrameIdx=t,Re.buf}var e=r.gl,n=e.getBufferParameter(e.ELEMENT_ARRAY_BUFFER,e.BUFFER_SIZE),o=new ArrayBuffer(n),a=new Int16Array(o),s=(e.getBufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o)),new Re.cW);for(let e=0;e<n/2;e+=3){const t=a[e],i=a[e+1],r=a[e+2];s.emplaceBack(t,i),s.emplaceBack(i,r),s.emplaceBack(r,t)}e=r.bindVertexArrayOES.current,o=new oo;return o.buf=new d(r,s),o.lastUsedFrameIdx=t,this._storage.set(i.id,o),r.bindVertexArrayOES.set(e),o.buf}update(e){for(var[t,i]of this._storage)30<e-i.lastUsedFrameIdx&&(i.buf.destroy(),this._storage.delete(t))}destroy(){for(var[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class so{registerParameter(e,t,i,r,n){}registerButton(e,t,i){}}const lo={symbol:function(e,t,i,r,n){if("translucent"===e.renderPass){var o=Be.disabled,a=e.colorModeForRenderPass();if(i.layout.get("text-variable-anchor")){var s=r;var l=e;var c=i;var h=t;var u=i.layout.get("text-rotation-alignment");var d=i.layout.get("text-pitch-alignment");var p=n;var f=l.transform,m="map"===u,g="map"===d;for(const l of s){const s=h.getTile(l),u=s.getBucket(c);if(u&&u.text&&u.text.segments.get().length){const d=Re.b5(u.textSizeData,f.zoom),_=bi(l,u.getProjection(),f),y=f.calculatePixelsToTileUnitsMatrix(s),v=ai(_,s.tileID.canonical,g,m,f,u.getProjection(),y),x=u.hasIconTextFit()&&u.hasIconData();if(d){const c=Math.pow(2,f.zoom-s.tileID.overscaledZ);bn(u,m,g,p,Re.cx,f,v,l,c,d,x)}}}}n=0!==i.paint.get("icon-opacity").constantOr(1),l=0!==i.paint.get("text-opacity").constantOr(1);void 0!==i.layout.get("symbol-sort-key").constantOr(1)&&(n||l)?wn(e,t,i,r,o,a):(n&&wn(e,t,i,r,o,a,{onlyIcons:!0}),l&&wn(e,t,i,r,o,a,{onlyText:!0})),t.map.showCollisionBoxes&&(yn(e,t,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),yn(e,t,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(t,i,r,n){if("translucent"===t.renderPass){const e=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),s=void 0!==r.layout.get("circle-sort-key").constantOr(1),l=r.paint.get("circle-emissive-strength");if(0!==e.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1)){const c=t.context,h=c.gl,u=t.transform,d=t.depthModeForSublayer(0,Oe.ReadOnly),p=Be.disabled,f=t.colorModeForDrapableLayerRenderPass(l),m="globe"===u.projection.name,g=[Re.a5(u.center.lng),Re.ae(u.center.lat)],_=[];for(let e=0;e<n.length;e++){const o=n[e],a=i.getTile(o),l=a.getBucket(r);if(l&&l.projection.name===u.projection.name){const c=l.programConfigurations.get(r.id),h=Re.cy(r),d=t.isTileAffectedByFog(o),p=(m&&h.push("PROJECTION_GLOBE_VIEW"),t.getOrCreateProgram("circle",{config:c,defines:h,overrideFog:d})),f=l.layoutVertexBuffer,y=l.globeExtVertexBuffer,v=l.indexBuffer,x=u.projection.createInversionMatrix(u,o.canonical),b={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:y,indexBuffer:v,uniformValues:Re.cz(t,o,a,x,g,r),tile:a};if(s){const t=l.segments.get();for(const i of t)_.push({segments:new Re.aB([i]),sortKey:i.sortKey,state:b})}else _.push({segments:l.segments,sortKey:0,state:b})}}s&&_.sort((e,t)=>e.sortKey-t.sortKey);const y={useDepthForOcclusion:u.depthOcclusionForSymbolsAndCircles};for(const Re of _){const{programConfiguration:i,program:n,layoutVertexBuffer:e,globeExtVertexBuffer:o,indexBuffer:a,uniformValues:s,tile:l}=Re.state,m=Re.segments;t.terrain&&t.terrain.setupElevationDraw(l,n,y),t.uploadCommonUniforms(c,n,l.tileID.toUnwrapped()),n.draw(t,h.TRIANGLES,d,p,f,Ne.disabled,s,r.id,e,a,m,r.paint,u.zoom,i,[o])}}}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var o=t.context,a=o.gl,s=Be.disabled,l=new Fe([a.ONE,a.ONE,a.ONE,a.ONE],Re.ax.transparent,[!0,!0,!0,!0]);{var c=o;var h=t;var u=r;var d="globe"===t.transform.projection.name?.5:.25;var p=c.gl,f=h.width*d,d=h.height*d;c.activeTexture.set(p.TEXTURE1),c.viewport.set([0,0,f,d]);let e=u.heatmapFbo;if(!e||e&&(e.width!==f||e.height!==d)){e&&e.destroy();const h=p.createTexture();p.bindTexture(p.TEXTURE_2D,h),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),e=u.heatmapFbo=c.createFramebuffer(f,d,!0,null),u=h,M=e,(C=c.gl).texImage2D(C.TEXTURE_2D,0,c.extRenderToTextureHalfFloat?C.RGBA16F:C.RGBA,f,d,0,C.RGBA,c.extRenderToTextureHalfFloat?C.HALF_FLOAT:C.UNSIGNED_BYTE,null),M.colorAttachment.set(u)}else p.bindTexture(p.TEXTURE_2D,e.colorAttachment.get()),c.bindFramebuffer.set(e.framebuffer)}o.clear({color:Re.ax.transparent});var m=t.transform,g="globe"===m.projection.name,_=g?["PROJECTION_GLOBE_VIEW"]:[],y=g?Ne.frontCCW:Ne.disabled,v=[Re.a5(m.center.lng),Re.ae(m.center.lat)];for(let e=0;e<n.length;e++){var x,b,w,T,S,A,E=n[e];i.hasRenderableParent(E)||(b=(x=i.getTile(E)).getBucket(r))&&b.projection.name===m.projection.name&&(T=t.isTileAffectedByFog(E),w=b.programConfigurations.get(r.id),T=t.getOrCreateProgram("heatmap",{config:w,defines:_,overrideFog:T}),S=t.transform["zoom"],t.terrain&&t.terrain.setupElevationDraw(x,T),t.uploadCommonUniforms(o,T,E.toUnwrapped()),A=m.projection.createInversionMatrix(m,E.canonical),T.draw(t,a.TRIANGLES,Oe.disabled,s,l,y,((e,t,i,r,n,o,a)=>{var s=e.transform,e="globe"===s.projection.name,i=e?Re.cp(s.zoom,t.canonical)*s._pixelsPerMercatorPixel:Re.a3(i,1,o),o={u_matrix:t.projMatrix,u_extrude_scale:i,u_intensity:a,u_inv_rot_matrix:an,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(e){o.u_inv_rot_matrix=r,o.u_merc_center=n,o.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],o.u_zoom_transition=Re.S(s.zoom);const e=n[0]*Re.V,i=n[1]*Re.V;o.u_up_dir=s.projection.upVector(new Re.bs(0,0,0),e,i)}return o})(t,E,x,A,v,S,r.paint.get("heatmap-intensity")),r.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,r.paint,t.transform.zoom,w,g?[b.globeExtVertexBuffer]:null))}o.viewport.set([0,0,t.width,t.height])}else if("translucent"===t.renderPass){t.context.setColorMode(t.colorModeForRenderPass());{h=t;f=r;var d=h.context,C=d.gl,M=f.heatmapFbo;if(M){d.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),d.activeTexture.set(C.TEXTURE1);let e=f.colorRampTexture;(e=e||(f.colorRampTexture=new Re.T(d,f.colorRamp,C.RGBA))).bind(C.LINEAR,C.CLAMP_TO_EDGE),h.getOrCreateProgram("heatmapTexture").draw(h,C.TRIANGLES,Oe.disabled,Be.disabled,h.colorModeForRenderPass(),Ne.disabled,{u_image:0,u_color_ramp:1,u_opacity:f.paint.get("heatmap-opacity")},f.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments,f.paint,h.transform.zoom)}return}}else return void 0},line:function(r,n,o,a){if("translucent"===r.renderPass){const c=o.paint.get("line-opacity"),h=o.paint.get("line-width");if(0!==c.constantOr(1)&&0!==h.constantOr(1)){const u=o.paint.get("line-emissive-strength"),d=r.depthModeForSublayer(0,Oe.ReadOnly),p=r.colorModeForDrapableLayerRenderPass(u),f=r.terrain&&r.terrain.renderingToTexture?1:Re.f.devicePixelRatio,m=o.paint.get("line-dasharray"),g=m.constantOr(1),_=o.layout.get("line-cap"),y=o.paint.get("line-pattern"),v=y.constantOr(1),x=o.paint.get("line-pattern").constantOr(1),b=1!==o.paint.get("line-opacity").constantOr(1);let i=!x&&b;const w=o.paint.get("line-gradient"),T=v?"linePattern":"line",S=r.context,A=S.gl,E=Re.cA(o);r.terrain&&r.terrain.clipOrMaskOverlapStencilType()&&(i=!1);for(const c of a){const a=n.getTile(c);if(!v||a.patternsLoaded()){const h=a.getBucket(o);if(h){r.prepareDrawTile();const u=h.programConfigurations.get(o.id),x=r.isTileAffectedByFog(c),b=r.getOrCreateProgram(T,{config:u,defines:E,overrideFog:x}),C=y.constantOr(null);if(C&&a.imageAtlas){const Re=a.imageAtlas.patternPositions[C.toString()];Re&&u.setConstantPatternPositions(Re)}var s=m.constantOr(null),l=_.constantOr(null);if(!v&&s&&l&&a.lineAtlas){const Re=a.lineAtlas.getDash(s,l);Re&&u.setConstantPatternPositions(Re)}let[e,t]=o.paint.get("line-trim-offset");if("round"===l||"square"===l){const Re=1;e!==t&&(0===e&&--e,1===t)&&(t+=1)}const M=r.terrain?c.projMatrix:null,I=v?Re.cB(r,a,o,M,f,[e,t]):Re.cC(r,a,o,M,h.lineClipsArray.length,f,[e,t]);if(w){const a=h.gradients[o.id];let t=a.texture;if(o.gradientVersion!==a.version){let e=256;if(o.stepInterpolant){const o=n.getSource().maxzoom,a=c.canonical.z===o?Math.ceil(1<<r.transform.maxZoom-c.canonical.z):1;e=Re.aa(Re.cD(h.maxLineLength/Re.V*1024*a),256,S.maxTextureSize)}a.gradient=Re.cE({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:e,image:a.gradient||void 0,clips:h.lineClipsArray}),a.texture?a.texture.update(a.gradient):a.texture=new Re.T(S,a.gradient,A.RGBA),a.version=o.gradientVersion,t=a.texture}S.activeTexture.set(A.TEXTURE1),t.bind(o.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}g&&(S.activeTexture.set(A.TEXTURE0),a.lineAtlasTexture&&a.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),u.updatePaintBuffers()),v&&(S.activeTexture.set(A.TEXTURE0),a.imageAtlasTexture&&a.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),u.updatePaintBuffers()),r.uploadCommonUniforms(S,b,c.toUnwrapped());s=e=>{b.draw(r,A.TRIANGLES,d,e,p,Ne.disabled,I,o.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,o.paint,r.transform.zoom,u,[h.layoutVertexBuffer2])};if(i){const Re=r.stencilModeForClipping(c).ref,n=(0===Re&&r.terrain&&S.clear({stencil:0}),{func:A.EQUAL,mask:255});I.u_alpha_discard_threshold=.8,s(new Be(n,Re,255,A.KEEP,A.KEEP,A.INVERT)),I.u_alpha_discard_threshold=0,s(new Be(n,Re,255,A.KEEP,A.KEEP,A.KEEP))}else s(r.stencilModeForClipping(c))}}}i&&(r.resetStencilClippingMasks(),r.terrain)&&S.clear({stencil:0})}}},fill:function(e,t,i,r){var n=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var a=i.paint.get("fill-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(a),s=i.paint.get("fill-pattern"),s=e.opaquePassEnabledForLayer()&&!s.constantOr(1)&&1===n.constantOr(Re.ax.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===s){const Re=e.depthModeForSublayer(1,"opaque"===e.renderPass?Oe.ReadWrite:Oe.ReadOnly);Sn(e,t,i,r,Re,a,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){const Re=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Oe.ReadOnly);Sn(e,t,i,r,Re,a,!0)}}},"fill-extrusion":function(a,s,l,c){const h=l.paint.get("fill-extrusion-opacity"),t=a.context,u=t.gl,i=a.terrain,r=i&&i.renderingToTexture;if(0!==h){const f=a.conflationActive&&a.layerUsedInConflation(l,s.getSource());if(f){var e=a;var n=s;var o=l;var d=c;for(const m of d){const d=n.getTile(m).getBucket(o);d&&(d.updateReplacement(m,e.replacementSource),d.uploadCentroid(e.context))}}if(i||f)for(const Re of c){const c=s.getTile(Re).getBucket(l);c&&Cn(a.context,s,Re,c,l,i,f)}if("shadow"===a.renderPass&&a.shadowRenderer){const t=a.shadowRenderer;if(!(i&&h<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Re.Z)){const u=t.getShadowPassDepthMode(),r=t.getShadowPassColorMode();An(a,s,l,c,u,Be.disabled,r,f)}}else if("translucent"===a.renderPass){var d=!l.paint.get("fill-extrusion-pattern").constantOr(1),p=l.paint.get("fill-extrusion-color").constantOr(Re.ax.white);if(!r&&0!==p.a){const Re=new Oe(a.context.gl.LEQUAL,Oe.ReadWrite,a.depthRangeFor3D);1===h&&d?An(a,s,l,c,Re,Be.disabled,Fe.unblended,f):(An(a,s,l,c,Re,Be.disabled,Fe.disabled,f),An(a,s,l,c,Re,a.stencilModeFor3D(),a.colorModeForRenderPass(),f),a.resetStencilClippingMasks())}if(a.style.enable3dLights()&&d&&(!i&&"globe"!==a.transform.projection.name||r)){const h=l.paint.get("fill-extrusion-opacity"),g=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),_=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),y=l.paint.get("fill-extrusion-flood-light-intensity"),v=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),x=0<g&&0<_,b=0<y,w=(e,t,i)=>(1-i)*e+i*t,T=e=>{const t=a.depthModeForSublayer(1,Oe.ReadOnly,u.LEQUAL,!0),i=l.paint.get(e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),r=w(.1,3,i),n=a._showOverdrawInspector;if(!n){const i=new Be({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),n=new Fe([u.ONE,u.ONE,u.ONE,u.ONE],Re.ax.transparent,[!1,!1,!1,!0],u.MIN);En(a,s,l,c,t,i,n,Ne.disabled,e,"sdf",h,g,_,y,v,r,f,!1)}{const i=n?Be.disabled:new Be({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),w=n?a.colorModeForRenderPass():new Fe([u.ONE_MINUS_DST_ALPHA,u.DST_ALPHA,u.ONE,u.ONE],Re.ax.transparent,[!0,!0,!0,!0]);En(a,s,l,c,t,i,w,Ne.disabled,e,"color",h,g,_,y,v,r,f,!1)}};if(r){const r=(e,t,i)=>{const r=a.depthModeForSublayer(1,Oe.ReadOnly,u.LEQUAL,!1),n=l.paint.get(e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),o=w(.1,3,n);{const i=new Fe([u.ONE,u.ONE,u.ONE,u.ONE],Re.ax.transparent,[!1,!1,!1,!0]);En(a,s,l,c,r,Be.disabled,i,Ne.disabled,e,"clear",h,g,_,y,v,o,f,t)}{const i=new Be({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),n=new Fe([u.ONE,u.ONE,u.ONE,u.ONE],Re.ax.transparent,[!1,!1,!1,!0],u.MIN);En(a,s,l,c,r,i,n,Ne.disabled,e,"sdf",h,g,_,y,v,o,f,t)}{const i=e?u.ZERO:u.ONE_MINUS_DST_ALPHA,n=new Be({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),w=new Fe([i,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.ZERO],Re.ax.transparent,[!0,!0,!0,!0]);En(a,s,l,c,r,n,w,Ne.disabled,e,"color",h,g,_,y,v,o,f,t)}{const n=new Fe([u.ONE,u.ONE,u.ONE,e?u.ZERO:u.ONE],Re.ax.transparent,[!1,!1,!1,!0],e?u.FUNC_ADD:u.MAX);En(a,s,l,c,r,Be.disabled,n,Ne.disabled,e,"clear",h,g,_,y,v,o,f,t,i)}};if(x||b){let e;if(a.prepareDrawTile(),i){const a=i.drapeBufferSize[0],l=i.drapeBufferSize[1];(e=i.framebufferCopyTexture)&&(!e||e.size[0]===a&&e.size[1]===l)||(e&&e.destroy(),e=i.framebufferCopyTexture=new Re.T(t,new Re.h({width:a,height:l}),u.RGBA)),e.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,a,l,0)}x&&r(!0,!1,e),b&&r(!1,!0,e)}}else x&&T(!0),b&&T(!1)}}}},hillshade:function(e,t,i,r){if(("offscreen"===e.renderPass||"translucent"===e.renderPass)&&!e.style.disableElevatedTerrain){const p=e.context,f=e.terrain&&e.terrain.renderingToTexture,[m,g]="translucent"!==e.renderPass||f?[{},r]:e.stencilConfigForOverlap(r);for(const r of g){const p=t.getTile(r);if(p.needsHillshadePrepare&&"offscreen"===e.renderPass){n=void 0;o=void 0;a=void 0;h=void 0;s=void 0;l=void 0;c=void 0;u=void 0;d=void 0;var n=e;var o=p;var a=i;var s=(h=n.context).gl;if(o.dem){var l=o.dem;if(h.activeTexture.set(s.TEXTURE1),Rr(n,o,l),o.demTexture){o.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);var c=l.dim;h.activeTexture.set(s.TEXTURE0);let e=o.hillshadeFBO;if(!e){const n=new Re.T(h,{width:c,height:c,data:null},s.RGBA);n.bind(s.LINEAR,s.CLAMP_TO_EDGE),(e=o.hillshadeFBO=h.createFramebuffer(c,c,!0,"renderbuffer")).colorAttachment.set(n.texture)}h.bindFramebuffer.set(e.framebuffer),h.viewport.set([0,0,c,c]);var{tileBoundsBuffer:h,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=n.getMercatorTileBoundsBuffers(),d=[];n.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),n.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(n,s.TRIANGLES,Oe.disabled,Be.disabled,Fe.unblended,Ne.disabled,(d=o.tileID,n=l.stride,s=Re.a6.create(),Re.a6.ortho(s,0,Re.V,-Re.V,0,0,1),Re.a6.translate(s,s,[0,-Re.V,0]),{u_matrix:s,u_image:1,u_dimension:[n,n],u_zoom:d.overscaledZ}),a.id,h,c,u),o.needsHillshadePrepare=!1}}}else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Oe.ReadOnly),g=i.paint.get("hillshade-emissive-strength"),_=e.colorModeForDrapableLayerRenderPass(g),y=f&&e.terrain?e.terrain.stencilModeForRTTOverlap(r):m[r.overscaledZ];zr(e,r,p,i,t,y,_)}}p.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()}},raster:function(M,I,P,e,t,L){if("translucent"===M.renderPass&&0!==P.paint.get("raster-opacity")){const D="globe"===M.transform.projection.name,k=0!==P.paint.get("raster-elevation"),z=k&&D;if(!M.renderElevatedRasterBackface||z){const R=M.context,O=R.gl,B=I.getSource(),F=function(e,t,i,r){var n=t.paint.get("raster-color"),o="raster-array"===e.type,a=[],s=t.paint.get("raster-resampling"),l=t.paint.get("raster-color-mix");let c=t.paint.get("raster-color-range");var h=[l[0],l[1],l[2],0],l=l[3];let u="nearest"===s?r.NEAREST:r.LINEAR;if(o&&(a.push("RASTER_ARRAY"),n||a.push("RASTER_COLOR"),"linear"===s&&a.push("RASTER_ARRAY_LINEAR"),u=r.NEAREST,!c)&&e.rasterLayers){const Re=e.rasterLayers.find(({id:e})=>e===t.sourceLayer);Re&&Re.fields&&Re.fields.range&&(c=Re.fields.range)}if(c=c||[0,1],n){a.push("RASTER_COLOR"),i.activeTexture.set(r.TEXTURE2),t.updateColorRamp(c);let e=t.colorRampTexture;(e=e||(t.colorRampTexture=new Re.T(i,t.colorRamp,r.RGBA))).bind(r.LINEAR,r.CLAMP_TO_EDGE)}return{mix:h,range:c,offset:l,defines:a,resampling:u}}(B,P,R,O);if(!(B instanceof Re.ap)||e.length||D){const N=P.paint.get("raster-emissive-strength"),U=M.colorModeForDrapableLayerRenderPass(N),j=M.terrain&&M.terrain.renderingToTexture,V=!M.options.moving,G="nearest"===P.paint.get("raster-resampling")?O.NEAREST:O.LINEAR;if(B instanceof Re.ap&&!e.length&&(B.onNorthPole||B.onSouthPole)){const Re=k?M.stencilModeFor3D():Be.disabled;void kn(!!B.onNorthPole,null,M,I,P,N,F,Ne.disabled,Re)}else if(e.length){const[q,i]=B instanceof Re.ap||j?[{},e]:M.stencilConfigForOverlap(e),W=i[i.length-1].overscaledZ;z&&F.defines.push("PROJECTION_GLOBE_VIEW"),k&&F.defines.push("RENDER_CUTOFF");e=(u,d,p)=>{for(const E of u){const u=E.toUnwrapped(),C=I.getTile(E);if(!j||C&&C.hasData()){R.activeTexture.set(O.TEXTURE0);var f=function(e,t,i,r){if(e)return t instanceof Xe&&e instanceof Wt?t.getTextureDescriptor(e,i,!0):{texture:e.texture,mix:Dn(r.mix),offset:r.offset,buffer:0,tileSize:1}}(C,B,P,F);if(f&&f.texture){var{texture:f,mix:m,offset:g,tileSize:_,buffer:y}=f;let e,t;t=j?(e=Oe.disabled,E.projMatrix):k?(e=new Oe(O.LEQUAL,Oe.ReadWrite,M.depthRangeFor3D),D?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(u,V)):(e=M.depthModeForSublayer(E.overscaledZ-W,1===P.paint.get("raster-opacity")?Oe.ReadWrite:Oe.ReadOnly,O.LESS),M.transform.calculateProjMatrix(u,V));var v=M.terrain&&j?M.terrain.stencilModeForRTTOverlap(E):q[E.overscaledZ],x=L?0:P.paint.get("raster-fade-duration"),b=(C.registerFadeDuration(x),I.findLoadedParent(E,0)),x=qr(C,b,I,M.transform,x);let i,r;M.terrain&&M.terrain.prepareDrawTile(),R.activeTexture.set(O.TEXTURE0),f.bind(G,O.CLAMP_TO_EDGE),R.activeTexture.set(O.TEXTURE1),b?(b.texture&&b.texture.bind(G,O.CLAMP_TO_EDGE),i=Math.pow(2,b.tileID.overscaledZ-C.tileID.overscaledZ),r=[C.tileID.canonical.x*i%1,C.tileID.canonical.y*i%1]):f.bind(G,O.CLAMP_TO_EDGE),f.useMipmap&&R.extTextureFilterAnisotropic&&20<M.transform.pitch&&O.texParameterf(O.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);b=M.transform;let n;T=k?(A=S=T=f=void 0,f=(w=b)._nearZ,T=w.projection.farthestPixelDistance(w),S=T-f,w=.2*w.height,[f,T,((A=f+w)-w-f)/S,(A-f)/S]):[0,0,0,0];let o,a,s,l,c,h=0;if(z&&B instanceof Re.ap&&3<B.coordinates.length)o=Float32Array.from(Re.aT(Re.ci(new Re.bs(0,0,0)))),a=Float32Array.from(b.globeMatrix),s=Float32Array.from(Re.ce(b)),l=[Re.a5(b.center.lng),Re.ae(b.center.lat)],n=B.elevatedGlobePerspectiveTransform,c=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const M=Re.cf(E.canonical);h=Re.cg(M.getCenter().lat),o=Float32Array.from(Re.aT(Re.ci(E.canonical))),a=Float32Array.from(b.globeMatrix),s=Float32Array.from(Re.ce(b)),l=[Re.a5(b.center.lng),Re.ae(b.center.lat)],n=[0,0],c=Float32Array.from(Re.ch(E.canonical,M,h,b.worldSize/b._pixelsPerMercatorPixel))}else n=B instanceof Re.ap?B.perspectiveTransform:[0,0],o=new Float32Array(16),a=new Float32Array(9),s=new Float32Array(16),l=[0,0],c=new Float32Array(9);w=cn(t,o,a,s,c,r||[0,0],Re.S(M.transform.zoom),l,T,i||1,x,P,n,k?P.paint.get("raster-elevation"):0,2,m,g,F.range,_,y,N),A=M.isTileAffectedByFog(E),f=M.getOrCreateProgram("raster",{defines:F.defines,overrideFog:A});if(M.uploadCommonUniforms(R,f,u),B instanceof Re.ap){const I=B.elevatedGlobeVertexBuffer,u=B.elevatedGlobeIndexBuffer;if(j||!D)B.boundsBuffer&&B.boundsSegments&&f.draw(M,O.TRIANGLES,e,Be.disabled,U,Ne.disabled,w,P.id,B.boundsBuffer,M.quadTriangleIndexBuffer,B.boundsSegments);else if(I&&u){const L=b.zoom<=Re.bG?B.elevatedGlobeSegments:B.getSegmentsForLongitude(b.center.lng);L&&f.draw(M,O.TRIANGLES,e,Be.disabled,U,d,w,P.id,I,u,L)}}else if(z){e=new Oe(O.LEQUAL,Oe.ReadOnly,M.depthRangeFor3D);const Re=M.globeSharedBuffers;if(Re){const[I,u,L]=Re.getGridBuffers(h,!1);f.draw(M,O.TRIANGLES,e,p||v,M.colorModeForRenderPass(),d,w,P.id,I,u,L)}}else{const{tileBoundsBuffer:Re,tileBoundsIndexBuffer:I,tileBoundsSegments:u}=M.getTileBoundsBuffers(C);f.draw(M,O.TRIANGLES,e,v,U,Ne.disabled,w,P.id,Re,I,u)}}}}var w,T,S,A;if(!(B instanceof Re.ap)&&z)for(const Re of u){const u=Re.canonical.y===(1<<Re.canonical.z)-1;0===Re.canonical.y&&kn(!0,Re,M,I,P,N,F,d,p||Be.disabled),u&&kn(!1,Re,M,I,P,N,F,d===Ne.frontCW?Ne.backCW:Ne.frontCW,p||Be.disabled)}};z?e(i,M.renderElevatedRasterBackface?Ne.backCW:Ne.frontCW,M.stencilModeFor3D()):e(i,Ne.disabled,void 0),M.resetStencilClippingMasks()}}}}},"raster-particle":function(e,O,B,F,N,U){if("offscreen"===e.renderPass){var t=e,j=O,i=B,r=F;if(r.length){const E=t.context,C=E.gl,Ee=j.getSource();if(Ee instanceof Xe){var n=[];for(const Re of r){const t=j.getTile(Re);if(t instanceof Wt){const r=zn(t,Ee,i);if(r){const C=[r.tileSize,r.tileSize];i.tileFramebuffer||(i.tileFramebuffer=E.createFramebuffer(C[0],C[1],!0,null));let e=t.rasterParticleState;var o=i.paint.get("raster-particle-count"),V=(e=e||(t.rasterParticleState=new Nt(E,Re,C,o))).update(i.lastInvalidatedAt),o=(e.numParticles!==o&&e.setNumParticles(Re,o),e.targetColorTexture),o=(e.targetColorTexture=e.backgroundColorTexture,e.backgroundColorTexture=o,e.particleVertices0);e.particleVertices0=e.particleVertices1,e.particleVertices1=o,n.push([Re,r,e,V])}}}if(0!==n.length){var a,G,q,W,H,Z,$,r=Re.f.now(),X=i.previousDrawTimestamp?.001*(r-i.previousDrawTimestamp):.0167;if(i.previousDrawTimestamp=r,i.hasColorMap()){E.activeTexture.set(C.TEXTURE0+2);let e=i.colorRampTexture;(e=e||(i.colorRampTexture=new Re.T(E,i.colorRamp,C.RGBA))).bind(C.LINEAR,C.CLAMP_TO_EDGE)}E.bindFramebuffer.set(i.tileFramebuffer.framebuffer),E.activeTexture.set(C.TEXTURE0);var s,l=t,Y=i,c=n,h=l.context,u=h.gl,K=Y.tileFramebuffer,J=(h.activeTexture.set(u.TEXTURE0),{u_texture:0,u_opacity:1.05*(s=Y.paint.get("raster-particle-fade-opacity-factor"))/(s+.05)}),Q=l.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});for(const s of c){const[,,c,Ce]=s;K.colorAttachment.set(c.targetColorTexture.texture),h.viewport.set([0,0,K.width,K.height]),h.clear({color:Re.ax.transparent}),Ce&&(c.backgroundColorTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),Q.draw(l,u.TRIANGLES,Oe.disabled,Be.disabled,Fe.alphaBlended,Ne.disabled,J,Y.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments))}{var ee=t,te=j,ie=i,d=n;const Me=ee.context.gl,M=ie.tileFramebuffer,Ie="globe"===ee.transform.projection.name,Pe=ie.paint.get("raster-particle-max-speed");for(const Le of d){const[d,I,De]=Le;I.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),M.colorAttachment.set(De.targetColorTexture.texture);var re,ne=ee.getOrCreateProgram("rasterParticleDraw",{defines:I.defines,overrideFog:!1}),oe=I.scalarData?[]:[0,1,2,3].map(e=>Re.cG[e](d)),ae=(oe.push(d),d.canonical.x),se=d.canonical.y;for(const Re of oe){const M=te.getTile(Ie?Re.wrapped():Re);M&&(re=M.rasterParticleState)&&(a=[Re.canonical.x+(1<<Re.canonical.z)*(Re.wrap-d.wrap)-ae,Re.canonical.y-se],G=0,q=I.texture.size,W=2,H=I.textureOffset,Z=I.scale,$=I.offset,a={u_tile_offset:a,u_velocity:G,u_color_ramp:W,u_velocity_res:q,u_max_speed:Pe,u_texture_offset:H,u_data_scale:Z,u_data_offset:$},ne.draw(ee,Me.POINTS,Oe.disabled,Be.disabled,Fe.alphaBlended,Ne.disabled,a,ie.id,re.particleVertices0,void 0,re.particleSegment))}}}{var le=t,p=i,f=n,ce=X,m=le.context.gl;let e=p.transformFeedbackObject;e=e||(p.transformFeedbackObject=m.createTransformFeedback()),m.bindTransformFeedback(m.TRANSFORM_FEEDBACK,p.transformFeedbackObject);var he,ue,de,pe,fe,me,ge=p.paint.get("raster-particle-max-speed"),_e=ce*p.paint.get("raster-particle-speed-factor")*.3,ye=(he=p.paint.get("raster-particle-reset-rate-factor"),Math.pow(he,6));for(const ce of f){const[,f,e]=ce,he=(f.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),ue=0,de=f.texture.size,pe=f.textureOffset,fe=f.scale,me=f.offset,{u_velocity:ue,u_velocity_res:de,u_max_speed:ge,u_speed_factor:_e,u_lifetime_delta:ye,u_rand_seed:Math.random(),u_texture_offset:pe,u_data_scale:fe,u_data_offset:me});le.getOrCreateProgram("rasterParticleUpdate",{defines:f.defines,transformFeedback:{bufferMode:m.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(le,m.POINTS,Oe.disabled,Be.disabled,Fe.disabled,Ne.disabled,he,p.id,e.particleVertices0,void 0,e.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:e.particleVertices1,targetIndex:0}])}m.bindTransformFeedback(m.TRANSFORM_FEEDBACK,null)}}}}}if("translucent"===e.renderPass){{var ve,xe,be,we,Te,g,_,y,v,x,b=e,w=O,Se=B,T=F;const P=b.context,L=P.gl,D=!b.options.moving,k="globe"===b.transform.projection.name;if(T.length){const[ke,z]=b.stencilConfigForOverlap(T),ze=[];k&&ze.push("PROJECTION_GLOBE_VIEW");for(const T of z){const R=T.toUnwrapped(),z=w.getTile(T);if(z.rasterParticleState){var S=z.rasterParticleState,A=(z.registerFadeDuration(100),w.findLoadedParent(T,0)),Ae=qr(z,A,w,b.transform,100);let e,t;b.terrain&&b.terrain.prepareDrawTile(),P.activeTexture.set(L.TEXTURE0),S.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),P.activeTexture.set(L.TEXTURE1),A&&A.rasterParticleState?(A.rasterParticleState.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),e=Math.pow(2,A.tileID.overscaledZ-z.tileID.overscaledZ),t=[z.tileID.canonical.x*e%1,z.tileID.canonical.y*e%1]):S.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);A=k?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(R,D),S=b.transform,y=(x=v=y=_=void 0,_=(g=S)._nearZ,y=g.projection.farthestPixelDistance(g),v=y-_,g=.2*g.height,[_,y,((x=_+g)-g-_)/v,(x-_)/v]),g=Re.cf(T.canonical),x=Re.cg(g.getCenter().lat);let i,r,n,o,a;a=k?(i=Float32Array.from(Re.aT(Re.ci(T.canonical))),r=Float32Array.from(S.globeMatrix),n=Float32Array.from(Re.ce(S)),o=[Re.a5(S.center.lng),Re.ae(S.center.lat)],Float32Array.from(Re.ch(T.canonical,g,x,S.worldSize/S._pixelsPerMercatorPixel))):(i=new Float32Array(16),r=new Float32Array(9),n=new Float32Array(16),o=[0,0],new Float32Array(9));_=A,v=i,g=r,S=n,A=a,ve=t||[0,0],xe=Re.S(b.transform.zoom),be=o,we=e||1,Te=250;_={u_matrix:_,u_normalize_matrix:v,u_globe_matrix:g,u_merc_matrix:S,u_grid_matrix:A,u_tl_parent:ve,u_scale_parent:we,u_fade_t:Ae.mix,u_opacity:Ae.opacity,u_image0:0,u_image1:1,u_raster_elevation:Te,u_zoom_transition:xe,u_merc_center:be,u_cutoff_params:y},v=b.isTileAffectedByFog(T),g=b.getOrCreateProgram("rasterParticle",{defines:ze,overrideFog:v});if(b.uploadCommonUniforms(P,g,R),k){const Re=new Oe(L.LEQUAL,Oe.ReadWrite,b.depthRangeFor3D),w=0,T=b.globeSharedBuffers;if(T){const[R,P,D]=T.getGridBuffers(x,!1);g.draw(b,L.TRIANGLES,Re,Be.disabled,Fe.alphaBlended,Ne.backCCW,_,Se.id,R,P,D)}}else{const Re=b.depthModeForSublayer(0,Oe.ReadOnly),w=ke[T.overscaledZ],{tileBoundsBuffer:R,tileBoundsIndexBuffer:P,tileBoundsSegments:D}=b.getTileBoundsBuffers(z);g.draw(b,L.TRIANGLES,Re,w,Fe.alphaBlended,Ne.disabled,_,Se.id,R,P,D)}}}b.resetStencilClippingMasks()}}e.style.map.triggerRepaint()}},background:function(i,r,n,o){var a=n.paint.get("background-color"),s=n.paint.get("background-opacity"),l=n.paint.get("background-emissive-strength");if(0!==s){var c=i.context,h=c.gl,u=i.transform,d=u.tileSize,p=n.paint.get("background-pattern");if(!i.isPatternMissing(p,n.scope)){const S=!p&&1===a.a&&1===s&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===S){var f,m=Be.disabled,g=i.depthModeForSublayer(0,"opaque"===S?Oe.ReadWrite:Oe.ReadOnly),_=i.colorModeForDrapableLayerRenderPass(l),y=p?"backgroundPattern":"background";let t,e=o;e||(t=i.getBackgroundTiles(),e=Object.values(t).map(e=>e.tileID)),p&&(c.activeTexture.set(h.TEXTURE0),i.imageManager.bind(i.context,n.scope));for(const S of e){const e=i.isTileAffectedByFog(S),A=i.getOrCreateProgram(y,{overrideFog:e}),E=S.toUnwrapped(),C=o?S.projMatrix:i.transform.calculateProjMatrix(E);i.prepareDrawTile();var v=r?r.getTile(S):t?t[S.key]:new M(S,d,u.zoom,i),x=p?(w=C,T=l,f=s,x=n.scope,b={tileID:S,tileSize:d},Re.e(function(e,t,i,r){var e=i.imageManager.getPattern(e.toString(),t),{width:t,height:n}=i.imageManager.getPixelSize(t),o=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,i.transform.tileZoom)/o,o=a*(r.tileID.canonical.x+r.tileID.wrap*o),a=a*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:e.tl,u_pattern_br:e.br,u_texsize:[t,n],u_pattern_size:e.displaySize,u_tile_units_to_pixels:1/Re.a3(r,1,i.transform.tileZoom),u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a]}}(p,x,i,b),{u_matrix:w,u_emissive_strength:T,u_opacity:f})):{u_matrix:C,u_emissive_strength:l,u_opacity:s,u_color:a},{tileBoundsBuffer:b,tileBoundsIndexBuffer:w,tileBoundsSegments:T}=(i.uploadCommonUniforms(c,A,E),i.getTileBoundsBuffers(v));A.draw(i,h.TRIANGLES,g,m,_,Ne.disabled,x,n.id,b,w,T)}}}}},sky:function(t,e,i){var r=t._atmosphere?Re.S(t.transform.zoom):1,r=i.paint.get("sky-opacity")*r;if(0!=r){var n=t.context,o=i.paint.get("sky-type"),n=new Oe(n.gl.LEQUAL,Oe.ReadOnly,[0,1]),a=t.frameCounter/1e3%1;if("atmosphere"===o)if("offscreen"===t.renderPass){if(i.needsSkyboxCapture(t)){{var s=t;var l=i;var c=s.context,h=c.gl;let e=l.skyboxFbo;if(!e){e=l.skyboxFbo=c.createFramebuffer(32,32,!0,null),l.skyboxGeometry=new Hn(c),l.skyboxTexture=c.gl.createTexture(),h.bindTexture(h.TEXTURE_CUBE_MAP,l.skyboxTexture),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR);for(let e=0;e<6;++e)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,h.RGBA,32,32,0,h.RGBA,h.UNSIGNED_BYTE,null)}c.bindFramebuffer.set(e.framebuffer),c.viewport.set([0,0,32,32]);var u=l.getCenter(s,!0),d=s.getOrCreateProgram("skyboxCapture"),p=new Float64Array(16);Re.a6.identity(p),Re.a6.rotateY(p,p,.5*-Math.PI),Zn(s,l,d,p,u,0),Re.a6.identity(p),Re.a6.rotateY(p,p,.5*Math.PI),Zn(s,l,d,p,u,1),Re.a6.identity(p),Re.a6.rotateX(p,p,.5*-Math.PI),Zn(s,l,d,p,u,2),Re.a6.identity(p),Re.a6.rotateX(p,p,.5*Math.PI),Zn(s,l,d,p,u,3),Re.a6.identity(p),Zn(s,l,d,p,u,4),Re.a6.identity(p),Re.a6.rotateY(p,p,Math.PI),Zn(s,l,d,p,u,5),c.viewport.set([0,0,s.width,s.height])}i.markSkyboxValid(t)}}else"sky"===t.renderPass&&(l=i,d=n,p=r,u=a,s=(c=t).context,m=s.gl,g=c.transform,f=c.getOrCreateProgram("skybox"),s.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_CUBE_MAP,l.skyboxTexture),g={u_matrix:g.skyboxMatrix,u_sun_direction:l.getCenter(c,!1),u_cubemap:0,u_opacity:p,u_temporal_offset:u},c.uploadCommonUniforms(s,f),f.draw(c,m.TRIANGLES,d,Be.disabled,c.colorModeForRenderPass(),Ne.backCW,g,"skybox",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment));else if("gradient"===o&&"sky"===t.renderPass){var f=t;var m=i;var g=n;o=r;t=a;i=f.context,n=i.gl,r=f.transform,a=f.getOrCreateProgram("skyboxGradient");m.skyboxGeometry||(m.skyboxGeometry=new Hn(i)),i.activeTexture.set(n.TEXTURE0);let e=m.colorRampTexture;(e=e||(m.colorRampTexture=new Re.T(i,m.colorRamp,n.RGBA))).bind(n.LINEAR,n.CLAMP_TO_EDGE);r=r.skyboxMatrix,_=m.getCenter(f,!1),y=m.paint.get("sky-gradient-radius"),o=o,t=t;var _,y,r={u_matrix:r,u_color_ramp:0,u_center_direction:_,u_radius:Re.bj(y),u_opacity:o,u_temporal_offset:t};f.uploadCommonUniforms(i,a),a.draw(f,n.TRIANGLES,g,Be.disabled,f.colorModeForRenderPass(),Ne.backCW,r,"skyboxGradient",m.skyboxGeometry.vertexBuffer,m.skyboxGeometry.indexBuffer,m.skyboxGeometry.segment)}}},debug:function(t,i,r,n,o,a){for(let e=0;e<r.length;e++)if(o){const o=1,s=new Re.ax(.8*n.r,.8*n.g,.8*n.b,1);Un(t,i,r[e],n,-1,-1,a),Un(t,i,r[e],n,-1,1,a),Un(t,i,r[e],n,1,1,a),Un(t,i,r[e],n,1,-1,a),Un(t,i,r[e],s,0,0,a)}else Un(t,i,r[e],n,0,0,a)},custom:function(e,t,i,r){var n=e.context,o=i.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&i.isLayerDraped(t)){if("offscreen"===e.renderPass){const t=o.prerender;if(t){if(e.setCustomLayerDefaults(),n.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;t.call(o,n.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Re.S(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else t.call(o,n.gl,e.transform.customLayerMatrix());n.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass)if(e.terrain&&e.terrain.renderingToTexture){const t=o.renderToTile;if(t){const i=r[0].canonical,a=new Re.L(i.x+r[0].wrap*(1<<i.z),i.y,i.z);n.setDepthMode(Oe.disabled),n.setStencilMode(Be.disabled),n.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),t.call(o,n.gl,a),n.setDirty(),e.setBaseState()}}else{e.setCustomLayerDefaults(),n.setColorMode(e.colorModeForRenderPass()),n.setStencilMode(Be.disabled);const t="3d"===o.renderingMode?new Oe(e.context.gl.LEQUAL,Oe.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Oe.ReadOnly);if(n.setDepthMode(t),"globe"===e.transform.projection.name){const t=e.transform.pointMerc;o.render(n.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Re.S(e.transform.zoom),[t.x,t.y],e.transform.pixelsPerMeterRatio)}else o.render(n.gl,e.transform.customLayerMatrix());n.setDirty(),e.setBaseState(),n.bindFramebuffer.set(null)}}else Re.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,i,r,n){if("opaque"!==t.renderPass){const c=r.paint.get("model-opacity");if(0!==c){const h=r.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!h)return;if(t.terrain&&c<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof Re.Z)return}const u=t.shadowRenderer,d=r.paint.get("model-receive-shadows"),p=(u&&(u.useNormalOffset=!0,d||(u.enabled=!1)),()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))}),f=i.getSource();if("light-beam"!==t.renderPass||"batched-model"===f.type)if("vector"===f.type||"geojson"===f.type)(function(e,t,i,r){const n=e.transform;if("mercator"!==n.projection.name)return Re.w(`Drawing 3D models for ${n.projection.name} projection is not yet implemented`);var o=n.getFreeCameraOptions().position;if(e.modelManager){var a=e.modelManager,s=(i.modelManager=a,e.shadowRenderer);if(i._unevaluatedLayout._values.hasOwnProperty("model-id")){var l,c,h=i._unevaluatedLayout._values["model-id"],u={...i.layout.get("model-id").parameters};for(const _ of r){const r=t.getTile(_).getBucket(i);if(r&&r.projection.name===n.projection.name){var d=function(e,t){var i=1<<e.canonical.z,r=t.getFreeCameraOptions().position,n=t.elevation,o=e.canonical.x/i,a=(e.canonical.x+1)/i,s=e.canonical.y/i,i=(e.canonical.y+1)/i;let l=t._centerAltitude;if(n){const Re=n.getMinMaxForTile(e);Re&&Re.max>l&&(l=Re.max)}return n=Re.aa(r.x,o,a)-r.x,e=Re.aa(r.y,s,i)-r.y,o=Re.bl(l,t.center.lat)-r.z,t._zoomFromMercatorZ(Math.sqrt(n*n+e*e+o*o))}(_,n),p=(u.zoom=d,h.possiblyEvaluate(u));if(d=e,l=r,c=_,m=void 0,m=l.updateZoomBasedPaintProperties(),c=function(t,i,r){let n,o,a,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&0<s){const i=t.terrain,o=i.findDEMTileFor(r);o&&o.dem?n=Re.cU.create(i,r,o):s=0}if(0===s&&(i.terrainElevationMin=0,i.terrainElevationMax=0),s===i.validForExaggeration&&(0===s||n&&n._demTile&&n._demTile.tileID===i.validForDEMTile.id&&n._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const Re in i.instancesPerModel){const t=i.instancesPerModel[Re];for(let e=0;e<t.instancedDataArray.length;++e){const r=(n?s*n.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=r,o=o?Math.min(i.terrainElevationMin,r):r,a=a?Math.max(i.terrainElevationMax,r):r}}return i.terrainElevationMin=o||0,i.terrainElevationMax=a||0,i.validForExaggeration=s,i.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,l,c),(m||c)&&(l.uploaded=!1,l.upload(d.context)),S.shadowUniformsInitialized=!1,S.useSingleShadowCascade=!!s&&0===s.getMaxCascadeForTile(_.toUnwrapped()),"shadow"===e.renderPass&&s){if(1===e.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const t=n.calculatePosMatrix(_.toUnwrapped(),n.worldSize);if(S.tileMatrix.set(t),S.shadowTileMatrix=Float32Array.from(s.calculateShadowPassMatrixFromMatrix(t)),S.aabb.min.fill(0),S.aabb.max[0]=S.aabb.max[1]=Re.V,S.aabb.max[2]=0,function(t,i,e,r){if(!e.modelManager)return 1;var n=e.modelManager;if(!e.shadowRenderer)return 1;var o=e.shadowRenderer,a=i.aabb;let s=!0,l=t.maxHeight;if(0===l){let e=0;for(const i in t.instancesPerModel){const t=n.getModel(i,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):s=!1}l=t.maxScale*e*1.41+t.maxVerticalOffset,s&&(t.maxHeight=l)}return a.max[2]=l,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,Re.N.transformMat4(a.min,a.min,i.tileMatrix),Re.N.transformMat4(a.max,a.max,i.tileMatrix),i=a.intersects(o.getCurrentCascadeFrustum()),0===e.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===i),0===i}(r,S,e,i.scope))continue}var f,m=1<<_.canonical.z,g=[((o.x-_.wrap)*m-_.canonical.x)*Re.V,(o.y*m-_.canonical.y)*Re.V,o.z*m*Re.V];for(f in r.instancesPerModel){const t=r.instancesPerModel[f],n=(0<t.features.length&&(f=p.evaluate(t.features[0].feature,{})),a.getModel(f,i.scope));if(n&&n.uploaded)for(const Re of n.nodes)!function e(n,o,a,s,l,c,h){const u=n.context,d="shadow"===n.renderPass,p=n.shadowRenderer,f=d&&p?p.getShadowPassDepthMode():new Oe(u.gl.LEQUAL,Oe.ReadWrite,n.depthRangeFor3D),m=n.isTileAffectedByFog(c);if(a.meshes)for(const x of a.meshes){var g=["MODEL_POSITION_ON_GPU"],_=[];let t,i,r;20<s.instancedDataArray.length&&g.push("INSTANCED_ARRAYS");var y=rr(n,o.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&g.push("RENDER_CUTOFF"),d&&p)t=n.getOrCreateProgram("modelDepth",{defines:g}),i=mn(h.shadowTileMatrix,h.shadowTileMatrix,Float32Array.from(a.matrix)),r=p.getShadowPassColorMode();else{eo(g,_,x,n),t=n.getOrCreateProgram("model",{defines:g,overrideFog:m});const s=x.material,d=s.pbrMetallicRoughness,f=o.paint.get("model-opacity"),b=o.paint.get("model-emissive-strength").constantOr(0);i=pn(c.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),n,f,d.baseColorFactor,s.emissiveFactor,d.metallicFactor,d.roughnessFactor,s,b,o,l),p&&(h.shadowUniformsInitialized?t.setShadowUniformValues(u,p.getShadowUniformValues()):(p.setupShadows(c.toUnwrapped(),t,"model-tile",c.overscaledZ),h.shadowUniformsInitialized=!0)),r=y.shouldRenderCutoff||f<1||"OPAQUE"!==s.alphaMode?Fe.alphaBlended:Fe.unblended}n.uploadCommonUniforms(u,t,c.toUnwrapped(),null,y);var v=x.material.doubleSided?Ne.disabled:Ne.backCCW;if(20<s.instancedDataArray.length)_.push(s.instancedDataBuffer),t.draw(n,u.gl.TRIANGLES,f,Be.disabled,r,v,i,o.id,x.vertexBuffer,x.indexBuffer,x.segments,o.paint,n.transform.zoom,void 0,_,s.instancedDataArray.length);else{const a=d?"u_instance":"u_normal_matrix";for(let e=0;e<s.instancedDataArray.length;++e)i[a]=new Float32Array(s.instancedDataArray.arrayBuffer,64*e,16),t.draw(n,u.gl.TRIANGLES,f,Be.disabled,r,v,i,o.id,x.vertexBuffer,x.indexBuffer,x.segments,o.paint,n.transform.zoom,void 0,_)}}if(a.children)for(const u of a.children)e(n,o,u,s,l,c,h)}(e,i,Re,t,g,_,S)}}}}}})(t,i,r,n),p();else if(f.loaded()){if("batched-model"===f.type)(function(v,x,b,w){b.resetLayerRenderingStats(v);const T=v.context,S=v.transform,A=v.style.fog,E=v.shadowRenderer;if("mercator"!==S.projection.name)return Re.w(`Drawing 3D landmark models for ${S.projection.name} projection is not yet implemented`);var e=v.transform.getFreeCameraOptions().position,e=Re.N.scale([],[e.x,e.y,e.z],v.transform.worldSize);Re.N.negate(e,e);function t(i,r){for(const m of w){const w=x.getTile(m).getBucket(b);if(w&&w.uploaded){let t=!1;E&&(t=0===E.getMaxCascadeForTile(m.toUnwrapped()));const g=S.calculatePosMatrix(m.toUnwrapped(),S.worldSize),_=w.modelTraits;for(const x of w.getNodesInfo())if(!x.hiddenByReplacement&&x.node.meshes){const w=x.evaluatedScale,y=x.node;let e=0;if(v.terrain&&y.elevation&&(e=y.elevation*v.terrain.exaggeration()),!(w[0]<=1&&w[1]<=1&&w[2]<=1&&0===(f=void 0,f=x.getLocalBounds(),D.min=[...f.min],D.max=[...f.max],D.min[2]+=e,D.max[2]+=e,Re.N.transformMat4(D.min,D.min,g),Re.N.transformMat4(D.max,D.max,g),D.intersects(z)))){var n="light-beam"===v.renderPass,o=[...g],a=(Re.a6.translate(o,o,[(y.anchor?y.anchor[0]:0)*(w[0]-1),(y.anchor?y.anchor[1]:0)*(w[1]-1),e]),Re.N.exactEquals(w,Re.cT)||Re.a6.scale(o,o,w),Re.a6.multiply(o,o,y.matrix),Re.a6.multiply([],M,o)),s=(Re.a6.multiply(a,C,a),Re.a6.invert([],a)),l=(Re.a6.transpose(s,s),Re.a6.scale(s,s,no),Re.a6.multiply([],S.expandedFarZProjMatrix,o)),c=_&Re.cV.HasMapboxMeshFeatures,h=c?0:x.evaluatedRMEA[0][2];for(let e=0;e<y.meshes.length;++e){const w=y.meshes[e],C=e===y.lightMeshIndex;if(C){if(!n&&!v.terrain&&v.shadowRenderer){v.currentLayer<v.firstLightBeamLayer&&(v.firstLightBeamLayer=v.currentLayer);continue}}else if(n)continue;const M={defines:[]},D=[];if(eo(M.defines,D,w,v),c||M.defines.push("DIFFUSE_SHADED"),t&&M.defines.push("SHADOWS_SINGLE_CASCADE"),R&&(k?R.numRenderedVerticesInShadowPass+=w.vertexArray.length:R.numRenderedVerticesInTransparentPass+=w.vertexArray.length),k)ro(w,o,v,b);else{let e=null;if(A){const Re=Qn(o,v.transform);if(e=new Float32Array(Re),"globe"!==S.projection.name){const v=w.aabb.min,x=w.aabb.max,[b,T]=A.getOpacityForBounds(Re,v[0],v[1],x[0],x[1]);M.overrideFog=.05<=b||.05<=T}}var u=w.material;let t;u.occlusionTexture&&u.occlusionTexture.offsetScale&&(t=u.occlusionTexture.offsetScale,M.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!k&&E&&(E.useNormalOffset=!!w.normalBuffer);var d=v.getOrCreateProgram("model",M),p=(!k&&E&&E.setupShadowsFromMatrix(o,d,E.useNormalOffset),v.uploadCommonUniforms(T,d,m.toUnwrapped(),e),u.pbrMetallicRoughness),p=(p.metallicFactor=.9,p.roughnessFactor=.5,pn(new Float32Array(l),new Float32Array(a),new Float32Array(s),v,I,p.baseColorFactor,u.emissiveFactor,p.metallicFactor,p.roughnessFactor,u,h,b,[0,0,0],t));d.draw(v,T.gl.TRIANGLES,r&&!C?P:L,Be.disabled,i?C||I<1||x.hasTranslucentParts?Fe.alphaBlended:Fe.unblended:Fe.disabled,Ne.backCCW,p,b.id,w.vertexBuffer,w.indexBuffer,w.segments,b.paint,v.transform.zoom,void 0,D)}}}}}}var f}const C=Re.a6.identity([]),i=Re.cR(S.center.lat,S.zoom),M=Re.a6.fromScaling([],[1,1,1/i]),I=(Re.a6.translate(C,C,e),b.paint.get("model-opacity")),P=new Oe(T.gl.LEQUAL,Oe.ReadWrite,v.depthRangeFor3D),L=new Oe(T.gl.LEQUAL,Oe.ReadOnly,v.depthRangeFor3D),D=new Re.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),k="shadow"===v.renderPass,z=k&&E?E.getCurrentCascadeFrustum():S.getFrustum(S.scaleZoom(S.worldSize)),R=b.getLayerRenderingStats();var r=v,n=x,o=b,a=w,s=r.terrain?r.terrain.exaggeration():0,l=r.transform.zoom;for(const c of a){const a=n.getTile(c).getBucket(o);a&&(r.conflationActive&&a.updateReplacement(c,r.replacementSource),a.evaluateScale(r,o),r.terrain&&0<s&&a.elevationUpdate(r.terrain,s,c,o.source),a.needsReEvaluation(r,l,o))&&a.evaluate(o)}1===I?t(!0,!0):(t(!1,!0),t(!0,!1))})(t,i,r,n);else{var n=f.getModels(),o=[],i=t.transform.getFreeCameraOptions().position,a=Re.N.scale([],[i.x,i.y,i.z],t.transform.worldSize),s=(Re.N.negate(a,a),[]),l=[];let e=0;for(const i of n){const n=r.paint.get("model-rotation").constantOr(null),c=r.paint.get("model-scale").constantOr(null),h=r.paint.get("model-translation").constantOr(null),u=(i.computeModelMatrix(t,n,c,h,!0,!0,!1),Re.a6.identity([])),d=Re.cR(i.position.lat,t.transform.zoom),p=Re.a6.fromScaling([],[1,1,1/d]);Re.a6.translate(u,u,a),o.push({zScaleMatrix:p,negCameraPosMatrix:u});for(const Re of i.nodes)io(t.transform,Re,i.matrix,t.transform.expandedFarZProjMatrix,e,s,l);e++}if(s.sort((e,t)=>t.depth-e.depth),"shadow"!==t.renderPass){if(1===c)for(const Re of l)to(Re,t,r,o[Re.modelIndex],Be.disabled,t.colorModeForRenderPass());else{for(const Re of l)to(Re,t,r,o[Re.modelIndex],Be.disabled,Fe.disabled);for(const Re of l)to(Re,t,r,o[Re.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const Re of s)to(Re,t,r,o[Re.modelIndex],Be.disabled,t.colorModeForRenderPass())}else{for(const Re of l)ro(Re.mesh,Re.nodeModelMatrix,t,r);for(const Re of s)ro(Re.mesh,Re.nodeModelMatrix,t,r)}}p()}}}}},co={model:function(e,t,i){e=e.scope,t=t.getSource();if(t.loaded())if("vector"===t.type||"geojson"===t.type)i.modelManager&&i.modelManager.upload(i,e);else if("batched-model"!==t.type)for(const e of t.getModels())e.upload(i.context)},raster:function(e,t,i){var r=t.getSource();if(r instanceof Xe&&r.loaded()){var n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(n){var o=e.paint.get("raster-array-band")||r.getInitialBand(n);if(null!=o)for(const e of t.getIds().map(e=>t.getTileByID(e)))e.updateNeeded(n,o)&&r.prepareTile(e,n,o)}}},"raster-particle":function(e,t,i){var r=t.getSource();if(r instanceof Xe&&r.loaded()){var n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(n){var o=e.paint.get("raster-particle-array-band")||r.getInitialBand(n);if(null!=o)for(const e of t.getIds().map(e=>t.getTileByID(e)))e.updateNeeded(n,o)&&r.prepareTile(e,n,o)}}}};class ho{constructor(e,t,i,r){this.context=new Bt(e,t),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=r,this._debugParams={showTerrainProxyTiles:!1},r.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=v.maxUnderzooming+v.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new Re.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ar(this),this._wireframeDebugCache=new ao,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){var i,r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;(r||this._terrain&&this._terrain.enabled)&&(this._terrain||(this._terrain=new $r(this,e)),i=this._terrain,this.transform.elevation=r?i:null,i.update(e,this.transform,t),this.transform.elevation)&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){var t,e=e.fog;!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03?this.transform.fogCullDistSq=null:([e,t]=e.getFovAdjustedRange(this.transform._fov),this.transform.fogCullDistSq=t<e?null:(t=e+.78*(t-e))*t)}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,t){if(this.width=e*Re.f.devicePixelRatio,this.height=t*Re.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const Re of this.style.order)this.style._mergedLayers[Re].resize()}setup(){var e=this.context,t=new Re.aN,t=(t.emplaceBack(0,0),t.emplaceBack(Re.V,0),t.emplaceBack(0,Re.V),t.emplaceBack(Re.V,Re.V),this.tileExtentBuffer=e.createVertexBuffer(t,Re.aP.members),this.tileExtentSegments=Re.aB.simpleSegment(0,0,4,2),new Re.aN),t=(t.emplaceBack(0,0),t.emplaceBack(Re.V,0),t.emplaceBack(0,Re.V),t.emplaceBack(Re.V,Re.V),this.debugBuffer=e.createVertexBuffer(t,Re.aP.members),this.debugSegments=Re.aB.simpleSegment(0,0,4,5),new Re.aN),t=(t.emplaceBack(-1,-1),t.emplaceBack(1,-1),t.emplaceBack(-1,1),t.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(t,Re.aP.members),this.viewportSegments=Re.aB.simpleSegment(0,0,4,2),new Re.av),t=(t.emplaceBack(0,0,0,0),t.emplaceBack(Re.V,0,Re.V,0),t.emplaceBack(0,Re.V,0,Re.V),t.emplaceBack(Re.V,Re.V,Re.V,Re.V),this.mercatorBoundsBuffer=e.createVertexBuffer(t,Re.aR.members),this.mercatorBoundsSegments=Re.aB.simpleSegment(0,0,4,2),new Re.aw),i=(t.emplaceBack(0,1,2),t.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(t),new Re.aO);for(const Re of[0,1,3,2,0])i.emplaceBack(Re);this.debugIndexBuffer=e.createIndexBuffer(i),this.emptyTexture=new Re.T(e,new Re.h({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=Re.a6.create();t=this.context.gl;this.stencilClearMode=new Be({func:t.ALWAYS,mask:0},0,255,t.ZERO,t.ZERO,t.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){var e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Oe.disabled,this.stencilClearMode,Fe.disabled,Ne.disabled,Gr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,i){if(t&&this.currentStencilSource!==t.id&&e.isTileClipped()&&i&&0!==i.length){if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of i)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const n=this.context,o=n.gl;256<this.nextStencilID+i.length&&this.clearStencil(),n.setColorMode(Fe.disabled),n.setDepthMode(Oe.disabled);var r=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of i){const i=t.getTile(e),n=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:a,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);r.draw(this,o.TRIANGLES,Oe.disabled,new Be({func:o.ALWAYS,mask:0},n,255,o.KEEP,o.KEEP,o.REPLACE),Fe.disabled,Ne.disabled,Gr(e.projMatrix),"$clipping",a,s,l)}}}stencilModeFor3D(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var e=this.nextStencilID++,t=this.context.gl;return new Be({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){var t;return this.terrain?this.terrain.stencilModeForRTTOverlap(e):(t=this.context.gl,new Be({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE))}stencilConfigForOverlap(t){var i=this.context.gl,e=t.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=e[e.length-1].overscaledZ,n=e[0].overscaledZ-r+1;if(1<n){this.currentStencilSource=void 0,256<this.nextStencilID+n&&this.clearStencil();const t={};for(let e=0;e<n;e++)t[e+r]=new Be({func:i.GEQUAL,mask:255},e+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=n,[t,e]}return[{[r]:Be.disabled},e]}colorModeForRenderPass(){var e=this.context.gl;return this._showOverdrawInspector?new Fe([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new Re.ax(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Fe.unblended:Fe.alphaBlended}colorModeForDrapableLayerRenderPass(e){var t=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new Fe([t.ONE,t.ONE_MINUS_SRC_ALPHA,t.CONSTANT_ALPHA,t.ONE_MINUS_SRC_ALPHA],new Re.ax(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,i,r=!1){return this.opaquePassEnabledForLayer()||r?(r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon,new Oe(i||this.context.gl.LEQUAL,t,[r,r])):Oe.disabled}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,t){this._wireframeDebugCache.update(this.frameCounter),this.style=r,this.options=t;const i=this.style._mergedLayers,n=this.style.order,o=n.map(e=>i[e]),e=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(Re.f.now()),this.imageManager.beginFrame();let a=0,s=!1;for(const Re in e){const r=e[Re];r.used&&(r.prepare(this.context),r.getSource().usedInConflation)&&++a}for(const Re of o)Re.isHidden(this.transform.zoom)||this.prepareLayer(Re);const l={},c={},h={},u={},d={};for(const Re in e){const r=e[Re];l[Re]=r.getVisibleCoordinates(),c[Re]=l[Re].slice().reverse(),h[Re]=r.getVisibleCoordinates(!0).reverse(),u[Re]=r.getShadowCasterCoordinates(),d[Re]=r.sortCoordinatesByDistance(l[Re])}var p=e=>{e=this.style.getLayerSourceCache(e);return e&&e.used?e.getSource():null};if(a){const Re=[];for(const r of o)this.layerUsedInConflation(r,p(r))&&Re.push(r);if(Re&&1<Re.length){const r=[];for(const t of Re){const Re=this.style.getLayerSourceCache(t);Re&&Re.used&&Re.getSource().usedInConflation&&r.push({layer:t.fqid,cache:Re})}this.replacementSource.setSources(r),s=!0}}s||this.replacementSource.clear(),this.conflationActive=s,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const Re of o){const r=Re.cutoffRange();if(this.longestCutoffRange=Math.max(r,this.longestCutoffRange),0<r){const r=p(Re);r&&(this.minCutoffZoom=Math.max(r.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(o[e].is3D()){this.opaquePassCutoff=e;break}var f=this.style&&this.style.fog,m=(f?(this._fogVisible=0!==f.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=f.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0),this._shadowRenderer);if(m){m.updateShadowParameters(this.transform,this.style.directionalLight);for(const Re in e)for(const r of l[Re]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(r)||e),m.addShadowReceiver(r.toUnwrapped(),e.min,e.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new Re.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Jn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),Re.cZ(this.context.gl)){this.renderPass="offscreen";for(const Re of o){const t=r.getLayerSourceCache(Re);if(Re.hasOffscreenPass()&&!Re.isHidden(this.transform.zoom)){const i=t?c[t.id]:void 0;("custom"===Re.type||"raster"===Re.type||"raster-particle"===Re.type||Re.isSky()||i&&i.length)&&this.renderLayer(this,t,Re,i)}}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];var g,_,y=this.terrain;y&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&y.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,u)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const x="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),b=t.showOverdrawInspector?Re.ax.black:this.style.fog&&this.transform.projection.supportsFog&&!x?(_=this.style.fog.properties.get("color").toArray01(),new Re.ax(..._)):this.style.fog&&this.transform.projection.supportsFog&&x?(_=this.style.fog.properties.get("space-color").toArray01(),new Re.ax(..._)):Re.ax.transparent;if(this.context.clear({color:b,depth:1}),this.clearStencil(),this._showOverdrawInspector=t.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&x&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;0<=this.currentLayer;this.currentLayer--){const Re=o[this.currentLayer],t=r.getLayerSourceCache(Re);if(!Re.isSky()){const i=t?(Re.is3D()?d:c)[t.id]:void 0;this._renderTileClippingMasks(Re,t,i),this.renderLayer(this,t,Re,i)}}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&x&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||0<Re.S(this.transform.zoom))&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const Re=o[this.currentLayer],t=r.getLayerSourceCache(Re);Re.isSky()&&this.renderLayer(this,t,Re,t?c[t.id]:void 0)}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<n.length;){const Re=o[this.currentLayer];if("raster"===Re.type){const t=r.getLayerSourceCache(Re);this.renderLayer(this,t,Re,v(Re,t))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let e=0;for(m&&(e=m.getShadowCastingLayerCount());this.currentLayer<n.length;){const Re=o[this.currentLayer],t=r.getLayerSourceCache(Re);if(Re.isSky())++this.currentLayer;else if(y&&this.style.isLayerDraped(Re))Re.isHidden(this.transform.zoom)?++this.currentLayer:this.currentLayer=y.renderBatch(this.currentLayer);else{if(this._renderTileClippingMasks(Re,t,t?l[t.id]:void 0),this.renderLayer(this,t,Re,v(Re,t)),!y&&m&&0<e&&Re.hasShadowPass()&&0==--e&&(m.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Re=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Re;this.currentLayer++){const Re=o[this.currentLayer];if(Re.hasLightBeamPass()){const t=r.getLayerSourceCache(Re);this.renderLayer(this,t,Re,t?c[t.id]:void 0)}}this.currentLayer=Re,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;o.forEach(e=>{var t=r.getLayerSourceCache(e);t&&!e.isHidden(this.transform.zoom)&&t.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<t.getSource().maxzoom)&&(i=t)}),i&&this.options.showTileBoundaries&&lo.debug(this,i,i.getVisibleCoordinates(),Re.ax.red,!1,this.options.showParseStatus)}function v(e,t){let i;return i=t?("symbol"===e.type?h:e.is3D()?d:c)[t.id]:i}this.terrain&&this._debugParams.showTerrainProxyTiles&&lo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new Re.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(_=(f=this).transform.padding,jn(f,f.transform.height-(_.top||0),3,Rn),jn(f,_.bottom||0,3,On),Vn(f,_.left||0,3,Bn),Vn(f,f.transform.width-(_.right||0),3,Fn),_=f.transform.centerPoint,t=f,g=_.x,f=f.transform.height-_.y,_=Nn,Gn(t,g-1,f-10,2,20,_),Gn(t,g-10,f-1,20,2,_)),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),s||(this.conflationActive=!1)}}prepareLayer(e){this.gpuTimingStart(e);const t=this.transform.projection["unsupportedLayers"],i=!t||!t.includes(e.type);if(co[e.type]&&(i||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);co[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)&&(!e.terrain||"custom"!==i.type)||lo[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(this.options.gpuTiming){var i=this.context.extTimerQuery,r=this.context.gl;let e=this.gpuTimers[t.id];(e=e||(this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQuery()})).calls++,r.beginQuery(i.TIME_ELAPSED_EXT,e.query)}}gpuTimingDeferredRenderStart(){var e,t,i;this.options.gpuTimingDeferredRender&&(e=this.context.extTimerQuery,i=(t=this.context.gl).createQuery(),this.deferredRenderGpuTimeQueries.push(i),t.beginQuery(e.TIME_ELAPSED_EXT,i))}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){var e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){var e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){var t={};for(const o in e){var i=e[o],r=this.context.extTimerQuery,n=r.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(i.query),t[o]=n}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;var t=this.context.extTimerQuery,i=this.context.gl;let r=0;for(const n of e)r+=t.getQueryParameter(n,i.QUERY_RESULT)/1e6,t.deleteQueryEXT(n);return r}translatePosMatrix(e,t,i,r,n){if(!i[0]&&!i[1])return e;r=n?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(r){const Re=Math.sin(r),e=Math.cos(r);i=[i[0]*e-i[1]*Re,i[0]*Re+i[1]*e]}r=[n?i[0]:Re.a3(t,i[0],this.transform.zoom),n?i[1]:Re.a3(t,i[1],this.transform.zoom),0],n=new Float32Array(16);return Re.a6.translate(n,e,r),n}saveTileTexture(e){var t=e.size[0],i=this._tileTextures[t];i?i.push(e):this._tileTextures[t]=[e]}getTileTexture(e){e=this._tileTextures[e];return e&&0<e.length?e.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,i){var i=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,r=this.terrain&&0===this.terrain.exaggeration(),n=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(n.push("LIGHTING_3D_MODE"),n.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||n.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||n.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):n.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(n.push("TERRAIN"),this.linearFloatFilteringSupported()&&n.push("TERRAIN_DEM_FLOAT_FORMAT"),r)&&n.push("ZERO_EXAGGERATION"),"globe"===this.transform.projection.name&&n.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||n.push("FOG","FOG_DITHERING"),i&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}getOrCreateProgram(e,t){this.cache=this.cache||{};var i=t&&t.defines||[],r=t&&t.config,n=t&&t.transformFeedback,t=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(i),i=Kr.cacheKey(Lr[e],e,t,r);return this.cache[i]||(this.cache[i]=new Kr(this.context,e,Lr[e],r,gn[e],t,n)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Re.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,t){var i,r,n,o,a,s,l;this.style.enable3dLights()&&(i=this.style.directionalLight,r=this.style.ambientLight,i)&&r&&(r=r,a=(i=i).properties.get("direction"),s=i.properties.get("color").toArray01(),i=i.properties.get("intensity"),l=r.properties.get("color").toArray01(),r=r.properties.get("intensity"),a=[a.x,a.y,a.z],l=Re.cn(l,r),r=Re.cn(s,i),i={u_lighting_ambient_color:l,u_lighting_directional_dir:a,u_lighting_directional_color:r,u_ground_radiance:(s=a,i=l,a=[0,0,1],r=l=r,n=Re.N.dot(a,s),r=Re.N.dot(r,[.2126,.7152,.0722]),r=(o=(e,t,i)=>(1-i)*e+i*t)(1-.3*Math.min(r,1),1,Math.min(n+1,1)),n=o(.92,1,Math.asin(Re.aa(a[2],-1,1))/Math.PI+.5)*r,o=[0,0,0],Re.N.scale(o,i.slice(0,3),n),a=[0,0,0],Re.N.scale(a,l.slice(0,3),s[2]),r=[0,0,0],Re.N.add(r,o,a),Re.bU(r))},t.setLightsUniformValues(e,i))}uploadCommonUniforms(e,t,i,r,n){if(this.uploadCommonLightUniforms(e,t),!this.terrain||!this.terrain.renderingToTexture){var o=this.style.fog;if(o){const n=o.getOpacity(this.transform.pitch),a=((e,t,i,r,n,o,a,s,l,c,h,u)=>{var d=e.transform,p=t.properties.get("color").toArray01(),r=(p[3]=r,e.frameCounter/1e3%1),[f,m]=t.properties.get("vertical-range");return{u_fog_matrix:i?d.calculateFogTileMatrix(i):u||e.identityMat,u_fog_range:t.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(f,m),m],u_fog_temporal_offset:r,u_frustum_tl:n,u_frustum_tr:o,u_frustum_br:a,u_frustum_bl:s,u_globe_pos:l,u_globe_radius:c,u_viewport:h,u_globe_transition:Re.S(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,o,i,n,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Re.f.devicePixelRatio,this.transform.height*Re.f.devicePixelRatio],r);t.setFogUniformValues(e,a)}n&&t.setCutoffUniformValues(e,n.uniformValues)}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){var e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){var e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){var e;return!!this.transform._elevation&&!!(e=this.style&&this.style.fog)&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){var e=this._backgroundTiles,t=this._backgroundTiles={};for(const i of this.transform.coveringTiles({tileSize:512}))t[i.key]=e[i.key]||new M(i,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),.05<=t[0]||.05<=t[1]}}function uo(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,t),i=!1)};return()=>(i=!0,r||n(),r)}class po{constructor(e){this._hashName=e&&encodeURIComponent(e),Re.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=uo(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map&&(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0),this}getHashString(){const r=this._map;if(!r)return"";const n=fo(r);if(this._hashName){const r=this._hashName;let i=!1;var e=location.hash.slice(1).split("&").map(e=>{var t=e.split("=")[0];return t===r?(i=!0,t+"="+n):e}).filter(e=>e);return i||e.push(r+"="+n),"#"+e.join("&")}return"#"+n}_getCurrentHash(){var e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){var e,t,i=this._map;return!!i&&3<=(e=this._getCurrentHash()).length&&!e.some(e=>isNaN(e))&&(t=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(e[3]||0):i.getBearing(),i.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0)}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function fo(e,t){var i=e.getCenter(),r=Math.round(100*e.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,n),o=Math.round(i.lng*n)/n,i=Math.round(i.lat*n)/n,n=e.getBearing(),e=e.getPitch();let a=t?`/${o}/${i}/`+r:r+`/${i}/`+o;return(n||e)&&(a+="/"+Math.round(10*n)/10),e&&(a+="/"+Math.round(e)),a}const mo={linearity:.3,easing:Re.c_(0,0,.3,1)},go=Re.e({deceleration:2500,maxSpeed:1400},mo),_o=Re.e({deceleration:20,maxSpeed:1400},mo),yo=Re.e({deceleration:1e3,maxSpeed:360},mo),vo=Re.e({deceleration:1e3,maxSpeed:90},mo);class xo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Re.f.now(),settings:e})}_drainInertiaBuffer(){for(var e=this._inertiaBuffer,t=Re.f.now();0<e.length&&160<t-e[0].time;)e.shift()}_onMoveEnd(e){if(!(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))){var t={zoom:0,bearing:0,pitch:0,pan:new Re.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:Re}of this._inertiaBuffer)t.zoom+=Re.zoomDelta||0,t.bearing+=Re.bearingDelta||0,t.pitch+=Re.pitchDelta||0,Re.panDelta&&t.pan._add(Re.panDelta),Re.around&&(t.around=Re.around),Re.pinchAround&&(t.pinchAround=Re.pinchAround);var i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(t.pan.mag()&&(e=wo(t.pan.mag(),i,Re.e({},go,e||{})),r.offset=t.pan.mult(e.amount/t.pan.mag()),r.center=this._map.transform.center,bo(r,e)),t.zoom){const Re=wo(t.zoom,i,_o);r.zoom=this._map.transform.zoom+Re.amount,bo(r,Re)}if(t.bearing){const e=wo(t.bearing,i,yo);r.bearing=this._map.transform.bearing+Re.aa(e.amount,-179,179),bo(r,e)}if(t.pitch){const Re=wo(t.pitch,i,vo);r.pitch=this._map.transform.pitch+Re.amount,bo(r,Re)}if(r.zoom||r.bearing){const Re=void 0===t.pinchAround?t.around:t.pinchAround;r.around=Re?this._map.unproject(Re):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}}function bo(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function wo(e,t,i){var{maxSpeed:r,linearity:n,deceleration:o}=i,e=Re.aa(e*n/(t/1e3),-r,r),t=Math.abs(e)/(o*n);return{easing:i.easing,duration:1e3*t,amount:e*(t/2)}}class A extends Re.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i,r={}){var n=N(t.getCanvasContainer(),i),o=t.unproject(n);super(e,Re.e({point:n,lngLat:o,originalEvent:i},r)),this._defaultPrevented=!1,this.target=t}}class To extends Re.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){var r="touchend"===e?i.changedTouches:i.touches,r=U(t.getCanvasContainer(),r),n=r.map(e=>t.unproject(e)),o=r.reduce((e,t,i,r)=>e.add(t.div(r.length)),new Re.P(0,0));super(e,{points:r,point:o,lngLats:n,lngLat:t.unproject(o),originalEvent:i}),this._defaultPrevented=!1}}class So extends Re.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class Ao{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new So(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new A(e.type,this._map,e))}mouseup(e){this._map.fire(new A(e.type,this._map,e))}preclick(e){e=Re.e({},e);e.type="preclick",this._map.fire(new A(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new A(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new A(e.type,this._map,e))}mouseover(e){this._map.fire(new A(e.type,this._map,e))}mouseout(e){this._map.fire(new A(e.type,this._map,e))}touchstart(e){return this._firePreventable(new To(e.type,this._map,e))}touchmove(e){this._map.fire(new To(e.type,this._map,e))}touchend(e){this._map.fire(new To(e.type,this._map,e))}touchcancel(e){this._map.fire(new To(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eo{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new A(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new A("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new A(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Co{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(k(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(this._active){var i=this._startPos,r=this._lastPos;if(!(!i||!r||r.equals(t)||!this._box&&t.dist(i)<this._clickTolerance)){this._lastPos=t,this._box||(this._box=l("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const n=Math.min(i.x,t.x),o=Math.max(i.x,t.x),a=Math.min(i.y,t.y),s=Math.max(i.y,t.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${n}px,${a}px)`,this._box.style.width=o-n+"px",this._box.style.height=s-a+"px")})}}}mouseupWindow(e,t){if(this._active){const i=this._startPos,r=t;if(i&&0===e.button){if(this.reset(),F(),i.x!==r.x||i.y!==r.y)return this._map.fire(new Re.b("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),z(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new Re.b(e,{originalEvent:t}))}}function Mo(t,i){var r={};for(let e=0;e<t.length;e++)r[t[e].identifier]=i[e];return r}class Io{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,t,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){var t=new Re.P(0,0);for(const Re of e)t._add(Re);return t.div(e.length)}(t),this.touches=Mo(i,t)))}touchmove(e,t,i){if(!this.aborted&&this.centroid){var r=Mo(i,t);for(const e in this.touches){const t=r[e];(!t||30<t.dist(this.touches[e]))&&(this.aborted=!0)}}}touchend(e,t,i){if((!this.centroid||500<e.timeStamp-this.startTime)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Po{constructor(e){this.singleTap=new Io(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){var r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Lo{constructor(){this._zoomIn=new Po({numTouches:1,numTaps:2}),this._zoomOut=new Po({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i);return r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Do={0:1,2:2};class ko{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){var i;this._lastPoint||(i=j(e),this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i))}mousemoveWindow(e,t){var i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){t=Do[t];return void 0===e.buttons||(e.buttons&t)!==t}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&j(e)===this._eventButton&&(this._moved&&F(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zo extends ko{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Ro extends ko{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){t=.8*(t.x-e.x);if(t)return this._active=!0,{bearingDelta:t}}contextmenu(e){e.preventDefault()}}class Oo extends ko{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){t=-.5*(t.y-e.y);if(t)return this._active=!0,{pitchDelta:t}}contextmenu(e){e.preventDefault()}}class Bo{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),Re.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new Re.P(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!Re.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,t,i)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,i){0<i.length&&(this._active=!0);var r=Mo(i,t),n=new Re.P(0,0),o=new Re.P(0,0);let a=0;for(const Re in r){const e=r[Re],t=this._touches[Re];t&&(n._add(e),o._add(e.sub(t)),a++,r[Re]=e)}if(this._touches=r,!(a<this._minTouches)&&o.mag())return i=o.div(a),this._sum._add(i),this._sum.mag()<this._clickTolerance?void 0:{around:n.div(a),panDelta:i}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))+"px")}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Fo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){var r=this._firstTwoTouches;if(r){e.preventDefault();var[r,n]=r,r=No(i,t,r),i=No(i,t,n);if(r&&i)return t=this._aroundCenter?null:r.add(i).div(2),this._move([r,i],t,e)}}touchend(e,t,i){var r,n;this._firstTwoTouches&&([n,r]=this._firstTwoTouches,n=No(i,t,n),i=No(i,t,r),n&&i||(this._active&&F(),this.reset()))}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function No(t,i,r){for(let e=0;e<t.length;e++)if(t[e].identifier===r)return i[e]}function Uo(e,t){return Math.log(e/t)/Math.LN2}class jo extends Fo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){var i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Uo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uo(this._distance,i),pinchAround:t}}}function Vo(e,t){return 180*e.angleWith(t)/Math.PI}class Go extends Fo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){var i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Vo(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;return!!i&&(e=Vo(e,i),Math.abs(e)<t)}}function qo(e){return Math.abs(e.y)>Math.abs(e.x)}class Wo extends Fo{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){qo((this._lastPoints=e)[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){var r,n=this._lastPoints;if(n)return r=e[0].sub(n[0]),n=e[1].sub(n[1]),this._map._cooperativeGestures&&!Re.c$()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5})}gestureBeginsVertically(e,t,i){var r,n;return void 0!==this._valid?this._valid:(n=2<=e.mag(),r=2<=t.mag(),n||r?n&&r?(n=0<e.y==0<t.y,qo(e)&&qo(t)&&n):(null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0):void 0)}}const Ho={panStep:100,bearingStep:15,pitchStep:10};class Zo{constructor(){var e=Ho;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){let i=0,r=0,n=0,o=0,a=0;switch(s.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:s.shiftKey?r=-1:(s.preventDefault(),o=-1);break;case 39:s.shiftKey?r=1:(s.preventDefault(),o=1);break;case 38:s.shiftKey?n=1:(s.preventDefault(),a=-1);break;case 40:s.shiftKey?n=-1:(s.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:e=>{var t=e.getZoom();e.easeTo({duration:300,easeId:"keyboardHandler",easing:$o,zoom:i?Math.round(t)+i*(s.shiftKey?2:1):t,bearing:e.getBearing()+r*this._bearingStep,pitch:e.getPitch()+n*this._pitchStep,offset:[-o*this._panStep,-a*this._panStep],center:e.getCenter()},{originalEvent:s})}}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $o(e){return e*(2-e)}const Xo=4.000244140625;class Yo{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,Re.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures)&&(clearTimeout(this._alertTimer),this._alertContainer.remove())}wheel(t){if(this.isEnabled()){if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||Re.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;var i=Re.f.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%Xo==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":400<r?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){this._delta&&(this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout),e=N(this._el,e),this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame()))}renderFrame(){if(this._frameId&&(this._frameId=null,this.isActive())){const r=this._map.transform,n=("wheel"===this._type&&r.projection.wrap&&(180<=r._center.lng||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0),()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom);if(0!==this._delta){const Re="wheel"===this._type&&Math.abs(this._delta)>Xo?this._wheelZoomRate:this._defaultZoomRate;let e=2/(1+Math.exp(-Math.abs(this._delta*Re)));this._delta<0&&0!==e&&(e=1/e);const a=n(),s=Math.pow(2,a),t="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(t*e))),"wheel"===this._type&&(this._startZoom=a,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const o="number"==typeof this._targetZoom?this._targetZoom:n(),a=this._startZoom,s=this._easing;let e,t=!1;if("wheel"===this._type&&a&&s){const r=Math.min((Re.f.now()-this._lastWheelEventTime)/200,1),n=s(r);e=Re.U(a,o,n),r<1?this._frameId||(this._frameId=!0):t=!0}else e=o,t=!0;this._active=!0,t&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let i=e-n();return i*this._lastDelta<0&&(i=0),{noInertia:!0,needsRenderFrame:!t,zoomDelta:i,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}}_smoothOutEasing(e){let t=Re.d0;if(this._prevEase){const e=this._prevEase,i=(Re.f.now()-e.start)/e.duration,r=e.easing(.01+i)-e.easing(i),n=.27/Math.sqrt(r*r+1e-4)*.01,o=Math.sqrt(.0729-n*n);t=Re.c_(n,o,.25,1)}return this._prevEase={start:Re.f.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))+"px")}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ko{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:e=>{e.easeTo({duration:300,zoom:e.getZoom()+(t.shiftKey?-1:1),around:e.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qo{constructor(){this._tap=new Po({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&500<e.timeStamp-this._tapTime&&this.reset(),this._tapTime?0<i.length&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){var r,n;if(this._tapTime){if(this._swipePoint&&i[0].identifier===this._swipeTouch)return n=(r=t[0]).y-this._swipePoint.y,this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ea{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ta{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ia{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ra=e=>e.zoom||e.drag||e.pitch||e.rotate;class na extends Re.b{}class oa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){t=Re.N.sub([],t,e);this.radius=Re.N.length(t[2]<0?Re.N.div([],t,this.constants):[t[0],t[1],0])}projectRay(e){Re.N.div(e,e,this.constants),Re.N.normalize(e,e),Re.N.mul(e,e,this.constants);var t=Re.N.scale([],e,this.radius);if(0<t[2]){const e=Re.N.scale([],[0,0,1],Re.N.dot(t,[0,0,1])),i=Re.N.scale([],Re.N.normalize([],[t[0],t[1],0]),this.radius),r=Re.N.add([],t,Re.N.scale([],Re.N.sub([],Re.N.add([],i,e),t),2));t[0]=r[0],t[1]=r[1]}return t}}function aa(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class sa{constructor(e,t){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xo(e),this._bearingSnap=t.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new oa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(t),Re.aY(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[Re,e,t]of this._listeners){const i=Re===document?this.handleWindowEvent:this.handleEvent;Re.addEventListener(e,i,t)}}destroy(){for(var[e,t,i]of this._listeners){var r=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,r,i)}}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new Ao(t,e));var r=t.boxZoom=new Co(t,e),r=(this._add("boxZoom",r),new Lo),n=new Jo,r=(t.doubleClickZoom=new Ko(n,r),this._add("tapZoom",r),this._add("clickZoom",n),new Qo),n=(this._add("tapDragZoom",r),t.touchPitch=new Wo(t)),n=(this._add("touchPitch",n),new Ro(e)),o=new Oo(e),n=(t.dragRotate=new ta(e,n,o),this._add("mouseRotate",n,["mousePitch"]),this._add("mousePitch",o,["mouseRotate"]),new zo(e)),o=new Bo(t,e),n=(t.dragPan=new ea(i,n,o),this._add("mousePan",n),this._add("touchPan",o,["touchZoom","touchRotate"]),new Go),o=new jo,r=(t.touchZoomRotate=new ia(i,o,n,r),this._add("touchRotate",n,["touchPan","touchZoom"]),this._add("touchZoom",o,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eo(t)),t.scrollZoom=new Yo(t,this)),n=(this._add("scrollZoom",r,["mousePan"]),t.keyboard=new Zo);this._add("keyboard",n);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(var{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ra(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,e.type+"Window")}_getMapTouches(e){var t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(t,i){this._updatingCamera=!0;const r="renderFrame"===t.type,n=r?void 0:t,o={needsRenderFrame:!1},a={},s={},l=t.touches?this._getMapTouches(t.touches):void 0,c=l?U(this._el,l):r?void 0:N(this._el,t);for(const{handlerName:r,handler:h,allowed:u}of this._handlers)if(h.isEnabled()){let e;this._blockedByActive(s,u,r)?h.reset():h[i||t.type]&&(e=h[i||t.type](t,c,l),this.mergeHandlerResult(o,a,e,r,n),e)&&e.needsRenderFrame&&this._triggerRenderFrame(),(e||h.isActive())&&(s[r]=h)}const h={};for(const t in this._previousActiveHandlers)s[t]||(h[t]=n);this._previousActiveHandlers=s,(Object.keys(h).length||aa(o))&&(this._changes.push([o,a,h]),this._triggerRenderFrame()),(Object.keys(s).length||aa(o))&&this._map._stop(!0),this._updatingCamera=!1;const u=o["cameraAnimation"];u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,t,i,r,n){i&&(Re.e(e,i),e={handlerName:r,originalEvent:i.originalEvent||n},void 0!==i.zoomDelta&&(t.zoom=e),void 0!==i.panDelta&&(t.drag=e),void 0!==i.pitchDelta&&(t.pitch=e),void 0!==i.bearingDelta)&&(t.rotate=e)}_applyChanges(){var e,t,i,r={},n={},o={};for([e,t,i]of this._changes)e.panDelta&&(r.panDelta=(r.panDelta||new Re.P(0,0))._add(e.panDelta)),e.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+e.zoomDelta),e.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+e.bearingDelta),e.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+e.pitchDelta),void 0!==e.around&&(r.around=e.around),void 0!==e.aroundCoord&&(r.aroundCoord=e.aroundCoord),void 0!==e.pinchAround&&(r.pinchAround=e.pinchAround),e.noInertia&&(r.noInertia=e.noInertia),Re.e(n,t),Re.e(o,i);this._updateMapTransform(r,n,o),this._changes=[]}_updateMapTransform(s,l,c){var h=this._map,u=h.transform,d=e=>[e.x,e.y,e.z];if((p=this._eventsInProgress.drag)&&!this._handlersById[p.handlerName].isActive()&&!aa(s)){const Re=u.zoom;u.cameraElevationReference="sea",null!=this._originalZoom&&u._orthographicProjectionAtLowPitch&&"globe"!==u.projection.name&&0===u.pitch?(u.cameraElevationReference="ground",u.zoom=this._originalZoom):(u.recenterOnTerrain(),u.cameraElevationReference="ground"),Re!==u.zoom&&this._map._update(!0)}if(u._isCameraConstrained&&h._stop(!0),aa(s)){let{panDelta:e,zoomDelta:t,bearingDelta:i,pitchDelta:r,around:n,aroundCoord:o,pinchAround:a}=s;u._isCameraConstrained&&(0<t&&(t=0),u._isCameraConstrained=!1),void 0!==a&&(n=a),(t||l.drag&&!this._eventsInProgress.drag)&&n&&(this._dragOrigin=d(u.pointCoordinate3D(n)),this._originalZoom=u.zoom,this._trackingEllipsoid.setup(u._camera.position,this._dragOrigin)),u.cameraElevationReference="sea",h._stop(!0),n=n||h.transform.centerPoint,i&&(u.bearing+=i),r&&(u.pitch+=r),u._updateCameraState();var p=[0,0,0];if(e)if("mercator"===u.projection.name){const Re=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(n).dir),s=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(n.sub(e)).dir);p[0]=s[0]-Re[0],p[1]=s[1]-Re[1]}else{const s=u.pointCoordinate(n);if("globe"===u.projection.name){e=e.rotate(-u.angle);const l=u._pixelsPerMercatorPixel/u.worldSize;p[0]=-e.x*Re.d1(Re.au(s.y))*l,p[1]=-e.y*Re.d1(u.center.lat)*l}else{const Re=u.pointCoordinate(n.sub(e));s&&Re&&(p[0]=Re.x-s.x,p[1]=Re.y-s.y)}}var h=u.zoom,f=[0,0,0];if(t){const s=d(o||u.pointCoordinate3D(n)),l={dir:Re.N.normalize([],Re.N.sub([],s,u._camera.position))};if(l.dir[2]<0){const c=u.zoomDeltaToMovement(s,t);Re.N.scale(f,l.dir,c)}}d=Re.N.add(p,p,f),u._translateCameraConstrained(d),t&&1e-4<Math.abs(u.zoom-h)&&u.recenterOnTerrain(),u.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s)}this._fireEvents(l,c,!0)}_fireEvents(e,t,i){var r=ra(this._eventsInProgress),n=ra(e),o={};for(const Re in e){const t=e[Re]["originalEvent"];this._eventsInProgress[Re]||(o[Re+"start"]=t),this._eventsInProgress[Re]=e[Re]}!r&&n&&this._fireEvent("movestart",n.originalEvent);for(const Re in o)this._fireEvent(Re,o[Re]);n&&this._fireEvent("move",n.originalEvent);for(const Re in e){const t=e[Re]["originalEvent"];this._fireEvent(Re,t)}var a={};let s;for(const Re in this._eventsInProgress){const{handlerName:e,originalEvent:i}=this._eventsInProgress[Re];this._handlersById[e].isActive()||(delete this._eventsInProgress[Re],s=t[e]||i,a[Re+"end"]=s)}for(const Re in a)this._fireEvent(Re,a[Re]);var l=ra(this._eventsInProgress);if(i&&(r||n)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:s})):(this._map.fire(new Re.b("moveend",{originalEvent:s})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new Re.b(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new na("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const la="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ca extends Re.E{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this._respectPrefersReducedMotion=!1!==t.respectPrefersReducedMotion,Re.aY(["_renderFrameCallback"],this)}getCenter(){return new Re.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,i){return e=Re.P.convert(e).mult(-1),this.panTo(this.transform.center,Re.e({offset:e},t),i)}panTo(e,t,i){return this.easeTo(Re.e({center:e},t),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,i){return this.easeTo(Re.e({zoom:e},t),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,i){return this.easeTo(Re.e({bearing:e},t),i)}resetNorth(e,t){return this.rotateTo(0,Re.e({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(Re.e({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=Re.ad.convert(e);var i=t&&t.bearing||0,r=t&&t.pitch||0,n=e.getNorthWest(),e=e.getSouthEast();return this._cameraForBounds(this.transform,n,e,i,r,t)}_extendCameraOptions(e){var t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=Re.e({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const Re=e.padding;e.padding={top:Re,bottom:Re,right:Re,left:Re}}return e.padding=Re.e(t,e.padding),e}_minimumAABBFrustumDistance(e,t){var i=t.max[0]-t.min[0],t=t.max[1]-t.min[1];return i/t>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):t/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,t,i,r,n,o){var e=e.clone(),a=this._extendCameraOptions(o);e.bearing=r,e.pitch=n;const s=Re.bn.convert(t),l=Re.bn.convert(i),c=.5*(s.lat+l.lat),h=.5*(s.lng+l.lng),u=Re.d2(c,h),d=Re.N.normalize([],u),p=Re.N.normalize([],Re.N.cross([],d,[0,1,0])),f=Re.N.cross([],p,d),m=[p[0],p[1],p[2],0,f[0],f[1],f[2],0,d[0],d[1],d[2],0,0,0,0,1],g=[u,Re.d2(s.lat,s.lng),Re.d2(l.lat,s.lng),Re.d2(l.lat,l.lng),Re.d2(s.lat,l.lng),Re.d2(c,s.lng),Re.d2(c,l.lng),Re.d2(s.lat,h),Re.d2(l.lat,h)];var _=Re.bS.fromPoints(g.map(e=>[Re.N.dot(p,e),Re.N.dot(f,e),Re.N.dot(d,e)])),y=Re.N.transformMat4([],_.center,m),v=(0===Re.N.squaredLength(y)&&Re.N.set(y,0,0,1),Re.N.normalize(y,y),Re.N.scale(y,y,Re.ab),e.center=Re.d3(y),e.getWorldToCameraMatrix()),x=Re.a6.invert(new Float64Array(16),v),_=Re.bS.applyTransform(_,Re.a6.multiply([],v,m)),v=(Re.N.transformMat4(y,y,v),.5*(_.max[2]-_.min[2])),_=this._minimumAABBFrustumDistance(e,_),v=Re.N.scale([],[0,0,1],v),v=Re.N.add(v,y,v),_=_+(0===e.pitch?0:Re.N.distance(y,v)),v=e.globeCenterInViewSpace,v=Re.N.sub([],y,[v[0],v[1],v[2]]),_=(Re.N.normalize(v,v),Re.N.scale(v,v,_),Re.N.add([],y,v)),y=(Re.N.transformMat4(_,_,x),Re.d4/Re.ab),v=Re.N.length(_),x=Re.bl(Math.max(v*y-Re.d4,Number.EPSILON),0),_=Math.min(e.zoomFromMercatorZAdjusted(x),a.maxZoom);return _>.5*(Re.bG+Re.bx)?(e.setProjection({name:"mercator"}),e.zoom=_,this._cameraForBounds(e,t,i,r,n,o)):{center:e.center,zoom:_,bearing:r,pitch:n}}queryTerrainElevation(e,t){var i=this.transform.elevation;return i?(t=Re.e({},{exaggerated:!0},t),i.getAtPoint(Re.L.fromLngLat(e),null,t.exaggerated)):null}_cameraForBounds(e,t,i,r,n,o){var a,s,l,c,h,u,d,p,f,m,g,_,y,v,x;return"globe"===e.projection.name?this._cameraForBoundsOnGlobe(e,t,i,r,n,o):(e=e.clone(),a=this._extendCameraOptions(o),u=e.padding,e.bearing=r,e.pitch=n,x=Re.bn.convert(t),s=Re.bn.convert(i),v=new Re.bn(x.lng,s.lat),d=new Re.bn(s.lng,x.lat),c=e.project(x),l=e.project(s),x=this.queryTerrainElevation(x),s=this.queryTerrainElevation(s),v=this.queryTerrainElevation(v),d=this.queryTerrainElevation(d),c=[[c.x,c.y,Math.min(x||0,s||0,v||0,d||0)],[l.x,l.y,Math.max(x||0,s||0,v||0,d||0)]],l=Re.bS.fromPoints(c),x=e.getWorldToCameraMatrix(),s=Re.a6.invert(new Float64Array(16),x),l=Re.bS.applyTransform(l,x),v=Re.N.sub([],l.max,l.min),d=u.left||0,c=u.right||0,h=u.bottom||0,u=u.top||0,{left:p,right:m,top:_,bottom:f}=a.padding,g=.5*(d+c),y=.5*(u+h),d=Math.min(e.scaleZoom(e.scale*Math.min((e.width-(d+c+p+m))/v[0],(e.height-(h+u+f+_))/v[1])),a.maxZoom),c=e.scale/e.zoomScale(d),l=new Re.bS([l.min[0]-(p+g)*c,l.min[1]-(f+y)*c,l.min[2]],[l.max[0]+(m+g)*c,l.max[1]+(_+y)*c,l.max[2]]),h=.5*v[2],u=this._minimumAABBFrustumDistance(e,l),Re.a7.transformMat4(d=[0,0,1,0],d,x),Re.a7.normalize(d,d),p=Re.N.scale([],d,u+h),f=Re.N.add([],l.center,p),m=("number"==typeof a.offset.x&&"number"==typeof a.offset.y?new Re.P(a.offset.x,a.offset.y):Re.P.convert(a.offset)).rotate(-Re.bj(r)),l.center[0]-=m.x*c,l.center[1]+=m.y*c,Re.N.transformMat4(l.center,l.center,s),Re.N.transformMat4(f,f,s),g=[l.center[0],l.center[1],f[2]*e.pixelsPerMeter],Re.N.scale(g,g,1/e.worldSize),_=Re.at(g[0]),y=Re.au(g[1]),v=Math.min(e._zoomFromMercatorZ(g[2]),a.maxZoom),x=new Re.bn(_,y),e.mercatorFromTransition&&v<.5*(Re.bG+Re.bx)?(e.setProjection({name:"globe"}),e.zoom=v,this._cameraForBounds(e,t,i,r,n,o)):{center:x,zoom:v,bearing:r,pitch:n})}fitBounds(e,t,i){e=this.cameraForBounds(e,t);return this._fitInternal(e,t,i)}fitScreenCoordinates(e,t,i,r,n){var o,e=Re.P.convert(e),t=Re.P.convert(t),a=new Re.P(Math.min(e.x,t.x),Math.min(e.y,t.y)),s=new Re.P(Math.max(e.x,t.x),Math.max(e.y,t.y));return"mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(e,t)?this:(e=this.transform.pointLocation3D(a),t=this.transform.pointLocation3D(s),o=this.transform.pointLocation3D(new Re.P(a.x,s.y)),s=this.transform.pointLocation3D(new Re.P(s.x,a.y)),a=[Math.min(e.lng,t.lng,o.lng,s.lng),Math.min(e.lat,t.lat,o.lat,s.lat)],e=[Math.max(e.lng,t.lng,o.lng,s.lng),Math.max(e.lat,t.lat,o.lat,s.lat)],t=r&&r.pitch?r.pitch:this.getPitch(),o=this._cameraForBounds(this.transform,a,e,i,t,r),this._fitInternal(o,r,n))}_fitInternal(e,t,i){return e?(delete(t=Re.e(e,t)).padding,t.linear?this.easeTo(t,i):this.flyTo(t,i)):this}jumpTo(e,t){this.stop();var i=e.preloadOnly?this.transform.clone():this.transform;let r=!1,n=!1,o=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=Re.bn.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(n=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(o=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),e.preloadOnly?(this._preloadTiles(i),this):(this.fire(new Re.b("movestart",t)).fire(new Re.b("move",t)),r&&this.fire(new Re.b("zoomstart",t)).fire(new Re.b("zoom",t)).fire(new Re.b("zoomend",t)),n&&this.fire(new Re.b("rotatestart",t)).fire(new Re.b("rotate",t)).fire(new Re.b("rotateend",t)),o&&this.fire(new Re.b("pitchstart",t)).fire(new Re.b("pitch",t)).fire(new Re.b("pitchend",t)),this.fire(new Re.b("moveend",t)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Re.w(la),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){var i,r,n,o=this.transform;return o.projection.supportsFreeCamera?(this.stop(),r=o.zoom,n=o.pitch,i=o.bearing,e=(o.setFreeCameraOptions(e),r!==o.zoom),r=n!==o.pitch,n=i!==o.bearing,this.fire(new Re.b("movestart",t)).fire(new Re.b("move",t)),e&&this.fire(new Re.b("zoomstart",t)).fire(new Re.b("zoom",t)).fire(new Re.b("zoomend",t)),n&&this.fire(new Re.b("rotatestart",t)).fire(new Re.b("rotate",t)).fire(new Re.b("rotateend",t)),r&&this.fire(new Re.b("pitchstart",t)).fire(new Re.b("pitch",t)).fire(new Re.b("pitchend",t)),this.fire(new Re.b("moveend",t))):Re.w(la),this}easeTo(i,r){this._stop(!1,i.easeId),!1!==(i=Re.e({offset:[0,0],duration:500,easing:Re.d0},i)).animate&&!this._prefersReducedMotion(i)||(i.duration=0);const t=this.transform,n=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in i?+i.zoom:n,c="bearing"in i?this._normalizeBearing(i.bearing,o):o,h="pitch"in i?+i.pitch:a,u=("padding"in i?i:t).padding,d=Re.P.convert(i.offset);let p,f,m;if("globe"===t.projection.name){const r=Re.L.fromLngLat(t.center),n=d.rotate(-t.angle),o=(r.x+=n.x/t.worldSize,r.y+=n.y/t.worldSize,r.toLngLat()),a=Re.bn.convert(i.center||o);this._normalizeCenter(a),p=t.centerPoint.add(n),f=new Re.P(r.x,r.y).mult(t.worldSize),m=new Re.P(Re.a5(a.lng),Re.ae(a.lat)).mult(t.worldSize).sub(f)}else{p=t.centerPoint.add(d);const r=t.pointLocation(p),n=Re.bn.convert(i.center||r);this._normalizeCenter(n),f=t.project(r),m=t.project(n).sub(f)}const g=t.zoomScale(l-n);let _,y;i.around&&(_=Re.bn.convert(i.around),y=t.locationPoint(_));const v=this._zooming||l!==n,x=this._rotating||o!==c,b=this._pitching||h!==a,w=!t.isPaddingEqual(u),e=t=>e=>{if(v&&(t.zoom=Re.U(n,l,e)),x&&(t.bearing=Re.U(o,c,e)),b&&(t.pitch=Re.U(a,h,e)),w&&(t.interpolatePadding(s,u,e),p=t.centerPoint.add(d)),_)t.setLocationAtPoint(_,y);else{const Re=t.zoomScale(t.zoom-n),i=l>n?Math.min(2,g):Math.max(.5,g),r=Math.pow(i,1-e),o=t.unproject(f.add(m.mult(e*r)).mult(Re));t.setLocationAtPoint(t.renderWorldCopies?o.wrap():o,p)}return i.preloadOnly||this._fireMoveEvents(r),t};if(i.preloadOnly){const Re=this._emulate(e,i.duration,t);this._preloadTiles(Re)}else{var T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};this._zooming=v,this._rotating=x,this._pitching=b,this._easeId=i.easeId,this._prepareEase(r,i.noMoveStart,T),this._ease(e(t),e=>{"sea"===t.cameraElevationReference&&t.recenterOnTerrain(),this._afterEase(r,e)},i)}return this}_prepareEase(e,t,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),t||i.moving||this.fire(new Re.b("movestart",e)),this._zooming&&!i.zooming&&this.fire(new Re.b("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new Re.b("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new Re.b("pitchstart",e))}_fireMoveEvents(e){this.fire(new Re.b("move",e)),this._zooming&&this.fire(new Re.b("zoom",e)),this._rotating&&this.fire(new Re.b("rotate",e)),this._pitching&&this.fire(new Re.b("pitch",e))}_afterEase(e,t){var i,r;this._easeId&&t&&this._easeId===t||(this._easeId=void 0,this.transform.cameraElevationReference="ground",t=this._zooming,i=this._rotating,r=this._pitching,this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,t&&this.fire(new Re.b("zoomend",e)),i&&this.fire(new Re.b("rotateend",e)),r&&this.fire(new Re.b("pitchend",e)),this.fire(new Re.b("moveend",e)))}flyTo(n,o){if(this._prefersReducedMotion(n)){const e=Re.ac(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(e,o)}this.stop(),n=Re.e({offset:[0,0],speed:1.2,curve:1.42,easing:Re.d0},n);const e=this.transform,a=this.getZoom(),s=this.getBearing(),l=this.getPitch(),c="zoom"in n?Re.aa(+n.zoom,e.minZoom,e.maxZoom):a,h="bearing"in n?this._normalizeBearing(n.bearing,s):s,u="pitch"in n?+n.pitch:l,t=e.zoomScale(c-a),i=Re.P.convert(n.offset),d=e.centerPoint.add(i),r=e.pointLocation(d);let p=n.center;if(p&&n.padding){const Re=this._cameraForBounds(this.transform,p,p,h,u,n);Re&&(p=Re.center)}p=Re.bn.convert(p||r),this._normalizeCenter(p);const f=e.project(r),m=e.project(p).sub(f);let g=n.curve;const _=Math.max(e.width,e.height),y=_/t,v=m.mag();if("minZoom"in n){const o=Re.aa(Math.min(n.minZoom,a,c),e.minZoom,e.maxZoom),s=_/e.zoomScale(o-a);g=Math.sqrt(s/v*2)}const x=g*g;function b(e){e=(y*y-_*_+(e?-1:1)*x*x*v*v)/(2*(e?y:_)*x*v);return Math.log(Math.sqrt(e*e+1)-e)}function w(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const S=b(0);let A=function(e){return T(S)/T(S+g*e)},E=function(e){return _*((T(S)*(w(e=S+g*e)/T(e))-w(S))/x)/v},C=(b(1)-S)/g;if(Math.abs(v)<1e-6||!isFinite(C)){if(Math.abs(_-y)<1e-6)return this.easeTo(n,o);const Re=y<_?-1:1;C=Math.abs(Math.log(y/_))/g,E=function(){return 0},A=function(e){return Math.exp(Re*g*e)}}n.duration="duration"in n?+n.duration:1e3*C/("screenSpeed"in n?+n.screenSpeed/g:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const M=s!==h,I=u!==l,P=r=>e=>{var t=e*C,i=1/A(t),e=(r.zoom=1===e?c:a+r.scaleZoom(i),M&&(r.bearing=Re.U(s,h,e)),I&&(r.pitch=Re.U(l,u,e)),1===e?p:r.unproject(f.add(m.mult(E(t))).mult(i)));return r.setLocationAtPoint(r.renderWorldCopies?e.wrap():e,d),r._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),r};if(n.preloadOnly){const Re=this._emulate(P,n.duration,e);this._preloadTiles(Re)}else this._zooming=!0,this._rotating=M,this._pitching=I,this._prepareEase(o,!1),this._ease(P(e),()=>this._afterEase(o),n);return this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,i){!1===i.animate||0===i.duration?(e(1),t()):(this._easeStart=Re.f.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){var e=Math.min((Re.f.now()-this._easeStart)/this._easeOptions.duration,1),t=this._onEaseFrame;t&&t(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=Re.bh(e,-180,180);var i=Math.abs(e-t);return Math.abs(e-360-t)<i&&(e-=360),Math.abs(e+360-t)<i&&(e+=360),e}_normalizeCenter(e){var t=this.transform;t.maxBounds||"globe"!==t.projection.name&&!t.renderWorldCopies||(t=e.lng-t.center.lng,e.lng+=180<t?-360:t<-180?360:0)}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&Re.f.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,t,i){var r=Math.ceil(15*t/1e3),n=[],o=e(i.clone());for(let e=0;e<=r;e++){const t=o(e/r);n.push(t.clone())}return n}}class ha{constructor(e={}){this.options=e,Re.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){var t=this.options&&this.options.compact;return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l("button","mapboxgl-ctrl-attrib-button",this._container),l("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=l("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){t=this._map._getUIString("AttributionControl."+t);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",t)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e=e||(this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Re.d5.ACCESS_TOKEN}];var t;e&&(t=r.reduce((e,t,i)=>(t.value&&(e+=t.key+"="+t.value+(i<r.length-1?"&":"")),e),"?"),e.href=Re.d5.FEEDBACK_URL+`/${t}#`+fo(this._map,!0),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback"))}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(this._map.style){let r=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){var e=t[i];if(e.used){const t=e.getSource();t.attribution&&r.indexOf(t.attribution)<0&&r.push(t.attribution)}}r.sort((e,t)=>e.length-t.length),r=r.filter((t,i)=>{for(let e=i+1;e<r.length;e++)if(0<=r[e].indexOf(t))return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const i=r.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,r.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ua{constructor(){Re.aY(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=l("div","mapboxgl-ctrl");e=l("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(this._map.style){var e=this._map.style._sourceCaches;if(0!==Object.entries(e).length)for(const i in e){var t=e[i].getSource();if(t.hasOwnProperty("mapbox_logo")&&!t.mapbox_logo)return!1}}return!0}_updateCompact(){var e=this._container.children;e.length&&(e=e[0],this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact"))}}class da{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){var t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function pa(e,t,i){var r,n,o,a,s;for(e=new Re.bn(e.lng,e.lat),t&&(r=new Re.bn(e.lng-360,e.lat),n=new Re.bn(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),a=i.locationPoint(e).distSqr(t),s=t.x<0||t.y<0||t.x>i.width||t.y>i.height,i.locationPoint(r).distSqr(t)<a&&(s||Math.abs(r.lng-i.center.lng)<o)?e=r:i.locationPoint(n).distSqr(t)<a&&(s||Math.abs(n.lng-i.center.lng)<o)&&(e=n));180<Math.abs(e.lng-i.center.lng);){const Re=i.locationPoint(e);if(0<=Re.x&&0<=Re.y&&Re.x<=i.width&&Re.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}const fa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ma extends Re.E{constructor(e,t){if(super(),(e instanceof HTMLElement||t)&&(e=Re.e({element:e},t)),Re.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=Re.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=l("div");const t=41,i=27,r=o("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},this._element),n=o("radialGradient",{id:"shadowGradient"},o("defs",{},r));o("stop",{offset:"10%","stop-opacity":.4},n),o("stop",{offset:"100%","stop-opacity":.05},n),o("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),o("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),o("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),o("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=Re.P.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const i=this._element.classList;for(const Re in fa)i.remove("mapboxgl-marker-anchor-"+Re);i.add("mapboxgl-marker-anchor-"+this._anchor);const r=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...r),this._popup=null}addTo(e){return e!==this._map&&(this.remove(),(this._map=e).getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){var e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=Re.bn.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){var t;return this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e&&("offset"in e.options||(t=Math.sqrt(Math.pow(13.5,2)/2),e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset),((this._popup=e)._marker=this)._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")),this}_onKeyPress(e){var t=e.code,e=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==e&&13!==e||this.togglePopup()}_onMapClick(e){var e=e.originalEvent.target,t=this._element;this._popup&&(e===t||t.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){var e=this._popup;return e&&(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true"))),this}_behindTerrain(){var e=this._map,t=this._pos;return!(!e||!t||(t=e.unproject(t),!(e=e.getFreeCameraOptions()).position))&&(e=e.position.toLngLat()).distanceTo(t)<.9*e.distanceTo(this._lngLat)}_evaluateOpacity(){var t=this._map;if(t){var i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)this._clearFadeTimer();else{i=t.unproject(i);let e;t._showingGlobe()&&Re.d6(t.transform,this._lngLat)?e=0:(e=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(e*=this._occludedOpacity)),this._element.style.opacity=""+e,this._element.style.pointerEvents=0<e?"auto":"none",this._popup&&this._popup._setOpacity(e),this._fadeTimer=null}}}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){var e,t=this._pos;t&&this._map&&(e=this._offset.mult(this._scale),this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${fa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${e.x}px,${e.y}px)
        `)}_calculateXYTransform(){var e,t=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!t||"map"!==r)return"";if(i._showingGlobe())return r=Re.bF(Re.d7(i.transform,this._lngLat)),t=t.sub(Re.d8(i.transform)),0===(e=Math.abs(t.x)+Math.abs(t.y))?"":`rotateX(${-t.y*(r=r/e)}deg) rotateY(${t.x*r}deg)`;{const Re=i.getPitch();return Re?`rotateX(${Re}deg)`:""}}_calculateZTransform(){const e=this._pos,t=this._map;if(!t||!e)return"";let i=0;const r=this.getRotationAlignment();if("map"===r)if(t._showingGlobe()){const e=t.project(new Re.bn(this._lngLat.lng,this._lngLat.lat+.001)),r=t.project(new Re.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);i=Re.bF(Math.atan2(r.y,r.x))-90}else i=-t.getBearing();else if("horizon"===r){const r=Re.O(4,6,t.getZoom()),o=Re.d8(t.transform);o.y+=r*t.transform.height;var n=e.sub(o),n=Re.bF(Math.atan2(n.y,n.x));i=(90<n?n-270:n+90)*(1-r)}return(i+=this._rotation)?`rotateZ(${i}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=pa(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60))}))}getOffset(){return this._offset}setOffset(e){return this._offset=Re.P.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){var t=this._map;if(t){var i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){const Re=this._clickTolerance||t._clickTolerance;if(e.point.dist(i)<Re)return;this._isDragging=!0}this._pos=e.point.sub(r),this._lngLat=t.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Re.b("dragstart"))),this.fire(new Re.b("drag"))}}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;var e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Re.b("dragend")),this._state="inactive"}_addDragHandler(e){var t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;var t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ga={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_a=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ya(e=new Re.P(0,0),t="bottom"){if("number"!=typeof e)return e instanceof Re.P||Array.isArray(e)?Re.P.convert(e):Re.P.convert(e[t]||[0,0]);var i=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new Re.P(0,e);case"top-left":return new Re.P(i,i);case"top-right":return new Re.P(-i,i);case"bottom":return new Re.P(0,-e);case"bottom-left":return new Re.P(i,-i);case"bottom-right":return new Re.P(-i,-i);case"left":return new Re.P(e,0);case"right":return new Re.P(-e,0)}return new Re.P(0,0)}class va{constructor(e){this.jumpTo(e)}getValue(e){return e<=this._startTime?this._start:e>=this._endTime?this._end:(e=Re.cc((e-this._startTime)/(this._endTime-this._startTime)),this._start*(1-e)+this._end*e)}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const xa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ba={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class wa{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Ta={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sa{constructor(e,t,i=!1){this._clickTolerance=10,this.element=t,this.mouseRotate=new Ro({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Oo({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),Re.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),t.addEventListener("mousedown",this.mousedown),t.addEventListener("touchstart",this.touchstart,{passive:!1}),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchend",this.touchend),t.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),k()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){var e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){z(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Re.e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),N(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,N(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=U(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=U(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Aa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ea={maxWidth:100,unit:"metric"},Ca={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ma={version:Re.dk,supported:E,setRTLTextPlugin:Re.dm,getRTLTextPluginStatus:Re.dn,Map:class extends ca{constructor(e){var t=e;if(null!=(e=Re.e({},ba,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&85<e.maxPitch)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&Re.d9(window)&&(e.antialias=!1,Re.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ir(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._repaint=!1,this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new da,this._domRenderTaskQueue=new da,this._controls=[],this._markers=[],this._popups=[],this._mapId=Re.aC(),this._locale=Re.e({},xa,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new va(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Re.da(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){const Re=document.getElementById(e.container);if(!Re)throw new Error(`Container '${e.container.toString()}' not found.`);this._container=Re}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(0<this._container.childNodes.length&&Re.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),Re.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new wa,this._tp=e.devtools?new so(this):new so,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,e=>{this.repaint=e}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,e=>{this.showTileAABBs=e}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,e=>{this.showPadding=e}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new sa(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,!e.style&&e.testMode||this.setStyle(e.style||Re.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new po("string"==typeof e.hash&&e.hash||void 0).addTo(this)),this._hash&&this._hash._onHashChange()||(null==t.center&&null==t.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),(t=e.bounds)&&(this.resize(),this.fitBounds(t,Re.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new ha({customAttribution:e.customAttribution})),this._logoControl=new ua,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new Re.b(e.dataType+"data",e))}),this.on("dataloading",e=>{this.fire(new Re.b(e.dataType+"dataloading",e))})}_getMapId(){return this._mapId}addControl(e,t){var i;return void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),e&&e.onAdd?(i=e.onAdd(this),this._controls.push(e),e=this._controlPositions[t],-1!==t.indexOf("bottom")?e.insertBefore(i,e.firstChild):e.appendChild(i),this):this.fire(new Re.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")))}removeControl(e){var t;return e&&e.onRemove?(-1<(t=this._controls.indexOf(e))&&this._controls.splice(t,1),e.onRemove(this),this):this.fire(new Re.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")))}hasControl(e){return-1<this._controls.indexOf(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){var t;return this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height||(this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),(t=!this._moving)&&this.fire(new Re.b("movestart",e)).fire(new Re.b("move",e)),this.fire(new Re.b("resize",e)),t&&this.fire(new Re.b("moveend",e))),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Re.ad.convert(e)),this._update()}setMinZoom(e){if(-2<=(e=null==e?-2:e)&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Re.b("zoomstart")).fire(new Re.b("zoom")).fire(new Re.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Re.b("zoomstart")).fire(new Re.b("zoom")).fire(new Re.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=e&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Re.b("pitchstart")).fire(new Re.b("pitch")).fire(new Re.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if(85<(e=null==e?85:e))throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Re.b("pitchstart")).fire(new Re.b("pitch")).fire(new Re.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){e=this._parseLanguage(e);if(this.style&&e!==this._language){this._language=e,this.style.reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language)}return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview&&(this._worldview=e,this.style.reloadSources()),this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"===this.getProjection().name){var t=this.transform,i=t.projection.name;let e;"globe"===i&&t.zoom>=Re.bx?(t.setMercatorFromTransition(),e=!0):"mercator"===i&&t.zoom<Re.bx&&(t.setProjection({name:"globe"}),e=!0),e&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){e="globe"===e.name&&this.transform.zoom>=Re.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(e);return this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Re.bn.convert(e))}unproject(e){return this.transform.pointLocation3D(Re.P.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(r,n,o){if("mouseenter"===r||"mouseover"===r){let i=!1;return{layers:new Set(n),listener:o,delegates:{mousemove:e=>{var t=n.filter(e=>this.getLayer(e)),t=t.length?this.queryRenderedFeatures(e.point,{layers:t}):[];t.length?i||(i=!0,o.call(this,new A(r,this,e.originalEvent,{features:t}))):i=!1},mouseout:()=>{i=!1}}}}if("mouseleave"===r||"mouseout"===r){let i=!1;return{layers:new Set(n),listener:o,delegates:{mousemove:e=>{var t=n.filter(e=>this.getLayer(e));(t.length?this.queryRenderedFeatures(e.point,{layers:t}):[]).length?i=!0:i&&(i=!1,o.call(this,new A(r,this,e.originalEvent)))},mouseout:e=>{i&&(i=!1,o.call(this,new A(r,this,e.originalEvent)))}}}}return{layers:new Set(n),listener:o,delegates:{[r]:e=>{var t=n.filter(e=>this.getLayer(e)),t=t.length?this.queryRenderedFeatures(e.point,{layers:t}):[];t.length&&(e.features=t,o.call(this,e),delete e.features)}}}}on(e,t,i){if(void 0===i)return super.on(e,t);if(t=Array.isArray(t)?t:[t])for(const e of t)if(!this._isValidId(e))return this;var r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);if(t=Array.isArray(t)?t:[t])for(const e of t)if(!this._isValidId(e))return this;var r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,r,n){if(void 0===n)return super.off(e,r);for(const e of r=new Set(Array.isArray(r)?r:[r]))if(!this._isValidId(e))return this;const t=this._delegatedListeners?this._delegatedListeners[e]:void 0;return t&&(t=>{for(let e=0;e<t.length;e++){var i=t[e];if(i.listener===n&&((e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0})(i.layers,r)){for(const t in i.delegates)this.off(t,i.delegates[t]);return t.splice(e,1)}}})(t),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof Re.P||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const Re of t.layers)if(!this._isValidId(Re))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){var t=this.transform.projection["name"];return"globe"!==t&&"mercator"!==t&&Re.w(t+" projection does not support isPointOnSurface, this API may behave unexpectedly."),this.transform.isPointOnSurface(Re.P.convert(e))}setStyle(e,t){return!1!==(t=Re.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){var t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new n(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new n(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){var t;"string"==typeof e?(t=this._requestManager.normalizeStyleURL(e),t=this._requestManager.transformRequest(t,Re.R.Style),Re.g(t,(e,t)=>{e?this.fire(new Re.a(e)):t&&this._updateDiff(t,i)})):"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(e){Re.w(`Unable to perform style diff: ${e.message||e.error||e}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Re.w("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new Re.a(new Error("IDs can't be empty."))),!1):!Re.c4(e)||(this.fire(new Re.a(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:i=1,sdf:r=!1,stretchX:n,stretchY:o,content:a}={}){var s,l,c;this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?({width:s,height:l,data:c}=Re.f.getImageData(t),this.style.addImage(e,{data:new Re.h({width:s,height:l},c),pixelRatio:i,stretchX:n,stretchY:o,content:a,sdf:r,version:0})):void 0===t.width||void 0===t.height?this.fire(new Re.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):({width:s,height:l}=t,c=t,this.style.addImage(e,{data:new Re.h({width:s,height:l},new Uint8Array(c.data)),pixelRatio:i,stretchX:n,stretchY:o,content:a,sdf:r,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e))}updateImage(e,t){this._lazyInitEmptyStyle();var i,r,n,o=this.style.getImage(e);o?({width:n,height:i}=r=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?Re.f.getImageData(t):t,r=r.data,void 0===n||void 0===i?this.fire(new Re.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):n!==o.data.width||i!==o.data.height?this.fire(new Re.a(new Error(`The width and height of the updated image (${n}, ${i})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):(n=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap),o.data.replace(r,n),this.style.updateImage(e,o))):this.fire(new Re.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Re.a(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,i){Re.d(this._requestManager.transformRequest(e,Re.R.Image),(e,t)=>{i(e,t instanceof HTMLImageElement?Re.f.getImageData(t):t)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Re.a(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){e=this.getLayer(e);return e&&e.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,r={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,r={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){var t;return this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type?(t=e[0]).properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat"):(this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0)),this._update(!0)}getLights(){var e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t=0){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Re.bn.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(this._container){const n=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let e,t,i,r=this._container;for(;r&&(!t||!i);){const n=window.getComputedStyle(r).transform;n&&"none"!==n&&((e=n.match(/matrix.*\((.+)\)/)[1].split(", "))[0]&&"0"!==e[0]&&"1"!==e[0]&&(t=e[0]),e[3])&&"0"!==e[3]&&"1"!==e[3]&&(i=e[3]),r=r.parentElement}this._containerWidth=t?Math.abs(n/t):n,this._containerHeight=i?Math.abs(o/i):o}}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&Re.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){var e=this._container,t=(e.classList.add("mapboxgl-map"),(this._missingCSSCanary=l("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS(),this._canvasContainer=l("div","mapboxgl-canvas-container",e));this._canvas=l("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=l("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{r[e]=l("div","mapboxgl-ctrl-"+e,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){var i=Re.f.devicePixelRatio||1;this._canvas.width=i*Math.ceil(e),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=e+"px",this._canvas.style.height=t+"px"}_addMarker(e){this._markers.push(e)}_removeMarker(e){e=this._markers.indexOf(e);-1!==e&&this._markers.splice(e,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){e=this._popups.indexOf(e);-1!==e&&this._popups.splice(e,1)}_setupPainter(){var e=Re.e({},E.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",e);e?(Re.db(e,!0),this.painter=new ho(e,this._contextCreateOptions,this.transform,this._tp),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),Re.dc.testSupport(e)):this.fire(new Re.a(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Re.b("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Re.b("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new Re.b("renderstart"));const r=this.painter.context.extTimerQuery,n=Re.f.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=o.createQuery(),o.beginQuery(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),!this._removed){this._updateProjectionTransition();var a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,r=Re.f.now(),n=new Re.K(t,{now:r,fadeDuration:a,pitch:i,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let e=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),e=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):e=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Re.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Re.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=Re.f.now()-n;o.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{var e=o.getQueryParameter(i,o.QUERY_RESULT)/1e6;o.deleteQuery(i),this.fire(new Re.b("gpu-timing-frame",{cpuTime:t,gpuTime:e}))},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{var e=this.painter.queryGpuTimers(t);this.fire(new Re.b("gpu-timing-layer",{layerTimes:e}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{var e=this.painter.queryGpuTimeDeferredRender(t);this.fire(new Re.b("gpu-timing-deferred-render",{gpuTime:e}))},50)}t=this._sourcesDirty||this._styleDirty||this._placementDirty||e;if(t||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(e=t?this._updateAverageElevation(n,!0):e)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new Re.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new Re.b("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||t||(this._fullyLoaded=!0,this._performanceMetricsCollection&&Re.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const i of this._popups)!e||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(t,i=!1){var r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);var n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(i||500<t-this._averageElevationLastSampledAt)&&!this._averageElevation.isEasing(t)){const i=this.transform.averageElevation;let e=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(e)?e=0:this._averageElevationLastSampledAt=t;var o=Math.abs(i-e);if(1<o){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(e),r(e);this._averageElevation.easeTo(e,t,300)}else if(1e-4<o)return this._averageElevation.jumpTo(e),r(e)}return!!this._averageElevation.isEasing(t)&&r(this._averageElevation.getValue(t))}_authenticate(){Re.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===Re.df||401===e.status)){const e=this.painter.context.gl;Re.db(e,!1),this._logoControl instanceof ua&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Re.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Re.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){var e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){var e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(i,r,n){let o=n[1]-n[0];var a=i.length/4;for(let e=0;e<r.length;e++){var s=r[e];let t=0;for(let e=0;e<s.length;e+=4)s[e]===i[e]&&s[e+1]===i[e+1]&&s[e+2]===i[e+2]&&s[e+3]===i[e+3]&&(t+=1);o+=(n[e+2]-n[e+1])*(1-t/a)}return o}remove(){this._hash&&this._hash.remove();for(const Re of this._controls)Re.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);var e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Re.dh(this.painter.context.gl),Re.di.remove(),Re.dj.remove(),this._removed=!0,this.fire(new Re.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=Re.f.frame(e=>{var t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(i){var e=this.style?Object.values(this.style._sourceCaches):[];return Re.b1(e,(e,t)=>e._preloadTiles(i,t),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&((this._showCollisionBoxes=e)?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e)&&this._update()}_setCacheLimits(e,t){Re.dl(e,t)}get version(){return Re.dk}},NavigationControl:class{constructor(e){this.options=Re.e({},Ta,e),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(Re.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),l("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),l("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Re.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{var t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=l("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){var e,t,i=this._map;i&&(e=(t=i.getZoom())===i.getMaxZoom(),t=t===i.getMinZoom(),this._zoomInButton.disabled=e,this._zoomOutButton.disabled=t,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",t.toString()))}_rotateCompassArrow(){var e=this._map;if(e){const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sa(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){var e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){e=l("button",e,this._container);return e.type="button",e.addEventListener("click",t),e}_setButtonTitle(e,t){this._map&&(t=this._map._getUIString("NavigationControl."+t),e.setAttribute("aria-label",t),e.firstElementChild)&&e.firstElementChild.setAttribute("title",t)}},GeolocateControl:class extends Re.E{constructor(e){super();var t=navigator.geolocation;this.options=Re.e({geolocation:t},Aa,e),Re.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=uo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const i=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>i("denied"!==e.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(e){var t=this._map.getMaxBounds(),e=e.coords;return!!t&&(e.longitude<t.getWest()||e.longitude>t.getEast()||e.latitude<t.getSouth()||e.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))this._setErrorState(),this.fire(new Re.b("outofmaxbounds",e)),this._updateMarker();else{if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Re.b("geolocate",e))}this._finish()}}_updateCamera(e){var t=new Re.bn(e.coords.longitude,e.coords.latitude),e=e.coords.accuracy,i=this._map.getBearing(),i=Re.e({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(e),i,{geolocateSource:!0})}_updateMarker(e){var t;e?(t=new Re.bn(e.coords.longitude,e.coords.latitude),this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()):(this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove())}_updateCircleRadius(){var e=this._map.transform,e=Re.bl(1,e._center.lat)*e.worldSize,e=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=e+"px",this._circleElement.style.height=e+"px"}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const Re=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",Re),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",Re),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Re.b("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=l("button","mapboxgl-ctrl-geolocate",this._container),l("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),!(this._geolocateButton.type="button")===e){Re.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const Re=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",Re),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",Re)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l("div","mapboxgl-user-location"),this._dotElement.appendChild(l("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(l("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ma({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=l("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Re.b("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Re.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Re.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Re.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Re.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,1<this._numberOfWatches?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ha,ScaleControl:class{constructor(e){this.options=Re.e({},Ea,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),Re.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,r=t._containerWidth/2-e/2,n=t.unproject([r,i]),o=t.unproject([r+e,i]),a=n.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*a;5280<t?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):1e3<=a?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(i,r,n){this._map._requestDomTask(()=>{t=r;var e=(e=Math.pow(10,(""+Math.floor(t)).length-1))*(10<=(t/=e)?10:5<=t?5:3<=t?3:2<=t?2:1<=t?1:(e=t,t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10)),Math.round(e*t)/t)),t=e/r;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(e):e+"&nbsp;"+Ca[n],this._container.style.width=i*t+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:Re.w("Full screen control 'container' must be a DOM element.")),Re.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Re.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){var e=this._fullscreenButton=l("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Re.E{constructor(e){super(),this.options=Re.e(Object.create(ga),e),Re.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Re.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);var e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Re.b("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Re.bn.convert(e),this._pos=null,this._trackPointer=!1,this._update();e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();var e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){var t,i=document.createDocumentFragment(),r=document.createElement("body");for(r.innerHTML=e;t=r.firstChild;)i.appendChild(t);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=l("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=l("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return t=!this._classList.delete(e)&&(this._classList.add(e),!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;var t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";var n=i.offsetWidth,i=i.offsetHeight,o=r.x<n/2,n=r.x>t.transform.width-n/2;if(r.y+e<i)return o?"top-left":n?"top-right":"top";if(r.y>t.transform.height-i){if(o)return"bottom-left";if(n)return"bottom-right"}return o?"left":n?"right":"bottom"}_updateClassList(){var e,t=this._container;t&&((e=[...this._classList]).push("mapboxgl-popup"),this._anchor&&e.push("mapboxgl-popup-anchor-"+this._anchor),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" "))}_update(t){const i=this._map,r=this._content;if(i&&(this._lngLat||this._trackPointer)&&r){let e=this._container;if(e||(e=this._container=l("div","mapboxgl-popup",i.getContainer()),this._tip=l("div","mapboxgl-popup-tip",e),e.appendChild(r)),this.options.maxWidth&&e.style.maxWidth!==this.options.maxWidth&&(e.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pa(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const Re=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),r=ya(this.options.offset),e=this._anchor=this._getAnchor(r.y),l=ya(this.options.offset,e),n=Re.add(l).round();i._requestDomTask(()=>{this._container&&e&&(this._container.style.transform=`${fa[e]} translate(${n.x}px,${n.y}px)`)})}if(!this._marker&&i._showingGlobe()){const t=Re.d6(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}}_focusFirstElement(){var e;this.options.focusAfterOpen&&this._container&&(e=this._container.querySelector(_a))&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=""+e),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:ma,Style:n,LngLat:Re.bn,LngLatBounds:Re.ad,Point:Re.P,MercatorCoordinate:Re.L,FreeCameraOptions:Ji,Evented:Re.E,config:Re.d5,prewarm:Re.dp,clearPrewarmedResources:Re.dq,get accessToken(){return Re.d5.ACCESS_TOKEN},set accessToken(e){Re.d5.ACCESS_TOKEN=e},get baseApiUrl(){return Re.d5.API_URL},set baseApiUrl(e){Re.d5.API_URL=e},get workerCount(){return Re.dr.workerCount},set workerCount(e){Re.dr.workerCount=e},get maxParallelImageRequests(){return Re.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){Re.d5.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){Re.ds(e)},get workerUrl(){return Re.dt.workerUrl},set workerUrl(e){Re.dt.workerUrl=e},get workerClass(){return Re.dt.workerClass},set workerClass(e){Re.dt.workerClass=e},get workerParams(){return Re.dt.workerParams},set workerParams(e){Re.dt.workerParams=e},get dracoUrl(){return Re.du()},set dracoUrl(e){Re.dv(e)},get meshoptUrl(){return Re.dw()},set meshoptUrl(e){Re.dx(e)},setNow:Re.f.setNow,restoreNow:Re.f.restoreNow};return Ma}),a}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(c){var r,o=window.Slick||{};r=0,(o=function(e,t){var i=this;i.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:c(e),appendDots:c(e),arrows:!0,asNavFor:null,prevArrow:'<button class="slick-prev" aria-label="Previous" type="button">Previous</button>',nextArrow:'<button class="slick-next" aria-label="Next" type="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(e,t){return c('<button type="button" />').text(t+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,focusOnChange:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},i.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,scrolling:!1,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,swiping:!1,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},c.extend(i,i.initials),i.activeBreakpoint=null,i.animType=null,i.animProp=null,i.breakpoints=[],i.breakpointSettings=[],i.cssTransitions=!1,i.focussed=!1,i.interrupted=!1,i.hidden="hidden",i.paused=!0,i.positionProp=null,i.respondTo=null,i.rowCount=1,i.shouldClick=!0,i.$slider=c(e),i.$slidesCache=null,i.transformType=null,i.transitionType=null,i.visibilityChange="visibilitychange",i.windowWidth=0,i.windowTimer=null,e=c(e).data("slick")||{},i.options=c.extend({},i.defaults,t,e),i.currentSlide=i.options.initialSlide,i.originalSettings=i.options,void 0!==document.mozHidden?(i.hidden="mozHidden",i.visibilityChange="mozvisibilitychange"):void 0!==document.webkitHidden&&(i.hidden="webkitHidden",i.visibilityChange="webkitvisibilitychange"),i.autoPlay=c.proxy(i.autoPlay,i),i.autoPlayClear=c.proxy(i.autoPlayClear,i),i.autoPlayIterator=c.proxy(i.autoPlayIterator,i),i.changeSlide=c.proxy(i.changeSlide,i),i.clickHandler=c.proxy(i.clickHandler,i),i.selectHandler=c.proxy(i.selectHandler,i),i.setPosition=c.proxy(i.setPosition,i),i.swipeHandler=c.proxy(i.swipeHandler,i),i.dragHandler=c.proxy(i.dragHandler,i),i.keyHandler=c.proxy(i.keyHandler,i),i.instanceUid=r++,i.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,i.registerBreakpoints(),i.init(!0)}).prototype.activateADA=function(){this.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},o.prototype.addSlide=o.prototype.slickAdd=function(e,t,i){var r=this;if("boolean"==typeof t)i=t,t=null;else if(t<0||t>=r.slideCount)return!1;r.unload(),"number"==typeof t?0===t&&0===r.$slides.length?c(e).appendTo(r.$slideTrack):i?c(e).insertBefore(r.$slides.eq(t)):c(e).insertAfter(r.$slides.eq(t)):!0===i?c(e).prependTo(r.$slideTrack):c(e).appendTo(r.$slideTrack),r.$slides=r.$slideTrack.children(this.options.slide),r.$slideTrack.children(this.options.slide).detach(),r.$slideTrack.append(r.$slides),r.$slides.each(function(e,t){c(t).attr("data-slick-index",e)}),r.$slidesCache=r.$slides,r.reinit()},o.prototype.animateHeight=function(){var e;1===this.options.slidesToShow&&!0===this.options.adaptiveHeight&&!1===this.options.vertical&&(e=this.$slides.eq(this.currentSlide).outerHeight(!0),this.$list.animate({height:e},this.options.speed))},o.prototype.animateSlide=function(e,t){var i={},r=this;r.animateHeight(),!0===r.options.rtl&&!1===r.options.vertical&&(e=-e),!1===r.transformsEnabled?!1===r.options.vertical?r.$slideTrack.animate({left:e},r.options.speed,r.options.easing,t):r.$slideTrack.animate({top:e},r.options.speed,r.options.easing,t):!1===r.cssTransitions?(!0===r.options.rtl&&(r.currentLeft=-r.currentLeft),c({animStart:r.currentLeft}).animate({animStart:e},{duration:r.options.speed,easing:r.options.easing,step:function(e){e=Math.ceil(e),!1===r.options.vertical?i[r.animType]="translate("+e+"px, 0px)":i[r.animType]="translate(0px,"+e+"px)",r.$slideTrack.css(i)},complete:function(){t&&t.call()}})):(r.applyTransition(),e=Math.ceil(e),!1===r.options.vertical?i[r.animType]="translate3d("+e+"px, 0px, 0px)":i[r.animType]="translate3d(0px,"+e+"px, 0px)",r.$slideTrack.css(i),t&&setTimeout(function(){r.disableTransition(),t.call()},r.options.speed))},o.prototype.getNavTarget=function(){var e=this.options.asNavFor;return e=e&&null!==e?c(e).not(this.$slider):e},o.prototype.asNavFor=function(t){var e=this.getNavTarget();null!==e&&"object"==typeof e&&e.each(function(){var e=c(this).slick("getSlick");e.unslicked||e.slideHandler(t,!0)})},o.prototype.applyTransition=function(e){var t=this,i={};!1===t.options.fade?i[t.transitionType]=t.transformType+" "+t.options.speed+"ms "+t.options.cssEase:i[t.transitionType]="opacity "+t.options.speed+"ms "+t.options.cssEase,(!1===t.options.fade?t.$slideTrack:t.$slides.eq(e)).css(i)},o.prototype.autoPlay=function(){this.autoPlayClear(),this.slideCount>this.options.slidesToShow&&(this.autoPlayTimer=setInterval(this.autoPlayIterator,this.options.autoplaySpeed))},o.prototype.autoPlayClear=function(){this.autoPlayTimer&&clearInterval(this.autoPlayTimer)},o.prototype.autoPlayIterator=function(){var e=this,t=e.currentSlide+e.options.slidesToScroll;e.paused||e.interrupted||e.focussed||(!1===e.options.infinite&&(1===e.direction&&e.currentSlide+1===e.slideCount-1?e.direction=0:0===e.direction&&(t=e.currentSlide-e.options.slidesToScroll,e.currentSlide-1==0)&&(e.direction=1)),e.slideHandler(t))},o.prototype.buildArrows=function(){var e=this;!0===e.options.arrows&&(e.$prevArrow=c(e.options.prevArrow).addClass("slick-arrow"),e.$nextArrow=c(e.options.nextArrow).addClass("slick-arrow"),e.slideCount>e.options.slidesToShow?(e.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.prependTo(e.options.appendArrows),e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.appendTo(e.options.appendArrows),!0!==e.options.infinite&&e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):e.$prevArrow.add(e.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},o.prototype.buildDots=function(){var e,t,i=this;if(!0===i.options.dots&&i.slideCount>i.options.slidesToShow){for(i.$slider.addClass("slick-dotted"),t=c("<ul />").addClass(i.options.dotsClass),e=0;e<=i.getDotCount();e+=1)t.append(c("<li />").append(i.options.customPaging.call(this,i,e)));i.$dots=t.appendTo(i.options.appendDots),i.$dots.find("li").first().addClass("slick-active")}},o.prototype.buildOut=function(){var e=this;e.$slides=e.$slider.children(e.options.slide+":not(.slick-cloned)").addClass("slick-slide"),e.slideCount=e.$slides.length,e.$slides.each(function(e,t){c(t).attr("data-slick-index",e).data("originalStyling",c(t).attr("style")||"")}),e.$slider.addClass("slick-slider"),e.$slideTrack=0===e.slideCount?c('<div class="slick-track"/>').appendTo(e.$slider):e.$slides.wrapAll('<div class="slick-track"/>').parent(),e.$list=e.$slideTrack.wrap('<div class="slick-list"/>').parent(),e.$slideTrack.css("opacity",0),!0!==e.options.centerMode&&!0!==e.options.swipeToSlide||(e.options.slidesToScroll=1),c("img[data-lazy]",e.$slider).not("[src]").addClass("slick-loading"),e.setupInfinite(),e.buildArrows(),e.buildDots(),e.updateDots(),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),!0===e.options.draggable&&e.$list.addClass("draggable")},o.prototype.buildRows=function(){var e,t,i,r=this,n=document.createDocumentFragment(),o=r.$slider.children();if(0<r.options.rows){for(i=r.options.slidesPerRow*r.options.rows,t=Math.ceil(o.length/i),e=0;e<t;e++){for(var a=document.createElement("div"),s=0;s<r.options.rows;s++){for(var l=document.createElement("div"),c=0;c<r.options.slidesPerRow;c++){var h=e*i+(s*r.options.slidesPerRow+c);o.get(h)&&l.appendChild(o.get(h))}a.appendChild(l)}n.appendChild(a)}r.$slider.empty().append(n),r.$slider.children().children().children().css({width:100/r.options.slidesPerRow+"%",display:"inline-block"})}},o.prototype.checkResponsive=function(e,t){var i,r,n,o=this,a=!1,s=o.$slider.width(),l=window.innerWidth||c(window).width();if("window"===o.respondTo?n=l:"slider"===o.respondTo?n=s:"min"===o.respondTo&&(n=Math.min(l,s)),o.options.responsive&&o.options.responsive.length&&null!==o.options.responsive){for(i in r=null,o.breakpoints)o.breakpoints.hasOwnProperty(i)&&(!1===o.originalSettings.mobileFirst?n<o.breakpoints[i]&&(r=o.breakpoints[i]):n>o.breakpoints[i]&&(r=o.breakpoints[i]));null!==r?null!==o.activeBreakpoint&&r===o.activeBreakpoint&&!t||(o.activeBreakpoint=r,"unslick"===o.breakpointSettings[r]?o.unslick(r):(o.options=c.extend({},o.originalSettings,o.breakpointSettings[r]),!0===e&&(o.currentSlide=o.options.initialSlide),o.refresh(e)),a=r):null!==o.activeBreakpoint&&(o.activeBreakpoint=null,o.options=o.originalSettings,!0===e&&(o.currentSlide=o.options.initialSlide),o.refresh(e),a=r),e||!1===a||o.$slider.trigger("breakpoint",[o,a])}},o.prototype.changeSlide=function(e,t){var i,r=this,n=c(e.currentTarget);switch(n.is("a")&&e.preventDefault(),n.is("li")||(n=n.closest("li")),i=r.slideCount%r.options.slidesToScroll!=0?0:(r.slideCount-r.currentSlide)%r.options.slidesToScroll,e.data.message){case"previous":o=0==i?r.options.slidesToScroll:r.options.slidesToShow-i,r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide-o,!1,t);break;case"next":o=0==i?r.options.slidesToScroll:i,r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide+o,!1,t);break;case"index":var o=0===e.data.index?0:e.data.index||n.index()*r.options.slidesToScroll;r.slideHandler(r.checkNavigable(o),!1,t),n.children().trigger("focus");break;default:return}},o.prototype.checkNavigable=function(e){var t=this.getNavigableIndexes(),i=0;if(e>t[t.length-1])e=t[t.length-1];else for(var r in t){if(e<t[r]){e=i;break}i=t[r]}return e},o.prototype.cleanUpEvents=function(){var e=this;e.options.dots&&null!==e.$dots&&(c("li",e.$dots).off("click.slick",e.changeSlide).off("mouseenter.slick",c.proxy(e.interrupt,e,!0)).off("mouseleave.slick",c.proxy(e.interrupt,e,!1)),!0===e.options.accessibility)&&e.$dots.off("keydown.slick",e.keyHandler),e.$slider.off("focus.slick blur.slick"),!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow&&e.$prevArrow.off("click.slick",e.changeSlide),e.$nextArrow&&e.$nextArrow.off("click.slick",e.changeSlide),!0===e.options.accessibility)&&(e.$prevArrow&&e.$prevArrow.off("keydown.slick",e.keyHandler),e.$nextArrow)&&e.$nextArrow.off("keydown.slick",e.keyHandler),e.$list.off("touchstart.slick mousedown.slick",e.swipeHandler),e.$list.off("touchmove.slick mousemove.slick",e.swipeHandler),e.$list.off("touchend.slick mouseup.slick",e.swipeHandler),e.$list.off("touchcancel.slick mouseleave.slick",e.swipeHandler),e.$list.off("click.slick",e.clickHandler),c(document).off(e.visibilityChange,e.visibility),e.cleanUpSlideEvents(),!0===e.options.accessibility&&e.$list.off("keydown.slick",e.keyHandler),!0===e.options.focusOnSelect&&c(e.$slideTrack).children().off("click.slick",e.selectHandler),c(window).off("orientationchange.slick.slick-"+e.instanceUid,e.orientationChange),c(window).off("resize.slick.slick-"+e.instanceUid,e.resize),c("[draggable!=true]",e.$slideTrack).off("dragstart",e.preventDefault),c(window).off("load.slick.slick-"+e.instanceUid,e.setPosition)},o.prototype.cleanUpSlideEvents=function(){this.$list.off("mouseenter.slick",c.proxy(this.interrupt,this,!0)),this.$list.off("mouseleave.slick",c.proxy(this.interrupt,this,!1))},o.prototype.cleanUpRows=function(){var e;0<this.options.rows&&((e=this.$slides.children().children()).removeAttr("style"),this.$slider.empty().append(e))},o.prototype.clickHandler=function(e){!1===this.shouldClick&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},o.prototype.destroy=function(e){var t=this;t.autoPlayClear(),t.touchObject={},t.cleanUpEvents(),c(".slick-cloned",t.$slider).detach(),t.$dots&&t.$dots.remove(),t.$prevArrow&&t.$prevArrow.length&&(t.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.prevArrow))&&t.$prevArrow.remove(),t.$nextArrow&&t.$nextArrow.length&&(t.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.nextArrow))&&t.$nextArrow.remove(),t.$slides&&(t.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){c(this).attr("style",c(this).data("originalStyling"))}),t.$slideTrack.children(this.options.slide).detach(),t.$slideTrack.detach(),t.$list.detach(),t.$slider.append(t.$slides)),t.cleanUpRows(),t.$slider.removeClass("slick-slider"),t.$slider.removeClass("slick-initialized"),t.$slider.removeClass("slick-dotted"),t.unslicked=!0,e||t.$slider.trigger("destroy",[t])},o.prototype.disableTransition=function(e){var t={};t[this.transitionType]="",(!1===this.options.fade?this.$slideTrack:this.$slides.eq(e)).css(t)},o.prototype.fadeSlide=function(e,t){var i=this;!1===i.cssTransitions?(i.$slides.eq(e).css({zIndex:i.options.zIndex}),i.$slides.eq(e).animate({opacity:1},i.options.speed,i.options.easing,t)):(i.applyTransition(e),i.$slides.eq(e).css({opacity:1,zIndex:i.options.zIndex}),t&&setTimeout(function(){i.disableTransition(e),t.call()},i.options.speed))},o.prototype.fadeSlideOut=function(e){!1===this.cssTransitions?this.$slides.eq(e).animate({opacity:0,zIndex:this.options.zIndex-2},this.options.speed,this.options.easing):(this.applyTransition(e),this.$slides.eq(e).css({opacity:0,zIndex:this.options.zIndex-2}))},o.prototype.filterSlides=o.prototype.slickFilter=function(e){null!==e&&(this.$slidesCache=this.$slides,this.unload(),this.$slideTrack.children(this.options.slide).detach(),this.$slidesCache.filter(e).appendTo(this.$slideTrack),this.reinit())},o.prototype.focusHandler=function(){var i=this;i.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*",function(e){e.stopImmediatePropagation();var t=c(this);setTimeout(function(){i.options.pauseOnFocus&&(i.focussed=t.is(":focus"),i.autoPlay())},0)})},o.prototype.getCurrent=o.prototype.slickCurrentSlide=function(){return this.currentSlide},o.prototype.getDotCount=function(){var e=this,t=0,i=0,r=0;if(!0===e.options.infinite)if(e.slideCount<=e.options.slidesToShow)++r;else for(;t<e.slideCount;)++r,t=i+e.options.slidesToScroll,i+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;else if(!0===e.options.centerMode)r=e.slideCount;else if(e.options.asNavFor)for(;t<e.slideCount;)++r,t=i+e.options.slidesToScroll,i+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;else r=1+Math.ceil((e.slideCount-e.options.slidesToShow)/e.options.slidesToScroll);return r-1},o.prototype.getLeft=function(e){var t,i,r=this,n=0;return r.slideOffset=0,t=r.$slides.first().outerHeight(!0),!0===r.options.infinite?(r.slideCount>r.options.slidesToShow&&(r.slideOffset=r.slideWidth*r.options.slidesToShow*-1,i=-1,!0===r.options.vertical&&!0===r.options.centerMode&&(2===r.options.slidesToShow?i=-1.5:1===r.options.slidesToShow&&(i=-2)),n=t*r.options.slidesToShow*i),r.slideCount%r.options.slidesToScroll!=0&&e+r.options.slidesToScroll>r.slideCount&&r.slideCount>r.options.slidesToShow&&(n=e>r.slideCount?(r.slideOffset=(r.options.slidesToShow-(e-r.slideCount))*r.slideWidth*-1,(r.options.slidesToShow-(e-r.slideCount))*t*-1):(r.slideOffset=r.slideCount%r.options.slidesToScroll*r.slideWidth*-1,r.slideCount%r.options.slidesToScroll*t*-1))):e+r.options.slidesToShow>r.slideCount&&(r.slideOffset=(e+r.options.slidesToShow-r.slideCount)*r.slideWidth,n=(e+r.options.slidesToShow-r.slideCount)*t),r.slideCount<=r.options.slidesToShow&&(n=r.slideOffset=0),!0===r.options.centerMode&&r.slideCount<=r.options.slidesToShow?r.slideOffset=r.slideWidth*Math.floor(r.options.slidesToShow)/2-r.slideWidth*r.slideCount/2:!0===r.options.centerMode&&!0===r.options.infinite?r.slideOffset+=r.slideWidth*Math.floor(r.options.slidesToShow/2)-r.slideWidth:!0===r.options.centerMode&&(r.slideOffset=0,r.slideOffset+=r.slideWidth*Math.floor(r.options.slidesToShow/2)),i=!1===r.options.vertical?e*r.slideWidth*-1+r.slideOffset:e*t*-1+n,!0===r.options.variableWidth&&(t=r.slideCount<=r.options.slidesToShow||!1===r.options.infinite?r.$slideTrack.children(".slick-slide").eq(e):r.$slideTrack.children(".slick-slide").eq(e+r.options.slidesToShow),i=!0===r.options.rtl?t[0]?-1*(r.$slideTrack.width()-t[0].offsetLeft-t.width()):0:t[0]?-1*t[0].offsetLeft:0,!0===r.options.centerMode)&&(t=r.slideCount<=r.options.slidesToShow||!1===r.options.infinite?r.$slideTrack.children(".slick-slide").eq(e):r.$slideTrack.children(".slick-slide").eq(e+r.options.slidesToShow+1),i=!0===r.options.rtl?t[0]?-1*(r.$slideTrack.width()-t[0].offsetLeft-t.width()):0:t[0]?-1*t[0].offsetLeft:0,i+=(r.$list.width()-t.outerWidth())/2),i},o.prototype.getOption=o.prototype.slickGetOption=function(e){return this.options[e]},o.prototype.getNavigableIndexes=function(){for(var e=this,t=0,i=0,r=[],n=!1===e.options.infinite?e.slideCount:(t=-1*e.options.slidesToScroll,i=-1*e.options.slidesToScroll,2*e.slideCount);t<n;)r.push(t),t=i+e.options.slidesToScroll,i+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;return r},o.prototype.getSlick=function(){return this},o.prototype.getSlideCount=function(){var i,r=this,n=!0===r.options.centerMode?r.slideWidth*Math.floor(r.options.slidesToShow/2):0;return!0===r.options.swipeToSlide?(r.$slideTrack.find(".slick-slide").each(function(e,t){if(t.offsetLeft-n+c(t).outerWidth()/2>-1*r.swipeLeft)return i=t,!1}),Math.abs(c(i).attr("data-slick-index")-r.currentSlide)||1):r.options.slidesToScroll},o.prototype.goTo=o.prototype.slickGoTo=function(e,t){this.changeSlide({data:{message:"index",index:parseInt(e)}},t)},o.prototype.init=function(e){var t=this;c(t.$slider).hasClass("slick-initialized")||(c(t.$slider).addClass("slick-initialized"),t.buildRows(),t.buildOut(),t.setProps(),t.startLoad(),t.loadSlider(),t.initializeEvents(),t.updateArrows(),t.updateDots(),t.checkResponsive(!0),t.focusHandler()),e&&t.$slider.trigger("init",[t]),!0===t.options.accessibility&&t.initADA(),t.options.autoplay&&(t.paused=!1,t.autoPlay())},o.prototype.initADA=function(){var i=this,r=Math.ceil(i.slideCount/i.options.slidesToShow),n=i.getNavigableIndexes().filter(function(e){return 0<=e&&e<i.slideCount});i.$slides.add(i.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),null!==i.$dots&&(i.$slides.not(i.$slideTrack.find(".slick-cloned")).each(function(e){var t=n.indexOf(e);c(this).attr({role:"tabpanel",id:"slick-slide"+i.instanceUid+e,tabindex:-1}),-1!==t&&(e="slick-slide-control"+i.instanceUid+t,c("#"+e).length)&&c(this).attr({"aria-describedby":e})}),i.$dots.attr("role","tablist").find("li").each(function(e){var t=n[e];c(this).attr({role:"presentation"}),c(this).find("button").first().attr({role:"tab",id:"slick-slide-control"+i.instanceUid+e,"aria-controls":"slick-slide"+i.instanceUid+t,"aria-label":e+1+" of "+r,"aria-selected":null,tabindex:"-1"})}).eq(i.currentSlide).find("button").attr({"aria-selected":"true",tabindex:"0"}).end());for(var e=i.currentSlide,t=e+i.options.slidesToShow;e<t;e++)i.options.focusOnChange?i.$slides.eq(e).attr({tabindex:"0"}):i.$slides.eq(e).removeAttr("tabindex");i.activateADA()},o.prototype.initArrowEvents=function(){var e=this;!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},e.changeSlide),e.$nextArrow.off("click.slick").on("click.slick",{message:"next"},e.changeSlide),!0===e.options.accessibility)&&(e.$prevArrow.on("keydown.slick",e.keyHandler),e.$nextArrow.on("keydown.slick",e.keyHandler))},o.prototype.initDotEvents=function(){var e=this;!0===e.options.dots&&e.slideCount>e.options.slidesToShow&&(c("li",e.$dots).on("click.slick",{message:"index"},e.changeSlide),!0===e.options.accessibility)&&e.$dots.on("keydown.slick",e.keyHandler),!0===e.options.dots&&!0===e.options.pauseOnDotsHover&&e.slideCount>e.options.slidesToShow&&c("li",e.$dots).on("mouseenter.slick",c.proxy(e.interrupt,e,!0)).on("mouseleave.slick",c.proxy(e.interrupt,e,!1))},o.prototype.initSlideEvents=function(){this.options.pauseOnHover&&(this.$list.on("mouseenter.slick",c.proxy(this.interrupt,this,!0)),this.$list.on("mouseleave.slick",c.proxy(this.interrupt,this,!1)))},o.prototype.initializeEvents=function(){var e=this;e.initArrowEvents(),e.initDotEvents(),e.initSlideEvents(),e.$list.on("touchstart.slick mousedown.slick",{action:"start"},e.swipeHandler),e.$list.on("touchmove.slick mousemove.slick",{action:"move"},e.swipeHandler),e.$list.on("touchend.slick mouseup.slick",{action:"end"},e.swipeHandler),e.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},e.swipeHandler),e.$list.on("click.slick",e.clickHandler),c(document).on(e.visibilityChange,c.proxy(e.visibility,e)),!0===e.options.accessibility&&e.$list.on("keydown.slick",e.keyHandler),!0===e.options.focusOnSelect&&c(e.$slideTrack).children().on("click.slick",e.selectHandler),c(window).on("orientationchange.slick.slick-"+e.instanceUid,c.proxy(e.orientationChange,e)),c(window).on("resize.slick.slick-"+e.instanceUid,c.proxy(e.resize,e)),c("[draggable!=true]",e.$slideTrack).on("dragstart",e.preventDefault),c(window).on("load.slick.slick-"+e.instanceUid,e.setPosition),c(e.setPosition)},o.prototype.initUI=function(){!0===this.options.arrows&&this.slideCount>this.options.slidesToShow&&(this.$prevArrow.show(),this.$nextArrow.show()),!0===this.options.dots&&this.slideCount>this.options.slidesToShow&&this.$dots.show()},o.prototype.keyHandler=function(e){e.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===e.keyCode&&!0===this.options.accessibility?this.changeSlide({data:{message:!0===this.options.rtl?"next":"previous"}}):39===e.keyCode&&!0===this.options.accessibility&&this.changeSlide({data:{message:!0===this.options.rtl?"previous":"next"}}))},o.prototype.lazyLoad=function(){var e,t,i,o=this;function r(e){c("img[data-lazy]",e).each(function(){var e=c(this),t=c(this).attr("data-lazy"),i=c(this).attr("data-srcset"),r=c(this).attr("data-sizes")||o.$slider.attr("data-sizes"),n=document.createElement("img");n.onload=function(){e.animate({opacity:0},100,function(){i&&(e.attr("srcset",i),r)&&e.attr("sizes",r),e.attr("src",t).animate({opacity:1},200,function(){e.removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading")}),o.$slider.trigger("lazyLoaded",[o,e,t])})},n.onerror=function(){e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),o.$slider.trigger("lazyLoadError",[o,e,t])},n.src=t})}if(!0===o.options.centerMode?i=!0===o.options.infinite?(t=o.currentSlide+(o.options.slidesToShow/2+1))+o.options.slidesToShow+2:(t=Math.max(0,o.currentSlide-(o.options.slidesToShow/2+1)),o.options.slidesToShow/2+1+2+o.currentSlide):(t=o.options.infinite?o.options.slidesToShow+o.currentSlide:o.currentSlide,i=Math.ceil(t+o.options.slidesToShow),!0===o.options.fade&&(0<t&&t--,i<=o.slideCount)&&i++),e=o.$slider.find(".slick-slide").slice(t,i),"anticipated"===o.options.lazyLoad)for(var n=t-1,a=i,s=o.$slider.find(".slick-slide"),l=0;l<o.options.slidesToScroll;l++)n<0&&(n=o.slideCount-1),e=(e=e.add(s.eq(n))).add(s.eq(a)),n--,a++;r(e),o.slideCount<=o.options.slidesToShow?r(o.$slider.find(".slick-slide")):o.currentSlide>=o.slideCount-o.options.slidesToShow?r(o.$slider.find(".slick-cloned").slice(0,o.options.slidesToShow)):0===o.currentSlide&&r(o.$slider.find(".slick-cloned").slice(-1*o.options.slidesToShow))},o.prototype.loadSlider=function(){this.setPosition(),this.$slideTrack.css({opacity:1}),this.$slider.removeClass("slick-loading"),this.initUI(),"progressive"===this.options.lazyLoad&&this.progressiveLazyLoad()},o.prototype.next=o.prototype.slickNext=function(){this.changeSlide({data:{message:"next"}})},o.prototype.orientationChange=function(){this.checkResponsive(),this.setPosition()},o.prototype.pause=o.prototype.slickPause=function(){this.autoPlayClear(),this.paused=!0},o.prototype.play=o.prototype.slickPlay=function(){this.autoPlay(),this.options.autoplay=!0,this.paused=!1,this.focussed=!1,this.interrupted=!1},o.prototype.postSlide=function(e){var t=this;t.unslicked||(t.$slider.trigger("afterChange",[t,e]),t.animating=!1,t.slideCount>t.options.slidesToShow&&t.setPosition(),t.swipeLeft=null,t.options.autoplay&&t.autoPlay(),!0===t.options.accessibility&&(t.initADA(),t.options.focusOnChange)&&c(t.$slides.get(t.currentSlide)).attr("tabindex",0).focus())},o.prototype.prev=o.prototype.slickPrev=function(){this.changeSlide({data:{message:"previous"}})},o.prototype.preventDefault=function(e){e.preventDefault()},o.prototype.progressiveLazyLoad=function(e){e=e||1;var t,i,r,n,o=this,a=c("img[data-lazy]",o.$slider);a.length?(t=a.first(),i=t.attr("data-lazy"),r=t.attr("data-srcset"),n=t.attr("data-sizes")||o.$slider.attr("data-sizes"),(a=document.createElement("img")).onload=function(){r&&(t.attr("srcset",r),n)&&t.attr("sizes",n),t.attr("src",i).removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading"),!0===o.options.adaptiveHeight&&o.setPosition(),o.$slider.trigger("lazyLoaded",[o,t,i]),o.progressiveLazyLoad()},a.onerror=function(){e<3?setTimeout(function(){o.progressiveLazyLoad(e+1)},500):(t.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),o.$slider.trigger("lazyLoadError",[o,t,i]),o.progressiveLazyLoad())},a.src=i):o.$slider.trigger("allImagesLoaded",[o])},o.prototype.refresh=function(e){var t=this,i=t.slideCount-t.options.slidesToShow;!t.options.infinite&&t.currentSlide>i&&(t.currentSlide=i),t.slideCount<=t.options.slidesToShow&&(t.currentSlide=0),i=t.currentSlide,t.destroy(!0),c.extend(t,t.initials,{currentSlide:i}),t.init(),e||t.changeSlide({data:{message:"index",index:i}},!1)},o.prototype.registerBreakpoints=function(){var e,t,i,r=this,n=r.options.responsive||null;if("array"===c.type(n)&&n.length){for(e in r.respondTo=r.options.respondTo||"window",n)if(i=r.breakpoints.length-1,n.hasOwnProperty(e)){for(t=n[e].breakpoint;0<=i;)r.breakpoints[i]&&r.breakpoints[i]===t&&r.breakpoints.splice(i,1),i--;r.breakpoints.push(t),r.breakpointSettings[t]=n[e].settings}r.breakpoints.sort(function(e,t){return r.options.mobileFirst?e-t:t-e})}},o.prototype.reinit=function(){var e=this;e.$slides=e.$slideTrack.children(e.options.slide).addClass("slick-slide"),e.slideCount=e.$slides.length,e.currentSlide>=e.slideCount&&0!==e.currentSlide&&(e.currentSlide=e.currentSlide-e.options.slidesToScroll),e.slideCount<=e.options.slidesToShow&&(e.currentSlide=0),e.registerBreakpoints(),e.setProps(),e.setupInfinite(),e.buildArrows(),e.updateArrows(),e.initArrowEvents(),e.buildDots(),e.updateDots(),e.initDotEvents(),e.cleanUpSlideEvents(),e.initSlideEvents(),e.checkResponsive(!1,!0),!0===e.options.focusOnSelect&&c(e.$slideTrack).children().on("click.slick",e.selectHandler),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.setPosition(),e.focusHandler(),e.paused=!e.options.autoplay,e.autoPlay(),e.$slider.trigger("reInit",[e])},o.prototype.resize=function(){var e=this;c(window).width()!==e.windowWidth&&(clearTimeout(e.windowDelay),e.windowDelay=window.setTimeout(function(){e.windowWidth=c(window).width(),e.checkResponsive(),e.unslicked||e.setPosition()},50))},o.prototype.removeSlide=o.prototype.slickRemove=function(e,t,i){var r=this;if(e="boolean"==typeof e?!0===(t=e)?0:r.slideCount-1:!0===t?--e:e,r.slideCount<1||e<0||e>r.slideCount-1)return!1;r.unload(),(!0===i?r.$slideTrack.children():r.$slideTrack.children(this.options.slide).eq(e)).remove(),r.$slides=r.$slideTrack.children(this.options.slide),r.$slideTrack.children(this.options.slide).detach(),r.$slideTrack.append(r.$slides),r.$slidesCache=r.$slides,r.reinit()},o.prototype.setCSS=function(e){var t,i,r=this,n={};!0===r.options.rtl&&(e=-e),t="left"==r.positionProp?Math.ceil(e)+"px":"0px",i="top"==r.positionProp?Math.ceil(e)+"px":"0px",n[r.positionProp]=e,!1!==r.transformsEnabled&&(!(n={})===r.cssTransitions?n[r.animType]="translate("+t+", "+i+")":n[r.animType]="translate3d("+t+", "+i+", 0px)"),r.$slideTrack.css(n)},o.prototype.setDimensions=function(){var e=this,t=(!1===e.options.vertical?!0===e.options.centerMode&&e.$list.css({padding:"0px "+e.options.centerPadding}):(e.$list.height(e.$slides.first().outerHeight(!0)*e.options.slidesToShow),!0===e.options.centerMode&&e.$list.css({padding:e.options.centerPadding+" 0px"})),e.listWidth=e.$list.width(),e.listHeight=e.$list.height(),!1===e.options.vertical&&!1===e.options.variableWidth?(e.slideWidth=Math.ceil(e.listWidth/e.options.slidesToShow),e.$slideTrack.width(Math.ceil(e.slideWidth*e.$slideTrack.children(".slick-slide").length))):!0===e.options.variableWidth?e.$slideTrack.width(5e3*e.slideCount):(e.slideWidth=Math.ceil(e.listWidth),e.$slideTrack.height(Math.ceil(e.$slides.first().outerHeight(!0)*e.$slideTrack.children(".slick-slide").length))),e.$slides.first().outerWidth(!0)-e.$slides.first().width());!1===e.options.variableWidth&&e.$slideTrack.children(".slick-slide").width(e.slideWidth-t)},o.prototype.setFade=function(){var i,r=this;r.$slides.each(function(e,t){i=r.slideWidth*e*-1,!0===r.options.rtl?c(t).css({position:"relative",right:i,top:0,zIndex:r.options.zIndex-2,opacity:0}):c(t).css({position:"relative",left:i,top:0,zIndex:r.options.zIndex-2,opacity:0})}),r.$slides.eq(r.currentSlide).css({zIndex:r.options.zIndex-1,opacity:1})},o.prototype.setHeight=function(){var e;1===this.options.slidesToShow&&!0===this.options.adaptiveHeight&&!1===this.options.vertical&&(e=this.$slides.eq(this.currentSlide).outerHeight(!0),this.$list.css("height",e))},o.prototype.setOption=o.prototype.slickSetOption=function(){var e,t,i,r,n,o=this,a=!1;if("object"===c.type(arguments[0])?(i=arguments[0],a=arguments[1],n="multiple"):"string"===c.type(arguments[0])&&(i=arguments[0],r=arguments[1],a=arguments[2],"responsive"===arguments[0]&&"array"===c.type(arguments[1])?n="responsive":void 0!==arguments[1]&&(n="single")),"single"===n)o.options[i]=r;else if("multiple"===n)c.each(i,function(e,t){o.options[e]=t});else if("responsive"===n)for(t in r)if("array"!==c.type(o.options.responsive))o.options.responsive=[r[t]];else{for(e=o.options.responsive.length-1;0<=e;)o.options.responsive[e].breakpoint===r[t].breakpoint&&o.options.responsive.splice(e,1),e--;o.options.responsive.push(r[t])}a&&(o.unload(),o.reinit())},o.prototype.setPosition=function(){this.setDimensions(),this.setHeight(),!1===this.options.fade?this.setCSS(this.getLeft(this.currentSlide)):this.setFade(),this.$slider.trigger("setPosition",[this])},o.prototype.setProps=function(){var e=this,t=document.body.style;e.positionProp=!0===e.options.vertical?"top":"left","top"===e.positionProp?e.$slider.addClass("slick-vertical"):e.$slider.removeClass("slick-vertical"),void 0===t.WebkitTransition&&void 0===t.MozTransition&&void 0===t.msTransition||!0===e.options.useCSS&&(e.cssTransitions=!0),e.options.fade&&("number"==typeof e.options.zIndex?e.options.zIndex<3&&(e.options.zIndex=3):e.options.zIndex=e.defaults.zIndex),void 0!==t.OTransform&&(e.animType="OTransform",e.transformType="-o-transform",e.transitionType="OTransition",void 0===t.perspectiveProperty)&&void 0===t.webkitPerspective&&(e.animType=!1),void 0!==t.MozTransform&&(e.animType="MozTransform",e.transformType="-moz-transform",e.transitionType="MozTransition",void 0===t.perspectiveProperty)&&void 0===t.MozPerspective&&(e.animType=!1),void 0!==t.webkitTransform&&(e.animType="webkitTransform",e.transformType="-webkit-transform",e.transitionType="webkitTransition",void 0===t.perspectiveProperty)&&void 0===t.webkitPerspective&&(e.animType=!1),void 0!==t.msTransform&&(e.animType="msTransform",e.transformType="-ms-transform",e.transitionType="msTransition",void 0===t.msTransform)&&(e.animType=!1),void 0!==t.transform&&!1!==e.animType&&(e.animType="transform",e.transformType="transform",e.transitionType="transition"),e.transformsEnabled=e.options.useTransform&&null!==e.animType&&!1!==e.animType},o.prototype.setSlideClasses=function(e){var t,i,r,n=this,o=n.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true");n.$slides.eq(e).addClass("slick-current"),!0===n.options.centerMode?(i=n.options.slidesToShow%2==0?1:0,r=Math.floor(n.options.slidesToShow/2),!0===n.options.infinite&&((r<=e&&e<=n.slideCount-1-r?n.$slides.slice(e-r+i,e+r+1):(t=n.options.slidesToShow+e,o.slice(t-r+1+i,t+r+2))).addClass("slick-active").attr("aria-hidden","false"),0===e?o.eq(o.length-1-n.options.slidesToShow).addClass("slick-center"):e===n.slideCount-1&&o.eq(n.options.slidesToShow).addClass("slick-center")),n.$slides.eq(e).addClass("slick-center")):(0<=e&&e<=n.slideCount-n.options.slidesToShow?n.$slides.slice(e,e+n.options.slidesToShow):o.length<=n.options.slidesToShow?o:(i=n.slideCount%n.options.slidesToShow,t=!0===n.options.infinite?n.options.slidesToShow+e:e,n.options.slidesToShow==n.options.slidesToScroll&&n.slideCount-e<n.options.slidesToShow?o.slice(t-(n.options.slidesToShow-i),t+i):o.slice(t,t+n.options.slidesToShow))).addClass("slick-active").attr("aria-hidden","false"),"ondemand"!==n.options.lazyLoad&&"anticipated"!==n.options.lazyLoad||n.lazyLoad()},o.prototype.setupInfinite=function(){var e,t,i,r=this;if(!0===r.options.fade&&(r.options.centerMode=!1),!0===r.options.infinite&&!1===r.options.fade&&(t=null,r.slideCount>r.options.slidesToShow)){for(i=!0===r.options.centerMode?r.options.slidesToShow+1:r.options.slidesToShow,e=r.slideCount;e>r.slideCount-i;--e)c(r.$slides[t=e-1]).clone(!0).attr("id","").attr("data-slick-index",t-r.slideCount).prependTo(r.$slideTrack).addClass("slick-cloned");for(e=0;e<i+r.slideCount;e+=1)t=e,c(r.$slides[t]).clone(!0).attr("id","").attr("data-slick-index",t+r.slideCount).appendTo(r.$slideTrack).addClass("slick-cloned");r.$slideTrack.find(".slick-cloned").find("[id]").each(function(){c(this).attr("id","")})}},o.prototype.interrupt=function(e){e||this.autoPlay(),this.interrupted=e},o.prototype.selectHandler=function(e){e=c(e.target).is(".slick-slide")?c(e.target):c(e.target).parents(".slick-slide"),e=(e=parseInt(e.attr("data-slick-index")))||0;this.slideCount<=this.options.slidesToShow?this.slideHandler(e,!1,!0):this.slideHandler(e)},o.prototype.slideHandler=function(e,t,i){var r,n,o,a=this;t=t||!1,!0===a.animating&&!0===a.options.waitForAnimate||!0===a.options.fade&&a.currentSlide===e||(!1===t&&a.asNavFor(e),r=e,t=a.getLeft(r),o=a.getLeft(a.currentSlide),a.currentLeft=null===a.swipeLeft?o:a.swipeLeft,!1===a.options.infinite&&!1===a.options.centerMode&&(e<0||e>a.getDotCount()*a.options.slidesToScroll)||!1===a.options.infinite&&!0===a.options.centerMode&&(e<0||e>a.slideCount-a.options.slidesToScroll)?!1===a.options.fade&&(r=a.currentSlide,!0!==i&&a.slideCount>a.options.slidesToShow?a.animateSlide(o,function(){a.postSlide(r)}):a.postSlide(r)):(a.options.autoplay&&clearInterval(a.autoPlayTimer),n=r<0?a.slideCount%a.options.slidesToScroll!=0?a.slideCount-a.slideCount%a.options.slidesToScroll:a.slideCount+r:r>=a.slideCount?a.slideCount%a.options.slidesToScroll!=0?0:r-a.slideCount:r,a.animating=!0,a.$slider.trigger("beforeChange",[a,a.currentSlide,n]),e=a.currentSlide,a.currentSlide=n,a.setSlideClasses(a.currentSlide),a.options.asNavFor&&(o=(o=a.getNavTarget()).slick("getSlick")).slideCount<=o.options.slidesToShow&&o.setSlideClasses(a.currentSlide),a.updateDots(),a.updateArrows(),!0===a.options.fade?(!0!==i?(a.fadeSlideOut(e),a.fadeSlide(n,function(){a.postSlide(n)})):a.postSlide(n),a.animateHeight()):!0!==i&&a.slideCount>a.options.slidesToShow?a.animateSlide(t,function(){a.postSlide(n)}):a.postSlide(n)))},o.prototype.startLoad=function(){var e=this;!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.hide(),e.$nextArrow.hide()),!0===e.options.dots&&e.slideCount>e.options.slidesToShow&&e.$dots.hide(),e.$slider.addClass("slick-loading")},o.prototype.swipeDirection=function(){var e=this.touchObject.startX-this.touchObject.curX,t=this.touchObject.startY-this.touchObject.curY,t=Math.atan2(t,e),e=Math.round(180*t/Math.PI);return(e=e<0?360-Math.abs(e):e)<=45&&0<=e||e<=360&&315<=e?!1===this.options.rtl?"left":"right":135<=e&&e<=225?!1===this.options.rtl?"right":"left":!0===this.options.verticalSwiping?35<=e&&e<=135?"down":"up":"vertical"},o.prototype.swipeEnd=function(e){var t,i,r=this;if(r.dragging=!1,r.swiping=!1,r.scrolling)return r.scrolling=!1;if(r.interrupted=!1,r.shouldClick=!(10<r.touchObject.swipeLength),void 0===r.touchObject.curX)return!1;if(!0===r.touchObject.edgeHit&&r.$slider.trigger("edge",[r,r.swipeDirection()]),r.touchObject.swipeLength>=r.touchObject.minSwipe){switch(i=r.swipeDirection()){case"left":case"down":t=r.options.swipeToSlide?r.checkNavigable(r.currentSlide+r.getSlideCount()):r.currentSlide+r.getSlideCount(),r.currentDirection=0;break;case"right":case"up":t=r.options.swipeToSlide?r.checkNavigable(r.currentSlide-r.getSlideCount()):r.currentSlide-r.getSlideCount(),r.currentDirection=1}"vertical"!=i&&(r.slideHandler(t),r.touchObject={},r.$slider.trigger("swipe",[r,i]))}else r.touchObject.startX!==r.touchObject.curX&&(r.slideHandler(r.currentSlide),r.touchObject={})},o.prototype.swipeHandler=function(e){var t=this;if(!(!1===t.options.swipe||"ontouchend"in document&&!1===t.options.swipe||!1===t.options.draggable&&-1!==e.type.indexOf("mouse")))switch(t.touchObject.fingerCount=e.originalEvent&&void 0!==e.originalEvent.touches?e.originalEvent.touches.length:1,t.touchObject.minSwipe=t.listWidth/t.options.touchThreshold,!0===t.options.verticalSwiping&&(t.touchObject.minSwipe=t.listHeight/t.options.touchThreshold),e.data.action){case"start":t.swipeStart(e);break;case"move":t.swipeMove(e);break;case"end":t.swipeEnd(e)}},o.prototype.swipeMove=function(e){var t,i,r=this,n=void 0!==e.originalEvent?e.originalEvent.touches:null;return!(!r.dragging||r.scrolling||n&&1!==n.length)&&(t=r.getLeft(r.currentSlide),r.touchObject.curX=void 0!==n?n[0].pageX:e.clientX,r.touchObject.curY=void 0!==n?n[0].pageY:e.clientY,r.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(r.touchObject.curX-r.touchObject.startX,2))),n=Math.round(Math.sqrt(Math.pow(r.touchObject.curY-r.touchObject.startY,2))),!r.options.verticalSwiping&&!r.swiping&&4<n?!(r.scrolling=!0):(!0===r.options.verticalSwiping&&(r.touchObject.swipeLength=n),n=r.swipeDirection(),void 0!==e.originalEvent&&4<r.touchObject.swipeLength&&(r.swiping=!0,e.preventDefault()),e=(!1===r.options.rtl?1:-1)*(r.touchObject.curX>r.touchObject.startX?1:-1),!0===r.options.verticalSwiping&&(e=r.touchObject.curY>r.touchObject.startY?1:-1),i=r.touchObject.swipeLength,(r.touchObject.edgeHit=!1)===r.options.infinite&&(0===r.currentSlide&&"right"===n||r.currentSlide>=r.getDotCount()&&"left"===n)&&(i=r.touchObject.swipeLength*r.options.edgeFriction,r.touchObject.edgeHit=!0),!1===r.options.vertical?r.swipeLeft=t+i*e:r.swipeLeft=t+i*(r.$list.height()/r.listWidth)*e,!0===r.options.verticalSwiping&&(r.swipeLeft=t+i*e),!0!==r.options.fade&&!1!==r.options.touchMove&&(!0===r.animating?(r.swipeLeft=null,!1):void r.setCSS(r.swipeLeft))))},o.prototype.swipeStart=function(e){var t,i=this;if(i.interrupted=!0,1!==i.touchObject.fingerCount||i.slideCount<=i.options.slidesToShow)return!(i.touchObject={});void 0!==e.originalEvent&&void 0!==e.originalEvent.touches&&(t=e.originalEvent.touches[0]),i.touchObject.startX=i.touchObject.curX=void 0!==t?t.pageX:e.clientX,i.touchObject.startY=i.touchObject.curY=void 0!==t?t.pageY:e.clientY,i.dragging=!0},o.prototype.unfilterSlides=o.prototype.slickUnfilter=function(){null!==this.$slidesCache&&(this.unload(),this.$slideTrack.children(this.options.slide).detach(),this.$slidesCache.appendTo(this.$slideTrack),this.reinit())},o.prototype.unload=function(){var e=this;c(".slick-cloned",e.$slider).remove(),e.$dots&&e.$dots.remove(),e.$prevArrow&&e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.remove(),e.$nextArrow&&e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.remove(),e.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},o.prototype.unslick=function(e){this.$slider.trigger("unslick",[this,e]),this.destroy()},o.prototype.updateArrows=function(){var e=this;Math.floor(e.options.slidesToShow/2);!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&!e.options.infinite&&(e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===e.currentSlide?(e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):(e.currentSlide>=e.slideCount-e.options.slidesToShow&&!1===e.options.centerMode||e.currentSlide>=e.slideCount-1&&!0===e.options.centerMode)&&(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},o.prototype.updateDots=function(){null!==this.$dots&&(this.$dots.find("li").removeClass("slick-active").end(),this.$dots.find("li").eq(Math.floor(this.currentSlide/this.options.slidesToScroll)).addClass("slick-active"))},o.prototype.visibility=function(){this.options.autoplay&&(document[this.hidden]?this.interrupted=!0:this.interrupted=!1)},c.fn.slick=function(){for(var e,t=arguments[0],i=Array.prototype.slice.call(arguments,1),r=this.length,n=0;n<r;n++)if("object"==typeof t||void 0===t?this[n].slick=new o(this[n],t):e=this[n].slick[t].apply(this[n].slick,i),void 0!==e)return e;return this}});